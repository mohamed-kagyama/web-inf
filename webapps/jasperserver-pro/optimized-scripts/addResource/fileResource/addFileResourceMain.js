/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define("runtime_dependencies/jrs-ui/src/resource/resource.locate",["require","exports","module","prototype","underscore","./resource.base","../components/components.pickers","jquery"],function(e,t,i){var s=e("prototype"),r=s.$,o=e("underscore"),n=e("./resource.base"),a=e("../components/components.pickers"),l=e("jquery"),d={CONTENT_REPOSITORY:"CONTENT_REPOSITORY",LOCAL:"LOCAL",NONE:"NONE",FILE_SYSTEM:"FILE_SYSTEM",LOCATE_EVENT:"resource:locate",ALLOWED_FILE_RESOURCE_EXTENSIONS:["css","ttf","jpg","jpeg","gif","bmp","png","jar","jrxml","properties","jrtx","xml","agxml","docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html"],initialize:function(e){var t=function(e){return o.isObject(e)?e:r(e)};this.resourceUri=t(e.resourceInput),this.browseButton=t(e.browseButton),this.filePath=t(e.fileUploadInput),this.fakeFilePath=t(e.fakeFileUploadInput),this.fakeFileInput=t(e.fakeFileUploadInputText),this.newResourceLink=t(e.newResourceLink);try{this._initFileSelector(e)}catch(e){}finally{this._initEvents(e)}return this},_initEvents:function(e){l(document).on("click","#CONTENT_REPOSITORY, #FILE_SYSTEM, #NONE, #LOCAL",this._clickHandler),"fileResourceTreeDataProvider"===e.providerId&&(l("#next").on("click",d._nextClickHandler),l("#filePath").on("change",d._uploadChangeHandler))},_nextClickHandler:function(e){l("#fileUpload").hasClass("error")&&e.preventDefault()},_uploadChangeHandler:function(e){l("#fileUpload").removeClass("error");var t=!0;if(l("#filePath")[0].value){var i=l("#filePath")[0].value.match(/.*\.([^\.]+)$/);if(i){var s=i[1];o.indexOf(d.ALLOWED_FILE_RESOURCE_EXTENSIONS,s)<0&&(t=!1)}else t=!1}else t=!1;if(!t){var r=n.messages["resource.report.unsupportedFileType.error"]+" "+d.ALLOWED_FILE_RESOURCE_EXTENSIONS.join(", ");l("#fileUpload").addClass("error").find("span.warning").html(r)}},_clickHandler:function(e){d._updateResourceSelectorState(e.target.id)},_updateResourceSelectorState:function(e){n.switchButtonState(this.filePath,e===this.FILE_SYSTEM),n.switchButtonState(this.fakeFilePath,e===this.FILE_SYSTEM),n.switchButtonState(this.fakeFileInput,e===this.FILE_SYSTEM),n.switchButtonState(this.browseButton,e===this.CONTENT_REPOSITORY),n.switchDisableState(this.resourceUri,e!==this.CONTENT_REPOSITORY);var t=e===this.LOCAL?["disabled","launcher"]:[];this._switchElementClasses(this.newResourceLink,t)},_initFileSelector:function(e){this.fileSelector=new a.FileSelector(o.extend({},e,{uriTextboxId:this.resourceUri,browseButtonId:this.browseButton,title:e.dialogTitle}))},remove:function(e){this.fileSelector.remove()},_switchElementClasses:function(e,t){e&&t&&e.removeClassName(t[0]).addClassName(t[1])}};i.exports=d}),define("runtime_dependencies/jrs-ui/src/resource/resource.add.files",["require","exports","module","prototype","./resource.base","../util/utils.common","../core/core.events.bis","./resource.locate"],function(e,t,i){var s=e("prototype"),r=s.$,o=s.Form,n=e("./resource.base"),a=e("../util/utils.common"),l=a.ValidationModule,d=a.matchAny,c=e("../core/core.events.bis"),u=e("./resource.locate"),h={PAGE_ID:"addResourceFile",TYPE_ID:"fileType",PATH_ID:"filePath",LABEL_ID:"addFileInputResourceLabelID",RESOURCE_ID_ID:"addFileInputResourceID",DESCRIPTION_ID:"addFileInputDescription",FOLDER_URI_ID:"folderUri",SAVE_BUTTON_ID:"save",typeToExtMap:{accessGrantSchema:["xml"],css:["css"],font:["ttf"],img:["jpg","jpeg","gif","bmp","png"],jar:["jar"],jrxml:["jrxml"],olapMondrianSchema:["xml"],prop:["properties"],jrtx:["jrtx"],xml:["xml","agxml"],config:["config"],cer:["p12","pfx"],contentResource:["docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html","txt","csv","json"],secureFile:["*"]},_canGenerateId:!0,initialize:function(e){this._form=r(this.PAGE_ID).select("form")[0],this._type=r(this.TYPE_ID),this._path=r(this.PATH_ID),this._label=r(this.LABEL_ID),this._resourceId=r(this.RESOURCE_ID_ID),this._description=r(this.DESCRIPTION_ID),this._folderUri=r(this.FOLDER_URI_ID),this._saveButton=r(this.SAVE_BUTTON_ID),this._isEditMode=e.isEditMode,this._type.validationEntry={validator:this._typeValidator.bind(this),element:this._type,onValid:function(){if(!this._manual){var e=this._getFileNameFromPath(this._path.getValue());this._label.value=e,this._resourceId.readOnly||(this._resourceId.value=n.generateResourceId(this._label.getValue()))}}.bind(this)},this._path.validator=this._pathValidator.bind(this),this._label.validator=n.labelValidator.bind(this),this._resourceId.validator=n.resourceIdValidator.bind(this),this._description.validator=n.descriptionValidator.bind(this),u.initialize({resourceInput:"folderUri",browseButton:"browser_button",treeId:"addFileTreeRepoLocation",providerId:"repositoryExplorerTreeFoldersProvider",dialogTitle:n.messages["resource.Add.Files.Title"]}),this._initEvents()},_initEvents:function(){this._saveButton.observe("click",function(e){this._isDataValid()||e.stop()}.bindAsEventListener(this)),this._type.observe("change",function(e){this._validateTypeAndPath()}.bindAsEventListener(this)),this._path.observe("change",function(e){this._validateTypeAndPath()}.bindAsEventListener(this)),this._form&&new o.Observer(this._form,.3,function(){this._folderUri.getValue().blank()?c.disable("save"):c.enable("save")}.bindAsEventListener(this)),this._form.observe("keyup",function(e){var t=e.element();[this._label,this._resourceId,this._description].include(t)&&(l.validate(n.getValidationEntries([t])),t==this._resourceId&&this._resourceId.getValue()!=n.generateResourceId(this._label.getValue())&&(this._canGenerateId=!1),t==this._label&&!this._isEditMode&&this._canGenerateId&&(this._resourceId.setValue(n.generateResourceId(this._label.getValue())),l.validate(n.getValidationEntries([this._resourceId])))),this._manual=!0}.bindAsEventListener(this)),this._form.observe("keydown",function(e){d(e.element(),["#"+this.DESCRIPTION_ID],!0)||13==e.keyCode&&this._saveButton.focus()}.bindAsEventListener(this))},_isDataValid:function(){var e=[this._label,this._resourceId,this._description,this._path,this._type];return l.validate(n.getValidationEntries(e))},_validateTypeAndPath:function(){var e=[this._type,this._path];l.validate(n.getValidationEntries(e))},_typeValidator:function(e){var t={isValid:!0,errorMessage:""},i=this._getExtension();return i.blank()?t:this.typeToExtMap[e]&&this.typeToExtMap[e].include("*")?t:(this._getTypesForExtension(i).include(e)||(t.errorMessage=n.messages.typeIsNotValid,t.isValid=!1),t)},_pathValidator:function(e){var t=!0,i="";return!this._isEditMode&&e.blank()&&(i=n.messages.pathIsEmpty,t=!1),{isValid:t,errorMessage:i}},_getTypesForExtension:function(e){var t=[];for(var i in this.typeToExtMap)this.typeToExtMap[i]&&this.typeToExtMap[i].include(e.toLowerCase())&&t.push(i);return t},_getExtension:function(){var e=this._path.getValue();if(e.blank())return"";var t=e.lastIndexOf(".");return-1==t?"":e.substr(t+1)},_getFileNameFromPath:function(e){var t=e.lastIndexOf("\\")>0?e.lastIndexOf("\\")+1:0;return e.substring(t,e.length)}};void 0===e&&document.observe("dom:loaded",function(){h.initialize(window.localContext.initOptions)}),i.exports=h}),define("runtime_dependencies/jrs-ui/src/addResource/fileResource/addFileResourceMain",["require","exports","module","requirejs-domready","../../resource/resource.add.files","underscore","runtime_dependencies/js-sdk/src/jrs.configs","../../resource/resource.base","../../util/utils.common"],function(e,t,i){var s=e("requirejs-domready"),r=e("../../resource/resource.add.files"),o=e("underscore"),n=e("runtime_dependencies/js-sdk/src/jrs.configs"),a=e("../../resource/resource.base"),l=e("../../util/utils.common"),d=l.isIPad;s(function(){var e=n.addFileResource.localContext.initOptions;o.extend(window.localContext,n.addFileResource.localContext),o.extend(a.messages,n.addFileResource.resource.messages),r.initialize(e),d()&&a.initSwipeScroll()})}),define("addResource/fileResource/addFileResourceMain",["require","exports","module","runtime_dependencies/jrs-ui/src/addResource/fileResource/addFileResourceMain"],function(e,t,i){e("runtime_dependencies/jrs-ui/src/addResource/fileResource/addFileResourceMain")});