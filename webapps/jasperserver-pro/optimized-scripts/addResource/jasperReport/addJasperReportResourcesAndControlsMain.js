/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define("runtime_dependencies/jrs-ui/src/resource/resource.locate",["require","exports","module","prototype","underscore","./resource.base","../components/components.pickers","jquery"],function(e,t,r){var i=e("prototype"),o=i.$,s=e("underscore"),n=e("./resource.base"),a=e("../components/components.pickers"),c=e("jquery"),l={CONTENT_REPOSITORY:"CONTENT_REPOSITORY",LOCAL:"LOCAL",NONE:"NONE",FILE_SYSTEM:"FILE_SYSTEM",LOCATE_EVENT:"resource:locate",ALLOWED_FILE_RESOURCE_EXTENSIONS:["css","ttf","jpg","jpeg","gif","bmp","png","jar","jrxml","properties","jrtx","xml","agxml","docx","doc","ppt","pptx","xls","xlsx","ods","odt","odp","pdf","rtf","html"],initialize:function(e){var t=function(e){return s.isObject(e)?e:o(e)};this.resourceUri=t(e.resourceInput),this.browseButton=t(e.browseButton),this.filePath=t(e.fileUploadInput),this.fakeFilePath=t(e.fakeFileUploadInput),this.fakeFileInput=t(e.fakeFileUploadInputText),this.newResourceLink=t(e.newResourceLink);try{this._initFileSelector(e)}catch(e){}finally{this._initEvents(e)}return this},_initEvents:function(e){c(document).on("click","#CONTENT_REPOSITORY, #FILE_SYSTEM, #NONE, #LOCAL",this._clickHandler),"fileResourceTreeDataProvider"===e.providerId&&(c("#next").on("click",l._nextClickHandler),c("#filePath").on("change",l._uploadChangeHandler))},_nextClickHandler:function(e){c("#fileUpload").hasClass("error")&&e.preventDefault()},_uploadChangeHandler:function(e){c("#fileUpload").removeClass("error");var t=!0;if(c("#filePath")[0].value){var r=c("#filePath")[0].value.match(/.*\.([^\.]+)$/);if(r){var i=r[1];s.indexOf(l.ALLOWED_FILE_RESOURCE_EXTENSIONS,i)<0&&(t=!1)}else t=!1}else t=!1;if(!t){var o=n.messages["resource.report.unsupportedFileType.error"]+" "+l.ALLOWED_FILE_RESOURCE_EXTENSIONS.join(", ");c("#fileUpload").addClass("error").find("span.warning").html(o)}},_clickHandler:function(e){l._updateResourceSelectorState(e.target.id)},_updateResourceSelectorState:function(e){n.switchButtonState(this.filePath,e===this.FILE_SYSTEM),n.switchButtonState(this.fakeFilePath,e===this.FILE_SYSTEM),n.switchButtonState(this.fakeFileInput,e===this.FILE_SYSTEM),n.switchButtonState(this.browseButton,e===this.CONTENT_REPOSITORY),n.switchDisableState(this.resourceUri,e!==this.CONTENT_REPOSITORY);var t=e===this.LOCAL?["disabled","launcher"]:[];this._switchElementClasses(this.newResourceLink,t)},_initFileSelector:function(e){this.fileSelector=new a.FileSelector(s.extend({},e,{uriTextboxId:this.resourceUri,browseButtonId:this.browseButton,title:e.dialogTitle}))},remove:function(e){this.fileSelector.remove()},_switchElementClasses:function(e,t){e&&t&&e.removeClassName(t[0]).addClassName(t[1])}};r.exports=l}),define("runtime_dependencies/jrs-ui/src/resource/resource.report",["require","exports","module","prototype","./resource.base","./resource.locate","../util/utils.common","jquery"],function(e,t,r){var i=e("prototype"),o=i.$,s=e("./resource.base"),n=e("./resource.locate"),a=e("../util/utils.common"),c=a.ValidationModule,l=a.isIE,u=a.isIE7,d=a.isIE8,p=a.isIE9,_=a.isIE10,h=e("jquery"),f={SET_UP_PAGE_ID:"addReport_SetUp",LABEL_ID:"label",RESOURCE_ID_ID:"resourceID",DESCRIPTION_ID:"reportUnit.description",FILE_PATH_ID:"filePath",RESOURCE_URI_ID:"resourceUri",FILE_SYSTEM_SOURCE_ID:"FILE_SYSTEM",CONTENT_REPOSITORY_SOURCE_ID:"CONTENT_REPOSITORY",RESOURCE_NAME_ID:"resourceName",EDIT_RESOURCE_BUTTON_ID:"editResourceButton",REMOVE_RESOURCE_BUTTON_ID:"removeResourceButton",ADD_RESOURCE_BUTTON_ID:"addResourceButton",EDIT_CONTROL_BUTTON_ID:"editControlButton",REMOVE_CONTROL_BUTTON_ID:"removeControlButton",ADD_CONTROL_BUTTON_ID:"addControlButton",FILE_NAME_ID:"fileName",FILE_UPLOAD_BUTTON_ID:"fake_upload_button",SAVE_BUTTON_ID:"done",JRXML_FILE_PATH_COOKIE:"jrxmlFilePath",_canGenerateId:!0,initialize:function(e){this._setUpPage=o(this.SET_UP_PAGE_ID),this._setUpPage&&(this._form=o(document.body).select("form")[0],this._label=o(this.LABEL_ID),this._resourceId=o(this.RESOURCE_ID_ID),this._description=o(this.DESCRIPTION_ID),this._filePath=o(this.FILE_PATH_ID),this._resourceUri=o(this.RESOURCE_URI_ID),this._fileName=o(this.FILE_NAME_ID),this._fileSystemSource=o(this.FILE_SYSTEM_SOURCE_ID),this._contentRepositorySource=o(this.CONTENT_REPOSITORY_SOURCE_ID),this._saveButton=o(this.SAVE_BUTTON_ID),this._isEditMode=!!e&&e.isEditMode,this._initialSource=this._fileSystemSource.checked?this._fileSystemSource:this._contentRepositorySource,this._jrxmlFileResourceAlreadyUploaded=e.jrxmlFileResourceAlreadyUploaded,this._label.validator=s.labelValidator.bind(this),this._resourceId.validator=s.resourceIdValidator.bind(this),this._description.validator=s.descriptionValidator.bind(this),this._filePath.validator=this._filePathValidator.bind(this),this._resourceUri.validator=this._resourceUriValidator.bind(this),this._initEvents(),this._adjustFileSelectorPosition(),this._fileName.value=this._jrxmlFileResourceAlreadyUploaded);var t={fileUploadInput:"filePath",fakeFileUploadInput:"fake_upload_button",fakeFileUploadInputText:"fileName",resourceInput:"resourceUri",browseButton:"browser_button",uploadButton:"upload_button",treeId:"resourceTreeRepoLocation",dialogTitle:s.messages["resource.Report.Title"],selectLeavesOnly:!0};e&&o(t.browseButton)&&("fileResource"==e.type?t.providerId="fileResourceTreeDataProvider":"jrxml"==e.type?t.providerId="jrxmlTreeDataProvider":"olapMondrianSchema"==e.type?t.providerId="olapSchemaTreeDataProvider":"folder"==e.type&&(t.treeId="addFileTreeRepoLocation",t.providerId="repositoryExplorerTreeFoldersProvider",t.resourceInput="folderUri"),n.initialize(t),n._updateResourceSelectorState(h("input[type=radio]:checked").attr("id")))},_initEvents:function(){var e=this;h("#"+this.FILE_UPLOAD_BUTTON_ID).click(function(t){t.preventDefault(),h("#"+e.FILE_PATH_ID).trigger("click")}),this._saveButton.observe("click",function(t){e._isDataValid()||t.stop()}),this._form.observe("keyup",function(t){var r=t.element();[e._label,e._resourceId,e._description].include(r)&&(c.validate(s.getValidationEntries([r])),r==e._resourceId&&e._resourceId.getValue()!=s.generateResourceId(e._label.getValue())&&(e._canGenerateId=!1),r==e._label&&!e._isEditMode&&e._canGenerateId&&(e._resourceId.setValue(s.generateResourceId(e._label.getValue())),c.validate(s.getValidationEntries([e._resourceId]))))}),this._filePath.observe("change",function(){l()?-1!=this.value.toLowerCase().indexOf("c:\\fakepath\\")?e._fileName.value=this.value.substring("c:\\fakepath\\".length,this.value.length):e._fileName.value=this.value:e._fileName.value=this.files[0].name,o("fileUpload").removeClassName("error"),e._adjustFileSelectorPosition()})},_isDataValid:function(){var e=[this._label,this._resourceId,this._description,this._filePath,this._resourceUri];return l()?this.file=this._filePath.value:this.file=this._filePath.files[0],this.html=h(this._filePath).html(),c.validate(s.getValidationEntries(e))},_filePathValidator:function(e){var t=!0,r="";return!this._fileSystemSource.checked||!e.blank()||this._isEditMode&&this._initialSource==this._fileSystemSource||this._jrxmlFileResourceAlreadyUploaded||(r=s.messages.filePathIsEmpty,t=!1),t?c.hideError(o("fileName")):c.showError(o("fileName"),r),{isValid:t,errorMessage:r}},_resourceUriValidator:function(e){var t=!0,r="";return this._contentRepositorySource.checked&&e.blank()&&(r=s.messages.resourceUriIsEmpty,t=!1),{isValid:t,errorMessage:r}},_adjustFileSelectorPosition:function(){var e=h("#filePath");if(u()||d()||p()||_()){var t=20;e.parents("label").hasClass("error")&&(t+=13),e.css({opacity:"0",position:"absolute",right:0,top:t,width:95,height:30})}else e.css({position:"fixed",right:"-1000px",top:"-1000px"})},editResource:function(e){o(this.RESOURCE_NAME_ID).setValue(e),o(this.EDIT_RESOURCE_BUTTON_ID).click()},removeResource:function(e){o(this.RESOURCE_NAME_ID).setValue(e),o(this.REMOVE_RESOURCE_BUTTON_ID).click()},addResource:function(){o(this.ADD_RESOURCE_BUTTON_ID).click()},editControl:function(e){o(this.RESOURCE_NAME_ID).setValue(e),o(this.EDIT_CONTROL_BUTTON_ID).click()},removeControl:function(e){o(this.RESOURCE_NAME_ID).setValue(e),o(this.REMOVE_CONTROL_BUTTON_ID).click()},addControl:function(){o(this.ADD_CONTROL_BUTTON_ID).click()}};void 0===e&&document.observe("dom:loaded",function(){f.initialize(window.localContext.initOptions)}),r.exports=f}),define("runtime_dependencies/jrs-ui/src/components/components.templateengine",["require","exports","module","jquery","underscore","../namespace/namespace"],function(e,t,r){var i=e("jquery"),o=e("underscore"),s=e("../namespace/namespace"),n=s.jaspersoft;n.components.templateEngine=function(e,t){return{render:function(e,r,i){if(!i)return t.template(e)(r);if(i==this.STD_PLACEHOLDERS){var o=String(e);return t.each(r,function(e,t){var r=new RegExp("\\{"+t+"\\}");o=o.replace(r,e)}),o}},renderUrl:function(e,r,i){var o=t.template(e)(r);return i&&(o=encodeURI(o)),o},getTemplateText:function(t){return e("#"+t).html()},createTemplate:function(r){var i=e("#"+r),o=i.html();if(o&&o.length>0)return function(e){return t.template(o)(e)}},createTemplateFromText:function(e){if(e&&e.length>0)return function(r){return t.template(e)(r)}},createTemplateSection:function(e,r){var i="\x3c!--#val--\x3e(\\s|\\S)*\x3c!--/val--\x3e",o=i.replace(/val/g,e),s=new RegExp(o,"g"),n=this.getTemplateText(r),a=n.match(s)[0];return function(e){return t.template(a)(e)}},STD_PLACEHOLDERS:"std_placeholder"}}(i,o),r.exports=n.components.templateEngine}),define("runtime_dependencies/jrs-ui/src/addResource/jasperReport/addJasperReportResourcesAndControlsMain",["require","exports","module","requirejs-domready","underscore","runtime_dependencies/js-sdk/src/jrs.configs","../../resource/resource.base","../../resource/resource.report","../../components/components.templateengine","jquery","../../util/utils.common"],function(e,t,r){function i(e,t){var r=h.getTemplateText("addJasperReportAddResourceTemplate"),i=f(h.render(r,t));i.find("a.launcher").on("click",function(){return _.addResource(),!1}),e.append(i)}function o(e,t){var r=h.getTemplateText("addJasperReportAddControlTemplate"),i=f(h.render(r,t));i.find("a.launcher").on("click",function(){return _.addControl(),!1}),e.append(i)}function s(e,t){var r=h.getTemplateText("addJasperReportSuggestedResourceTemplate");u.each(t,function(t){var i=f(h.render(r,u.defaults({},t,{fileType:""})));i.find("a.emphasis").on("click",function(){return _.editResource(t.name),!1}),t.located||i.find("a.launcher").on("click",function(){return _.editResource(t.name),!1}),e.append(i)})}function n(e,t){var r=h.getTemplateText("addJasperReportSuggestedControlTemplate");u.each(t,function(t){var i=f(h.render(r,t));i.find("a.emphasis").on("click",function(){return _.editControl(t.name),!1}),t.located&&i.find("a.launcher").on("click",function(){return _.removeControl(t.name),!1}),e.append(i)})}function a(e,t,r){var i=h.getTemplateText("addJasperReportNonSuggestedResourceTemplate");u.each(t,function(t){var o=f(h.render(i,t));r&&(o.find("a.emphasis").on("click",function(){return _.editResource(t.name),!1}),o.find("a.launcher").on("click",function(){return _.removeResource(t.name),!1})),e.append(o)})}function c(e,t,r){var i=h.getTemplateText("addJasperReportNonSuggestedControlTemplate");u.each(t,function(t){var o=f(h.render(i,t));r&&(o.find("a.emphasis").on("click",function(){return t.local?_.editControl(t.name):_.editControl(t.referenceURI),!1}),o.find("a.launcher").on("click",function(){return t.local?_.removeControl(t.name):_.removeControl(t.referenceURI),!1})),e.append(o)})}var l=e("requirejs-domready"),u=e("underscore"),d=e("runtime_dependencies/js-sdk/src/jrs.configs"),p=e("../../resource/resource.base"),_=e("../../resource/resource.report"),h=e("../../components/components.templateengine"),f=e("jquery"),E=e("../../util/utils.common"),R=E.isIPad;l(function(){u.extend(p.messages,d.addJasperReport.resource.messages),_.initialize(),R()&&p.initSwipeScroll();var e=f(f("#resources ul")[0]);a(e,d.addJasperReport.nonSuggestedResources,d.addJasperReport.canChangeResources),s(e,d.addJasperReport.suggestedResources),i(e,{canChangeResources:d.addJasperReport.canChangeResources});var t=f(f("#controls ul")[0]);c(t,d.addJasperReport.nonSuggestedControls,d.addJasperReport.canChangeResources),n(t,d.addJasperReport.suggestedControls),o(t,{canChangeResources:d.addJasperReport.canChangeResources})})}),define("addResource/jasperReport/addJasperReportResourcesAndControlsMain",["require","exports","module","runtime_dependencies/jrs-ui/src/addResource/jasperReport/addJasperReportResourcesAndControlsMain"],function(e,t,r){e("runtime_dependencies/jrs-ui/src/addResource/jasperReport/addJasperReportResourcesAndControlsMain")});