/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","underscore","jquery","runtime_dependencies/js-sdk/src/jrs.configs","./domain.base"],function(e,n,o){var r=e("prototype"),t=r.$,i=r.$break,s=r.$H,a=e("underscore"),l=e("jquery"),d=e("runtime_dependencies/js-sdk/src/jrs.configs"),c=e("./domain.base"),u=new RegExp("[\\?&]reportType=([^&#]*)");c.chooser={FLOW_ID:"adhocFlow",FIELDS:"dataChooserFields",DISPLAY:"dataChooserDisplay",SAVE_AS_TOPIC:"dataChooserSaveAsTopic",PRE_FILTERS:"dataChooserPreFilters",submitFormId:"stepDisplayForm",currentPage:null,flowExecutionKey:null,unsavedChangesPresent:!1,initialize:function(e){var n=u.exec(location.search);if(this.reportType=null==n?"":decodeURIComponent(n[1].replace(/\+/g," ")),window.localContext.rsInitOptions){var o=window.localContext.rsInitOptions;this.currentPage=t(document.body).identify(),this.flowExecutionKey=o.flowExecutionKey,this.unsavedChangesPresent=o.unsavedChangesPresent;var r=this.pageInitFactory[this.currentPage]();o=a.extend({},o,e),this.initModule(r,o),c.registerClickHandlers([this.getFlowControlsClickEventHandler()])}},initModule:function(e,n){e&&(e.fillForm&&(h.fillForm=e.fillForm.bind(e)),e.getFlowControlsClickEventHandler&&(h.getFlowControlsClickEventHandler=e.getFlowControlsClickEventHandler.bind(e)),e.init.bind(e)(n))},fillForm:function(){},getFlowControlsClickEventHandler:function(){return h.flowControlsClickEventHandler.bind(h)},flowControlsClickEventHandler:function(e){var n=!1;return this.flowControlsEventMap.each(function(o){if(c.elementClicked(e,o.key)){if(n=!0,o.value.returnOnPage&&this.currentPage===o.value.returnOnPage)throw i;if(o.value.confirmLeave&&!this.confirmAndLeave())throw i;throw delete o.value.returnOnPage,o.value.flowId=this.FLOW_ID,o.value.flowExecutionKey=this.flowExecutionKey,o.value.reportType=this.reportType,d.initAdditionalUIComponents||(o.value.decorate="no"),"cancelRedirect"===o.value.eventId&&l(document).trigger("adhocDesigner:cancel"),c.submitForm(this.submitFormId,o.value,this.fillForm),i}}.bind(this)),n}};var h=c.chooser;h.confirmAndLeave=function(){return!h.unsavedChangesPresent||confirm(c.getMessage("exitMessage"))},h.setUnsavedChangesPresent=function(e){h.unsavedChangesPresent=!!e},h.isUnsavedChangesPresent=function(){return h.unsavedChangesPresent},h.pageInitFactory={dataChooserFields:function(){return c.chooser.fields},dataChooserPreFilters:function(){return c.chooser.preFilters},dataChooserDisplay:function(){return c.chooser.display},dataChooserSaveAsTopic:function(){return c.chooser.saveAsTopic}},h.flowControlsEventMap=s({"#fieldsTab":{returnOnPage:c.chooser.FIELDS,eventId:"fields"},"#filtersTab":{returnOnPage:c.chooser.PRE_FILTERS,eventId:"preFilters"},"#displayTab":{returnOnPage:c.chooser.DISPLAY,eventId:"display"},"#saveTopicTab":{returnOnPage:c.chooser.SAVE_AS_TOPIC,eventId:"saveAsTopic"},"#goToDesigner":{eventId:"done",reportType:h.reportType},"#cancel":{eventId:"cancelRedirect",confirmLeave:!0}}),window.domain=window.domain||{},window.domain.chooser={confirmAndLeave:h.confirmAndLeave},o.exports=h});