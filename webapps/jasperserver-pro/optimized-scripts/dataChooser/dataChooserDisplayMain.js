/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define("runtime_dependencies/js-sdk/src/common/util/datetime/RelativeDate",["require","exports","module","underscore"],function(e,t,i){var r=e("underscore"),n=function(e,t,i){this.setKeyword(e),this.setSign(t),this.setNumber(i)};n.prototype.setKeyword=function(e){this.keyword=e.toUpperCase()},n.prototype.setSign=function(e){this.sign=e},n.prototype.setNumber=function(e){if(r.isNumber(e))this.number=e;else{var t=parseInt(e,10);isNaN(t)?this.number=0:this.number=t}},n.prototype.toString=function(){return r.isNumber(this.number)&&!isNaN(this.number)&&this.number>0&&("+"===this.sign||"-"===this.sign)&&this.keyword in n.PATTERNS?this.keyword+this.sign+this.number.toString():this.keyword in n.PATTERNS?this.keyword:""},n.PATTERNS={DAY:/^(DAY)(([+|\-])(\d{1,9}))?$/i,WEEK:/^(WEEK)(([+|\-])(\d{1,9}))?$/i,MONTH:/^(MONTH)(([+|\-])(\d{1,9}))?$/i,QUARTER:/^(QUARTER)(([+|\-])(\d{1,9}))?$/i,SEMI:/^(SEMI)(([+|\-])(\d{1,9}))?$/i,YEAR:/^(YEAR)(([+|\-])(\d{1,9}))?$/i},n.parse=function(e){if(n.isValid(e))for(var t in n.PATTERNS){var i=n.PATTERNS[t].exec(e);if(null!==i&&r.isArray(i)&&5===i.length)return new n(i[1],i[3],i[4])}},n.isValid=function(e){if(e instanceof n)return""!==e.toString();if(r.isString(e))for(var t in n.PATTERNS)if(n.PATTERNS[t].test(e))return!0;return!1},i.exports=n}),define("runtime_dependencies/js-sdk/src/common/util/datetime/RelativeTimestamp",["require","exports","module","./RelativeDate","underscore"],function(e,t,i){var r=e("./RelativeDate"),n=e("underscore"),o=function(){r.apply(this,arguments)},s=function(){};s.prototype=r.prototype,o.prototype=new s,o.prototype.constructor=o,o.PATTERNS={DAY:/^(DAY)(([+|\-])(\d{1,9}))?$/i,WEEK:/^(WEEK)(([+|\-])(\d{1,9}))?$/i,MONTH:/^(MONTH)(([+|\-])(\d{1,9}))?$/i,QUARTER:/^(QUARTER)(([+|\-])(\d{1,9}))?$/i,SEMI:/^(SEMI)(([+|\-])(\d{1,9}))?$/i,YEAR:/^(YEAR)(([+|\-])(\d{1,9}))?$/i},o.parse=function(e){if(o.isValid(e))for(var t in o.PATTERNS){var i=o.PATTERNS[t].exec(e);if(null!==i&&n.isArray(i)&&5===i.length)return new o(i[1],i[3],i[4])}},o.isValid=function(e){if(e instanceof o)return""!==e.toString();if(n.isString(e))for(var t in o.PATTERNS)if(o.PATTERNS[t].test(e))return!0;return!1},i.exports=o}),define("runtime_dependencies/js-sdk/src/common/util/parse/date",["require","exports","module","momentExtension","../../../jrs.configs","underscore","../datetime/RelativeDate","../datetime/RelativeTimestamp"],function(e,t,i){function r(e){var t=e;return t=e.indexOf("yy")>-1?t.replace("yy","YYYY"):t.replace("y","YY"),e.indexOf("mm")>-1?t=t.replace("mm","MM"):e.indexOf("MM")>-1?t=t.replace("MM","MMMM"):e.indexOf("m")>-1?t=t.replace("m","M"):e.indexOf("M")>-1&&(t=t.replace("M","MMM")),e.indexOf("dd")>-1?t=t.replace("dd","DD"):e.indexOf("DD")>-1?t=t.replace("DD","dddd"):e.indexOf("d")>-1?t=t.replace("d","D"):e.indexOf("D")>-1&&(t=t.replace("D","ddd")),t}function n(e){return e.toUpperCase()}function o(e){return e.toLowerCase().replace("hh","HH")}function s(e){return e.replace("aaa","a")}function a(e,t,i){var n=r(e),s=o(t);return n+(null!=i?i:" ")+s}function d(e,t,i){i=void 0!==i&&i,t=t||" ";var a=e.split(t),d=a[0],l=a.length>1?a[1]:null,u=i?n:r,c=i?s:o;(d.indexOf("h")>0||d.indexOf("H")>0||d.indexOf("s")>0)&&(l=d,d=null);var m="";return d&&(m+=u(d)),l&&(m&&(m+=t),m+=c(l)),m}function l(e){return k(e,r(U.dateFormat),!0)}function u(e){return k(e,a(U.dateFormat,U.timeFormat,U.timestampSeparator),!0)}function c(e){return V.isValid(e)}function m(e){return B.isValid(e)}function h(e){return j.isDate(e)&&k(e).isValid()||j.isString(e)&&""!==e&&l(e).isValid()}function p(e){return j.isDate(e)&&k(e).isValid()||j.isString(e)&&""!==e&&u(e).isValid()}function f(e){return k(e,J,!0).isValid()}function _(e,t){if(h(e)&&h(t)){return N(j.isDate(e)?k(e):l(e),j.isDate(t)?k(t):l(t))}}function T(e,t){if(p(e)&&p(t)){return N(j.isDate(e)?k(e):u(e),j.isDate(t)?k(t):u(t))}}function N(e,t){return e.isBefore(t)?-1:e.isAfter(t)?1:0}function I(e){var t=k(e);if(j.isDate(e)&&t.isValid())return t.format(J)}function v(e){var t=k(e,J,!0);if(t.isValid())return t.toDate()}function b(e){return S(e,a(U.dateFormat,U.timeFormat,U.timestampSeparator),J)}function E(e){return S(e,J,a(U.dateFormat,U.timeFormat,U.timestampSeparator))}function C(e){return S(e,r(U.dateFormat),z)}function y(e){return S(e,z,r(U.dateFormat))}function g(e){return S(e,o(U.timeFormat),Y)}function M(e){return S(e,Y,o(U.timeFormat))}function S(e,t,i){if(V.isValid(e))return e;var r=k(e,t,!0);return r.isValid()?r.format(i):e}function D(e){return k(e,z,!0)}function A(e){return e.format(z)}function O(e){return e.format(r(U.dateFormat))}function L(e,t){var i;return i=t?k.tz(e,t).tz(G):k.utc(e).tz(G),i.format(r(U.dateFormat))}function x(e,t){var i=k.duration(e),r=k.utc();return t&&r.tz(t),r.hours(i.hours()),r.minutes(i.minutes()),r.seconds(i.seconds()),r.tz(G).format(o(U.timeFormat))}function w(e,t){var i;return i=t?k.tz(e,t).tz(G):k.utc(e).tz(G),i.format(a(U.dateFormat,U.timeFormat,U.timestampSeparator))}function R(e,t){e=C(e);var i=k.tz(e,G);return i=t?i.tz(t):i.utc(),i.format(z)}function F(e,t){var i=k.duration(e),r=k.utc(),n=r.tz(G);n.hours(i.hours()),n.minutes(i.minutes()),n.seconds(i.seconds());var o;return o=t?n.tz(t):n.utc(),o.format(Y)}function P(e,t){e=b(e);var i=k.tz(e,G);return i=t?i.tz(t):i.utc(),i.format(J)}var k=e("momentExtension"),H=e("../../../jrs.configs"),j=e("underscore"),V=e("../datetime/RelativeDate"),B=e("../datetime/RelativeTimestamp"),U=H.localeSettings,G=H.userTimezone,J="YYYY-MM-DD[T]HH:mm:ss",z="YYYY-MM-DD",Y="HH:mm:ss";i.exports={isRelativeDate:c,isRelativeTimestamp:m,isDate:h,isTimestamp:p,isIso8601Timestamp:f,compareDates:_,compareTimestamps:T,iso8601DateToMoment:D,momentToIso8601Date:A,momentToLocalizedDate:O,dateObjectToIso8601Timestamp:I,iso8601TimestampToDateObject:v,localizedTimestampToIsoTimestamp:b,isoTimestampToLocalizedTimestamp:E,localizedDateToIsoDate:C,isoDateToLocalizedDate:y,localizedTimeToIsoTime:g,isoTimeToLocalizedTime:M,toMomentDateOrTimeOrTimestampPattern:d,isoDateToLocalizedDateByTimezone:L,localizedDateToIsoDateByTimezone:R,isoTimeToLocalizedTimeByTimezone:x,localizedTimeToIsoTimeByTimezone:F,isoTimestampToLocalizedTimestampByTimezone:w,localizedTimestampToIsoTimestampByTimezone:P}}),define("runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils",["require","exports","module","underscore"],function(e,t,i){var r=e("underscore"),n=function(e){function t(e){return"."===e?e="\\.":" "===e&&(e="\\s"),e}e=e||{},this.DECIMAL_SEPARATOR=e.decimalSeparator||".",this.GROUPING_SEPARATOR=e.groupingSeparator||",",this.decimalSeparator=t(this.DECIMAL_SEPARATOR),this.groupingSeparator=t(this.GROUPING_SEPARATOR),this.DECIMAL_NUMBER_PATTERN=new RegExp("^-?([1-9]{1}[0-9]{0,2}("+this.groupingSeparator+"[0-9]{3})*("+this.decimalSeparator+"[0-9]+)?|[1-9]{1}[0-9]{0,}("+this.decimalSeparator+"[0-9]+)?|0("+this.decimalSeparator+"[0-9]+)?)$"),this.INTEGER_NUMBER_PATTERN=new RegExp("^-?([1-9]{1}[0-9]{0,2}("+this.groupingSeparator+"[0-9]{3})*|[1-9]{1}[0-9]{0,}|0)$")},o=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER+1:9007199254740992,s=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER-1:-9007199254740992;n.prototype.number_format=function(e,t,i,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+e)?+e:0,o=isFinite(+t)?Math.abs(t):0,s=void 0===r?",":r,a=void 0===i?".":i,d=(o?function(e,t){var i=Math.pow(10,t);return""+(Math.round(e*i)/i).toFixed(t)}(n,o):""+Math.round(n)).split(".");return d[0].length>3&&(d[0]=d[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(d[1]||"").length<o&&(d[1]=d[1]||"",d[1]+=new Array(o-d[1].length+1).join("0")),d.join(a)},n.prototype.isInt=function(e){return this.isNumberInt(e)||this.isStringInt(e)},n.prototype.isNumberInt=function(e){return r.isNumber(e)&&!isNaN(e)&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY&&(e===+e&&e===(0|e)||e%1==0)},n.prototype.isStringInt=function(e){return r.isString(e)&&this.INTEGER_NUMBER_PATTERN.test(e)},n.prototype.isInt32=function(e){return this.isInt(e)&&this.parseNumber(e)>=-2147483648&&this.parseNumber(e)<=2147483647},n.prototype.isDecimal=function(e){return r.isNumber(e)&&!isNaN(e)&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY||r.isString(e)&&this.DECIMAL_NUMBER_PATTERN.test(e)},n.prototype.parseNumber=function(e){if(r.isNumber(e))return e;if(r.isString(e)&&this.DECIMAL_NUMBER_PATTERN.test(e)){e=e.replace(new RegExp(this.groupingSeparator,"g"),"").replace(new RegExp(this.decimalSeparator,"g"),".");var t=1*e;return t>=o||t<=s?(window.console&&window.console.warn(e+" is out of the ["+(s+1)+", "+(o-1)+"] bounds. Parsing results may be corrupted. Use string representation instead. For more details see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number."),!1):t}},n.prototype.formatNumber=function(e,t){t=t||{};var i=e.toString().split(".")[1],n=i?i.length:0;r.isUndefined(t.decimalPlacesAmount)||(n=t.decimalPlacesAmount);try{return this.number_format(e,n,t.decimalSeparator||this.DECIMAL_SEPARATOR,t.groupingSeparator||this.GROUPING_SEPARATOR)}catch(t){return e.toString()}},n.prototype.MaxRange=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER+1:9007199254740992,n.prototype.MinRange=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER-1:-9007199254740992,i.exports=n}),define("dataChooser/domain.base",["require","exports","module","prototype","underscore","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.ajax","../core/core.ajax.utils","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/js-sdk/src/common/util/parse/date","momentExtension","runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"],function(e,t,i){var r=e("prototype"),n=r.$,o=r.Template,s=r.$break,a=r.$$,d=e("underscore"),l=e("runtime_dependencies/jrs-ui/src/util/utils.common"),u=l.buildActionUrl,c=l.matchAny,m=l.isSupportsTouch,h=l.deepClone,p=e("runtime_dependencies/jrs-ui/src/core/core.ajax"),f=p.AjaxRequester,_=p.ajaxTargettedUpdate,T=e("../core/core.ajax.utils"),N=T.baseErrorHandler,I=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),v=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),b=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),E=e("runtime_dependencies/js-sdk/src/common/util/parse/date"),C=e("momentExtension"),y=e("runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"),g=new y,M={PROPAGATE_EVENT:"propagateEvent",_messages:{},disabledFolderTooltip:"disabledFolderTooltip",attributesPattern:new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),getMessage:function(e,t){var i=this._messages[e];return i?new o(i).evaluate(t||{}):""},setMessage:function(e,t){this._messages[e]=t},treeErrorHandler:function(){throw"exception while loading tree"},submitForm:function(e,t,i){if(t){var r=u(t);i&&i(),n(e).writeAttribute("method","post").writeAttribute("action",r),n(e).submit()}},sendAjaxRequest:function(e,t,i,r){var n=u(e),o={postData:Object.toQueryString(t),callback:i,errorHandler:this._serverErrorHandler,mode:f.prototype.EVAL_JSON};r&&Object.extend(o,r),_(n,o)},_serverErrorHandler:function(e,t){return N(e)},elementClicked:function(e,t){return!(!e||!t)&&c(e,[t],!0)},basicClickHandler:function(e,t,i){var r=null;return t.any(function(t){if(r=M.elementClicked(e,t.key))return Object.isFunction(t.value)?t.value(r):Object.isFunction(i)&&i(t.value),!0})},registerClickHandlers:function(e,t,i){if(M._bodyClickEventHandlers)return void(i?Array.prototype.unshift:Array.prototype.push).apply(M._bodyClickEventHandlers,e);M._bodyClickEventHandlers=e,a(t||"body")[0].observe(m()?"touchstart":"click",function(e){var t=e.element();M._bodyClickEventHandlers&&M._bodyClickEventHandlers.each(function(i){var r=i(t);if(r)throw r!==M.PROPAGATE_EVENT&&Event.stop(e),s})})},enableButton:function(e,t){"string"==typeof e&&(e=n(e)),e.disabled=t,t?I.enable(e):I.disable(e)},setOptionsToSelect:function(e,t){if(e&&(e.update(""),t))return t.each(function(t){var i={value:t.value,title:t.label};t.selected&&(i.selected="selected");var r=new Element("option",i);r.appendChild(document.createTextNode(t.label)),e.appendChild(r)}),e},getDataIslandId:function(e,t){var i=v.trees[e.getTreeId()].getRootNode();return function e(t,r){return null===t.parent||t.parent===i?t.param.extra[r]:e(t.parent,r)}(e,t)},areNodesFromSameIsland:function(e,t){return!!e.any(function(e){return e.param.extra.isConstant})||(!(1!==e.pluck("parent").uniq().length)||1===e.map(function(e){return M.getDataIslandId(e,t||"itemId")}).uniq().length)},NumberFormat:function(e,t){var i="."===e,r=new RegExp("["+e.gsub(/\s/,"\\s")+"]+"),n=new RegExp("["+t.gsub(/\s/,"\\s")+"]+"),o=new RegExp("^-|\\"+t+"?\\d+|\\"+t+"$|\\"+e+"+","g");return{toNumber:function(e){return!e||!i&&/[.]/.test(e)?NaN:Number(e.gsub(n,"").gsub(r,"."))||M.attributesPattern.test(e)},normalizeNumberEntry:function(i){var r=i.strip(),n=r.match(M.attributesPattern)||r.match(o);if(!n)return"";for(var s=!1,a=0;a<n.length;a++)n[a].startsWith(e)?s?delete n[a]:(n[a]=e,s=!0):n[a].startsWith(t)&&s&&(n[a]=n[a].substring(1));return n.join("")},isInteger:function(e){return r.test(e)}}},baseValidator:function(e,t){var i=!0,r="";return e()&&(r=t,i=!1),{isValid:i,errorMessage:r}},maxLengthValidator:function(e,t,i){return M.baseValidator(function(e,t){return e.length>t}.curry(e,t),i)},minLengthValidator:function(e,t,i){return M.baseValidator(function(e,t){return e.length<t}.curry(e,t),i)},valueNotEmptyValidator:function(e,t){return M.baseValidator(function(e){return Object.isArray(e)&&0===e.length||!e||!String(e).strip()}.curry(e),t)},stringIdValidator:function(e,t){return M.baseValidator(function(e){return!/^[^0-9() .,'"=!+-\/><\/\/:][^() .,'"=!+-\/><\/\/:]*$/.test(e)}.curry(e),t)},numberValidator:function(e,t,i){return M.baseValidator(isNaN.curry(t.toNumber(e)),i)},numberBoundsValidator:function(e,t,i){return M.baseValidator(function(e,t){return e===g.MinRange||e===g.MaxRange||!(e<=t.max&&e>=t.min)}.curry(e,t),i)},rangeValidator:function(e,t,i){return M.baseValidator(function(e,t){return!(e<t)}.curry(e,t),i)},dateValidator:function(e,t,i,r){return M.baseValidator(function(){var r=E.toMomentDateOrTimeOrTimestampPattern(t,i);return!C(e,r,!0).isValid()&&!M.attributesPattern.test(e)},r)},unescapeTree:function e(t){t.hasChilds()&&d.each(t.childs,function(t){e(t)}),t.name=b.unescape(t.name)}};M.NodeCopyMoveController=function(){},M.NodeCopyMoveController.addMethod("copy",function(e,t,i){if(e&&e.length>0&&t){var r=v.trees[t.getTreeId()],n=e.collect(function(e){var n=e.param.id,o=this._copyParentStructure(e,r);return o?this._mergeToDestTree(o,t,n,i):null}.bind(this));return t.isloaded=!0,n.without(null)}}),M.NodeCopyMoveController.addMethod("copySelected",function(e,t){if(window.sourceTree&&t)return this.copy(window.sourceTree.selectedNodes,t)}),M.NodeCopyMoveController.addMethod("move",function(e,t){if(e&&t){var i=this.copy(e,t);return this.hide(e),i}}),M.NodeCopyMoveController.addMethod("moveSelected",function(e,t){if(e&&t)return this.move(e.selectedNodes,t)}),M.NodeCopyMoveController.addMethod("hide",function(e,t,i){if(e&&e.length>0){t||(t=this._getVisibleChildrenCount),i||(i=function(e,t){e.hide(t)});var r=v.trees[e[0].getTreeId()];e.collect(function(e){return e.id}).each(function(e){var n=v.nodes[e];i(n,!0);for(var o=n.parent;o&&o!=r.getRootNode()&&!(t(o)>0);)i(o,!1),o.refreshStyle(),o=o.parent}.bind(this))}}),M.NodeCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){return e.param.id}),M.NodeCopyMoveController.addMethod("_markAsLoaded",function(e){e.isloaded=!0,e.isParent()&&e.childs.each(function(e){this._markAsLoaded(e)}.bind(this))}),M.NodeCopyMoveController.addMethod("_mergeToDestTree",function(e,t,i,r){if(t){var n=v.trees[t.getTreeId()];if(r)return i=this._handleDuplicatedNode(e,t),n.findNodeById(i,e);var o=n.findNodeChildByMetaName(t,e.param.id);return null!=o?(o.isHidden()&&o.show(),e.hasChilds()&&(o.disabled&&o.enable(e.tooltip),e.childs.each(function(e){this._mergeToDestTree(e,o)}.bind(this))),n.findNodeById(i,o)):(t.addChild(e),this._markAsLoaded(e),n.findNodeById(i,e))}}),M.NodeCopyMoveController.addMethod("_copyParentStructure",function(e,t){if(e&&t){var i=v.trees[e.getTreeId()];if(e.disabled)return null;for(var r=this._copyNode(e,t,!0),n=e.parent,o=null;n&&n!=i.getRootNode();)o=this._copyNode(n,t,!1),o.addChild(r),r=o,n=n.parent;return r}}),M.NodeCopyMoveController.addMethod("_buildMetanode",function(e){return h(e.param)}),M.NodeCopyMoveController.addMethod("_copyNode",function(e,t,i){if(e&&t){var r=t.processNode(this._buildMetanode(e));i&&(e.hasChilds()?e.childs.each(function(e){if(!e.disabled){var e=this._copyNode(e,t,i);e&&r.addChild(e)}}.bind(this)):r.setHasChilds(!1));var n=e.childs.findAll(function(e){return e.disabled});return e.childs.length>0&&n.length==e.childs.length?null:r}}),M.NodeCopyMoveController.addMethod("_delete",function(e){e&&e.collect(function(e){return e.id}).each(function(e){var t=v.nodes[e];t&&t.parent.removeChild(t)})}),M.NodeCopyMoveController.addMethod("_getVisibleChildrenCount",function(e){var t=e.childs.findAll(function(e){return e.isHidden()});return e.childs.length-t.length}),M.resetTreeSelectionHandler={_COMMON_ELEMENTS_TO_SAVE_SELECTION:["#pageDimmer","#detail","#standardConfirm"],_getTrees:null,_elementIds:null,_callback:null,_validator:null,init:function(e,t,i,r){M.resetTreeSelectionHandler._init.bind(M.resetTreeSelectionHandler,e,t,i,r)()},_init:function(e,t,i,r){this._getTrees=t,this._callback=i,this._validator=r,this._elementIds=this._COMMON_ELEMENTS_TO_SAVE_SELECTION.concat(e),M.registerClickHandlers([this._removeTreeSelectionClickEventHandler.bind(this)],null,!0)},_removeTreeSelectionClickEventHandler:function(e){if(!c(e,this._elementIds,!0)){var t=!1;return this._getTrees().each(function(e){if(e.selectedNodes&&e.selectedNodes.first())throw t=!0,s}),t?!(!this._validator||this._validator())||(this._getTrees().each(function(e){e._deselectAllNodes()}),this._callback&&this._callback(),!1):!1}}},M.NodeChangeOrderController=function(){},M.NodeChangeOrderController.addMethod("findNodeWithSpecificOrder",function(e,t,i){for(var r=e.length-1;r>=0;r--)if(e[r].isSelected()==i&&e[r].orderNumber===t)return e[r];return null}),M.NodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i){var r=null,n=null;return e.each(function(e){e.isSelected()==t&&(null!==r&&i!=e.orderNumber<r||(r=e.orderNumber,n=e))}),n}),M.NodeChangeOrderController.addMethod("moveNode",function(e,t,i,r){var n=e.orderNumber,o=e.parent.childs,s=null,a=null;i?(s=this.findMaxSiblingNode(o,!1,t,e.param.type),a=s?s.orderNumber:-1,o.each(function(i){i.param.id!==e.param.id&&(t==i.orderNumber>a&&t==i.orderNumber<n||i.orderNumber==a)&&(i.orderNumber=t?i.orderNumber+1:i.orderNumber-1,r&&r(i,i.orderNumber))}),r&&r(e,a),e.orderNumber=a):(a=t?e.orderNumber-1:e.orderNumber+1,(s=this.findNodeWithSpecificOrder(o,a,!1))&&(r&&r(e,a),r&&r(s,n),e.orderNumber=a,s.orderNumber=n))}),M.NodeChangeOrderController.addMethod("nodeAscSorter",function(e,t){return e.orderNumber-t.orderNumber}),M.NodeChangeOrderController.addMethod("nodeDescSorter",function(e,t){return t.orderNumber-e.orderNumber}),M.DisplayNodeChangeOrderController=function(){M.NodeChangeOrderController.call()},M.DisplayNodeChangeOrderController.prototype=h(M.NodeChangeOrderController.prototype),M.DisplayNodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i,r){var n=null,o=null;return e.each(function(e){e.isSelected()==t&&(null!==n&&i!=e.orderNumber<n||r&&e.param.type!==r||(n=e.orderNumber,o=e))}),o}),i.exports=M}),define("dataChooser/domain.chooser",["require","exports","module","prototype","underscore","jquery","runtime_dependencies/js-sdk/src/jrs.configs","./domain.base"],function(e,t,i){var r=e("prototype"),n=r.$,o=r.$break,s=r.$H,a=e("underscore"),d=e("jquery"),l=e("runtime_dependencies/js-sdk/src/jrs.configs"),u=e("./domain.base"),c=new RegExp("[\\?&]reportType=([^&#]*)");u.chooser={FLOW_ID:"adhocFlow",FIELDS:"dataChooserFields",DISPLAY:"dataChooserDisplay",SAVE_AS_TOPIC:"dataChooserSaveAsTopic",PRE_FILTERS:"dataChooserPreFilters",submitFormId:"stepDisplayForm",currentPage:null,flowExecutionKey:null,unsavedChangesPresent:!1,initialize:function(e){var t=c.exec(location.search);if(this.reportType=null==t?"":decodeURIComponent(t[1].replace(/\+/g," ")),window.localContext.rsInitOptions){var i=window.localContext.rsInitOptions;this.currentPage=n(document.body).identify(),this.flowExecutionKey=i.flowExecutionKey,this.unsavedChangesPresent=i.unsavedChangesPresent;var r=this.pageInitFactory[this.currentPage]();i=a.extend({},i,e),this.initModule(r,i),u.registerClickHandlers([this.getFlowControlsClickEventHandler()])}},initModule:function(e,t){e&&(e.fillForm&&(m.fillForm=e.fillForm.bind(e)),e.getFlowControlsClickEventHandler&&(m.getFlowControlsClickEventHandler=e.getFlowControlsClickEventHandler.bind(e)),e.init.bind(e)(t))},fillForm:function(){},getFlowControlsClickEventHandler:function(){return m.flowControlsClickEventHandler.bind(m)},flowControlsClickEventHandler:function(e){var t=!1;return this.flowControlsEventMap.each(function(i){if(u.elementClicked(e,i.key)){if(t=!0,i.value.returnOnPage&&this.currentPage===i.value.returnOnPage)throw o;if(i.value.confirmLeave&&!this.confirmAndLeave())throw o;throw delete i.value.returnOnPage,i.value.flowId=this.FLOW_ID,i.value.flowExecutionKey=this.flowExecutionKey,i.value.reportType=this.reportType,l.initAdditionalUIComponents||(i.value.decorate="no"),"cancelRedirect"===i.value.eventId&&d(document).trigger("adhocDesigner:cancel"),u.submitForm(this.submitFormId,i.value,this.fillForm),o}}.bind(this)),t}};var m=u.chooser;m.confirmAndLeave=function(){return!m.unsavedChangesPresent||confirm(u.getMessage("exitMessage"))},m.setUnsavedChangesPresent=function(e){m.unsavedChangesPresent=!!e},m.isUnsavedChangesPresent=function(){return m.unsavedChangesPresent},m.pageInitFactory={dataChooserFields:function(){return u.chooser.fields},dataChooserPreFilters:function(){return u.chooser.preFilters},dataChooserDisplay:function(){return u.chooser.display},dataChooserSaveAsTopic:function(){return u.chooser.saveAsTopic}},m.flowControlsEventMap=s({"#fieldsTab":{returnOnPage:u.chooser.FIELDS,eventId:"fields"},"#filtersTab":{returnOnPage:u.chooser.PRE_FILTERS,eventId:"preFilters"},"#displayTab":{returnOnPage:u.chooser.DISPLAY,eventId:"display"},"#saveTopicTab":{returnOnPage:u.chooser.SAVE_AS_TOPIC,eventId:"saveAsTopic"},"#goToDesigner":{eventId:"done",reportType:m.reportType},"#cancel":{eventId:"cancelRedirect",confirmLeave:!0}}),window.domain=window.domain||{},window.domain.chooser={confirmAndLeave:m.confirmAndLeave},i.exports=m}),define("dataChooser/domain.components",["require","exports","module","prototype","underscore","jquery","./domain.base","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/jrs-ui/src/components/list.base","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.layout","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/jrs-ui/src/components/components.dialogs"],function(e,t,i){var r=e("prototype"),n=r.$,o=r.$$,s=e("underscore"),a=e("jquery"),d=e("./domain.base"),l=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),u=e("runtime_dependencies/jrs-ui/src/components/list.base"),c=u.dynamicList,m=e("runtime_dependencies/jrs-ui/src/util/utils.common"),h=m.deepClone,p=e("runtime_dependencies/jrs-ui/src/core/core.layout"),f=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),_=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),T=e("runtime_dependencies/jrs-ui/src/components/components.dialogs");d.ItemNode=function(e){l.TreeNode.call(this,e),this.Types={Folder:new l.TreeNode.Type("ItemGroupType"),Leaf:new l.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_fields:fields",this._hidden=!1,this.disabled=!1},d.ItemNode.prototype=h(l.TreeNode.prototype),d.ItemNode.addMethod("hide",function(e){if(e&&this.hasChilds())for(var t=0;t<this.getChildCount();t++)this.childs[t].hide(!0);var i=(this.childs.findAll(function(e){return e.disabled}).length,this.childs.findAll(function(e){return e.isHidden()}).length),r=this.childs.length-i;this.disabled||0!==r?this.getType()===this.Types.Leaf&&(this.deselect(),this.disable(d.getMessage(d.disabledFolderTooltip))):(this._hidden=!0,this.deselect(),this.refreshStyle())}),d.ItemNode.addMethod("show",function(){this._hidden=!1,this._getElement()&&this.refreshStyle(this._getElement())}),d.ItemNode.addMethod("disable",function(e){e&&(this.tooltip=e),this.disabled=!0,this._getElement()&&this.refreshStyle(this._getElement())}),d.ItemNode.addMethod("enable",function(e){e&&(this.tooltip=e),this.disabled=!1,this._getElement()&&this.refreshStyle(this._getElement())}),d.ItemNode.addMethod("refreshStyle",function(e){if(e||(e=this._getElement())){l.TreeNode.prototype.refreshStyle.call(this,e),this.isHidden()?e.addClassName(p.HIDDEN_CLASS):e.removeClassName(p.HIDDEN_CLASS);var t=e.select("p").first();t&&(this.tooltip?t.title=this.tooltip:t.title="",this.disabled?(f.disable(t),f.disable(e)):(f.enable(t),f.enable(e)))}}),d.ItemNode.addMethod("isHidden",function(){return this._hidden}),d.ItemNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.labelId=e.labelId||"",t.descr=e.descr,t.descrId=e.descrId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=s.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),d.ItemNode.addMethod("hasVisibleChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.isHidden()})}),d.ItemNode.addMethod("hasEnabledChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.disabled})}),d.ItemNode.addMethod("removeChilds",function(){this.hasChilds()&&this.childs.each(function(e){this.removeChild(e)}.bind(this))}),d.FieldsCopyMoveController=function(){d.NodeCopyMoveController(this)},d.FieldsCopyMoveController.prototype=h(d.NodeCopyMoveController.prototype),d.FieldsCopyMoveController.addMethod("_buildMetanode",function(e){var t=h(e.param);return t.label=e.name,t.order=e.orderNumber,t.tooltip=e.tooltip,t}),d.TwoColumnNode=function(e){l.TreeNode.call(this,e),this.Types={Folder:new l.TreeNode.Type("ItemGroupType",{}),Leaf:new l.TreeNode.Type("ItemType",{})},this.nodeHeaderTemplateDomId="list_responsive:twoColumn"},d.TwoColumnNode.prototype=h(l.TreeNode.prototype),d.TwoColumnNode.addMethod("_createNode",function(){var e=this.id,t=(l.trees[this.getTreeId()],this._getHeaderTemplateElement());t.id=this.NODE_ID_PREFIX+e,this.refreshStyle(t),t.treeNode=this;var i=t.childElements()[0];this.tooltip&&(i.title=this.tooltip),i.childElements()[0].id=this.HANDLER_ID_PREFIX+e;var r=i.childElements()[1],n=this.param.extra&&this.param.extra.label?this.param.extra.label:this.name;r.insert(_.hardEscape(n)),i.childElements()[2].insert(_.hardEscape(this.name)),this._element=t}),d.TwoColumnNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0].childElements()[2];return e.cleanWhitespace(),0===e.childNodes.length&&e.appendChild(document.createTextNode("")),e.childNodes[0]}),d.TwoColumnNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type,order:this.orderNumber.toString()};return e&&(t.labelId=e.labelId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=s.invoke(this.childs,"toJSON")),t}),d.TwoColumnNode.addMethod("expandAllChilds",function(){var e=l.trees[this.getTreeId()];this.isParent()&&!this.isOpen()&&(e.writeStates(this.id,l.TreeNode.State.OPEN),this.refreshNode()),this.hasChilds()&&this.childs.each(function(e){e.expandAllChilds()})}),d.TablesNode=function(e){l.TreeNode.call(this,e),this.Types={Folder:new l.TreeNode.Type("level"),Leaf:new l.TreeNode.Type("item")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_tables:tables"},d.TablesNode.prototype=h(d.ItemNode.prototype),d.TablesNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.originalId=e.originalId,t.datasourceId=e.datasourceId,t.repoId=e.repoId,t.itemId=e.itemId,t.dataSource=e.dataSource,t.table=e.table,this.isParent()?(t.query=e.query,t.dataSetType=e.dataSetType):(t.expression=e.expression,t.islandId=e.islandId,t.isConstant=e.isConstant,t.JavaType=e.JavaType,t.JdbcType=e.JdbcType),e.fieldDbName&&(t.fieldDbName=e.fieldDbName)),this.isParent()&&(t.children=s.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),d.TablesNode.addVar("CONSTANT_TABLE_ID","constant_fields_level"),d.TablesNode.addVar("CROSSTABLES_FIELDS_TABLE_ID","crossTablesFieldsLevel"),d.TablesNode.addVar("INVALID_NODE_CLASS","invalid"),d.TablesNode.addVar("DATA_ISLAND_CLASS","dataIsland"),d.TablesNode.addVar("DERIVED_TABLE_CLASS","table derived"),d.TablesNode.addVar("CONSTANT_TABLE_CLASS","table constant"),d.TablesNode.addVar("CALCULATED_FIELD_CLASS","field calculated"),d.TablesNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(d.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS),this.param.extra&&this.param.extra.expression&&e.addClassName(this.CALCULATED_FIELD_CLASS),this.param.extra&&this.param.extra.query&&e.addClassName(this.DERIVED_TABLE_CLASS),this.param.id===this.CONSTANT_TABLE_ID&&e.addClassName(this.CONSTANT_TABLE_CLASS),this.param.extra&&this.param.extra.isIsland&&e.addClassName(this.DATA_ISLAND_CLASS))}),d.TablesNode.addMethod("edit",function(e){e&&"dblclick"!==e.type||d.ItemNode.prototype.edit.call(this,e)}),d.TablesCustomNode=function(e){d.TablesNode.call(this,e),this.nodeHeaderTemplateDomId=e.param.type===this.Types.Folder.name?"list_responsive_collapsible_type_tables:tables":"list_responsive_collapsible_type_tables:fields"},d.TablesCustomNode.prototype=h(d.TablesNode.prototype),d.TablesCopyMoveController=function(){d.NodeCopyMoveController(this)},d.TablesCopyMoveController.prototype=h(d.NodeCopyMoveController.prototype),d.TablesCopyMoveController.addMethod("_buildMetanode",function(e){var t={id:e.param.id,label:e.name,type:e.param.type,uri:e.param.uri};return e.param.extra&&(t.extra={originalId:e.param.extra.originalId,table:e.param.extra.table,itemId:e.param.extra.itemId,datasourceId:e.param.extra.datasourceId,repoId:e.param.extra.repoId,dataSource:e.param.extra.dataSource,dataSetType:e.param.extra.dataSetType,query:e.param.extra.query},e.param.extra.expression&&(t.extra.expression=e.param.extra.expression),e.param.extra.fieldDbName&&(t.extra.fieldDbName=e.param.extra.fieldDbName),e.isParent()||(t.extra.JavaType=e.param.extra.JavaType,t.extra.JdbcType=e.param.extra.JdbcType,t.extra.sourceItem=e.parent.param.extra.originalId)),t}),d.TablesCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){if(e.isParent()){for(var i=1,r=e.param.extra.datasourceId+"."+e.param.extra.itemId+i,n=l.trees[t.getTreeId()];n.findNodeChildByMetaName(t,r);)i++,r=e.param.extra.datasourceId+"."+e.param.extra.itemId+i;return e.param.id=r,e.param.extra.itemId+=i,e.name=e.param.extra.itemId,e.param.extra.originalId=e.param.extra.itemId,t.addChild(e),e.isloaded=!0,e.hasChilds()&&e.childs.each(function(t){this._handleDuplicatedNode(t,e)}.bind(this)),r}e.param.id=e.parent.param.id+"."+e.param.extra.itemId,e.param.extra.originalId=e.parent.param.extra.originalId+"."+e.param.extra.itemId}),d.DerivedTablesNode=function(e){d.TablesNode.call(this,e),e.param.type===this.Types.Folder.name&&e.param.extra&&e.param.extra.query&&(this.isSelectable=!0)},
d.DerivedTablesNode.prototype=h(d.TablesNode.prototype),d.JoinsList=function(e,t){c.List.call(this,e,t)},d.JoinsList.prototype=h(c.List.prototype),d.JoinsList.addMethod("_changeHandler",function(e){var t=this.getItemByEvent(e);t&&(t._respondOnItemEvents&&!e.isInvoked&&this.fire("item:change",{targetEvent:e,item:t}),e.isInvoked=!0)}),d.JoinsList.addMethod("_initEvents",function(){c.List.prototype._initEvents.call(this);var e=this._getElement();a(e).off("change").on("change","select",s.bind(this._changeHandler,this))}),d.JoinsListItem=function(e){c.ListItem.call(this,e),this._hidden=!1},d.JoinsListItem.prototype=h(c.ListItem.prototype),d.JoinsListItem.addMethod("hide",function(e){this._hidden=!!e,this.refreshStyle()}),d.JoinsListItem.addMethod("refreshStyle",function(){c.ListItem.prototype.refreshStyle.call(this),this._getElement()&&(this._hidden?this._getElement().addClassName(p.HIDDEN_CLASS):this._getElement().removeClassName(p.HIDDEN_CLASS))}),d.JoinsListItem.addMethod("processTemplate",function(e){var t=e.childElements()[0];t.cleanWhitespace();var i=t.childElements()[1],r=t.childElements()[2],n=t.childElements()[3],o=n.childElements()[0],s=o.childElements();return i.update(_.hardEscape(this._value.left.table.label+":"+this._value.left.label)),r.update(_.hardEscape(this._value.right.table.label+":"+this._value.right.label)),s.each(function(e){e.selected=e.value===this._value.type}.bind(this)),e}),d.JoinsListItem.addMethod("setJoinType",function(e){this.getValue().type=e;var t=this._getElement();if(t){var i=t.childElements()[0].childElements()[3].childElements()[0];n(i).value=e}}),d.JoinsListItem.addMethod("toJSON",function(){return{left:this._value.left.id,right:this._value.right.id,type:this._value.type}}),d.DisplayNode=function(e){d.ItemNode.call(this,e),this.Types={Folder:new l.TreeNode.Type("ItemGroupType"),Leaf:new l.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_sets:sets"},d.DisplayNode.prototype=h(d.ItemNode.prototype),d.DisplayNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,type:this.param.type};return e&&(t.itemId=e.itemId,t.descr=e.descr,t.labelId=e.labelId||"",t.descrId=e.descrId||"",t.resourceId=e.resourceId||""),e&&e.label&&(t.label=e.label),this.isParent()?t.children=s.chain(this.childs).filter(function(e){return!e.isHidden()&&!e._markAsDeleted}).invoke("toJSON").value():(t.dataType=e.dataType,t.dimensionOrMeasure=e.dimensionOrMeasure,t.defaultMask=e.defaultMask,t.defaultAgg=e.defaultAgg),t}),d.DisplayNode.addVar("INVALID_NODE_CLASS","invalid"),d.DisplayNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(d.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS))}),d.genericTreeParams={rootUri:"/",showRoot:!1,nodeClass:d.ItemNode,treeClassName:"",multiSelectEnabled:!0},d.createItemsTree=function(e){return e=Object.extend(h(d.genericTreeParams),e),new l.TreeSupport(e.treeId,e)},d.confirmDialog={MODE_OK_CANCEL:"okCancel",MODE_YES_NO:"yesNo",_CONFIRM_DIALOG_DOM_ID:"standardConfirm",_CONFIRM_DIALOG_BODY_DOM_PATTERN:"#standardConfirm > .content > .body",_CONFIRM_DIALOG_OK_BUTTON_ID:"#confirmYes",_CONFIRM_DIALOG_CANCEL_BUTTON_ID:"#confirmNo",_CONFIRM_DIALOG_OK_PATTERN:"#confirmYes > span",_CONFIRM_DIALOG_CANCEL_PATTERN:"#confirmNo > span",_yesMessageHolder:null,_noMessageHolder:null,_dialog:null,_onOk:null,_onCancel:null,_customEventHandler:null,_templateDomId:null,_visible:!1,init:function(){d.confirmDialog._init.bind(d.confirmDialog)()},show:function(e,t,i,r,n){d.confirmDialog._show.bind(d.confirmDialog,e,t,i,r,n)()},hideForDetails:function(){T.popup.hide(d.confirmDialog._dialog)},showFromDetails:function(){T.popup.show(d.confirmDialog._dialog,!0)},visible:function(){return d.confirmDialog._visible},_init:function(){this._dialog=n(this._CONFIRM_DIALOG_DOM_ID),this._yesMessageHolder=o(this._CONFIRM_DIALOG_OK_PATTERN).first(),this._noMessageHolder=o(this._CONFIRM_DIALOG_CANCEL_PATTERN).first(),d.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e,t,i,r,o){this._onOk=t,this._onCancel=i,this._customEventHandler=r,this._templateDomId=e,o&&o==this.MODE_YES_NO?(this._yesMessageHolder.update(d.getMessage("yes")),this._noMessageHolder.update(d.getMessage("no"))):(this._yesMessageHolder.update(d.getMessage("ok")),this._noMessageHolder.update(d.getMessage("cancel"))),n(this._templateDomId).removeClassName(p.HIDDEN_CLASS),T.popup.show(this._dialog,!0),this._visible=!0},_hide:function(e){n(this._templateDomId).addClassName(p.HIDDEN_CLASS),T.popup.hide(this._dialog),this._visible=!1,e&&e()},_clickEventHandler:function(e){return d.elementClicked(e,this._CONFIRM_DIALOG_OK_BUTTON_ID)?(this._hide(this._onOk),!0):d.elementClicked(e,this._CONFIRM_DIALOG_CANCEL_BUTTON_ID)?(this._hide(this._onCancel),!0):this._customEventHandler?this._customEventHandler(e):void 0}},d.detailsDialog={_DETAIL_DIALOG_DOM_ID:"detail",_DETAIL_DIALOG_CLOSE_BUTTON_ID:"#close",_DETAIL_DIALOG_LIST_DOM_ID:"detailsList",_DETAIL_DIALOG_TEXT_DOM_ID:"detailsText",_LIST_TEMPLATE:"defaultListTemplate",_LIST_ITEM_TEMPLATE:"dynamicListItemTemplate",_dialog:null,_showConfirmAfterClose:!1,_list:null,_listItems:null,init:function(){d.detailsDialog._init.bind(d.detailsDialog)()},show:function(e){d.detailsDialog._show.bind(d.detailsDialog,e)()},_init:function(){this._dialog=n(this._DETAIL_DIALOG_DOM_ID),d.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e){d.confirmDialog.visible()?(d.confirmDialog.hideForDetails(),this._showConfirmAfterClose=!0):this._showConfirmAfterClose=!1,this._createMessage(e),T.popup.show(this._dialog,!0),n(this._DETAIL_DIALOG_LIST_DOM_ID).parentNode.scrollTop=0},_createMessage:function(e){"string"==typeof e?(n(this._DETAIL_DIALOG_LIST_DOM_ID).addClassName(p.HIDDEN_CLASS),n(this._DETAIL_DIALOG_TEXT_DOM_ID).removeClassName(p.HIDDEN_CLASS).update(e)):(n(this._DETAIL_DIALOG_TEXT_DOM_ID).addClassName(p.HIDDEN_CLASS),n(this._DETAIL_DIALOG_LIST_DOM_ID).removeClassName(p.HIDDEN_CLASS),this._items&&(this._list.removeItems(this._items),this._items=null,this._list=null),this._items=e.collect(function(e){return new c.ListItem({label:e})}),this._list=new c.List(this._DETAIL_DIALOG_LIST_DOM_ID,{listTemplateDomId:this._LIST_TEMPLATE,itemTemplateDomId:this._LIST_ITEM_TEMPLATE,items:this._items}),this._list.show())},_close:function(){T.popup.hide(this._dialog),this._showConfirmAfterClose&&d.confirmDialog.showFromDetails()},_clickEventHandler:function(e){if(d.elementClicked(e,this._DETAIL_DIALOG_CLOSE_BUTTON_ID))return this._close(),!0}},i.exports=d}),define("dataChooser/domain.chooser.display",["require","exports","module","prototype","./domain.chooser","./domain.components","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/jrs-ui/src/core/core.layout","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/util/touch.controller"],function(e,t,i){var r=e("prototype"),n=r.$,o=r.$break,s=r.$H,a=e("./domain.chooser"),d=e("./domain.components"),l=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),u=e("runtime_dependencies/jrs-ui/src/core/core.layout"),c=e("runtime_dependencies/jrs-ui/src/util/utils.common"),m=c.isIPad,h=c.sessionManager,p=c.deepClone,f=e("runtime_dependencies/jrs-ui/src/util/touch.controller");a.display={ITEMS_TREE_DOM_ID:"foldersTreeRoot",CONTAINER_TREE_DOM_ID:"containerTree",MOVE_BUTTON_IDS:["#toTop","#upward","#downward","#toBottom"],treeItemsModel:null,treeItemsMap:{},listItemsModel:null,listItemsMap:{},itemOriginalLabels:null,flatList:null,flatListOrderChanged:!1,itemsTree:null,changeOrderController:new d.NodeChangeOrderController,lastSelectedNode:null,fillForm:function(){n("slSortedQueryTree").writeAttribute("value",a.display.getTreeItemsModelJSON()),n("slSortedQueryList").writeAttribute("value",a.display.getListItemsModelJSON()),n("isSimpleListCheckbox").writeAttribute("value",a.display.flatList?"true":"false"),n("unsavedChangesPresent").writeAttribute("value",a.isUnsavedChangesPresent().toString())},getTreeItemsModelJSON:function(){return a.display.convertNodesModelToJSON(a.display.treeItemsModel)},getListItemsModelJSON:function(){return a.display.convertNodesModelToJSON(a.display.listItemsModel)},convertNodesModelToJSON:function(e){var t="";return e.children&&e.children.each(function(e){t&&(t+=","),t+=a.display._convertNodeToJSON(e)}),"["+t+"]"},_prepareNodeForJSON:function(e){var t={};if(t.id=e.id,t.label=e.label,t.type=e.type,t.order=e.order,e.extra&&(t.labelId=e.extra.labelId?e.extra.labelId:"",t.dataType=e.extra.dataType?e.extra.dataType:"",t.resourceId=e.extra.resourceId),e.children){for(var i=e.children,r=new Array(i.length),n=0;n<i.length;n++)r[n]=a.display._prepareNodeForJSON(i[n]);r.sort(function(e,t){return e.order-t.order}),t.children=r}return t},_convertNodeToJSON:function(e){var t=a.display._prepareNodeForJSON(e);return Object.toJSON(t)},init:function(e){this.setUpJSONModels(e),this.initTree(),this.initFlatListOrderChanged(),this.initTreeEvents(),d.resetTreeSelectionHandler.init(this.MOVE_BUTTON_IDS.concat(["#"+this.ITEMS_TREE_DOM_ID]),function(){return[this.itemsTree]}.bind(this),this.itemSelectionClearCallback.bind(this)),d.registerClickHandlers([this.moveButtonsClickEventHandler.bind(this),this.displayAsButtonsClickEventHandler.bind(this)]),this.updateMoveButtonsState(),this.itemsTree.renderTree(),this.flatList||this.itemsTree.getRootNode()&&this.itemsTree.getRootNode().expandAllChilds()},setUpJSONModels:function(e){this.treeItemsModel=e.treeItemsModel,this.listItemsModel=e.listItemsModel,this.itemOriginalLabels=e.itemOriginalLabels,this.flatList=e.isFlatList},buildMapModelFromNode:function(e,t){t[e.id]=e,e.tooltip&&delete e.tooltip,e.children&&e.children.length>0&&e.children.each(function(i){i.parent=e,this.buildMapModelFromNode(i,t)}.bind(this))},buildTreeFromModel:function(e){this.itemsTree&&this.itemsTree.getRootNode()&&this.itemsTree.getRootNode().childs.each(function(e){e&&e.parent.removeChild(e)});var t=e?this.listItemsModel:this.treeItemsModel;this.itemsTree.setRootNode(this.itemsTree.processNode(t));for(var i in l.nodes){var r=l.nodes[i];if(this.itemOriginalLabels[r.param.id]&&(r.param.extra.label=this.itemOriginalLabels[r.param.id],e&&!r.isParent())){var n=this.treeItemsMap[r.param.id].parent;if(n){var o=this.itemOriginalLabels[n.id];r.param.extra.label=o+"."+r.param.extra.label}}r.getTreeId()===this.ITEMS_TREE_DOM_ID&&(r.editable=!0)}this.itemsTree.renderTree()},buildLeafArrayFromItemsMap:function(e){var t=[];for(var i in e){var r=e[i];r.children||t.push(r)}return t},initFlatListOrderChanged:function(){if(this.flatList)for(var e=this.buildLeafArrayFromItemsMap(this.treeItemsMap),t=this.buildLeafArrayFromItemsMap(this.listItemsMap),i=0;i<e.length;i++)if(e[i].id!==t[i].id){this.flatListOrderChanged=!0;break}},initTree:function(){if(this.itemsTree=d.createItemsTree({treeId:this.ITEMS_TREE_DOM_ID,nodeClass:d.TwoColumnNode,templateDomId:"list_responsive"}),this.itemsTree.NODE_CUSTOM_PATTERNS=[u.COLUMN_NODE_WRAPPER_PATTERN],this.itemsTree.LEAF_CUSTOM_PATTERNS=[u.COLUMN_LEAF_WRAPPER_PATTERN],[{rootNode:this.treeItemsModel,map:this.treeItemsMap},{rootNode:this.listItemsModel,map:this.listItemsMap}].each(function(e){this.buildMapModelFromNode(e.rootNode,e.map)}.bind(this)),this.buildTreeFromModel(this.flatList),m()){var e=n("containerTree");new f(e,e.up(1))}},deselectAllExceptSiblings:function(e){if(e&&e.parent&&e!=this.itemsTree.getRootNode()){var t=e.parent.childs.collect(function(e){return{node:e,selected:e.isSelected()}}),i=this.itemsTree.selectedNodes.collect(function(e){return e});this.itemsTree.resetSelected(),t.each(function(e){e.selected&&e.node.select()}),i.each(function(e){e.refreshStyle()})}},buildFlatLabel:function(e,t){if(e){for(var i=e.parent,r=l.trees[e.getTreeId()],n=t?e.name:e.param.extra.label;i&&i!=r.getRootNode();)-1==n.indexOf(i.name)&&(n=t?i.name+"."+n:i.param.extra.label+"."+n),i=i.parent;return n}},updateListItemsMapByNode:function(e){e&&(e.isParent()?e.hasChilds()&&e.childs.each(function(e){this.updateListItemsMapByNode(e)}.bind(this)):this.listItemsMap[e.param.id].label=this.buildFlatLabel(e,!0))},nodeMouseup:function(e){var t=e.memo.node;t&&(null!=l.treeNodeEdited&&l.treeNodeEdited!==t&&l.treeNodeEdited.doEndEdit(),null!=l.treeNodeEdited&&l.treeNodeEdited===t||(this.flatList||this.deselectAllExceptSiblings(t),1===this.itemsTree.selectedNodes.length&&this.lastSelectedNode===t&&t.edit()),1===this.itemsTree.selectedNodes.length?this.lastSelectedNode=this.itemsTree.selectedNodes.first():this.lastSelectedNode=null,this.updateMoveButtonsState(),h.resetSession(a.flowExecutionKey),Event.stop(e))},nodeEdit:function(e){var t=e.memo.node,i=e.memo.newValue;t&&t.name!==i&&(t.name=i,this.treeItemsMap[t.param.id].label=i,this.treeItemsMap[t.param.id].extra.labelId="",this.flatList?(this.listItemsMap[t.param.id].label=i,this.listItemsMap[t.param.id].extra.labelId=""):this.updateListItemsMapByNode(t)),t.deselect(),this.updateMoveButtonsState(),h.resetSession(a.flowExecutionKey),Event.stop(e)},initTreeEvents:function(){for(var e in this.treeEventFactory)this.itemsTree.observe(e,this.treeEventFactory[e].bind(this))},updateNodeOrderNumberInItemsMap:function(e,t){this.flatList?(this.flatListOrderChanged=!0,this.listItemsMap[e.param.id].order=t):this.treeItemsMap[e.param.id].order=t},updateMoveButtonsState:function(){if(this.itemsTree&&this.itemsTree.selectedNodes.length>0){var e=this.itemsTree.selectedNodes[0].parent,t=this.changeOrderController.findMaxSiblingNode(e.childs,!1,!0),i=this.changeOrderController.findMaxSiblingNode(e.childs,!0,!1),r=t&&t.orderNumber<i.orderNumber;["toTop","upward"].each(function(e){d.enableButton(e,r)});var n=this.changeOrderController.findMaxSiblingNode(e.childs,!1,!1),o=this.changeOrderController.findMaxSiblingNode(e.childs,!0,!0),s=n&&n.orderNumber>o.orderNumber;["downward","toBottom"].each(function(e){d.enableButton(e,s)})}else["toTop","upward","downward","toBottom"].each(function(e){d.enableButton(e,!1)})},moveButtonsClickEventHandler:function(e){var t=!1;return this.moveButtonsClickEventMap.each(function(i){if(d.elementClicked(e,i.key)){var r=this.itemsTree.selectedNodes,s=r.sort(i.value.upward?this.changeOrderController.nodeAscSorter:this.changeOrderController.nodeDescSorter),l=i.value.upward?s.first():s.last();throw s.each(function(e){this.changeOrderController.moveNode(e,i.value.upward,i.value.maxmove,this.updateNodeOrderNumberInItemsMap.bind(this))}.bind(this)),this.itemsTree.resortSubtree(r[0].parent),this.itemsTree.renderTree(),l.scroll(n(this.CONTAINER_TREE_DOM_ID)),this.updateMoveButtonsState(),h.resetSession(a.flowExecutionKey),t=!0,o}}.bind(this)),t},itemSelectionClearCallback:function(){null!=l.treeNodeEdited&&l.treeNodeEdited.doEndEdit(),this.updateMoveButtonsState()},convertTreeModelToListModel:function(e,t,i){if(e){if(!e.isParent()){var r=this.treeItemsMap[e.param.id],n={id:r.id,tooltip:r.tooltip,type:r.type,uri:r.uri};n.extra=p(r.extra),n.label=this.buildFlatLabel(e,!0),n.extra.label=this.buildFlatLabel(e,!1),n.order=t++,i.push(n)}return e.hasChilds()&&e.childs.each(function(e){t=this.convertTreeModelToListModel(e,t,i)}.bind(this)),t}},convertTreeViewToListView:function(){var e=[];this.convertTreeModelToListModel(this.itemsTree.getRootNode(),1,e),this.listItemsModel.children=e,this.buildMapModelFromNode(this.listItemsModel,this.listItemsMap)},displayAsButtonsClickEventHandler:function(e){var t=!1;return this.displayAsButtonsClickEventMap.each(function(i){if(d.elementClicked(e,i.key)){if(this.flatList!==i.value.flatListState)return;if(this.flatListOrderChanged&&!confirm(d.getMessage("sortingInfoWillBeLost")))return;throw this.flatListOrderChanged=!1,this.flatList=!this.flatList,this.flatList&&this.convertTreeViewToListView(),this.buildTreeFromModel(this.flatList),this.itemsTree.resortTree(),this.itemsTree.renderTree(),this.flatList||this.itemsTree.getRootNode()&&this.itemsTree.getRootNode().expandAllChilds(),i.value.removeClassName&&n("foldersTree").removeClassName(i.value.removeClassName),i.value.addClassName&&n("foldersTree").addClassName(i.value.addClassName),this.itemsTree.resetSelected(),this.updateMoveButtonsState(),h.resetSession(a.flowExecutionKey),t=!0,o}}.bind(this)),t}};var _=a.display;_.treeEventFactory={"leaf:mouseup":_.nodeMouseup,"node:mouseup":_.nodeMouseup,"node:edit":_.nodeEdit,"leaf:edit":_.nodeEdit},_.moveButtonsClickEventMap=s({"#toTop":{upward:!0,maxmove:!0},"#upward":{upward:!0,maxmove:!1},"#downward":{upward:!1,maxmove:!1},"#toBottom":{upward:!1,maxmove:!0}}),_.displayAsButtonsClickEventMap=s({"#nestedList":{flatListState:!0,removeClassName:"flat"},"#flatList":{flatListState:!1,addClassName:"flat"}}),void 0===e&&document.observe("dom:loaded",a.initialize.bind(a)),i.exports=d}),define("dataChooser/dataChooserDisplayMain",["require","exports","module","requirejs-domready","./domain.chooser.display","runtime_dependencies/js-sdk/src/jrs.configs","underscore","runtime_dependencies/jrs-ui/src/util/tools.drag","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.treesupport"],function(e,t,i){var r=e("requirejs-domready"),n=e("./domain.chooser.display"),o=e("runtime_dependencies/js-sdk/src/jrs.configs"),s=e("underscore");e("runtime_dependencies/jrs-ui/src/util/tools.drag"),e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.treesupport"),r(function(){s.extend(n._messages,o.dataChooser.domain._messages),s.extend(window.localContext,o.dataChooser.localContext),n.chooser.initialize()})});