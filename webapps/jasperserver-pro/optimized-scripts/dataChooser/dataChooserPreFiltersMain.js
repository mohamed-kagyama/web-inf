/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define("runtime_dependencies/js-sdk/src/common/util/datetime/RelativeDate",["require","exports","module","underscore"],function(e,t,i){var r=e("underscore"),n=function(e,t,i){this.setKeyword(e),this.setSign(t),this.setNumber(i)};n.prototype.setKeyword=function(e){this.keyword=e.toUpperCase()},n.prototype.setSign=function(e){this.sign=e},n.prototype.setNumber=function(e){if(r.isNumber(e))this.number=e;else{var t=parseInt(e,10);isNaN(t)?this.number=0:this.number=t}},n.prototype.toString=function(){return r.isNumber(this.number)&&!isNaN(this.number)&&this.number>0&&("+"===this.sign||"-"===this.sign)&&this.keyword in n.PATTERNS?this.keyword+this.sign+this.number.toString():this.keyword in n.PATTERNS?this.keyword:""},n.PATTERNS={DAY:/^(DAY)(([+|\-])(\d{1,9}))?$/i,WEEK:/^(WEEK)(([+|\-])(\d{1,9}))?$/i,MONTH:/^(MONTH)(([+|\-])(\d{1,9}))?$/i,QUARTER:/^(QUARTER)(([+|\-])(\d{1,9}))?$/i,SEMI:/^(SEMI)(([+|\-])(\d{1,9}))?$/i,YEAR:/^(YEAR)(([+|\-])(\d{1,9}))?$/i},n.parse=function(e){if(n.isValid(e))for(var t in n.PATTERNS){var i=n.PATTERNS[t].exec(e);if(null!==i&&r.isArray(i)&&5===i.length)return new n(i[1],i[3],i[4])}},n.isValid=function(e){if(e instanceof n)return""!==e.toString();if(r.isString(e))for(var t in n.PATTERNS)if(n.PATTERNS[t].test(e))return!0;return!1},i.exports=n}),define("runtime_dependencies/js-sdk/src/common/util/datetime/RelativeTimestamp",["require","exports","module","./RelativeDate","underscore"],function(e,t,i){var r=e("./RelativeDate"),n=e("underscore"),a=function(){r.apply(this,arguments)},o=function(){};o.prototype=r.prototype,a.prototype=new o,a.prototype.constructor=a,a.PATTERNS={DAY:/^(DAY)(([+|\-])(\d{1,9}))?$/i,WEEK:/^(WEEK)(([+|\-])(\d{1,9}))?$/i,MONTH:/^(MONTH)(([+|\-])(\d{1,9}))?$/i,QUARTER:/^(QUARTER)(([+|\-])(\d{1,9}))?$/i,SEMI:/^(SEMI)(([+|\-])(\d{1,9}))?$/i,YEAR:/^(YEAR)(([+|\-])(\d{1,9}))?$/i},a.parse=function(e){if(a.isValid(e))for(var t in a.PATTERNS){var i=a.PATTERNS[t].exec(e);if(null!==i&&n.isArray(i)&&5===i.length)return new a(i[1],i[3],i[4])}},a.isValid=function(e){if(e instanceof a)return""!==e.toString();if(n.isString(e))for(var t in a.PATTERNS)if(a.PATTERNS[t].test(e))return!0;return!1},i.exports=a}),define("runtime_dependencies/js-sdk/src/common/util/parse/date",["require","exports","module","momentExtension","../../../jrs.configs","underscore","../datetime/RelativeDate","../datetime/RelativeTimestamp"],function(e,t,i){function r(e){var t=e;return t=e.indexOf("yy")>-1?t.replace("yy","YYYY"):t.replace("y","YY"),e.indexOf("mm")>-1?t=t.replace("mm","MM"):e.indexOf("MM")>-1?t=t.replace("MM","MMMM"):e.indexOf("m")>-1?t=t.replace("m","M"):e.indexOf("M")>-1&&(t=t.replace("M","MMM")),e.indexOf("dd")>-1?t=t.replace("dd","DD"):e.indexOf("DD")>-1?t=t.replace("DD","dddd"):e.indexOf("d")>-1?t=t.replace("d","D"):e.indexOf("D")>-1&&(t=t.replace("D","ddd")),t}function n(e){return e.toUpperCase()}function a(e){return e.toLowerCase().replace("hh","HH")}function o(e){return e.replace("aaa","a")}function s(e,t,i){var n=r(e),o=a(t);return n+(null!=i?i:" ")+o}function l(e,t,i){i=void 0!==i&&i,t=t||" ";var s=e.split(t),l=s[0],d=s.length>1?s[1]:null,u=i?n:r,c=i?o:a;(l.indexOf("h")>0||l.indexOf("H")>0||l.indexOf("s")>0)&&(d=l,l=null);var h="";return l&&(h+=u(l)),d&&(h&&(h+=t),h+=c(d)),h}function d(e){return P(e,r(U.dateFormat),!0)}function u(e){return P(e,s(U.dateFormat,U.timeFormat,U.timestampSeparator),!0)}function c(e){return H.isValid(e)}function h(e){return B.isValid(e)}function m(e){return j.isDate(e)&&P(e).isValid()||j.isString(e)&&""!==e&&d(e).isValid()}function p(e){return j.isDate(e)&&P(e).isValid()||j.isString(e)&&""!==e&&u(e).isValid()}function f(e){return P(e,q,!0).isValid()}function E(e,t){if(m(e)&&m(t)){return _(j.isDate(e)?P(e):d(e),j.isDate(t)?P(t):d(t))}}function g(e,t){if(p(e)&&p(t)){return _(j.isDate(e)?P(e):u(e),j.isDate(t)?P(t):u(t))}}function _(e,t){return e.isBefore(t)?-1:e.isAfter(t)?1:0}function T(e){var t=P(e);if(j.isDate(e)&&t.isValid())return t.format(q)}function v(e){var t=P(e,q,!0);if(t.isValid())return t.toDate()}function y(e){return F(e,s(U.dateFormat,U.timeFormat,U.timestampSeparator),q)}function I(e){return F(e,q,s(U.dateFormat,U.timeFormat,U.timestampSeparator))}function M(e){return F(e,r(U.dateFormat),z)}function b(e){return F(e,z,r(U.dateFormat))}function N(e){return F(e,a(U.timeFormat),Y)}function V(e){return F(e,Y,a(U.timeFormat))}function F(e,t,i){if(H.isValid(e))return e;var r=P(e,t,!0);return r.isValid()?r.format(i):e}function C(e){return P(e,z,!0)}function A(e){return e.format(z)}function D(e){return e.format(r(U.dateFormat))}function S(e,t){var i;return i=t?P.tz(e,t).tz(G):P.utc(e).tz(G),i.format(r(U.dateFormat))}function O(e,t){var i=P.duration(e),r=P.utc();return t&&r.tz(t),r.hours(i.hours()),r.minutes(i.minutes()),r.seconds(i.seconds()),r.tz(G).format(a(U.timeFormat))}function R(e,t){var i;return i=t?P.tz(e,t).tz(G):P.utc(e).tz(G),i.format(s(U.dateFormat,U.timeFormat,U.timestampSeparator))}function L(e,t){e=M(e);var i=P.tz(e,G);return i=t?i.tz(t):i.utc(),i.format(z)}function w(e,t){var i=P.duration(e),r=P.utc(),n=r.tz(G);n.hours(i.hours()),n.minutes(i.minutes()),n.seconds(i.seconds());var a;return a=t?n.tz(t):n.utc(),a.format(Y)}function x(e,t){e=y(e);var i=P.tz(e,G);return i=t?i.tz(t):i.utc(),i.format(q)}var P=e("momentExtension"),k=e("../../../jrs.configs"),j=e("underscore"),H=e("../datetime/RelativeDate"),B=e("../datetime/RelativeTimestamp"),U=k.localeSettings,G=k.userTimezone,q="YYYY-MM-DD[T]HH:mm:ss",z="YYYY-MM-DD",Y="HH:mm:ss";i.exports={isRelativeDate:c,isRelativeTimestamp:h,isDate:m,isTimestamp:p,isIso8601Timestamp:f,compareDates:E,compareTimestamps:g,iso8601DateToMoment:C,momentToIso8601Date:A,momentToLocalizedDate:D,dateObjectToIso8601Timestamp:T,iso8601TimestampToDateObject:v,localizedTimestampToIsoTimestamp:y,isoTimestampToLocalizedTimestamp:I,localizedDateToIsoDate:M,isoDateToLocalizedDate:b,localizedTimeToIsoTime:N,isoTimeToLocalizedTime:V,toMomentDateOrTimeOrTimestampPattern:l,isoDateToLocalizedDateByTimezone:S,localizedDateToIsoDateByTimezone:L,isoTimeToLocalizedTimeByTimezone:O,localizedTimeToIsoTimeByTimezone:w,isoTimestampToLocalizedTimestampByTimezone:R,localizedTimestampToIsoTimestampByTimezone:x}}),define("runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils",["require","exports","module","underscore"],function(e,t,i){var r=e("underscore"),n=function(e){function t(e){return"."===e?e="\\.":" "===e&&(e="\\s"),e}e=e||{},this.DECIMAL_SEPARATOR=e.decimalSeparator||".",this.GROUPING_SEPARATOR=e.groupingSeparator||",",this.decimalSeparator=t(this.DECIMAL_SEPARATOR),this.groupingSeparator=t(this.GROUPING_SEPARATOR),this.DECIMAL_NUMBER_PATTERN=new RegExp("^-?([1-9]{1}[0-9]{0,2}("+this.groupingSeparator+"[0-9]{3})*("+this.decimalSeparator+"[0-9]+)?|[1-9]{1}[0-9]{0,}("+this.decimalSeparator+"[0-9]+)?|0("+this.decimalSeparator+"[0-9]+)?)$"),this.INTEGER_NUMBER_PATTERN=new RegExp("^-?([1-9]{1}[0-9]{0,2}("+this.groupingSeparator+"[0-9]{3})*|[1-9]{1}[0-9]{0,}|0)$")},a=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER+1:9007199254740992,o=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER-1:-9007199254740992;n.prototype.number_format=function(e,t,i,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+e)?+e:0,a=isFinite(+t)?Math.abs(t):0,o=void 0===r?",":r,s=void 0===i?".":i,l=(a?function(e,t){var i=Math.pow(10,t);return""+(Math.round(e*i)/i).toFixed(t)}(n,a):""+Math.round(n)).split(".");return l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(l[1]||"").length<a&&(l[1]=l[1]||"",l[1]+=new Array(a-l[1].length+1).join("0")),l.join(s)},n.prototype.isInt=function(e){return this.isNumberInt(e)||this.isStringInt(e)},n.prototype.isNumberInt=function(e){return r.isNumber(e)&&!isNaN(e)&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY&&(e===+e&&e===(0|e)||e%1==0)},n.prototype.isStringInt=function(e){return r.isString(e)&&this.INTEGER_NUMBER_PATTERN.test(e)},n.prototype.isInt32=function(e){return this.isInt(e)&&this.parseNumber(e)>=-2147483648&&this.parseNumber(e)<=2147483647},n.prototype.isDecimal=function(e){return r.isNumber(e)&&!isNaN(e)&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY||r.isString(e)&&this.DECIMAL_NUMBER_PATTERN.test(e)},n.prototype.parseNumber=function(e){if(r.isNumber(e))return e;if(r.isString(e)&&this.DECIMAL_NUMBER_PATTERN.test(e)){e=e.replace(new RegExp(this.groupingSeparator,"g"),"").replace(new RegExp(this.decimalSeparator,"g"),".");var t=1*e;return t>=a||t<=o?(window.console&&window.console.warn(e+" is out of the ["+(o+1)+", "+(a-1)+"] bounds. Parsing results may be corrupted. Use string representation instead. For more details see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number."),!1):t}},n.prototype.formatNumber=function(e,t){t=t||{};var i=e.toString().split(".")[1],n=i?i.length:0;r.isUndefined(t.decimalPlacesAmount)||(n=t.decimalPlacesAmount);try{return this.number_format(e,n,t.decimalSeparator||this.DECIMAL_SEPARATOR,t.groupingSeparator||this.GROUPING_SEPARATOR)}catch(t){return e.toString()}},n.prototype.MaxRange=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER+1:9007199254740992,n.prototype.MinRange=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER-1:-9007199254740992,i.exports=n}),define("dataChooser/domain.base",["require","exports","module","prototype","underscore","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.ajax","../core/core.ajax.utils","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/js-sdk/src/common/util/parse/date","momentExtension","runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"],function(e,t,i){var r=e("prototype"),n=r.$,a=r.Template,o=r.$break,s=r.$$,l=e("underscore"),d=e("runtime_dependencies/jrs-ui/src/util/utils.common"),u=d.buildActionUrl,c=d.matchAny,h=d.isSupportsTouch,m=d.deepClone,p=e("runtime_dependencies/jrs-ui/src/core/core.ajax"),f=p.AjaxRequester,E=p.ajaxTargettedUpdate,g=e("../core/core.ajax.utils"),_=g.baseErrorHandler,T=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),v=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),y=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),I=e("runtime_dependencies/js-sdk/src/common/util/parse/date"),M=e("momentExtension"),b=e("runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"),N=new b,V={PROPAGATE_EVENT:"propagateEvent",_messages:{},disabledFolderTooltip:"disabledFolderTooltip",attributesPattern:new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),getMessage:function(e,t){var i=this._messages[e];return i?new a(i).evaluate(t||{}):""},setMessage:function(e,t){this._messages[e]=t},treeErrorHandler:function(){throw"exception while loading tree"},submitForm:function(e,t,i){if(t){var r=u(t);i&&i(),n(e).writeAttribute("method","post").writeAttribute("action",r),n(e).submit()}},sendAjaxRequest:function(e,t,i,r){var n=u(e),a={postData:Object.toQueryString(t),callback:i,errorHandler:this._serverErrorHandler,mode:f.prototype.EVAL_JSON};r&&Object.extend(a,r),E(n,a)},_serverErrorHandler:function(e,t){return _(e)},elementClicked:function(e,t){return!(!e||!t)&&c(e,[t],!0)},basicClickHandler:function(e,t,i){var r=null;return t.any(function(t){if(r=V.elementClicked(e,t.key))return Object.isFunction(t.value)?t.value(r):Object.isFunction(i)&&i(t.value),!0})},registerClickHandlers:function(e,t,i){if(V._bodyClickEventHandlers)return void(i?Array.prototype.unshift:Array.prototype.push).apply(V._bodyClickEventHandlers,e);V._bodyClickEventHandlers=e,s(t||"body")[0].observe(h()?"touchstart":"click",function(e){var t=e.element();V._bodyClickEventHandlers&&V._bodyClickEventHandlers.each(function(i){var r=i(t);if(r)throw r!==V.PROPAGATE_EVENT&&Event.stop(e),o})})},enableButton:function(e,t){"string"==typeof e&&(e=n(e)),e.disabled=t,t?T.enable(e):T.disable(e)},setOptionsToSelect:function(e,t){if(e&&(e.update(""),t))return t.each(function(t){var i={value:t.value,title:t.label};t.selected&&(i.selected="selected");var r=new Element("option",i);r.appendChild(document.createTextNode(t.label)),e.appendChild(r)}),e},getDataIslandId:function(e,t){var i=v.trees[e.getTreeId()].getRootNode();return function e(t,r){return null===t.parent||t.parent===i?t.param.extra[r]:e(t.parent,r)}(e,t)},areNodesFromSameIsland:function(e,t){return!!e.any(function(e){return e.param.extra.isConstant})||(!(1!==e.pluck("parent").uniq().length)||1===e.map(function(e){return V.getDataIslandId(e,t||"itemId")}).uniq().length)},NumberFormat:function(e,t){var i="."===e,r=new RegExp("["+e.gsub(/\s/,"\\s")+"]+"),n=new RegExp("["+t.gsub(/\s/,"\\s")+"]+"),a=new RegExp("^-|\\"+t+"?\\d+|\\"+t+"$|\\"+e+"+","g");return{toNumber:function(e){return!e||!i&&/[.]/.test(e)?NaN:Number(e.gsub(n,"").gsub(r,"."))||V.attributesPattern.test(e)},normalizeNumberEntry:function(i){var r=i.strip(),n=r.match(V.attributesPattern)||r.match(a);if(!n)return"";for(var o=!1,s=0;s<n.length;s++)n[s].startsWith(e)?o?delete n[s]:(n[s]=e,o=!0):n[s].startsWith(t)&&o&&(n[s]=n[s].substring(1));return n.join("")},isInteger:function(e){return r.test(e)}}},baseValidator:function(e,t){var i=!0,r="";return e()&&(r=t,i=!1),{isValid:i,errorMessage:r}},maxLengthValidator:function(e,t,i){return V.baseValidator(function(e,t){return e.length>t}.curry(e,t),i)},minLengthValidator:function(e,t,i){return V.baseValidator(function(e,t){return e.length<t}.curry(e,t),i)},valueNotEmptyValidator:function(e,t){return V.baseValidator(function(e){return Object.isArray(e)&&0===e.length||!e||!String(e).strip()}.curry(e),t)},stringIdValidator:function(e,t){return V.baseValidator(function(e){return!/^[^0-9() .,'"=!+-\/><\/\/:][^() .,'"=!+-\/><\/\/:]*$/.test(e)}.curry(e),t)},numberValidator:function(e,t,i){return V.baseValidator(isNaN.curry(t.toNumber(e)),i)},numberBoundsValidator:function(e,t,i){return V.baseValidator(function(e,t){return e===N.MinRange||e===N.MaxRange||!(e<=t.max&&e>=t.min)}.curry(e,t),i)},rangeValidator:function(e,t,i){return V.baseValidator(function(e,t){return!(e<t)}.curry(e,t),i)},dateValidator:function(e,t,i,r){return V.baseValidator(function(){var r=I.toMomentDateOrTimeOrTimestampPattern(t,i);return!M(e,r,!0).isValid()&&!V.attributesPattern.test(e)},r)},unescapeTree:function e(t){t.hasChilds()&&l.each(t.childs,function(t){e(t)}),t.name=y.unescape(t.name)}};V.NodeCopyMoveController=function(){},V.NodeCopyMoveController.addMethod("copy",function(e,t,i){if(e&&e.length>0&&t){var r=v.trees[t.getTreeId()],n=e.collect(function(e){var n=e.param.id,a=this._copyParentStructure(e,r);return a?this._mergeToDestTree(a,t,n,i):null}.bind(this));return t.isloaded=!0,n.without(null)}}),V.NodeCopyMoveController.addMethod("copySelected",function(e,t){if(window.sourceTree&&t)return this.copy(window.sourceTree.selectedNodes,t)}),V.NodeCopyMoveController.addMethod("move",function(e,t){if(e&&t){var i=this.copy(e,t);return this.hide(e),i}}),V.NodeCopyMoveController.addMethod("moveSelected",function(e,t){if(e&&t)return this.move(e.selectedNodes,t)}),V.NodeCopyMoveController.addMethod("hide",function(e,t,i){if(e&&e.length>0){t||(t=this._getVisibleChildrenCount),i||(i=function(e,t){e.hide(t)});var r=v.trees[e[0].getTreeId()];e.collect(function(e){return e.id}).each(function(e){var n=v.nodes[e];i(n,!0);for(var a=n.parent;a&&a!=r.getRootNode()&&!(t(a)>0);)i(a,!1),a.refreshStyle(),a=a.parent}.bind(this))}}),V.NodeCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){return e.param.id}),V.NodeCopyMoveController.addMethod("_markAsLoaded",function(e){e.isloaded=!0,e.isParent()&&e.childs.each(function(e){this._markAsLoaded(e)}.bind(this))}),V.NodeCopyMoveController.addMethod("_mergeToDestTree",function(e,t,i,r){if(t){var n=v.trees[t.getTreeId()];if(r)return i=this._handleDuplicatedNode(e,t),n.findNodeById(i,e);var a=n.findNodeChildByMetaName(t,e.param.id);return null!=a?(a.isHidden()&&a.show(),e.hasChilds()&&(a.disabled&&a.enable(e.tooltip),e.childs.each(function(e){this._mergeToDestTree(e,a)}.bind(this))),n.findNodeById(i,a)):(t.addChild(e),this._markAsLoaded(e),n.findNodeById(i,e))}}),V.NodeCopyMoveController.addMethod("_copyParentStructure",function(e,t){if(e&&t){var i=v.trees[e.getTreeId()];if(e.disabled)return null;for(var r=this._copyNode(e,t,!0),n=e.parent,a=null;n&&n!=i.getRootNode();)a=this._copyNode(n,t,!1),a.addChild(r),r=a,n=n.parent;return r}}),V.NodeCopyMoveController.addMethod("_buildMetanode",function(e){return m(e.param)}),V.NodeCopyMoveController.addMethod("_copyNode",function(e,t,i){if(e&&t){var r=t.processNode(this._buildMetanode(e));i&&(e.hasChilds()?e.childs.each(function(e){if(!e.disabled){var e=this._copyNode(e,t,i);e&&r.addChild(e)}}.bind(this)):r.setHasChilds(!1));var n=e.childs.findAll(function(e){return e.disabled});return e.childs.length>0&&n.length==e.childs.length?null:r}}),V.NodeCopyMoveController.addMethod("_delete",function(e){e&&e.collect(function(e){return e.id}).each(function(e){var t=v.nodes[e];t&&t.parent.removeChild(t)})}),V.NodeCopyMoveController.addMethod("_getVisibleChildrenCount",function(e){var t=e.childs.findAll(function(e){return e.isHidden()});return e.childs.length-t.length}),V.resetTreeSelectionHandler={_COMMON_ELEMENTS_TO_SAVE_SELECTION:["#pageDimmer","#detail","#standardConfirm"],_getTrees:null,_elementIds:null,_callback:null,_validator:null,init:function(e,t,i,r){V.resetTreeSelectionHandler._init.bind(V.resetTreeSelectionHandler,e,t,i,r)()},_init:function(e,t,i,r){this._getTrees=t,this._callback=i,this._validator=r,this._elementIds=this._COMMON_ELEMENTS_TO_SAVE_SELECTION.concat(e),V.registerClickHandlers([this._removeTreeSelectionClickEventHandler.bind(this)],null,!0)},_removeTreeSelectionClickEventHandler:function(e){if(!c(e,this._elementIds,!0)){var t=!1;return this._getTrees().each(function(e){if(e.selectedNodes&&e.selectedNodes.first())throw t=!0,o}),t?!(!this._validator||this._validator())||(this._getTrees().each(function(e){e._deselectAllNodes()}),this._callback&&this._callback(),!1):!1}}},V.NodeChangeOrderController=function(){},V.NodeChangeOrderController.addMethod("findNodeWithSpecificOrder",function(e,t,i){for(var r=e.length-1;r>=0;r--)if(e[r].isSelected()==i&&e[r].orderNumber===t)return e[r];return null}),V.NodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i){var r=null,n=null;return e.each(function(e){e.isSelected()==t&&(null!==r&&i!=e.orderNumber<r||(r=e.orderNumber,n=e))}),n}),V.NodeChangeOrderController.addMethod("moveNode",function(e,t,i,r){var n=e.orderNumber,a=e.parent.childs,o=null,s=null;i?(o=this.findMaxSiblingNode(a,!1,t,e.param.type),s=o?o.orderNumber:-1,a.each(function(i){i.param.id!==e.param.id&&(t==i.orderNumber>s&&t==i.orderNumber<n||i.orderNumber==s)&&(i.orderNumber=t?i.orderNumber+1:i.orderNumber-1,r&&r(i,i.orderNumber))}),r&&r(e,s),e.orderNumber=s):(s=t?e.orderNumber-1:e.orderNumber+1,(o=this.findNodeWithSpecificOrder(a,s,!1))&&(r&&r(e,s),r&&r(o,n),e.orderNumber=s,o.orderNumber=n))}),V.NodeChangeOrderController.addMethod("nodeAscSorter",function(e,t){return e.orderNumber-t.orderNumber}),V.NodeChangeOrderController.addMethod("nodeDescSorter",function(e,t){return t.orderNumber-e.orderNumber}),V.DisplayNodeChangeOrderController=function(){V.NodeChangeOrderController.call()},V.DisplayNodeChangeOrderController.prototype=m(V.NodeChangeOrderController.prototype),V.DisplayNodeChangeOrderController.addMethod("findMaxSiblingNode",function(e,t,i,r){var n=null,a=null;return e.each(function(e){e.isSelected()==t&&(null!==n&&i!=e.orderNumber<n||r&&e.param.type!==r||(n=e.orderNumber,a=e))}),a}),i.exports=V}),define("dataChooser/domain.chooser",["require","exports","module","prototype","underscore","jquery","runtime_dependencies/js-sdk/src/jrs.configs","./domain.base"],function(e,t,i){var r=e("prototype"),n=r.$,a=r.$break,o=r.$H,s=e("underscore"),l=e("jquery"),d=e("runtime_dependencies/js-sdk/src/jrs.configs"),u=e("./domain.base"),c=new RegExp("[\\?&]reportType=([^&#]*)");u.chooser={FLOW_ID:"adhocFlow",FIELDS:"dataChooserFields",DISPLAY:"dataChooserDisplay",SAVE_AS_TOPIC:"dataChooserSaveAsTopic",PRE_FILTERS:"dataChooserPreFilters",submitFormId:"stepDisplayForm",currentPage:null,flowExecutionKey:null,unsavedChangesPresent:!1,initialize:function(e){var t=c.exec(location.search);if(this.reportType=null==t?"":decodeURIComponent(t[1].replace(/\+/g," ")),window.localContext.rsInitOptions){var i=window.localContext.rsInitOptions;this.currentPage=n(document.body).identify(),this.flowExecutionKey=i.flowExecutionKey,this.unsavedChangesPresent=i.unsavedChangesPresent;var r=this.pageInitFactory[this.currentPage]();i=s.extend({},i,e),this.initModule(r,i),u.registerClickHandlers([this.getFlowControlsClickEventHandler()])}},initModule:function(e,t){e&&(e.fillForm&&(h.fillForm=e.fillForm.bind(e)),e.getFlowControlsClickEventHandler&&(h.getFlowControlsClickEventHandler=e.getFlowControlsClickEventHandler.bind(e)),e.init.bind(e)(t))},fillForm:function(){},getFlowControlsClickEventHandler:function(){return h.flowControlsClickEventHandler.bind(h)},flowControlsClickEventHandler:function(e){var t=!1;return this.flowControlsEventMap.each(function(i){if(u.elementClicked(e,i.key)){if(t=!0,i.value.returnOnPage&&this.currentPage===i.value.returnOnPage)throw a;if(i.value.confirmLeave&&!this.confirmAndLeave())throw a;throw delete i.value.returnOnPage,i.value.flowId=this.FLOW_ID,i.value.flowExecutionKey=this.flowExecutionKey,i.value.reportType=this.reportType,d.initAdditionalUIComponents||(i.value.decorate="no"),"cancelRedirect"===i.value.eventId&&l(document).trigger("adhocDesigner:cancel"),u.submitForm(this.submitFormId,i.value,this.fillForm),a}}.bind(this)),t}};var h=u.chooser;h.confirmAndLeave=function(){return!h.unsavedChangesPresent||confirm(u.getMessage("exitMessage"))},h.setUnsavedChangesPresent=function(e){h.unsavedChangesPresent=!!e},h.isUnsavedChangesPresent=function(){return h.unsavedChangesPresent},h.pageInitFactory={dataChooserFields:function(){return u.chooser.fields},dataChooserPreFilters:function(){return u.chooser.preFilters},dataChooserDisplay:function(){return u.chooser.display},dataChooserSaveAsTopic:function(){return u.chooser.saveAsTopic}},h.flowControlsEventMap=o({"#fieldsTab":{returnOnPage:u.chooser.FIELDS,eventId:"fields"},"#filtersTab":{returnOnPage:u.chooser.PRE_FILTERS,eventId:"preFilters"},"#displayTab":{returnOnPage:u.chooser.DISPLAY,eventId:"display"},"#saveTopicTab":{returnOnPage:u.chooser.SAVE_AS_TOPIC,eventId:"saveAsTopic"},"#goToDesigner":{eventId:"done",reportType:h.reportType},"#cancel":{eventId:"cancelRedirect",confirmLeave:!0}}),window.domain=window.domain||{},window.domain.chooser={confirmAndLeave:h.confirmAndLeave},i.exports=h}),define("dataChooser/domain.components",["require","exports","module","prototype","underscore","jquery","./domain.base","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/jrs-ui/src/components/list.base","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.layout","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/jrs-ui/src/components/components.dialogs"],function(e,t,i){var r=e("prototype"),n=r.$,a=r.$$,o=e("underscore"),s=e("jquery"),l=e("./domain.base"),d=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),u=e("runtime_dependencies/jrs-ui/src/components/list.base"),c=u.dynamicList,h=e("runtime_dependencies/jrs-ui/src/util/utils.common"),m=h.deepClone,p=e("runtime_dependencies/jrs-ui/src/core/core.layout"),f=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),E=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),g=e("runtime_dependencies/jrs-ui/src/components/components.dialogs");l.ItemNode=function(e){d.TreeNode.call(this,e),this.Types={Folder:new d.TreeNode.Type("ItemGroupType"),Leaf:new d.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_fields:fields",this._hidden=!1,this.disabled=!1},l.ItemNode.prototype=m(d.TreeNode.prototype),l.ItemNode.addMethod("hide",function(e){if(e&&this.hasChilds())for(var t=0;t<this.getChildCount();t++)this.childs[t].hide(!0);var i=(this.childs.findAll(function(e){return e.disabled}).length,this.childs.findAll(function(e){return e.isHidden()}).length),r=this.childs.length-i;this.disabled||0!==r?this.getType()===this.Types.Leaf&&(this.deselect(),this.disable(l.getMessage(l.disabledFolderTooltip))):(this._hidden=!0,this.deselect(),this.refreshStyle())}),l.ItemNode.addMethod("show",function(){this._hidden=!1,this._getElement()&&this.refreshStyle(this._getElement())}),l.ItemNode.addMethod("disable",function(e){e&&(this.tooltip=e),this.disabled=!0,this._getElement()&&this.refreshStyle(this._getElement())}),l.ItemNode.addMethod("enable",function(e){e&&(this.tooltip=e),this.disabled=!1,this._getElement()&&this.refreshStyle(this._getElement())}),l.ItemNode.addMethod("refreshStyle",function(e){if(e||(e=this._getElement())){d.TreeNode.prototype.refreshStyle.call(this,e),this.isHidden()?e.addClassName(p.HIDDEN_CLASS):e.removeClassName(p.HIDDEN_CLASS);var t=e.select("p").first();t&&(this.tooltip?t.title=this.tooltip:t.title="",this.disabled?(f.disable(t),f.disable(e)):(f.enable(t),f.enable(e)))}}),l.ItemNode.addMethod("isHidden",function(){return this._hidden}),l.ItemNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.labelId=e.labelId||"",t.descr=e.descr,t.descrId=e.descrId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=o.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),l.ItemNode.addMethod("hasVisibleChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.isHidden()})}),l.ItemNode.addMethod("hasEnabledChilds",function(){return this.hasChilds()&&!!this.childs.find(function(e){return!e.disabled})}),l.ItemNode.addMethod("removeChilds",function(){this.hasChilds()&&this.childs.each(function(e){this.removeChild(e)}.bind(this))}),l.FieldsCopyMoveController=function(){l.NodeCopyMoveController(this)},l.FieldsCopyMoveController.prototype=m(l.NodeCopyMoveController.prototype),l.FieldsCopyMoveController.addMethod("_buildMetanode",function(e){var t=m(e.param);return t.label=e.name,t.order=e.orderNumber,t.tooltip=e.tooltip,t}),l.TwoColumnNode=function(e){d.TreeNode.call(this,e),this.Types={Folder:new d.TreeNode.Type("ItemGroupType",{}),Leaf:new d.TreeNode.Type("ItemType",{})},this.nodeHeaderTemplateDomId="list_responsive:twoColumn"},l.TwoColumnNode.prototype=m(d.TreeNode.prototype),l.TwoColumnNode.addMethod("_createNode",function(){var e=this.id,t=(d.trees[this.getTreeId()],this._getHeaderTemplateElement());t.id=this.NODE_ID_PREFIX+e,this.refreshStyle(t),t.treeNode=this;var i=t.childElements()[0];this.tooltip&&(i.title=this.tooltip),i.childElements()[0].id=this.HANDLER_ID_PREFIX+e;var r=i.childElements()[1],n=this.param.extra&&this.param.extra.label?this.param.extra.label:this.name;r.insert(E.hardEscape(n)),i.childElements()[2].insert(E.hardEscape(this.name)),this._element=t}),l.TwoColumnNode.addMethod("_getTitle",function(){var e=this._getElement().childElements()[0].childElements()[2];return e.cleanWhitespace(),0===e.childNodes.length&&e.appendChild(document.createTextNode("")),e.childNodes[0]}),l.TwoColumnNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type,order:this.orderNumber.toString()};return e&&(t.labelId=e.labelId||"",t.dataType=e.dataType||"",t.resourceId=e.resourceId),this.isParent()&&(t.children=o.invoke(this.childs,"toJSON")),t}),l.TwoColumnNode.addMethod("expandAllChilds",function(){var e=d.trees[this.getTreeId()];this.isParent()&&!this.isOpen()&&(e.writeStates(this.id,d.TreeNode.State.OPEN),this.refreshNode()),this.hasChilds()&&this.childs.each(function(e){e.expandAllChilds()})}),l.TablesNode=function(e){d.TreeNode.call(this,e),this.Types={Folder:new d.TreeNode.Type("level"),Leaf:new d.TreeNode.Type("item")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_tables:tables"},l.TablesNode.prototype=m(l.ItemNode.prototype),l.TablesNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,label:this.name,type:this.param.type};return e&&(t.originalId=e.originalId,t.datasourceId=e.datasourceId,t.repoId=e.repoId,t.itemId=e.itemId,t.dataSource=e.dataSource,t.table=e.table,this.isParent()?(t.query=e.query,t.dataSetType=e.dataSetType):(t.expression=e.expression,t.islandId=e.islandId,t.isConstant=e.isConstant,t.JavaType=e.JavaType,t.JdbcType=e.JdbcType),e.fieldDbName&&(t.fieldDbName=e.fieldDbName)),this.isParent()&&(t.children=o.chain(this.childs).filter(function(e){return!e.isHidden()}).invoke("toJSON").value()),t}),l.TablesNode.addVar("CONSTANT_TABLE_ID","constant_fields_level"),l.TablesNode.addVar("CROSSTABLES_FIELDS_TABLE_ID","crossTablesFieldsLevel"),l.TablesNode.addVar("INVALID_NODE_CLASS","invalid"),l.TablesNode.addVar("DATA_ISLAND_CLASS","dataIsland"),l.TablesNode.addVar("DERIVED_TABLE_CLASS","table derived"),l.TablesNode.addVar("CONSTANT_TABLE_CLASS","table constant"),l.TablesNode.addVar("CALCULATED_FIELD_CLASS","field calculated"),l.TablesNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(l.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS),this.param.extra&&this.param.extra.expression&&e.addClassName(this.CALCULATED_FIELD_CLASS),this.param.extra&&this.param.extra.query&&e.addClassName(this.DERIVED_TABLE_CLASS),this.param.id===this.CONSTANT_TABLE_ID&&e.addClassName(this.CONSTANT_TABLE_CLASS),this.param.extra&&this.param.extra.isIsland&&e.addClassName(this.DATA_ISLAND_CLASS))}),l.TablesNode.addMethod("edit",function(e){e&&"dblclick"!==e.type||l.ItemNode.prototype.edit.call(this,e)}),l.TablesCustomNode=function(e){l.TablesNode.call(this,e),this.nodeHeaderTemplateDomId=e.param.type===this.Types.Folder.name?"list_responsive_collapsible_type_tables:tables":"list_responsive_collapsible_type_tables:fields"},l.TablesCustomNode.prototype=m(l.TablesNode.prototype),l.TablesCopyMoveController=function(){l.NodeCopyMoveController(this)},l.TablesCopyMoveController.prototype=m(l.NodeCopyMoveController.prototype),l.TablesCopyMoveController.addMethod("_buildMetanode",function(e){var t={id:e.param.id,label:e.name,type:e.param.type,uri:e.param.uri};return e.param.extra&&(t.extra={originalId:e.param.extra.originalId,table:e.param.extra.table,itemId:e.param.extra.itemId,datasourceId:e.param.extra.datasourceId,repoId:e.param.extra.repoId,dataSource:e.param.extra.dataSource,dataSetType:e.param.extra.dataSetType,query:e.param.extra.query},e.param.extra.expression&&(t.extra.expression=e.param.extra.expression),e.param.extra.fieldDbName&&(t.extra.fieldDbName=e.param.extra.fieldDbName),e.isParent()||(t.extra.JavaType=e.param.extra.JavaType,t.extra.JdbcType=e.param.extra.JdbcType,t.extra.sourceItem=e.parent.param.extra.originalId)),t}),l.TablesCopyMoveController.addMethod("_handleDuplicatedNode",function(e,t){if(e.isParent()){for(var i=1,r=e.param.extra.datasourceId+"."+e.param.extra.itemId+i,n=d.trees[t.getTreeId()];n.findNodeChildByMetaName(t,r);)i++,r=e.param.extra.datasourceId+"."+e.param.extra.itemId+i;return e.param.id=r,e.param.extra.itemId+=i,e.name=e.param.extra.itemId,e.param.extra.originalId=e.param.extra.itemId,t.addChild(e),e.isloaded=!0,e.hasChilds()&&e.childs.each(function(t){this._handleDuplicatedNode(t,e)}.bind(this)),r}e.param.id=e.parent.param.id+"."+e.param.extra.itemId,e.param.extra.originalId=e.parent.param.extra.originalId+"."+e.param.extra.itemId}),l.DerivedTablesNode=function(e){l.TablesNode.call(this,e),e.param.type===this.Types.Folder.name&&e.param.extra&&e.param.extra.query&&(this.isSelectable=!0)},
l.DerivedTablesNode.prototype=m(l.TablesNode.prototype),l.JoinsList=function(e,t){c.List.call(this,e,t)},l.JoinsList.prototype=m(c.List.prototype),l.JoinsList.addMethod("_changeHandler",function(e){var t=this.getItemByEvent(e);t&&(t._respondOnItemEvents&&!e.isInvoked&&this.fire("item:change",{targetEvent:e,item:t}),e.isInvoked=!0)}),l.JoinsList.addMethod("_initEvents",function(){c.List.prototype._initEvents.call(this);var e=this._getElement();s(e).off("change").on("change","select",o.bind(this._changeHandler,this))}),l.JoinsListItem=function(e){c.ListItem.call(this,e),this._hidden=!1},l.JoinsListItem.prototype=m(c.ListItem.prototype),l.JoinsListItem.addMethod("hide",function(e){this._hidden=!!e,this.refreshStyle()}),l.JoinsListItem.addMethod("refreshStyle",function(){c.ListItem.prototype.refreshStyle.call(this),this._getElement()&&(this._hidden?this._getElement().addClassName(p.HIDDEN_CLASS):this._getElement().removeClassName(p.HIDDEN_CLASS))}),l.JoinsListItem.addMethod("processTemplate",function(e){var t=e.childElements()[0];t.cleanWhitespace();var i=t.childElements()[1],r=t.childElements()[2],n=t.childElements()[3],a=n.childElements()[0],o=a.childElements();return i.update(E.hardEscape(this._value.left.table.label+":"+this._value.left.label)),r.update(E.hardEscape(this._value.right.table.label+":"+this._value.right.label)),o.each(function(e){e.selected=e.value===this._value.type}.bind(this)),e}),l.JoinsListItem.addMethod("setJoinType",function(e){this.getValue().type=e;var t=this._getElement();if(t){var i=t.childElements()[0].childElements()[3].childElements()[0];n(i).value=e}}),l.JoinsListItem.addMethod("toJSON",function(){return{left:this._value.left.id,right:this._value.right.id,type:this._value.type}}),l.DisplayNode=function(e){l.ItemNode.call(this,e),this.Types={Folder:new d.TreeNode.Type("ItemGroupType"),Leaf:new d.TreeNode.Type("ItemType")},this.nodeHeaderTemplateDomId="list_responsive_collapsible_type_sets:sets"},l.DisplayNode.prototype=m(l.ItemNode.prototype),l.DisplayNode.addMethod("toJSON",function(){var e=this.param.extra,t={id:this.param.id,type:this.param.type};return e&&(t.itemId=e.itemId,t.descr=e.descr,t.labelId=e.labelId||"",t.descrId=e.descrId||"",t.resourceId=e.resourceId||""),e&&e.label&&(t.label=e.label),this.isParent()?t.children=o.chain(this.childs).filter(function(e){return!e.isHidden()&&!e._markAsDeleted}).invoke("toJSON").value():(t.dataType=e.dataType,t.dimensionOrMeasure=e.dimensionOrMeasure,t.defaultMask=e.defaultMask,t.defaultAgg=e.defaultAgg),t}),l.DisplayNode.addVar("INVALID_NODE_CLASS","invalid"),l.DisplayNode.addMethod("refreshStyle",function(e){(e||(e=this._getElement()))&&(l.ItemNode.prototype.refreshStyle.call(this,e),this.param.extra&&"true"===this.param.extra.isInvalid?e.addClassName(this.INVALID_NODE_CLASS):e.removeClassName(this.INVALID_NODE_CLASS))}),l.genericTreeParams={rootUri:"/",showRoot:!1,nodeClass:l.ItemNode,treeClassName:"",multiSelectEnabled:!0},l.createItemsTree=function(e){return e=Object.extend(m(l.genericTreeParams),e),new d.TreeSupport(e.treeId,e)},l.confirmDialog={MODE_OK_CANCEL:"okCancel",MODE_YES_NO:"yesNo",_CONFIRM_DIALOG_DOM_ID:"standardConfirm",_CONFIRM_DIALOG_BODY_DOM_PATTERN:"#standardConfirm > .content > .body",_CONFIRM_DIALOG_OK_BUTTON_ID:"#confirmYes",_CONFIRM_DIALOG_CANCEL_BUTTON_ID:"#confirmNo",_CONFIRM_DIALOG_OK_PATTERN:"#confirmYes > span",_CONFIRM_DIALOG_CANCEL_PATTERN:"#confirmNo > span",_yesMessageHolder:null,_noMessageHolder:null,_dialog:null,_onOk:null,_onCancel:null,_customEventHandler:null,_templateDomId:null,_visible:!1,init:function(){l.confirmDialog._init.bind(l.confirmDialog)()},show:function(e,t,i,r,n){l.confirmDialog._show.bind(l.confirmDialog,e,t,i,r,n)()},hideForDetails:function(){g.popup.hide(l.confirmDialog._dialog)},showFromDetails:function(){g.popup.show(l.confirmDialog._dialog,!0)},visible:function(){return l.confirmDialog._visible},_init:function(){this._dialog=n(this._CONFIRM_DIALOG_DOM_ID),this._yesMessageHolder=a(this._CONFIRM_DIALOG_OK_PATTERN).first(),this._noMessageHolder=a(this._CONFIRM_DIALOG_CANCEL_PATTERN).first(),l.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e,t,i,r,a){this._onOk=t,this._onCancel=i,this._customEventHandler=r,this._templateDomId=e,a&&a==this.MODE_YES_NO?(this._yesMessageHolder.update(l.getMessage("yes")),this._noMessageHolder.update(l.getMessage("no"))):(this._yesMessageHolder.update(l.getMessage("ok")),this._noMessageHolder.update(l.getMessage("cancel"))),n(this._templateDomId).removeClassName(p.HIDDEN_CLASS),g.popup.show(this._dialog,!0),this._visible=!0},_hide:function(e){n(this._templateDomId).addClassName(p.HIDDEN_CLASS),g.popup.hide(this._dialog),this._visible=!1,e&&e()},_clickEventHandler:function(e){return l.elementClicked(e,this._CONFIRM_DIALOG_OK_BUTTON_ID)?(this._hide(this._onOk),!0):l.elementClicked(e,this._CONFIRM_DIALOG_CANCEL_BUTTON_ID)?(this._hide(this._onCancel),!0):this._customEventHandler?this._customEventHandler(e):void 0}},l.detailsDialog={_DETAIL_DIALOG_DOM_ID:"detail",_DETAIL_DIALOG_CLOSE_BUTTON_ID:"#close",_DETAIL_DIALOG_LIST_DOM_ID:"detailsList",_DETAIL_DIALOG_TEXT_DOM_ID:"detailsText",_LIST_TEMPLATE:"defaultListTemplate",_LIST_ITEM_TEMPLATE:"dynamicListItemTemplate",_dialog:null,_showConfirmAfterClose:!1,_list:null,_listItems:null,init:function(){l.detailsDialog._init.bind(l.detailsDialog)()},show:function(e){l.detailsDialog._show.bind(l.detailsDialog,e)()},_init:function(){this._dialog=n(this._DETAIL_DIALOG_DOM_ID),l.registerClickHandlers([this._clickEventHandler.bind(this)])},_show:function(e){l.confirmDialog.visible()?(l.confirmDialog.hideForDetails(),this._showConfirmAfterClose=!0):this._showConfirmAfterClose=!1,this._createMessage(e),g.popup.show(this._dialog,!0),n(this._DETAIL_DIALOG_LIST_DOM_ID).parentNode.scrollTop=0},_createMessage:function(e){"string"==typeof e?(n(this._DETAIL_DIALOG_LIST_DOM_ID).addClassName(p.HIDDEN_CLASS),n(this._DETAIL_DIALOG_TEXT_DOM_ID).removeClassName(p.HIDDEN_CLASS).update(e)):(n(this._DETAIL_DIALOG_TEXT_DOM_ID).addClassName(p.HIDDEN_CLASS),n(this._DETAIL_DIALOG_LIST_DOM_ID).removeClassName(p.HIDDEN_CLASS),this._items&&(this._list.removeItems(this._items),this._items=null,this._list=null),this._items=e.collect(function(e){return new c.ListItem({label:e})}),this._list=new c.List(this._DETAIL_DIALOG_LIST_DOM_ID,{listTemplateDomId:this._LIST_TEMPLATE,itemTemplateDomId:this._LIST_ITEM_TEMPLATE,items:this._items}),this._list.show())},_close:function(){g.popup.hide(this._dialog),this._showConfirmAfterClose&&l.confirmDialog.showFromDetails()},_clickEventHandler:function(e){if(l.elementClicked(e,this._DETAIL_DIALOG_CLOSE_BUTTON_ID))return this._close(),!0}},i.exports=l}),define("dataChooser/domain.filters",["require","exports","module","dragdropextra","prototype","underscore","jquery","./domain.components","runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils","runtime_dependencies/jrs-ui/src/components/list.base","runtime_dependencies/js-sdk/src/common/util/xssUtil","runtime_dependencies/jrs-ui/src/core/core.layout","runtime_dependencies/jrs-ui/src/util/touch.controller","runtime_dependencies/js-sdk/src/common/util/parse/date","momentExtension","runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"],function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=e("dragdropextra"),a=n.Droppables,o=e("prototype"),s=o.$,l=o.$$,d=o.Selector,u=o.Field,c=e("underscore"),h=e("jquery"),m=e("./domain.components"),p=e("runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker"),f=e("runtime_dependencies/jrs-ui/src/util/utils.common"),E=f.isNotNullORUndefined,g=f.disableSelectionWithoutCursorStyle,_=f.deepClone,T=f.matchAny,v=f.ValidationModule,y=f.isIE,I=f.isIPad,M=f.enableSelection,b=f.cancelEventBubbling,N=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"),V=e("runtime_dependencies/jrs-ui/src/components/list.base"),F=V.dynamicList,C=e("runtime_dependencies/js-sdk/src/common/util/xssUtil"),A=e("runtime_dependencies/jrs-ui/src/core/core.layout"),D=e("runtime_dependencies/jrs-ui/src/util/touch.controller"),S=e("runtime_dependencies/js-sdk/src/common/util/parse/date"),O=e("momentExtension"),R=e("runtime_dependencies/js-sdk/src/common/util/parse/NumberUtils"),L=new R;m.typesMap={Integer:"number",Decimal:"number",BigDecimal:"number",Time:"date",Date:"date",Timestamp:"date",String:"string",Boolean:"boolean"},m.javaNumericTypesValidation={"java.lang.Double":{min:L.MinRange,max:L.MaxRange},"java.math.BigDecimal":{min:-1/0,max:1/0},"java.lang.Long":{min:"-9223372036854775808",max:"9223372036854775807"},"java.lang.Integer":{min:"-2147483648",max:"2147483647"},"java.lang.Short":{min:"-32768",max:"32767"},"java.lang.Byte":{min:"-128",max:"127"}},m.getNumberBounds=function(e){return m.javaNumericTypesValidation[e]},m.filter={CALENDAR_DATE_FORMAT:"M dd yy",CALENDAR_TIMESTAMP_FORMAT:"M dd yy",CALENDAR_TIME_FORMAT:"HH:mm:ss",init:function(e){this.TIMEZONE_OFFSET=e.timeOffset,this.FILTER_DATE_FORMAT=e.dateFormat||"MMM dd yyyy",this.FILTER_TIMESTAMP_FORMAT=e.dateTimeFormat||"MMM dd yyyy HH:mm:ss",this.FILTER_TIME_FORMAT=e.timeFormat||"HH:mm:ss",this.CALENDAR_DATE_TIME_SEPARATOR=e.calendarDateTimeSeparator||" ",this.CALENDAR_DATE_FORMAT=e.calendarDateFormat||"M dd yy",this.CALENDAR_TIMESTAMP_FORMAT=e.calendarDateTimeFormat||"M dd yy",this.CALENDAR_TIME_FORMAT=e.calendarTimeFormat||"HH:mm:ss",this.DECIMAL_SEPARATOR=e.decimalSeparator||".",this.GROUPING_SEPARATOR=e.groupingSeparator||",",this.numberFormat=m.NumberFormat(this.DECIMAL_SEPARATOR,this.GROUPING_SEPARATOR),window.MONTH_NAMES=window.Calendar._SMN,window.DAY_NAMES=window.Calendar._SDN,this.ATTRIBUTES_PATTERN=new RegExp("\\s*attribute\\s*\\(\\s*'[^\\/'\\s][^\\/']*'(?:\\s*,\\s*'[^\\/'\\s][^\\/']*')*\\s*\\)\\s*"),this.ATTRIBUTE_VALUE_PATTERN=new RegExp("'(.*)'"),m.javaToDataTypeMap=e.javaToDataTypeMap},toNumber:function(e){return this.numberFormat.toNumber(e)},normalizeNumberEntry:function(e){return this.numberFormat.normalizeNumberEntry(e)},toString:function(e){switch(r(e)){case"undefined":case"function":case"unknown":return"{''}";case"boolean":case"number":case"string":return"{"+e.toString()+"}"}return null===e?"{''}":Object.isArray(e)?"{"+this.arrayToString(e)+"}":void 0},arrayToString:function(e){return e.collect(function(e){return E(e)&&""!==e?e:"''"}).join(", ")}},m.FilterItem=function(e){if(!e||!e.node&&!e.json)throw"Trying to create FilterItem with empty input";this.fieldId=null,this.id=null,this.name=null,this.type=null,this.value=null,this.comparison="",this.locked=null,this.dataType=null,this.javaType=null,this.index=1,e.node?this._initNode(e.node):this._initJson(e.json)},c.extend(m.FilterItem.prototype,{_initNode:function(e){if(e&&e.param&&e.param.extra){var t=e.param.extra;this.setFieldId(e.param.id),this.name=e.name,this.value=[],this.locked=!1,this.javaType=t.JavaType,m.javaToDataTypeMap&&this.javaType&&(t.dataType=m.javaToDataTypeMap[this.javaType]),this.dataType=t.dataType,this.type=m.typesMap[this.dataType]}},_initJson:function(e){e&&(this.init=!0,this.setFieldId(e.fieldId),this.name=e.fieldName,this.type=e.ruleTypeId||e.ruleType,this.setValues(e.value||e.values),this.locked=!e.isParameter,this.comparison=e.comparisonId||e.comparison,this.dataType=e.dataType,this.javaType=e.javaType||e.JavaType)},setFieldId:function(e){this.fieldId=e,this.id=this.normalizeIdentifier(e)},setValues:function(e){if("field"===this.type){this.field2Id=e[0];var t=c.find(N.nodes,function(t){return t.param.id===e[0]});this.name2=t&&t.name}else"string"===this.type&&null===e[0]&&(e=[m.getMessage("filter_null_value")]);this.value=e},getValues:function(){return"field"===this.type?[this.field2Id]:this.value},normalizeIdentifier:function(e){return e&&e.length>0?e.gsub(/[.]/,"_").gsub(/[\W]/,""):e},updateIndex:function(e){this.index=e,this.id+="_"+e,this.init||(this.name+="_"+e)},toJSON:function(){return{fieldId:this.fieldId,fieldName:this.name,ruleTypeId:this.type,value:this.getValues(),isParameter:!this.locked,comparisonId:this.comparison,dataType:this.dataType,javaType:this.javaType}},initFieldFilterItem:function(e){this.type="field",this.field2Id=e.fieldId,this.name2=e.name,this.value=[this.name2]}}),m.FilterList=function(e){if(this._valueList=[],this._keyPositionMapping={},e&&"object"===r(e))for(var t in e)this.set(t,e[t])},c.extend(m.FilterList.prototype,{reIndex:function(e,t){var i;for(var r in this._keyPositionMapping)(i=this._keyPositionMapping[r])>e&&(this._keyPositionMapping[r]=i+t)},unset:function(e){this._valueList.splice(this._keyPositionMapping[e],1),this.reIndex(this._keyPositionMapping[e],-1),delete this._keyPositionMapping[e]},set:function(e,t,i){this._keyPositionMapping[e]>=0?this._valueList.splice(this._keyPositionMapping[e],1,t):(i=i>=0?i:this._valueList.length,this._valueList.splice(i,0,t),i<this._valueList.length-1&&this.reIndex(i-1,1),this._keyPositionMapping[e]=i)},get:function(e){return this._valueList[this._keyPositionMapping[e]]},size:function(){return this._valueList.length},values:function(){return this._valueList.clone()},collect:function(e){return c.collect.call(c,this._valueList,e)}}),m.FilterEditor=function(e,t){this.filterValue=e,t&&(this.flowExecutionKey=t),this.init()},c.extend(m.FilterEditor.prototype,{EDITOR_TEMPLATE:"editorTemplate",create:function(e,t){if(!e||!e.type)return null;var i=null;switch(e.type){case"string":i=new m.StringFilterEditor(e,t);break;case"number":i=new m.NumberFilterEditor(e);break;case"date":case"time":i=new m.DateFilterEditor(e);break;case"boolean":i=new m.BooleanFilterEditor(e);break;case"field":i=new m.FieldFilterEditor(e);break;default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:e.type})}return i},init:function(){this.valueEditorsCache={},this.valueEditorsFactory=this.createValueEditorsFactory(),this.initTemplate(),this.initComparisons(this.getFirstComparison()),this.initEventHandlers()},createValueEditorsFactory:function(){return{}},afterDraw:function(){this.fillinTemplate()},beforeRemove:function(){this.removeEventHandlers()},initTemplate:function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE),this.fieldNameElement=this.editorTemplate.select(".fieldName").first()},fillinTemplate:function(){this.fieldNameElement.update(C.hardEscape(this.getOriginalValue().name)),this.updateFilterValueEditor()},initComparisons:function(e){this._comparisons=this.createComparisons(),this.comparisonId=e,this.comparisonsSelect=this.editorTemplate.select("#fieldAndOperation select")[0],this._comparisons.each(function(t,i){var r={id:t,title:m.getMessage(t)};t===e&&(r.selected="selected",this.selectedIndex=i);var n=new Element("option",r).insert(m.getMessage(t));this.comparisonsSelect.insert(n)}.bind(this))},getFirstComparison:function(){return this.getOriginalValue().comparison||"equals"},initEventHandlers:function(){this.comparisonsSelect.observe("change",this.comparisonSelectedHandler.bindAsEventListener(this)),this.getTemplate().observe("submit",function(e){Event.stop(e)})},removeEventHandlers:function(){Event.stopObserving(this.comparisonsSelect),Event.stopObserving(this.getTemplate())},comparisonSelectedHandler:function(e){this.comparisonId=m.getSelectedOptionId(e.element()),this.updateFilterValueEditor()},updateFilterValueEditor:function(){this.valueEditor=this.createValueEditor(this.comparisonId);var e=this.valueEditor.getTemplate();this.editorTemplate.select("#values")[0].replace(e),this.valueEditor.afterDraw()},createValueEditor:function(e){if(!e)return null;var t=this.getFactoryKey(e),i=this.valueEditorsCache[t];if(!i)try{i=this.valueEditorsFactory[t](this.getOriginalValue.bind(this),e,this.flowExecutionKey),this.valueEditorsCache[t]=i}catch(e){throw"Editor for #{name} is undefined".interpolate({name:t})}return i},processTemplate:function(e){var t=e.select(".fieldName")[0],i=e.select(".operation")[0],r=e.select(".value")[0],n=e.select(".lock")[0],a=this.getValue(),o=a.getOriginalValue();t.update(C.hardEscape(o.name)),i.update(C.hardEscape(m.getMessage(o.comparison))),r.update(C.hardEscape(a.getFormattedValue())),a.lockStatusElement&&n.update(o.locked?C.hardEscape(m.getMessage("domain.filter.locked")):C.hardEscape(m.getMessage("domain.filter.unlocked")));var s="f"+o.id+"_filter";if(!l("#"+s)[0]){var d=a.getTemplate();d.removeClassName("hidden"),e.appendChild(d),d.writeAttribute("id",s)}return e},getTemplate:function(){return this.editorTemplate},getOriginalValue:function(){return this.filterValue},getFormattedValue:function(){return m.filter.toString(this.getOriginalValue().value)},resetToCurrentEditor:function(){this.comparisonId=this.getOriginalValue().comparison,this.comparisonsSelect.selectedIndex=this.selectedIndex},applyEditorValue:function(){this.filterValue=this.getValue(),this.selectedIndex=this.comparisonsSelect.selectedIndex},cancel:function(){this.resetToCurrentEditor(),g(s(document.body)),this.valueEditor&&this.valueEditor.cancel()},getValue:function(){var e=_(this.getOriginalValue());return e.value=this._toArray(this.valueEditor.getValue()),e.comparison=this.comparisonId,e},validate:function(){return this.valueEditor.validate()},_cloneTemplate:function(e){return Element.clone(e,!0)||null},_toArray:function(e){return Object.isArray(e)?e:[e]},handleClick:function(e){this.valueEditor&&m.FilterValueEditor.handleClick.call(this.valueEditor,e)}}),m.StringFilterEditor=function(e,t){m.FilterEditor.call(this,e,t)},m.StringFilterEditor.prototype=_(m.FilterEditor.prototype),m.StringFilterEditor.addMethod("createComparisons",function(){return["isOneOf","isNotOneOf","equals","doesNotEqual","contains","doesNotContain","startsWith","doesNotStartWith","endsWith","doesNotEndWith"]}),m.StringFilterEditor.addMethod("getFactoryKey",function(e){switch(e){case"isOneOf":case"isNotOneOf":return"MultipleValuesEditor";case"equals":case"doesNotEqual":return"ComboSelectEditor";case"contains":case"doesNotContain":case"startsWith":case"doesNotStartWith":case"endsWith":case"doesNotEndWith":return"StringValueEditor";default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}}),m.StringFilterEditor.addMethod("createValueEditorsFactory",function(){return{MultipleValuesEditor:function(e,t,i){return new m.MultipleValuesEditor(e,t,i)},ComboSelectEditor:function(e,t,i){return new m.ComboSelectEditor(e,t,i)},StringValueEditor:function(e,t,i){return new m.StringValueEditor(e,t,i)}}}),m.NumberFilterEditor=function(e){m.FilterEditor.call(this,e)},m.NumberFilterEditor.prototype=_(m.FilterEditor.prototype),m.NumberFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo","isBetween","isNotBetween"]}),m.NumberFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isGreaterThan":case"lessThan":case"isGreaterThanOrEqualTo":case"isLessThanOrEqualTo":t=new m.NumberValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new m.NumberRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),m.NumberFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return e.value[0]}}),m.NumberFilterEditor.addMethod("updateFilterValueEditor",function(){m.FilterEditor.prototype.updateFilterValueEditor.call(this),this.registerBlurHandlers()}),m.NumberFilterEditor.addMethod("registerBlurHandlers",function(){var e=this.valueEditor.getValueElement();!Object.isArray(e)&&(e=[e]),e.invoke("observe","blur",function(e){var t=this.getValue(),i=m.filter.normalizeNumberEntry(t);t!=i&&this.setValue(i)})}),m.BooleanFilterEditor=function(e){m.FilterEditor.call(this,e)},m.BooleanFilterEditor.prototype=_(m.FilterEditor.prototype),m.BooleanFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo"]}),m.BooleanFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":t=new m.BooleanSelectEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),m.DateFilterEditor=function(e,t){m.FilterEditor.call(this,e,t)},m.DateFilterEditor.prototype=_(m.FilterEditor.prototype),m.DateFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),m.DateFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new m.DateValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new m.DateRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),m.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return m.FilterEditor.prototype.getFormattedValue.call(this)}}),m.TimeFilterEditor=function(e,t){m.FilterEditor.call(this,e,t)},m.TimeFilterEditor.prototype=_(m.FilterEditor.prototype),m.TimeFilterEditor.addMethod("createComparisons",function(){return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore","isBetween","isNotBetween"]}),m.TimeFilterEditor.addMethod("createValueEditor",function(e){if(!e)return null;var t=null;switch(e){case"equals":case"isNotEqualTo":case"isAfter":case"isBefore":case"isOnOrAfter":case"isOnOrBefore":t=new m.StringValueEditor(this.getOriginalValue.bind(this),e);break;case"isBetween":case"isNotBetween":t=new m.TimeRangeEditor(this.getOriginalValue.bind(this),e);break;default:throw"Undefined Value type : #{valueType}".interpolate({valueType:e})}return t}),m.DateFilterEditor.addMethod("getFormattedValue",function(){var e=this.getOriginalValue();switch(e.comparison){case"isBetween":case"isNotBetween":return"{"+e.value.join(" and ")+"}";default:return m.FilterEditor.prototype.getFormattedValue.call(this)}}),m.FieldFilterEditor=function(e,t){this.newFilterValue=_(e),m.FilterEditor.call(this,e,t)},m.FieldFilterEditor.prototype=_(m.FilterEditor.prototype),m.FieldFilterEditor.addMethod("createComparisons",function(){switch(m.typesMap[this.getOriginalValue().dataType]){case"string":return["equals","contains","startsWith","endsWith","doesNotEqual","doesNotContain"];case"number":return["equals","isNotEqualTo","isGreaterThan","lessThan","isGreaterThanOrEqualTo","isLessThanOrEqualTo"];case"date":return["equals","isNotEqualTo","isAfter","isBefore","isOnOrAfter","isOnOrBefore"];case"boolean":return["equals","isNotEqualTo"];default:throw"Unsupported editor type: [#{editorType}]".interpolate({editorType:window.filterValue.type})}}),m.FieldFilterEditor.addMethod("initTemplate",function(){this.editorTemplate=this._cloneTemplate(this.EDITOR_TEMPLATE);var e=this.editorTemplate.down(".checkBox.lock");e&&e.remove();var t=this._cloneTemplate("fieldEditor");t.writeAttribute("id","fieldAndOperation"),t.removeClassName("hidden"),this.editorTemplate.select("#fieldAndOperation").first().replace(t),this.fieldNameElement=this.editorTemplate.select(".fieldName").first(),this.fieldValueElement=this.editorTemplate.select(".fieldName")[1]}),m.FieldFilterEditor.addMethod("handleClick",function(e){T(e,["button#swap"],!0)&&this.swapClickHandler()}),m.FieldFilterEditor.addMethod("fillinTemplate",function(){var e=this.newFilterValue;this.fieldNameElement.update(C.hardEscape(e.name)),this.fieldValueElement.update(C.hardEscape(e.name2))}),m.FieldFilterEditor.addMethod("getValue",function(){return this.newFilterValue.comparison=this.comparisonId,this.newFilterValue.locked=!0,this.newFilterValue}),m.FieldFilterEditor.addMethod("cancel",function(){this.resetToCurrentEditor(),this.newFilterValue=_(this.getOriginalValue())}),m.FieldFilterEditor.addMethod("getFormattedValue",function(){return"{"+String(this.getOriginalValue().name2)+"}"}),m.FieldFilterEditor.addMethod("validate",function(){return!0}),m.FieldFilterEditor.addMethod("swapClickHandler",function(){var e=this.newFilterValue,t=e.name,i=e.fieldId;return e.name=e.name2,e.fieldId=e.field2Id,e.name2=t,e.field2Id=i,e.value=[e.name],this.fillinTemplate(),!0}),m.FieldFilterEditor.addMethod("comparisonSelectedHandler",function(e){this.comparisonId=m.getSelectedOptionId(e.element())}),m.FilterValueEditor=function(e,t){this.getOriginalValue=e,this.currentComparisonId=t,this.init()},m.FilterValueEditor.addMethod("init",function(){this.initTemplate(),this.afterTemplateInitialization(),this.initValidators(),this.initEventHandlers(),this.clickHandlersHash=this.createHandlersHash()}),m.FilterValueEditor.addMethod("initTemplate",function(){this.template=this.createTemplate(),this.initValueElements()}),m.FilterValueEditor.addMethod("createTemplate",function(){var e=Element.clone(this.valueEditorId,!0);return e.writeAttribute("id","values"),e.removeClassName("hidden"),e}),m.FilterValueEditor.addMethod("afterTemplateInitialization",function(){}),m.FilterValueEditor.addMethod("fillinTemplate",function(){this.currentComparisonId===this.getOriginalValue().comparison&&this.setValue(this.getOriginalValue().value),this.setTitle(this.currentComparisonId)}),m.FilterValueEditor.addMethod("setTitle",function(e){var t=this.getValueElement();!Object.isArray(t)&&(t=[t]),t&&t.each(function(t){(t.up("label")||t).writeAttribute("title",this.getTitleMessage(e))}.bind(this))}),m.FilterValueEditor.addMethod("getTitleMessage",function(){return m.getMessage("filter_default_title")}),m.FilterValueEditor.addMethod("initValidators",function(){this.validators=this.createCommonValidators().concat(this.createValidators())}),m.FilterValueEditor.addMethod("createCommonValidators",function(){return[{validator:function(){return m.valueNotEmptyValidator(this.getValue(),m.getMessage("value_should_be_not_empty"))}.bind(this),element:this.getValueElement()}]}),m.FilterValueEditor.addMethod("createValidators",function(){return[]}),m.FilterValueEditor.addMethod("validate",function(){return this.removeMalicious(),v.validate(this.validators)}),m.FilterValueEditor.addMethod("removeMalicious",function(){this.setValue(this.stripValue(this.getValue()))}),m.FilterValueEditor.handleClick=function(e){var t=c.find(this.clickHandlersHash,function(t,i){return e.match(i)});t&&t.call(this,e)},m.FilterValueEditor.addMethod("createHandlersHash",function(){return{}}),m.FilterValueEditor.addMethod("afterDraw",function(){this.fillinTemplate()}),m.FilterValueEditor.addMethod("initValueElements",function(){}),m.FilterValueEditor.addMethod("initEventHandlers",function(){}),m.FilterValueEditor.addMethod("cancel",function(){}),m.FilterValueEditor.addMethod("getTemplate",function(){return this.template}),m.FilterValueEditor.addMethod("setValue",function(e){this.getValueElement().setValue(String(e[0]))}),m.FilterValueEditor.addMethod("getValue",function(){return this.getValueElement().getValue()}),m.FilterValueEditor.addMethod("stripValue",function(e){var t=function(e){return e?e.strip().stripScripts():""};return Object.isArray(e)?e.collect(t):[t(e)]}),m.FilterValueEditor.addMethod("isTimestampField",function(){return"Timestamp"===this.getOriginalValue().dataType}),m.FilterValueEditor.addMethod("isTimeField",function(){return"Time"===this.getOriginalValue().dataType}),m.FilterValueEditor.addMethod("_getControlName",function(){return this.isTimestampField()?"datetimepicker":this.isTimeField()?"timepicker":"datepicker"}),m.FilterValueEditor.addMethod("getValueElement",function(){}),m.SingleDictionaryEditor=function(e,t,i){this.searchParams={limitType:"contains",itemId:e().fieldId,searchWord:""},this.flowExecutionKey=i,m.FilterValueEditor.apply(this,arguments)},m.SingleDictionaryEditor.prototype=_(m.FilterValueEditor.prototype),m.SingleDictionaryEditor.addMethod("afterTemplateInitialization",function(){this.retrieveAvailableDictionaryValues(this.searchParams)}),m.SingleDictionaryEditor.addMethod("initValueElements",function(){this.searchInputElement=this.getTemplate().select(".searchLockup input")[0],this.searchButtonElement=this.getTemplate().select(".searchLockup > .search.button")[0],this.searchClearElement=this.getTemplate().select(".searchLockup .button.searchClear")[0]}),m.SingleDictionaryEditor.addMethod("initEventHandlers",function(){this.searchInputElement.observe("keyup",this.handleKeyup.bind(this))}),m.SingleDictionaryEditor.addMethod("handleKeyup",function(e){switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_ESC:case Event.KEY_LEFT:case Event.KEY_UP:case Event.KEY_RIGHT:case Event.KEY_DOWN:case Event.KEY_DELETE:case Event.KEY_HOME:case Event.KEY_END:case Event.KEY_PAGEUP:case Event.KEY_PAGEDOWN:case Event.KEY_INSERT:return!0;case Event.KEY_RETURN:this.doSearch();break;default:this.onCharacterPressed(e)}return!0}),m.SingleDictionaryEditor.addMethod("createHandlersHash",function(){return{".button.search":function(){this.doSearch()},".button.searchClear":function(){this.onClearButtonClicked(),this.doSearch(this.onClearButtonClicked.bind(this))}}}),m.SingleDictionaryEditor.addMethod("onCharacterPressed",function(){this.updateSearchClearButtonState()}),m.SingleDictionaryEditor.addMethod("updateSearchClearButtonState",function(){this.searchInputElement.getValue().blank()?this.searchClearElement.removeClassName(A.UP_CLASS):this.searchClearElement.addClassName(A.UP_CLASS)}),m.SingleDictionaryEditor.addMethod("doSearch",function(e){v.hideError(this.getAvailableValueElement()),this.searchParams.itemId=this.getOriginalValue().fieldId,this.searchParams.searchWord=this.searchInputElement.getValue(),this.retrieveAvailableDictionaryValues(this.searchParams,e)}),m.SingleDictionaryEditor.addMethod("onClearButtonClicked",function(){this.setSearchValue("")}),m.SingleDictionaryEditor.addMethod("retrieveAvailableDictionaryValues",function(e,t){m.sendAjaxRequest({flowExecutionKey:this.flowExecutionKey,eventId:"availableValues"},e,this.handleAvailableValuesRetrieved.bindAsEventListener(this,t))}),m.SingleDictionaryEditor.addMethod("handleAvailableValuesRetrieved",function(e,t){if(!e||"object"!==r(e)){if("INFO:TOO_MANY_ROWS"===e)return v.showError(this.getAvailableValueElement(),m.getMessage("domain.filter.too_many_records")),void this.getAvailableValueElement().update("");e=[]}try{this.updateDictionaryValuesSelect(e),Object.isFunction(t)&&t()}catch(e){throw"Available values response handling error : #{error}".interpolate({error:e})}}),m.SingleDictionaryEditor.addMethod("initValidators",function(){this.validators=this.createValidators()}),m.SingleDictionaryEditor.addMethod("setSearchValue",function(e){this.searchInputElement.setValue(e),this.updateSearchClearButtonState()}),m.SingleDictionaryEditor.addMethod("afterValueSet",function(){this.updateSearchClearButtonState()}),m.MultipleValuesEditor=function(e,t,i){m.SingleDictionaryEditor.apply(this,arguments)},m.MultipleValuesEditor.prototype=_(m.SingleDictionaryEditor.prototype),m.MultipleValuesEditor.addVar("valueEditorId","multipleValues"),m.MultipleValuesEditor.addMethod("initValueElements",function(){m.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0],this.selectedValuesElement=this.getTemplate().select("select.selectedValues")[0]}),
m.MultipleValuesEditor.addMethod("initEventHandlers",function(){m.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments);var e=y()?"click":"mouseup";e=I()?"blur":e;var t=this.getTemplate();t.on(e,"select.availableValues",m.moveOption.bindAsEventListener(this,function(){return this.selectedValuesElement}.bind(this))),t.on(e,"select.selectedValues",m.moveOption.bindAsEventListener(this,function(){return this.availableValuesElement}.bind(this)))}),m.MultipleValuesEditor.addMethod("updateDictionaryValuesSelect",function(e){var t=m.getSelectValues(this.selectedValuesElement),i=c.difference(e,t),r=m.createSelectWithOptions(i,{class:this.availableValuesElement.readAttribute("class"),multiple:"multiple"});this.availableValuesElement;this.availableValuesElement.replace(r),this.availableValuesElement=this.getTemplate().select("select.availableValues")[0]}),m.moveOption=m.MultipleValuesEditor.moveSelectOption=function(e,t){function i(e,i){e.remove();var r=c.find(i.options,function(t){return t.value>e.value}),n=C.hardEscape(e.text);r?s(r).insert({before:new Element("option",{value:e.value,title:n}).update(n)}):i.insert(new Element("option",{value:e.value,title:n}).update(n)),t.focus()}var r=e.element(),t=t(),n=r.selectedIndex>-1?s(r.options[r.selectedIndex]):e.element();I()?r.childElements().each(function(e){e.selected&&i(e,t)}):Object.isUndefined(n.selectedIndex)&&i(n,t)},m.MultipleValuesEditor.addMethod("createValidators",function(){return[{validator:function(e){return m.baseValidator(function(e){return 0===e.options.length}.curry(this.selectedValuesElement),m.getMessage("value_should_be_not_empty"))}.bind(this),element:this.selectedValuesElement}]}),m.MultipleValuesEditor.addMethod("removeMalicious",function(){}),m.MultipleValuesEditor.addMethod("cancel",function(){v.hideError(this.selectedValuesElement),this.reloadAvailable=!0}),m.MultipleValuesEditor.addMethod("setValue",function(e){this.reloadAvailable&&this.afterTemplateInitialization(),m.setSelectOptions(this.selectedValuesElement,e),this.afterValueSet()}),m.MultipleValuesEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),m.MultipleValuesEditor.addMethod("getValueElement",function(){return this.selectedValuesElement}),m.MultipleValuesEditor.addMethod("getValue",function(){return m.getSelectValues(this.selectedValuesElement)}),m.MultipleValuesEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_multiple_values_title",{comparison:m.getMessage(e)})}),m.ComboSelectEditor=function(e,t,i){m.SingleDictionaryEditor.apply(this,arguments)},m.ComboSelectEditor.prototype=_(m.SingleDictionaryEditor.prototype),m.ComboSelectEditor.addVar("valueEditorId","comboValues"),m.ComboSelectEditor.addMethod("initValueElements",function(){m.SingleDictionaryEditor.prototype.initValueElements.apply(this,arguments),this.availableValuesElement=this.getTemplate().select("select")[0],this.inputElement=this.searchInputElement}),m.ComboSelectEditor.addMethod("initEventHandlers",function(){m.SingleDictionaryEditor.prototype.initEventHandlers.apply(this,arguments),this.initValueChangeHandler(),new u.Observer(this.inputElement,.3,function(e,t){e.writeAttribute("title",t)})}),m.ComboSelectEditor.addMethod("initValueChangeHandler",function(){this.availableValuesElement.observe("change",this.valueSelectedHandler.bind(this))}),m.ComboSelectEditor.addMethod("valueSelectedHandler",function(e){this.setValue(e.element().getValue())}),m.ComboSelectEditor.addMethod("updateDictionaryValuesSelect",function(e){var t=""===e[0]?[]:[""];Event.stopObserving(this.availableValuesElement),this.availableValuesElement.replace(m.createSelectWithOptions(t,e)),this.availableValuesElement=this.getTemplate().select("select")[0],this.initValueChangeHandler(),this.availableValuesElement.selectedIndex=0}),m.ComboSelectEditor.addMethod("onCharacterPressed",function(){m.SingleDictionaryEditor.prototype.onCharacterPressed.call(this),this.availableValuesElement.selectedIndex=0}),m.ComboSelectEditor.addMethod("onClearButtonClicked",function(){m.SingleDictionaryEditor.prototype.onClearButtonClicked.call(this),this.availableValuesElement.selectedIndex=0}),m.ComboSelectEditor.addMethod("setValue",function(e){Object.isArray(e)&&(e=e[0]),this.inputElement.setValue(e),this.afterValueSet()}),m.ComboSelectEditor.addMethod("getAvailableValueElement",function(){return this.availableValuesElement}),m.ComboSelectEditor.addMethod("getValueElement",function(){return this.inputElement}),m.ComboSelectEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_combo_title",{comparison:m.getMessage(e)})}),m.StringValueEditor=function(e,t){m.FilterValueEditor.apply(this,arguments)},m.StringValueEditor.prototype=_(m.FilterValueEditor.prototype),m.StringValueEditor.addVar("valueEditorId","stringValues"),m.StringValueEditor.addMethod("initValueElements",function(){this.stringValueElement=this.getTemplate().select("input")[0]}),m.StringValueEditor.addMethod("createValidators",function(){return[{validator:function(e){return m.maxLengthValidator(e,1e3,m.getMessage("too_long_text"))}.bind(this),element:this.getValueElement()}]}),m.StringValueEditor.addMethod("getValueElement",function(){return this.stringValueElement}),m.StringValueEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_string_title",{comparison:m.getMessage(e)})}),m.NumberValueEditor=function(e,t){m.StringValueEditor.apply(this,arguments)},m.NumberValueEditor.prototype=_(m.StringValueEditor.prototype),m.NumberValueEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=this.getOriginalValue().dataType,i=m.getNumberBounds(e)||{min:L.MinRange,max:L.MaxRange};return[{validator:function(r){var n=m.numberValidator(r,m.filter.numberFormat,m.getMessage("wrong_number_format",{value:r}));return n.isValid&&(n=m.baseValidator(function(){return"Integer"===t&&m.filter.numberFormat.isInteger(r)},m.getMessage("domain.filter.incorrect_integer_value")),n.isValid&&(n=m.numberBoundsValidator(m.filter.toNumber(r),i,m.getMessage("number_out_of_range",{type:e})))),n},element:this.getValueElement()}]}),m.NumberValueEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_number_title",{comparison:m.getMessage(e)})}),m.ValueRangeEditor=function(e,t){m.FilterValueEditor.apply(this,arguments)},m.ValueRangeEditor.prototype=_(m.FilterValueEditor.prototype),m.ValueRangeEditor.addMethod("initValueElements",function(){this.rangeValueElements=c.collect(this.getValueRangeIds(),function(e){return this.getTemplate().select("#"+e.inputId)[0]},this)}),m.ValueRangeEditor.addMethod("createCommonValidators",function(){return c.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){return m.valueNotEmptyValidator(this.getElementValue(e),m.getMessage("value_should_be_not_empty"))}.bind(this,t),element:this.getElement(t)}},this)}),m.ValueRangeEditor.addMethod("setValue",function(e){c.each(this.getValueRangeIds(),function(t,i){this.getElement(i).setValue(e[i])},this)}),m.ValueRangeEditor.addMethod("getElement",function(e){return this.rangeValueElements[e]}),m.ValueRangeEditor.addMethod("getElementValue",function(e){return this.getElement(e).getValue()}),m.ValueRangeEditor.addMethod("getValue",function(){return c.collect(this.getValueRangeIds(),function(e,t){return this.getElementValue(t)},this)}),m.ValueRangeEditor.addMethod("getValueElement",function(){return this.rangeValueElements}),m.ValueRangeEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_range_title",{comparison:m.getMessage(e)})}),m.NumberRangeEditor=function(e,t){var i=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=c.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:t,inputId:i+"_"+t}},this),m.ValueRangeEditor.apply(this,arguments)},m.NumberRangeEditor.prototype=_(m.ValueRangeEditor.prototype),m.NumberRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),m.NumberRangeEditor.addMethod("createTemplate",function(){var e=m.FilterValueEditor.prototype.createTemplate.call(this);return c.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),m.NumberRangeEditor.addMethod("createValidators",function(){var e=this.getOriginalValue().javaType,t=m.getNumberBounds(e)||{min:L.MinRange,max:L.MaxRange},i=this.getOriginalValue().dataType;return c.collect(this.getValueRangeIds(),function(r,n){return{validator:function(r){var n,a=this.getElementValue(r);return a.match(m.filter.ATTRIBUTES_PATTERN)?n=m.baseValidator(function(){return!1}):(n=m.numberValidator(a,m.filter.numberFormat,m.getMessage("wrong_number_format",{value:a})),n.isValid&&(n=m.baseValidator(function(){return"Integer"===i&&m.filter.numberFormat.isInteger(a)},m.getMessage("domain.filter.incorrect_integer_value")),n.isValid&&(n=m.numberBoundsValidator(m.filter.toNumber(a),t,m.getMessage("number_out_of_range",{type:e}))))),n}.bind(this,n),element:this.getElement(n)}},this).concat({validator:function(){var i=this.getElementValue(0),r=this.getElementValue(1),n=m.filter.ATTRIBUTES_PATTERN,a=m.filter.ATTRIBUTE_VALUE_PATTERN,o=i.match(n),s=r.match(n),l=i.match(a),d=r.match(a),u=m.numberBoundsValidator(m.filter.toNumber(r),t,m.getMessage("number_out_of_range",{type:e}));return o&&s?m.baseValidator(function(){return l[1]===d[1]},m.getMessage("number_range_error",{from:i,to:r})):o||s?m.baseValidator(function(){return!1}):u.isValid||""===r?m.rangeValidator(m.filter.toNumber(i),m.filter.toNumber(r),m.getMessage("number_range_error",{from:i,to:r})):u}.bind(this),element:this.getElement(1)})}),m.DateValueEditor=function(e,t){"Date"===e().dataType?(this.dateFormat=m.filter.CALENDAR_DATE_FORMAT,this.timeFormat=m.filter.CALENDAR_TIME_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=m.filter.CALENDAR_TIME_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_TIME_FORMAT):(this.dateFormat=m.filter.CALENDAR_DATE_FORMAT,this.timeFormat=m.filter.CALENDAR_TIME_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_TIMESTAMP_FORMAT),this.timeZoneOffset=m.filter.TIMEZONE_OFFSET,this.valueEditorId="dateValues",this.CALENDAR_INPUT_ID="calendar_input",this.CALENDAR_BUTTON_ID="calendar_button",this.dateInputName=e().id+this.CALENDAR_INPUT_ID,this.dateButtonName=e().id+this.CALENDAR_BUTTON_ID,m.FilterValueEditor.apply(this,arguments)},m.DateValueEditor.prototype=_(m.FilterValueEditor.prototype),m.DateValueEditor.addMethod("initValueElements",function(){this.dateValueElement=this.getTemplate().select("#"+this.dateInputName)[0]}),m.DateValueEditor.addMethod("createTemplate",function(){var e=m.FilterValueEditor.prototype.createTemplate.call(this);return e.select("#"+this.CALENDAR_INPUT_ID)[0].writeAttribute("id",this.dateInputName),e}),m.DateValueEditor.addMethod("afterDraw",function(){var e=h("#"+this.dateInputName),t=this._getControlName();this.picker=new p({el:e[0],showOn:"button",buttonText:"",dateFormat:"timepicker"===t?null:this.dateFormat,timeFormat:"datepicker"===t?null:this.timeFormat,showSecond:this.isTimestampField()||this.isTimeField()}),e.next().addClass("button").addClass("picker"),e[0].getValue=function(){return h(this).val()},e.on("mousedown",b),this.fillinTemplate()}),m.DateValueEditor.addMethod("createValidators",function(){return[{validator:function(e){var t=S.toMomentDateOrTimeOrTimestampPattern(m.filter.CALENDAR_DATE_FORMAT,m.filter.CALENDAR_DATE_TIME_SEPARATOR);return this.isTimestampField()&&O(e,t,!0).isValid()&&(e+=" 00:00"),m.dateValidator(e,this.getOriginalValue().calendarDateFormat,m.filter.CALENDAR_DATE_TIME_SEPARATOR,m.getMessage("wrong_date_format",{value:e}))}.bind(this),element:this.getValueElement()}]}),m.DateValueEditor.addMethod("getValueElement",function(){return this.dateValueElement}),m.DateValueEditor.addMethod("getTitleMessage",function(e){return m.getMessage("filter_date_title",{comparison:m.getMessage(e)})}),m.DateRangeEditor=function(e,t){"Date"===e().dataType?(this.dateFormat=m.filter.CALENDAR_DATE_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_DATE_FORMAT):"Time"===e().dataType?(this.timeFormat=m.filter.CALENDAR_TIME_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_TIME_FORMAT):(this.dateFormat=m.filter.CALENDAR_DATE_FORMAT,this.timeFormat=m.filter.CALENDAR_TIME_FORMAT,e().calendarDateFormat=m.filter.CALENDAR_TIMESTAMP_FORMAT),this.timeZoneOffset=m.filter.TIMEZONE_OFFSET;var i=e().id;this.valueEditorId="dateRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.dateRangeNames=c.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e,r=t+this.BUTTON_SUFFIX;return{standardInputId:t,inputId:i+"_"+t,standardButtonId:r,buttonId:i+"_"+r}},this),m.ValueRangeEditor.apply(this,arguments)},m.DateRangeEditor.prototype=_(m.ValueRangeEditor.prototype),m.DateRangeEditor.addMethod("getValueRangeIds",function(){return this.dateRangeNames}),m.DateRangeEditor.addMethod("createTemplate",function(){var e=m.FilterValueEditor.prototype.createTemplate.call(this);return c.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),m.DateRangeEditor.addMethod("afterDraw",function(){c.each(this.getValueRangeIds(),function(e){var t=h("#"+e.inputId),i=this._getControlName();this.picker=new p({el:t[0],showOn:"button",buttonText:"",dateFormat:"timepicker"===i?null:this.dateFormat,timeFormat:"datepicker"===i?null:this.timeFormat,showSecond:this.isTimestampField()||this.isTimeField()}),t.next().addClass("button").addClass("picker"),t[0].getValue=function(){return h(this).val()},t.on("mousedown",b)},this),this.fillinTemplate()}),m.DateRangeEditor.addMethod("createValidators",function(){return c.collect(this.getValueRangeIds(),function(e,t){return{validator:function(e){var t=this.getElementValue(e),i=S.toMomentDateOrTimeOrTimestampPattern(m.filter.CALENDAR_DATE_FORMAT,m.filter.CALENDAR_DATE_TIME_SEPARATOR);return this.isTimestampField()&&O(t,i,!0).isValid()&&(t+=" 00:00"),m.dateValidator(t,this.getOriginalValue().calendarDateFormat,m.filter.CALENDAR_DATE_TIME_SEPARATOR,m.getMessage("wrong_date_format",{value:t}))}.bind(this,t),element:this.getElement(t)}},this).concat({validator:function(){var e=this.getElementValue(0),t=this.getElementValue(1),i=S.toMomentDateOrTimeOrTimestampPattern(this.getOriginalValue().calendarDateFormat,m.filter.CALENDAR_DATE_TIME_SEPARATOR),r=O(e,i,!0),n=O(t,i,!0);return m.rangeValidator(r.isValid()?r.toDate().getTime():0,n.isValid()?n.toDate().getTime():0,m.getMessage("date_range_error",{from:e,to:t}))}.bind(this),element:this.getElement(1)})}),m.TimeRangeEditor=function(e,t){var i=e().id;this.valueEditorId="numberRangeValues",this.RANGE_INPUT_ID="rangeValue",this.BUTTON_SUFFIX="_button",this.numberRangeNames=c.collect([1,2],function(e){var t=this.RANGE_INPUT_ID+"_"+e;return{standardInputId:t,inputId:i+"_"+t}},this),m.ValueRangeEditor.apply(this,arguments)},m.TimeRangeEditor.prototype=_(m.ValueRangeEditor.prototype),m.TimeRangeEditor.addMethod("getValueRangeIds",function(){return this.numberRangeNames}),m.TimeRangeEditor.addMethod("createTemplate",function(){var e=m.FilterValueEditor.prototype.createTemplate.call(this);return c.each(this.getValueRangeIds(),function(t){e.select("#"+t.standardInputId)[0].writeAttribute("id",t.inputId)}),e}),m.BooleanSelectEditor=function(e,t){m.FilterValueEditor.apply(this,arguments),this.setID(e().id),this.initBooleanLastValueMap(),this.setInitialSelectValue()},m.BooleanSelectEditor.prototype=_(m.FilterValueEditor.prototype),m.BooleanSelectEditor.addVar("valueEditorId","booleanComboValues"),m.BooleanSelectEditor.addMethod("initValueElements",function(){this.selectElement=this.getTemplate().select("select")[0],this.inputElement=this.getTemplate().select("input")[0],this.inputElement.validatorMessageContainer=this.getTemplate().select("div.errorContainer")[0],this.setValueList(),this.initEvents()}),m.BooleanSelectEditor.addMethod("setLastValue",function(e){m.booleanLastValueMap[this.id]=e}),m.BooleanSelectEditor.addMethod("initBooleanLastValueMap",function(){m.booleanLastValueMap=m.booleanLastValueMap||[]}),m.BooleanSelectEditor.addMethod("setInitialSelectValue",function(){this.selectElement.setValue(m.booleanLastValueMap[this.id])}),m.BooleanSelectEditor.addMethod("setID",function(e){this.id=e}),m.BooleanSelectEditor.addMethod("initEvents",function(){var e=this;this.selectElement.observe("change",function(t){var i=t.element().getValue(),r=i===m.getMessage("filter_empty_string")?"":i;e.inputElement.setValue(r),e.setLastValue(r)}),this.inputElement.observe("keyup",function(t){e.selectElement.setValue(m.getMessage("filter_empty_string"))}),this.inputElement.observe("change",function(t){e.setLastValue(t.element().getValue())})}),m.BooleanSelectEditor.addMethod("setValueList",function(){m.setSelectOptions(this.selectElement,[m.getMessage("filter_empty_string"),"true","false"])}),m.BooleanSelectEditor.addMethod("createValidators",function(){var e=this;return[{validator:function(t){var i=m.baseValidator(function(t){return""===e.inputElement.value},m.getMessage("value_should_be_not_empty"));return i.isValid?{isValid:t.match(m.filter.ATTRIBUTES_PATTERN)||"true"===t||"false"===t,errorMessage:m.getMessage("domain.filter.incorrect_attribute_pattern")}:i}.bind(e),element:e.inputElement}]}),m.BooleanSelectEditor.addMethod("getValueElement",function(){return this.inputElement}),m.FilterModelController=function(e,t,i){m.filter.init(i),this.PRE_FILTERS_PANEL="preFilters",this.FILTERS_LIST_ID=e,this.FILTER_EDITOR_CANCEL_BUTTON_ID="filterEditorCancel",this.FILTER_EDITOR_OK_BUTTON_ID="filterEditorOk",this.CREATE_MODE="create",this.UPDATE_MODE="update",this.targetHiddenFieldId="slRules",this.initParams=i,this.filterEditor=t,this._filterEditorsMap=null,this._currentFilter=null,this.mode=null},m.FilterModelController.addMethod("init",function(){if(this._list=new F.List(this.FILTERS_LIST_ID,{listTemplateDomId:"list_domain_chooser_filter",itemTemplateDomId:"list_domain_chooser_filter:leaf",excludeFromSelectionTriggers:[".leaf *"],excludeFromEventHandling:!0}),I()){var e=s(this.FILTERS_LIST_ID);new D(e,e.up())}try{this._filterEditorsMap=new m.FilterList,this.initFilters()}catch(e){window.console&&console.error("Filters initialization failed. Error : #{error}".interpolate({error:e}))}finally{this.updateHiddenField(),this._initListEvents(),this.drawList()}}),m.FilterModelController.addMethod("initFilters",function(){this.initParams.filtersJson.each(function(e){this.addNewToFilterEditorsMap(this.filterEditor.prototype.create(new m.FilterItem({json:e}),this.initParams.flowExecutionKey))}.bind(this))}),m.FilterModelController.addMethod("initDropContainer",function(e){var t={onDrop:this.onDropHandler.bind(this)};e&&(t.accept=e),a.add(s(this.PRE_FILTERS_PANEL),t)}),m.FilterModelController.addMethod("onDropHandler",function(e){var t=e.node;if(t){var i=m.getSelectedTreeNodes(N.trees[t.getTreeId()]);try{1===i.length?this.addFilter(new m.FilterItem({node:t})):2===i.length&&this.addFieldFilter(i)}catch(e){console&&console.error(e)}}}),m.FilterModelController.addMethod("addNewToFilterEditorsMap",function(e,t){if(e){var i=e.getOriginalValue();this.mode!==this.UPDATE_MODE&&this._updateIdIfFilterPresent(i),this._filterEditorsMap.set(i.id,e,t)}}),m.FilterModelController.addMethod("_prepareListItem",function(e){var t=new F.ListItem({cssClassName:A.LEAF_CLASS,value:e});return t.processTemplate=e.processTemplate,t}),m.FilterModelController.addMethod("drawList",function(){var e=this._filterEditorsMap.values().collect(this._prepareListItem);this.getList().setItems(e),this.getList().show()}),m.FilterModelController.addMethod("refreshScroll",function(){var e=A.scrolls.get(this.PRE_FILTERS_PANEL);e&&e.refresh()}),m.FilterModelController.addMethod("addFieldFilter",function(e){if(m.areNodesFromSameIsland(e)){var t=e.collect(function(e){return new m.FilterItem({node:e})}),i=t.first();i.type===t[1].type&&(i.initFieldFilterItem(t[1]),this.addFilter(i))}}),m.FilterModelController.addMethod("addFilter",function(e){try{this.cancelPreviousEditing(),this._updateIdIfFilterPresent(e);var t=this.filterEditor.prototype.create(e,this.initParams.flowExecutionKey),i=this._prepareListItem(t);this.setCurrentFilter(i),this.getList().insertItems(0,[i]),this.getList().refresh(),s(this.FILTERS_LIST_ID).up().scrollTop=0,this.editMode(i),this.mode=this.CREATE_MODE}catch(e){throw this.setCurrentFilter(null),"Unknown filter creation error: #{error}".interpolate({error:e})}}),m.FilterModelController.addMethod("editFilter",function(e){this.cancelPreviousEditing(),e.getValue().resetToCurrentEditor(),this.editMode(e),this.mode=this.UPDATE_MODE}),m.FilterModelController.addMethod("cancelPreviousEditing",function(){if(this._currentFilter){var e=this._currentFilter.getValue();e.cancel();var t=e.getOriginalValue();this._filterEditorsMap.get(t.id)?(this._setItemClassName(this._currentFilter,""),this._currentFilter.refresh()):this.getList().removeItems([this._currentFilter]),this.setCurrentFilter(null)}}),m.FilterModelController.addMethod("removeFilter",function(e){if(e){var t=e.getValue();t.beforeRemove(),this._filterEditorsMap.unset(t.getOriginalValue().id),this.getList().removeItems([e]),this.refreshScroll(),this.updateHiddenField()}}),m.FilterModelController.addMethod("editMode",function(e){this.setCurrentFilter(e),this._setItemClassName(e,"editMode"),e.getValue().afterDraw(),this.refreshScroll(),M(s(document.body))}),m.FilterModelController.addMethod("saveFilter",function(e){var t=e.getValue();t.validate()&&(t.applyEditorValue(),this.addNewToFilterEditorsMap(t,0),this.cancelPreviousEditing(),this.updateHiddenField())}),m.FilterModelController.addMethod("getList",function(){return this._list}),m.FilterModelController.addVar("listEventFactory",{"item:click":function(e){Event.stop(e);var t=Event.extend(e.memo.targetEvent),i=t.element(),r=e.memo.item,n=[i].concat(i.ancestors().slice(0,2));c.any(this._editorElementsMap,function(e,i){return!!d.findElement(n,i,0)&&(Event.stop(t),e.call(this,r),!0)},this)||r.getValue().handleClick(i)}}),m.FilterModelController.addVar("_editorElementsMap",{"#filterEditorOk":function(e){this.saveFilter(e)},"#filterEditorCancel":function(){this.cancelPreviousEditing()},".change":function(e){this.editFilter(e)},".remove":function(e){this.removeFilter(e)}}),m.FilterModelController.addVar("treeEventFactory",{"leaf:dblclick":function(e){var t=e.memo.node;if(Event.stop(e),t){var i=m.getSelectedTreeNodes(N.trees[t.getTreeId()]);try{2===i.length?this.addFieldFilter(i):this.addFilter(new m.FilterItem({node:t}))}catch(e){console&&console.error(e)}}}}),m.FilterModelController.addMethod("setCurrentFilter",function(e){this._currentFilter=e}),m.FilterModelController.addMethod("_setItemClassName",function(e,t){e.setCssClassName(t),e.refreshStyle()}),m.FilterModelController.addMethod("_initListEvents",function(){for(var e in this.listEventFactory)this._list.observe(e,this.listEventFactory[e].bindAsEventListener(this))}),m.FilterModelController.addMethod("_updateIdIfFilterPresent",function(e){var t=this._filterEditorsMap.get(e.id);return t&&e.updateIndex(++t.getOriginalValue().index),e});m.FilterModelController.addMethod("updateHiddenField",function(){var e=Object.toJSON(this._filterEditorsMap.collect(function(e){return e.getOriginalValue()}));l("#"+this.targetHiddenFieldId)[0].writeAttribute("value",e)}),m.setSelectOptions=function(e,t){if(!Object.isElement(e)||!t||!Object.isArray(t))return e;var i=new Date;e.update("");var r=[];return m.appendOptions(r,t),e.update(r.join("")),y()&&(e.className=e.className),window.console&&window.console.log("Select input update time : "+(new Date-i)+" ms."),e},m.createSelectWithOptions=function(){var e=new Date,t=arguments[arguments.length-1],i="";c.isArray(t)||"object"!==r(t)||(i=c.reduce(t||{},function(e,t,i){return e+=i+'="'+t+'" '},""));for(var n=["<select "+i+">"],a=0;a<arguments.length;a++){var o=arguments[a];o&&c.isArray(o)&&m.appendOptions(n,o)}return n.push("</select>"),window.console&&window.console.log("String conversion time : "+(new Date-e)+" ms."),n.join("")},m.appendOptions=function(e,t){for(var i,r,n=0;n<t.length;n++){i=r=null!==t[n]?t[n].replace(/'/g,"&#39;"):m.getMessage("filter_null_value"),""===t[n]&&(i=m.getMessage("filter_empty_string"));var a=C.hardEscape(i);e.push("<option title='"+a+"' value='"+r+"'>"+a+"</option>")}},m.getSelectValues=function(e){return c.map(e.options,function(e){return e.readAttribute("value")})},m.getSelectedOptionId=function(e){return Object.isElement(e)?e.options[e.selectedIndex].readAttribute("id"):null},m.getSelectedTreeNodes=function(e){var t=e.selectedNodes;if(Object.isArray(t))return t.findAll(function(e){return!e.isParent()})},i.exports=m}),define("dataChooser/domain.chooser.filters",["require","exports","module","prototype","underscore","./domain.chooser","./domain.filters","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/util/touch.controller"],function(e,t,i){var r=e("prototype"),n=r.$,a=e("underscore"),o=e("./domain.chooser"),s=e("./domain.filters"),l=e("runtime_dependencies/jrs-ui/src/util/utils.common"),d=l.isSupportsTouch,u=l.disableSelectionWithoutCursorStyle,c=l.isIPad,h=l.deepClone,m=e("runtime_dependencies/jrs-ui/src/util/touch.controller");o.preFilters={init:function(){var e=o.preFilters;o.submitFormId="preFiltersForm";var t=new s.FilterModelController("filtersListId",s.FilterEditor,window.localContext.rsInitOptions);if(e.fields.init(t,function(){t.init(),t.initDropContainer(["draggable"])}),d()){var i=document.getElementById("stepDisplayScrollWrapper"),r=document.getElementById("fieldsTreeRoot"),a=document.getElementById("filtersListId");new m(i,i.parentNode,{absolute:!0,scrollbars:!0}),new m(r,r.parentNode),new m(a,a.parentNode)}s.resetTreeSelectionHandler.init(["#"+e.fields.ITEMS_TREE_DOM_ID],function(){return[e.fields.itemsTree]}),u(n(document.body))}},o.preFilters.fields={ITEMS_TREE_DOM_ID:"fieldsTreeRoot",TREE_DATA_PROVIDER:"semantic-layer-query-tree-data-provider",itemsTree:null,init:function(e,t){var i=o.preFilters.fields;i.filterModel=e,i.itemsTree=s.createItemsTree({treeId:i.ITEMS_TREE_DOM_ID,providerId:i.TREE_DATA_PROVIDER,templateDomId:"list_responsive_collapsible_fields",selectOnMousedown:!c(),dragPattern:".leaf .draggable"}),i.itemsTree.showTree(10,function(){i.initTreeEvents(),t()})},initTreeEvents:function(){a.each(this.filterModel.treeEventFactory,function(e,t){this.itemsTree.observe(t,a.bind(e,this.filterModel))},this)}};o.preFilters;s.chooser.FilterEditor=h(s.FilterEditor.prototype),s.chooser.FilterEditorPrototype={initTemplate:function(){s.chooser.FilterEditor.initTemplate.call(this),this.lockStatusElement=this.editorTemplate.down(".editable")},fillinTemplate:function(){this.lockStatusElement.setValue(!!this.getOriginalValue().locked),s.chooser.FilterEditor.fillinTemplate.call(this)},getValue:function(){var e=s.chooser.FilterEditor.getValue.call(this);return e.locked=!!this.lockStatusElement.getValue(),e}},Object.extend(s.FilterEditor.prototype,s.chooser.FilterEditorPrototype),Object.extend(s.NumberFilterEditor.prototype,s.chooser.FilterEditorPrototype),Object.extend(s.StringFilterEditor.prototype,s.chooser.FilterEditorPrototype),Object.extend(s.DateFilterEditor.prototype,s.chooser.FilterEditorPrototype),Object.extend(s.BooleanFilterEditor.prototype,s.chooser.FilterEditorPrototype),s.FilterModelController.addMethod("addFieldFilter",function(e){var t=e.collect(function(e){return new s.FilterItem({node:e})}),i=t.first();i.type===t[1].type&&(i.initFieldFilterItem(t[1]),this.addFilter(i))}),void 0===e&&document.observe("dom:loaded",o.initialize.bind(o)),i.exports=s}),define("dataChooser/dataChooserPreFiltersMain",["require","exports","module","requirejs-domready","./domain.chooser.filters","runtime_dependencies/js-sdk/src/jrs.configs","underscore"],function(e,t,i){var r=e("requirejs-domready"),n=e("./domain.chooser.filters"),a=e("runtime_dependencies/js-sdk/src/jrs.configs"),o=e("underscore");r(function(){o.extend(n._messages,a.dataChooser.domain._messages),o.extend(window.localContext,a.dataChooser.localContext),n.chooser.initialize()})});