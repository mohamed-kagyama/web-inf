/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","highcharts"],function(t,i,e){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=t("highcharts");!function(t){function i(t,i){return this.name=t.name||t,this.parent=i,this}function e(t){return parseInt(t,10)-.5}function r(t){for(var i=t.length,e=0;i--;)e+=t[i];return e}function o(t,i,e,s,r){var n,h=t.length;for(r||(r=0),e.depth||(e.depth=0);h--;)n=t[h],s&&(n.parent=s),n.categories?o(n.categories,i,e,n,r+1):a(i,n,s);e.depth=u(e.depth,r)}function a(t,e,s){for(t.unshift(new i(e,s));s;)s.leaves++||(s.leaves=1),s=s.parent}function n(t,i){t.push("M",e(i[0]),e(i[1]),"L",e(i[2]),e(i[3]))}function h(t,i){return t.getPosition(t.axis.horiz,i,t.axis.tickmarkOffset)}function l(t,i,e){for(var s,r=t.length;r--;)s=t[r][i],s&&l(s,i,e),e(t[r])}var c=void 0,p=(Math.round,Math.min),u=Math.max,d=t.Axis.prototype,g=t.Tick.prototype,f=d.init,b=d.render,x=d.setCategories,y=g.getLabelSize,v=g.addLabel,G=g.destroy,k=g.render;i.prototype.toString=function(){for(var t=[],i=this;i;)t.push(i.name),i=i.parent;return t.join(", ")},d.init=function(t,i){f.call(this,t,i),"object"===s(i)&&i.categories&&this.setupGroups(i)},d.setupGroups=function(i){var e=t.extend([],i.categories),s=[],r={};o(e,s,r),this.categoriesTree=e,this.categories=s,this.isGrouped=0!==r.depth,this.labelsDepth=r.depth,this.labelsSizes=[],this.labelsGridPath=[],this.tickLength=i.tickLength||this.tickLength||null,this.directionFactor=[-1,1,1,-1][this.side],this.options.lineWidth=i.lineWidth||1},d.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),this.originalTickLength===c&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,b.call(this),!this.isGrouped)return void(this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}));var t,i=this,e=i.options,s=i.top,r=i.left,o=r+i.width,a=s+i.height,h=i.hasVisibleSeries,p=i.labelsDepth,u=i.labelsGrid,d=i.horiz,g=i.labelsGridPath,f=0,x=i.opposite?d?s:o:d?a:r;for(i.userTickLength&&(p-=1),u||(u=i.labelsGrid=i.chart.renderer.path().attr({strokeWidth:e.lineWidth,stroke:e.lineColor}).add(i.axisGroup));f<=p;)x+=i.groupSize(f),t=d?[r,x,o,x]:[x,s,x,a],n(g,t),f++;u.attr({d:g,visibility:h?"visible":"hidden"}),i.labelGroup.attr({visibility:h?"visible":"hidden"}),l(i.categoriesTree,"categories",function(t){var e=t.tick;e&&(e.startAt+e.leaves-1<i.min||e.startAt>i.max?(e.label.hide(),e.destroyed=0):e.label.show())})},d.setCategories=function(t,i){this.categories&&this.cleanGroups(),this.setupGroups({categories:t}),x.call(this,this.categories,i)},d.cleanGroups=function(){var t,i=this.ticks;for(t in i)i[t].parent;delete i[t].parent,l(this.categoriesTree,"categories",function(t){var i,e=t.tick;if(e){e.label.destroy();for(i in e)delete e[i];delete t.tick}})},d.groupSize=function(t,i){var e=this.labelsSizes,s=this.directionFactor;return i!==c&&(e[t]=u(e[t]||0,i+10)),!0===t?r(e)*s:e[t]?e[t]*s:0},g.addLabel=function(){var t;v.call(this),this.axis.categories&&(t=this.axis.categories[this.pos])&&(t.name&&this.label.attr("text",t.name),this.axis.isGrouped&&this.addGroupedLabels(t))},g.addGroupedLabels=function(t){for(var i,e=this,s=this.axis,r=s.chart,o=s.options.labels,a=o.useHTML,n=o.style,h={align:"center"},l=s.horiz?"height":"width",c=0;e;)c>0&&!t.tick&&(i=r.renderer.text(t.name,0,0,a).attr(h).css(n).add(s.labelGroup),e.startAt=this.pos,e.childCount=t.categories.length,e.leaves=t.leaves,e.visible=this.childCount,e.label=i,t.tick=e),s.groupSize(c,e.label.getBBox()[l]),t=t.parent,e=t?e.parent=t.tick||{}:null,c++},g.render=function(t,i){if(k.call(this,t,i),this.axis.isGrouped&&this.axis.categories[this.pos]&&!(this.pos>this.axis.max)){var e,s,r,o,a,l,c=this,d=c,g=c.axis,f=c.pos,b=c.isFirst,x=g.max,y=g.min,v=g.horiz,G=(g.categories[f],g.labelsGridPath),m=g.groupSize(0),S=(g.tickLength,g.directionFactor),L=h(c,f),z=v?L.y:L.x,T=1;for(b&&(e=v?[g.left,L.y,g.left,L.y+g.groupSize(!0)]:g.isXAxis?[L.x,g.top,L.x+g.groupSize(!0),g.top]:[L.x,g.top+g.len,L.x+g.groupSize(!0),g.top+g.len],n(G,e)),e=v?[L.x,L.y,L.x,L.y+m]:[L.x,L.y,L.x+m,L.y],n(G,e),m=z+m;d=d.parent;)a=h(c,u(d.startAt-1,y-1)),l=h(c,p(d.startAt+d.leaves-1,x)),o=d.label.getBBox(),s=g.groupSize(T),r=v?{x:(a.x+l.x)/2,y:o.height*S+m+4}:{x:m,y:(a.y+l.y+o.height)/2},d.label.attr(r),G&&(e=v?[l.x,m,l.x,m+s]:[m,l.y,m+s,l.y],n(G,e)),m+=s,T++}},g.destroy=function(){for(var t=this;t=t.parent;)t.destroyed++||(t.destroyed=1);G.call(this)},g.getLabelSize=function(){return!0===this.axis.isGrouped?r(this.axis.labelsSizes):y.call(this)}}(r),e.exports=r});