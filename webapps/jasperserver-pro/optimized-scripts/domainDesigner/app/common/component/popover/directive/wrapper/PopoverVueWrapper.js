/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","vue","../../../util/positionUtil","../../component/popoverVueConfig","../../mixin/popoverComputedMixin","text!./template/popoverWrapperTemplate.htm","runtime_dependencies/js-sdk/src/common/extension/customEventExtension"],function(t,e,o){var n=t("underscore"),i=t("vue"),s=t("../../../util/positionUtil"),r=t("../../component/popoverVueConfig"),p=t("../../mixin/popoverComputedMixin"),d=t("text!./template/popoverWrapperTemplate.htm");t("runtime_dependencies/js-sdk/src/common/extension/customEventExtension"),o.exports=i.extend({template:d,components:{popover:i.extend(r)},watch:{text:function(t){t?this.document.addEventListener("mousedown",this.onDocumentMousedown):this.document.removeEventListener("mousedown",this.onDocumentMousedown)}},computed:{normalizedOffset:function(){var t={top:0,left:0};return n.isUndefined(this.offset.top)||(t.top=this.offset.top),n.isUndefined(this.offset.left)||(t.left=this.offset.left),t}},mixins:[p],data:function(){return{type:"",placement:"",title:"",text:"",target:"",offset:{},position:{top:0,left:0},inheritTargetWidth:!1}},created:function(){this.document=this.$options.document||document},methods:{setState:function(t){t=n.extend({},t,{target:this.$options.directiveEl}),n.extend(this,t),this.$nextTick(function(){n.extend(this,{position:this._getPosition()})})},onDocumentMousedown:function(t){this.$el.contains(t.target)||this._closePopover()},getTargetWidth:function(){if(this.inheritTargetWidth)return this.target.offsetWidth},remove:function(){this.document.removeEventListener("mousedown",this.onDocumentMousedown),this.$el.parentNode.removeChild(this.$el),this.$destroy()},_getPosition:function(){var t={top:0,left:0};return this.isVisible&&(t=s.getPlacementWithPosition({placement:this.placement,targetEl:this.target,parentEl:this.$el.parentElement,sourceEl:this.$el}),t.top=t.top+this.normalizedOffset.top,t.left=t.left+this.normalizedOffset.left),t},_closePopover:function(){var t=new CustomEvent("popoverClose");this.target.dispatchEvent(t)}}})});