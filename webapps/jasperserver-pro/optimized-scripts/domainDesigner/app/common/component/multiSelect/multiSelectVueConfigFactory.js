/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","../../../rest/enum/requestCanceledEnum","runtime_dependencies/js-sdk/src/components/multiSelect/view/MultiSelectWithTrueAll","runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/SelectedItemsDataProvider"],function(e,t,i){var s=e("underscore"),n=e("jquery"),l=e("../../../rest/enum/requestCanceledEnum"),r=e("runtime_dependencies/js-sdk/src/components/multiSelect/view/MultiSelectWithTrueAll"),o=e("runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/SelectedItemsDataProvider");i.exports={create:function(e){e=e||{multiSelectOptions:{}};var t=e.multiSelectOptions||{},i=e.$||n,u=e.MultiSelect||r,c=e.SelectedItemsDataProvider||o;return{template:"<div class='jr'></div>",props:["options"],watch:{options:function(e){this.setValue(e)}},methods:{initEvents:function(){this.multiSelect.on("selection:change",s.bind(this.triggerSelectionChangeEvent,this)),this.multiSelect.on("listRenderError",s.bind(this.onListRenderError,this))},triggerSelectionChangeEvent:function(e,t){var i;t.isTrueAll||(i=this.selectedItemsDataProvider.getAllCachedData(),e=i.map(function(e){return e.value})),this.$emit("selection:change",e,t)},onListRenderError:function(e,t){e===l.CANCELED&&(this.multiSelect.reset(),this.setValue(this.options))},setValue:function(e){this.multiSelect.setTrueAll(e.isTrueAll,{silent:!0}),e.isTrueAll||this.multiSelect.setValue(e.value,{silent:!0})}},created:function(){this.selectedItemsDataProvider=new c(this.options.selectedListOptions);var e=s.isUndefined(this.options.value)?t:s.extend({},t,{value:this.options.value,selectedItemsDataProvider:this.selectedItemsDataProvider});this.multiSelect=new u(e),this.options.isTrueAll&&this.multiSelect.setTrueAll(this.options.isTrueAll,{silent:!0}),this.initEvents()},mounted:function(){i(this.$el).append(this.multiSelect.$el)},destroyed:function(){this.multiSelect.remove()}}}}});