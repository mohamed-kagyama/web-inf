/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","../../util/extractElementFromEventUtil","../../util/collectElementDataAttributesUtil","../../util/extractFnFromConfigurationUtil","jquery-ui/ui/widgets/draggable"],function(t,r,e){function a(t){var r=t.selector,e=c(this.$el);r===D?(e.on("mouseover",d.bind(n,this,t)),e.on("mouseleave",d.bind(i,this))):(e.on("mouseover",r,d.bind(n,this,t)),e.on("mouseleave",r,d.bind(i,this)))}function n(t,r){var e=h.byCurrentTarget(r),a=b.getElementDataAttributes(t.attrs,e);t=d.extend({},t,{attrs:a}),this._isDragInProgress()||t.testFn(a)&&this._initDraggable(e,t)}function i(t){var r=h.byCurrentTarget(t);this._isDragInProgress()||this._destroyDraggable(r)}function l(t,r){return f(d.extend({},r,{name:t}))}function o(t){var r=t.config,e={config:r,context:this,options:t.attrs},a=l("onDragStart",e),n=l("onDrag",e),i=l("onDragStop",e),o=d.extend({appendTo:c("body"),cursor:"move",cursorAt:{top:0,left:0},helper:function(){return c('<div class="wrap button draggable dragging dragHelper"></div>')}},d.omit(r,v));return o.start=s.call(this,a),o.drag=g.call(this,n),o.stop=u.call(this,i),o}function s(t){var r=this,e={label:"",data:[]};return function(a,n){a.originalEvent.preventDefault(),r.dragInProgress=!0;var i=t&&t(a),l=d.extend({},e,i);n.helper.text(l.label).data("data",l.data)}}function g(t){return function(r,e){var a=e.helper.data("data");t&&t(a,r)}}function u(t){var r=this;return function(e,a){r.dragInProgress=!1;var n=a.helper.data("data");t&&t(n,e)}}var c=t("jquery"),d=t("underscore"),h=t("../../util/extractElementFromEventUtil"),b=t("../../util/collectElementDataAttributesUtil"),f=t("../../util/extractFnFromConfigurationUtil");t("jquery-ui/ui/widgets/draggable");var D=":el",v=["onDragStart","onDrag","onDragStop","shouldDrag","attrs","selector"];e.exports={_initializeDraggable:function(){var t=d.result(this,"draggable"),r=d.result(t,"selector");if(!r)throw new Error("Selector for draggable is required.");this.$lastDraggableEl=null,this.dragInProgress=!1;var e=d.result(t,"attrs")||[],n=f({config:t,name:"shouldBeDraggable",context:this})||function(){return!0},i={selector:r,attrs:e,testFn:n,config:t};a.call(this,i)},_isDragInProgress:function(){return this.dragInProgress},_initDraggable:function(t,r){this._destroyDraggable(),r=o.call(this,r),t.draggable(r),this.$lastDraggableEl=t},_destroyDraggable:function(t){t=t||this.$lastDraggableEl;try{t&&t.draggable("destroy")}catch(t){}this.$lastDraggableEl=null}}});