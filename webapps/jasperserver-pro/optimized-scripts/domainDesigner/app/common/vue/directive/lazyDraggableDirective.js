/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","jquery-ui/ui/widgets/draggable"],function(e,a,t){var r=e("jquery"),n=e("underscore");e("jquery-ui/ui/widgets/draggable");var g=["onDragStart","onDrag","onDragStop","test"],s=function(e,a){this.initialize(e,a)};n.extend(s.prototype,{initialize:function(e,a){n.bindAll(this,"_onDraggableMouseOver","_onDraggableMouseLeave"),this.$lastDraggableEl=null,this.dragInProgress=!1,this.$wrappedElement=r(e),this.options=a,this._initDraggableEvents()},isDragInProgress:function(){return this.dragInProgress},destroyDraggable:function(){this._destroyDraggableAndRemoveListeners()},_initDraggableEvents:function(){this.$wrappedElement.on("mouseover",this._onDraggableMouseOver),this.$wrappedElement.on("mouseleave",this._onDraggableMouseLeave)},_onDraggableMouseOver:function(){this._isDragInProgress()||this.options.testFn()&&this._initDraggable()},_onDraggableMouseLeave:function(){this._isDragInProgress()||this._destroyDraggable()},_isDragInProgress:function(){return this.dragInProgress},_initDraggable:function(){this._destroyDraggable();var e=this._getDraggableOptions();this.$wrappedElement.draggable(e),this.$lastDraggableEl=this.$wrappedElement},_getDraggableOptions:function(){var e=this.options.config,a=n.extend({appendTo:r("body"),cursor:"move",cursorAt:{top:0,left:0},helper:function(){return r('<div class="wrap button draggable dragging dragHelper"></div>')}},n.omit(e,g));return a.start=this._getStartDraggableCallback(e.onDragStart),a.drag=this._getOnDragCallback(e.onDrag),a.stop=this._getOnDragStopCallback(e.onDragStop),a},_getStartDraggableCallback:function(e){var a=this,t={label:"",data:[]};return function(r,g){r.originalEvent.preventDefault(),a.dragInProgress=!0;var s=e&&e(r),i=n.extend({},t,s);g.helper.text(i.label).data("data",i.data)}},_getOnDragCallback:function(e){var a=this;return function(t,r){var n=a._getDraggableData();r.helper.data("data",n),n.label&&r.helper.text(n.label),e&&e(n,t)}},_getOnDragStopCallback:function(e){var a=this;return function(t){a.dragInProgress=!1;var n=a._getDraggableData();r.contains(document,a.$wrappedElement[0])||a._destroyDraggableAndRemoveListeners(),e&&e(n,t)}},_getDraggableData:function(){var e=this.options.config;return e.getData&&e.getData()},_destroyDraggable:function(){var e=this.$lastDraggableEl||this.$wrappedElement;try{e&&e.draggable("destroy")}catch(e){}this.$lastDraggableEl=null},_destroyDraggableAndRemoveListeners:function(){this._destroyDraggable(),this.$wrappedElement.off("mouseover",this._onDraggableMouseOver),this.$wrappedElement.off("mouseleave",this._onDraggableMouseLeave)}}),t.exports={bind:function(e,a){var t=a.value,r=t.test||function(){return!0},n={testFn:r,config:t};e._draggable=new s(e,n)},unbind:function(e){var a=e._draggable;a&&!a.isDragInProgress()&&a.destroyDraggable()}}});