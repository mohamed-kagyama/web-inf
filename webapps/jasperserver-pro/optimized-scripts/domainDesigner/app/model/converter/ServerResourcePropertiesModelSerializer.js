/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../util/resourcePropertiesUtil","../enum/subResourceTypesEnum"],function(e,t,r){var n=e("underscore"),i=e("../util/resourcePropertiesUtil"),u=e("../enum/subResourceTypesEnum"),l={};l[u.FILE]=function(e){return{locale:e.locale,file:{file:{label:i.createBundleLabelFromLabelAndLocale(e.label,e.locale),type:"prop",content:e.content.base64}}}},l[u.FILE_REFERENCE]=function(e){return{locale:e.locale,file:{fileReference:{uri:e.uri}}}};var o={};o[u.FILE]=function(e){return{securityFile:{securityFile:{label:e.label,type:"xml",content:e.content.base64}}}},o[u.FILE_REFERENCE]=function(e){return{securityFile:{securityFileReference:{uri:e.uri}}}};var c=function(e){};n.extend(c.prototype,{serialize:function(e,t){var r=e.toJSON(),i=n.omit(r,"securityFile","dataSources","bundles");return n.extend(i,this._serializeDataSource(r)),n.extend(i,this._serializeBundles(r,t)),n.extend(i,this._serializeSecurityFile(r,t)),i},_serializeBundles:function(e,t){var r={},n=this;return e.bundles&&(r={bundles:e.bundles.map(function(e){return n._getSerializer({map:l,type:e.type,useContent:t,content:e.content})(e)})}),r},_getSerializer:function(e){var t=e.map,r=e.type,n=e.content;return e.useContent&&n&&(r=u.FILE),t[r]},_serializeSecurityFile:function(e,t){var r={},n=e.securityFile,i=this;if(n){r=i._getSerializer({map:o,type:n.type,useContent:t,content:n.content})(n)}return r},_serializeDataSource:function(e){return{dataSource:{dataSourceReference:{uri:n.chain(e.dataSources).values().first().value()}}}}}),r.exports=c});