/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","../../../model/util/profileAttributeUtil"],function(e,t,r){var i=e("jquery"),a=e("underscore"),o=e("../../../model/util/profileAttributeUtil"),s=function(e){this.initialize(e)};a.extend(s.prototype,{initialize:function(e){a.bindAll(this,"_filterParametrizedSchemas","_mapParametrizedSchemaToProfileAttributes"),this.profileAttributesService=e.profileAttributesService},resolve:function(e,t){t=t||{};var r=this._getProfileAttributesFromParametrizedSchemas(e);return a.size(r)>0?this.profileAttributesService.getProfileAttributes(r,{refresh:t.refresh}):(new i.Deferred).resolve([])},_getProfileAttributesFromParametrizedSchemas:function(e){return e.dataSourceGroups.chain().filter(this._filterParametrizedSchemas).map(this._mapParametrizedSchemaToProfileAttributes).toArray()},_getSchemaName:function(e){return e.getSourceName()||e.getName()},_filterParametrizedSchemas:function(e){var t=this._getSchemaName(e);return o.containsProfileAttributeWithPlaceholders(t)},_mapParametrizedSchemaToProfileAttributes:function(e){var t=this._getSchemaName(e),r=o.extractProfileAttributeArgs(t),i={name:r[0]};return a.size(r)>1&&(i.level=r[1]),i}}),r.exports=s});