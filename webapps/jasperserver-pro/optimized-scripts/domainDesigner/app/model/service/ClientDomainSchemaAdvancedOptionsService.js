/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../model/schema/mixin/allCollectionsMixin","../../../model/schema/util/entityUtil"],function(e,t,n){var i=e("underscore"),r=e("../../../model/schema/mixin/allCollectionsMixin"),a=e("../../../model/schema/util/entityUtil"),l=i.template("{{=template}}{{=key}}={{=value}}\r\n"),o=function(e){this.initialize(e)};i.extend(o.prototype,r,{initialize:function(e){this.dataStore=e.dataStore,this.mixInAllCollections(this.dataStore)},getBundleTemplate:function(){return this._getBundleTemplateForPresentationItems(this.dataIslands)},generateBundleKeys:function(e){return this._generateBundleKeysForPresentationItems(this.dataIslands,e)},_generateBundleKeysForPresentationItems:function(e,t){var n=this;return e.reduce(function(e,i){return e=e.concat(n._generateBundleKeysForPresentationItem(i,t))},[])},_generateBundleKeysForPresentationItem:function(e,t){var n=t.autoGenerateLabelKeyIfMissing,r=t.autoGenerateDescriptionKeyIfMissing,l=e.getName().toUpperCase(),o=t.parentLabel||"",s=[],d=o?o+"."+l:l,u={id:e.getId(),type:a.getEntityName(e)};return n&&!e.getLabelId()?u.labelId=d+".LABEL":e.getLabelId()&&(u.labelId=e.getLabelId()),r&&!e.getDescriptionId()?u.descriptionId=d+".DESCR":e.getDescriptionId()&&(u.descriptionId=e.getDescriptionId()),(u.labelId||u.descriptionId)&&s.push(u),a.isPresentationField(e)||(s=s.concat(this._generateBundleKeysForPresentationItems(e.getChildren(),i.extend({},t,{parentLabel:d})))),s},_getBundleTemplateForPresentationItems:function(e){var t=this;return e.reduce(function(e,n){return e+t._getBundleTemplateForPresentationItem(n)},"")},_getBundleTemplateForPresentationItem:function(e){var t=e.getLabelId(),n=e.getDescriptionId(),i="",r=this;return t&&(i=l({template:i,key:t,value:r._getLabelValue(e)})),n&&(i=l({template:i,key:n,value:r._getDescriptionValue(e)})),a.isPresentationField(e)||(i+=this._getBundleTemplateForPresentationItems(e.getChildren())),i},_getLabelValue:function(e){return e.getLabel()||""},_getDescriptionValue:function(e){return e.getDescription()||""}}),n.exports=o});