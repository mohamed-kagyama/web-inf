/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../model/schema/util/entityUtil","../util/defaultValueUtil","../enum/viewStateModelDefaultsEnum","../enum/canvasViewDesignersEnum","../../component/designer/presentationDesigner/moveItems/enum/movePresentationItemsPositionEnum"],function(e,t,n){var i=e("underscore"),r=e("../../../model/schema/util/entityUtil"),a=e("../util/defaultValueUtil"),o=e("../enum/viewStateModelDefaultsEnum"),s=e("../enum/canvasViewDesignersEnum"),S=e("../../component/designer/presentationDesigner/moveItems/enum/movePresentationItemsPositionEnum"),c=s.PRESENTATION_DESIGNER,l=function(e){i.bindAll(this,"isPresentationSidebarItemSelected","_isPresentationSidebarItemSelected","isPresentationItemSelected","_isPresentationItemSelected"),this.presentationItemsSelectionFactory=e.presentationItemsSelectionFactory,this.presentationSidebarSelectionFactory=e.presentationSidebarSelectionFactory,this.viewStateModel=e.viewStateModel,this.clientDomainSchemaService=e.clientDomainSchemaService};i.extend(l.prototype,{getPresentationDesignerDropZoneActivator:function(){return i.cloneDeep(this.viewStateModel.getDesignerSpecificProperty(c,"dropZoneActivator"))},getPresentationSidebarSelectedItems:function(){return this._getPresentationSidebarSelectedItems()},getPresentationSidebarSelectionParentId:function(){return this._getPresentationSidebarSelectionParentId()},getPresentationSidebarSelectionSize:function(){return this._getPresentationSidebarSelectedItems().length},getPresentationSidebarRangeSelectionStartItem:function(){var e=this._getPresentationSidebarSelectedItems();return i.find(e,function(e){return e.rangeSelectionStartItem})},isPresentationSidebarItemSelected:function(e){return this._isPresentationSidebarItemSelected(e)},isPresentationSidebarSelectionEmpty:function(){return this._isPresentationSidebarSelectionEmpty()},canSelectPresentationSidebarItem:function(e){return!this._isPresentationSidebarItemSelected(e)||this._isMoreThanOneItemInPresentationSidebarSelection()},canTogglePresentationSidebarSelection:function(e){return this._canTogglePresentationSidebarSelection(e)},getPresentationDesignerCanvasSearchKeyword:function(){var e=this.viewStateModel.getSearchKeyword(c);return i.cloneDeep(e.canvas)},getSidebarSearchKeyword:function(){var e=this.viewStateModel.getSidebarSearchKeyword(c);return i.cloneDeep(e)},getPresentationCanvasSelectedItems:function(){return this._getPresentationCanvasSelectedItems()},getPresentationCanvasSelectionParentId:function(){return this._getPresentationCanvasSelectionParentId()},getPresentationItemsRangeSelectionStartItem:function(){var e=this._getPresentationCanvasSelectedItems();return i.find(e,function(e){return e.rangeSelectionStartItem})},getPresentationItemsSelectionSize:function(){return this._getPresentationItemsSelectionSize()},canEnableAddPresentationSetButton:function(){var e=this._getPresentationCanvasSelectedItems(),t=e[0];return 1===this._getPresentationItemsSelectionSize()&&(r.isDataIsland(t.type)||r.isPresentationSet(t.type))},getItemsCountOnSelectedLevel:function(){return this._getItemsCountOnSelectedLevel()},getEnabledButtonsForPresentationMoving:function(){var e=this._getPresentationCanvasSelectedItems(),t=this._getItemsCountOnSelectedLevel(),n=i.reduce(e,function(e,t){return t&&e.push(t.index),e},[]),r={},a=n[0],o=n[n.length-1],s=o>n.length-1;r[S.MOVE_TOP]=s,r[S.MOVE_UP]=s;var c=a<t-n.length;return r[S.MOVE_DOWN]=c,r[S.MOVE_BOTTOM]=c,r},getNewPresentationSidebarSelection:function(e,t){var n=this._getPresentationSidebarSelection();return t=i.extend({items:e,selection:n,isItemSelected:this._isPresentationSidebarItemSelected},t),this.presentationSidebarSelectionFactory.create(t)},getNewPresentationItemsSelection:function(e,t){var n=this._getPresentationItemsSelection();return t=i.extend({items:e,selection:n,isItemSelected:this._isPresentationItemSelected},t),this.presentationItemsSelectionFactory.create(t)},getCellsWidth:function(){return this.viewStateModel.getDesignerSpecificRuntimeProperty(c,"cellsWidth")},canSelectPresentationItem:function(e){return!this._isPresentationItemSelected(e)||this._isMoreThanOneItemInPresentationSelection()},canTogglePresentationItemSelection:function(e){return this._canTogglePresentationItemSelection(e)},isPresentationItemSelected:function(e){return this._isPresentationItemSelected(e)},isPresentationItemsSelectionEmpty:function(){var e=this._getPresentationCanvasSelectedItems();return i.isEmpty(e)},isPresentationItemSingleSelectShouldBePerformedOnDrag:function(e){return!this._isPresentationItemSelected(e)},isPresentationItemMultiSelectShouldBePerformedOnDrag:function(e){var t=this._isPresentationItemSelected(e);return this._canTogglePresentationItemSelection(e)&&!t},isPresentationSidebarSingleSelectShouldBePerformedOnDrag:function(e){return!this._isPresentationSidebarItemSelected(e)},isPresentationSidebarMultiSelectShouldBePerformedOnDrag:function(e){var t=this._isPresentationSidebarItemSelected(e);return this._canTogglePresentationSidebarSelection(e)&&!t},isDataIslandExpanded:function(e){var t=this._getDataIsland(e),n=this._getDefaultPresentationItemsNodeExpandedState(),i=o.PRESENTATION_DESIGNER.NODE_EXPANSION.property;return a.getPropertyValueOrDefault(t,i,n)},isPresentationSetExpanded:function(e){var t=this._getPresentationSet(e),n=this._getDefaultPresentationItemsNodeExpandedState(),i=o.PRESENTATION_DESIGNER.NODE_EXPANSION.property;return a.getPropertyValueOrDefault(t,i,n)},isDataIslandPropertiesEditorExpanded:function(e){var t=this._getDataIsland(e),n=this._getDefaultPresentationItemsEditorExpandedState(),i=o.PRESENTATION_DESIGNER.PROPERTY_EDITOR_EXPANSION.property;return a.getPropertyValueOrDefault(t,i,n)},isPresentationSetPropertiesEditorExpanded:function(e){var t=this._getPresentationSet(e),n=this._getDefaultPresentationItemsEditorExpandedState(),i=o.PRESENTATION_DESIGNER.PROPERTY_EDITOR_EXPANSION.property;return a.getPropertyValueOrDefault(t,i,n)},isPresentationFieldPropertiesEditorExpanded:function(e){var t=this._getPresentationField(e),n=this._getDefaultPresentationItemsEditorExpandedState(),i=o.PRESENTATION_DESIGNER.PROPERTY_EDITOR_EXPANSION.property;return a.getPropertyValueOrDefault(t,i,n)},getPresentationDesignerColumnSet:function(){return this.viewStateModel.getDesignerSpecificProperty(c,"columnSet")},_getPresentationSidebarSelectedItems:function(){var e=this._getPresentationSidebarSelection();return this._sortSelectionByIndex(e.items)},_getPresentationSidebarSelectionSize:function(){return this._getPresentationSidebarSelectedItems().length},_getPresentationSidebarSelection:function(){return i.cloneDeep(this.viewStateModel.getDesignerSpecificProperty(c,"sidebarSelection"))},_getPresentationSidebarSelectionParentId:function(){return this._getPresentationSidebarSelection().parentId},_isPresentationSidebarItemSelected:function(e){return this.viewStateModel.getDesignerSpecificProperty(c,"sidebarSelection").items[e.id]},_isPresentationSidebarSelectionEmpty:function(){var e=this._getPresentationSidebarSelectedItems();return i.isEmpty(e)},_isMoreThanOneItemInPresentationSidebarSelection:function(){return this._getPresentationSidebarSelectionSize()>1},_isPresentationSidebarItemOnSameLevelAsSelection:function(e){return this._getPresentationSidebarSelectionParentId()===e.parentId},_canTogglePresentationSidebarSelection:function(e){return this._isPresentationSidebarSelectionEmpty()||this._isPresentationSidebarItemOnSameLevelAsSelection(e)},_getPresentationItemsSelection:function(){var e=this.viewStateModel.getCurrentSelection(c);return i.cloneDeep(e)},_getPresentationCanvasSelectedItems:function(){var e=this._getPresentationItemsSelection();return this._sortSelectionByIndex(e.items)},_getPresentationCanvasSelectionParentId:function(){return this._getPresentationItemsSelection().parentId},_getPresentationItemsSelectionSize:function(){return this._getPresentationCanvasSelectedItems().length},_getItemsCountOnSelectedLevel:function(){var e=this._getPresentationItemsSelection(),t=this._getPresentationItemsSelectionSize(),n=e.parentId;return 0===t?0:n?this.clientDomainSchemaService.getPresentationItemChildrenSize(n):this.clientDomainSchemaService.getDataIslandsSize()},_isPresentationItemSelected:function(e){return this.viewStateModel.getCurrentSelection(c).items[e.id]},_isMoreThanOneItemInPresentationSelection:function(){return this._getPresentationItemsSelectionSize()>1},_isPresentationItemOnSameLevelAsSelection:function(e){return this._getPresentationCanvasSelectionParentId()===e.parentId},_canTogglePresentationItemSelection:function(e){return this.isPresentationItemsSelectionEmpty()||this._isPresentationItemOnSameLevelAsSelection(e)},_getDefaultPresentationItemsNodeExpandedState:function(){return this.viewStateModel.getDesignerSpecificProperty(c,"defaultPresentationItemsNodeExpandedState")},_getDefaultPresentationItemsEditorExpandedState:function(){return this.viewStateModel.getDesignerSpecificProperty(c,"defaultPresentationItemsEditorExpandedState")},_getDataIsland:function(e){var t=this.viewStateModel.getDesignerSpecificProperty(c,"dataIslands");return a.getPropertyValueOrDefault(t,e,o.PRESENTATION_DESIGNER.DATA_ISLAND.value)},_getPresentationSet:function(e){var t=this.viewStateModel.getDesignerSpecificProperty(c,"presentationSets");return a.getPropertyValueOrDefault(t,e,o.PRESENTATION_DESIGNER.PRESENTATION_SET.value)},_getPresentationField:function(e){var t=this.viewStateModel.getDesignerSpecificProperty(c,"presentationFields");return a.getPropertyValueOrDefault(t,e,o.PRESENTATION_DESIGNER.PRESENTATION_FIELD.value)},_sortSelectionByIndex:function(e){return i.sortBy(e,function(e){return e.index})}}),n.exports=l});