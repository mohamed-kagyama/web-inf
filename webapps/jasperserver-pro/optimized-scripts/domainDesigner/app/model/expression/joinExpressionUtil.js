/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../util/pathUtil","../../../model/schema/util/entityUtil","../enum/expressionsEnum","../enum/expressionFormatEnum","./expressionVariables","./expressionFormatter","./joinParserUtil/util/joinVariableParser","../../../model/schema/util/schemaModelUtil"],function(e,r,t){function i(e){var r=O(e);return l.reduce(r,function(e,r){return r=g.parse(r),e[r.alias]||(e[r.alias]=[]),e[r.alias].push(r.field),e},{})}function n(e,r,t){var i=t.joinAliases.byId(e),n=h.getTableReferenceByJoinAlias(i,t),a=h.getTableFieldsByJoinAlias(i,t).concat(n.getCalcFields().toArray()),o=l.findWhere(a,{id:r});return u.join([i.getName(),o.getName()],"\\",".")}function a(e,r){return e.reduce(function(e,t){var i;d.isJoinExpression(t)?i=o(t,r):d.isConstantJoinExpression(t)&&(i=s(t,r));var n=m[x.and.name];return e?n({leftOperand:e,rightOperand:i}):i},"")}function o(e,r){var t=e.getLeftJoinAliasId(),i=e.getRightJoinAliasId(),a=e.getLeftFieldId(),o=e.getRightFieldId(),s=n(t,a,r),l=n(i,o,r);return f.formatOperatorWithTwoOperands({leftOperand:s,rightOperand:l,operator:e.getOperator()})}function s(e,r){var t=e.getJoinAliasId(),i=e.getFieldId(),a=n(t,i,r);return f.formatOperatorWithTwoOperands({leftOperand:a,rightOperand:e.getValue(),operator:e.getOperator()})}var l=e("underscore"),u=e("../../util/pathUtil"),d=e("../../../model/schema/util/entityUtil"),p=e("../enum/expressionsEnum"),m=e("../enum/expressionFormatEnum"),c=e("./expressionVariables"),f=e("./expressionFormatter"),g=e("./joinParserUtil/util/joinVariableParser"),h=e("../../../model/schema/util/schemaModelUtil"),x=p.operators,O=c.collect;t.exports={collectJoinVariables:i,formatJoinExpression:o,formatConstantJoinExpression:s,formatJoinExpressions:a}});