/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../enum/clientExpressionsEnum","./enum/filterParserStateNamesEnum","./factory/filterParserStateFactory","../expressionWalker"],function(e,t,s){function r(e){return(new u).parseFilter(e)}var n=e("underscore"),i=e("../../enum/clientExpressionsEnum"),a=e("./enum/filterParserStateNamesEnum"),o=e("./factory/filterParserStateFactory"),p=e("../expressionWalker"),l=i.operators,c=i.functions,h=i.castFunctions,u=function(){this.initialize()};n.extend(u.prototype,{initialize:function(){n.bindAll(this,"_changeState","_parseUnsupportedFilterExpression"),this.context={currentFilterExpression:{},filterExpressions:[]},this.state=o.create(a.SET_FILTER_EXPRESSION_OPERATOR_STATE,this.context)},parseFilter:function(e){return this._parseFilterExpressionIfWholeExpressionObjectIsComplex(e),Boolean(this.context.filterExpressions.length)||p.walk(e.object,this._getHandlers()),this.context.filterExpressions},_getHandlers:function(){return{any:this._parseUnsupportedFilterExpression,and:this._changeState,not:this._changeState,equals:this._changeState,notEqual:this._changeState,greater:this._changeState,less:this._changeState,greaterOrEqual:this._changeState,lessOrEqual:this._changeState,function:this._changeState,in:this._changeState}},_isFilterExpressionKeySupported:function(e){return l[e]||c[e]||h[e]},_parseFilterExpressionIfWholeExpressionObjectIsComplex:function(e){var t=this;p.walk(e.object,{any:function(s,r){return t._parseUnsupportedFilterExpression(s,r,e.string),!0}})},_parseUnsupportedFilterExpression:function(e,t,s){if(n.isString(e)&&!this._isFilterExpressionKeySupported(e))return this._parseComplexFilterExpression(t,e,s)},_changeState:function(e,t){try{this.state=this.state[t](e,t)}catch(s){return this._parseComplexFilterExpression(e,t)}if(this.context.resetExpressionWalker)return this.context.resetExpressionWalker=!1,!0},_parseComplexFilterExpression:function(e,t,s){return this.state=o.create(a.PARSE_COMPLEX_FILTER_EXPRESSION_STATE,this.context),this.state=this.state.parseComplexFilter(e,t,s),!0}}),s.exports={parseFilter:r}});