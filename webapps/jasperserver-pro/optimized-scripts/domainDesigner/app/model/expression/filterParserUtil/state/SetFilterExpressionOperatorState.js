/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./error/ParseFilterExpressionError","./factory/operatorByFunctionNameFactory","../../expressionWalker","./specification/isNotOperatorCanInvertExpressionSpecification","../../../enum/clientExpressionsEnum","../enum/filterParserStateNamesEnum"],function(t,e,n){var a=t("underscore"),r=t("./error/ParseFilterExpressionError"),i=t("./factory/operatorByFunctionNameFactory"),s=t("../../expressionWalker"),o=t("./specification/isNotOperatorCanInvertExpressionSpecification"),c=t("../../../enum/clientExpressionsEnum"),h=t("../enum/filterParserStateNamesEnum"),u=c.operators,l=c.functions,S=function(t){this.initialize(t)};a.extend(S.prototype,{initialize:function(t){a.bindAll(this,"_changeState"),this.factory=t.factory,this.context=t.context},not:function(t){if(o.isSatisfiedBy(t))return this.context.isNot=!0,this.factory.create(h.SET_FILTER_EXPRESSION_OPERATOR_STATE,this.context);throw new r},and:function(){return this.context.currentFilterExpression={},this.factory.create(h.SET_FILTER_EXPRESSION_OPERATOR_STATE,this.context)},equals:function(t){var e=this.context.isNot?u.notEqual.name:u.equals.name;return this._setSimpleOperator(e,t)},notEqual:function(t){return this._setSimpleOperator(u.notEqual.name,t)},greater:function(t){return this._setSimpleOperator(u.greater.name,t)},less:function(t){return this._setSimpleOperator(u.less.name,t)},greaterOrEqual:function(t){return this._setSimpleOperator(u.greaterOrEqual.name,t)},lessOrEqual:function(t){return this._setSimpleOperator(u.lessOrEqual.name,t)},in:function(t){var e=this.context.isNot?u.notIn.name:u.in.name;return this._setSimpleOperator(e,t)},function:function(t){var e=t.functionName,n=i.create(e,{isNot:this.context.isNot});if(e===l.isAnyValue.name&&(this.context.isAnyValue=!0),n)return this._setSimpleOperator(n,t);throw new r},_setSimpleOperator:function(t,e){this.context.currentFilterExpression={left:{},operator:t,right:{}},this.state=this.factory.create(h.SET_FILTER_EXPRESSION_LEFT_OPERAND_STATE,this.context);try{s.walk(e[u.operands.name],this._getHandlers())}catch(t){throw new r}return this.context.resetExpressionWalker=!0,this.state},_getHandlers:function(){return{and:this._changeState,not:this._changeState,equals:this._changeState,notEqual:this._changeState,greater:this._changeState,less:this._changeState,greaterOrEqual:this._changeState,lessOrEqual:this._changeState,function:this._changeState,in:this._changeState,range:this._changeState,list:this._changeState,items:this._changeState,start:this._changeState,end:this._changeState,value:this._changeState,variable:this._changeState,name:this._changeState,string:this._changeState,number:this._changeState,boolean:this._changeState,date:this._changeState,time:this._changeState,timestamp:this._changeState,NULL:this._changeState}},_changeState:function(t,e){this.state=this.state[e](t,e)}}),n.exports=S});