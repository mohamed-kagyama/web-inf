/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../enum/dependenciesTreeAlignmentEnum"],function(e,t,n){var i=e("underscore"),s=e("backbone"),o=e("../enum/dependenciesTreeAlignmentEnum"),r=function(e){this.dependenciesInspectorModel=e.dependenciesInspectorModel,this.dependenciesInspectorDialog=e.dependenciesInspectorDialog,this.dependenciesInspectorEventBus=e.dependenciesInspectorEventBus,this.leftVirtualDataEventBus=e.leftVirtualDataEventBus,this.rightVirtualDataEventBus=e.rightVirtualDataEventBus,this.dependenciesLeftTreeVirtualDataComponentEventBus=e.dependenciesLeftTreeVirtualDataComponentEventBus,this.dependenciesRightTreeVirtualDataComponentEventBus=e.dependenciesRightTreeVirtualDataComponentEventBus,this.dependenciesInspectorLeftTreeStoreMutations=e.dependenciesInspectorLeftTreeStoreMutations,this.dependenciesInspectorRightTreeStoreMutations=e.dependenciesInspectorRightTreeStoreMutations,this._initEvents()};i.extend(r.prototype,s.Events,{_initEvents:function(){this.listenTo(this.dependenciesInspectorEventBus,"dependenciesInspectorComponent:confirm",this._onConfirm),this.listenTo(this.dependenciesInspectorEventBus,"dependenciesInspectorComponent:reject",this._onReject),this.listenTo(this.dependenciesInspectorDialog,"dialog:resize",this._onDialogResize),this.listenTo(this.dependenciesInspectorDialog,"dialog:resize:started",this._onDialogResizeStarted),this.listenTo(this.dependenciesLeftTreeVirtualDataComponentEventBus,"tree:toggle",this._onLeftTreeToggle),this.listenTo(this.dependenciesRightTreeVirtualDataComponentEventBus,"tree:toggle",this._onRightTreeToggle),this.listenTo(this.leftVirtualDataEventBus,"canvas:scroll",this._onScrollChange),this.listenTo(this.rightVirtualDataEventBus,"canvas:scroll",this._onScrollChange)},open:function(e){this.dependenciesInspectorModel.reset(),this.dependenciesInspectorLeftTreeStoreMutations.reset(),this.dependenciesInspectorRightTreeStoreMutations.reset();var t=e.leftGroup,n=e.rightGroup,s=!i.isEmpty(t),r=!i.isEmpty(n);s&&(this.dependenciesInspectorModel.set("isAllDependenciesExceptDataIslandsVisible",s),this.dependenciesInspectorLeftTreeStoreMutations.setItems(t)),r&&(this.dependenciesInspectorModel.set("isDataIslandsVisible",r),this.dependenciesInspectorRightTreeStoreMutations.setItems(n)),r&&s&&this.dependenciesInspectorModel.set({allDependenciesExceptDataIslandsAlignment:o.LEFT_ALIGNMENT,dataIslandsAlignment:o.RIGHT_ALIGNMENT}),this.dependenciesInspectorDialog.open()},_onConfirm:function(){this.trigger("confirm")},_onReject:function(){this.trigger("reject")},_onLeftTreeToggle:function(e){this.dependenciesInspectorLeftTreeStoreMutations.toggle(e)},_onRightTreeToggle:function(e){this.dependenciesInspectorRightTreeStoreMutations.toggle(e)},_onScrollChange:function(e){this.dependenciesInspectorLeftTreeStoreMutations.updateScrollPos(e),this.dependenciesInspectorRightTreeStoreMutations.updateScrollPos(e)},_onDialogResize:function(e){var t,n=e.size,i=this.dependenciesInspectorModel.get("dialogInitialHeight"),s=this.dependenciesInspectorModel.get("initialDependenciesHeight"),o=n.height-i,r=s+o;t=n.height>i?r:s,this.dependenciesInspectorLeftTreeStoreMutations.updateHeight(t),this.dependenciesInspectorRightTreeStoreMutations.updateHeight(t)},_onDialogResizeStarted:function(){var e=this.dependenciesInspectorModel.get("dialogInitialHeight"),t=this.dependenciesInspectorModel.get("initialDependenciesHeight");e||t||(e=this.dependenciesInspectorDialog.$el.outerHeight(),t=this.dependenciesInspectorDialog.$el.find(".jr-jDependencies").outerHeight(),this.dependenciesInspectorModel.set({dialogInitialHeight:e,initialDependenciesHeight:t}))},close:function(){this.dependenciesInspectorDialog.close()}}),n.exports=r});