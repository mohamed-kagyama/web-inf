/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/schema/enum/schemaEntitiesEnum","../../enum/dependenciesSortSequenceEnum","../../enum/dependenciesGroupNamesEnum"],function(e,n,r){function u(){t.bindAll(this,"reduce")}var t=e("underscore"),o=e("../../../../../model/schema/enum/schemaEntitiesEnum"),s=e("../../enum/dependenciesSortSequenceEnum"),i=e("../../enum/dependenciesGroupNamesEnum");t.extend(u.prototype,{reduce:function(e){var n=[];return t.isEmpty(e)||(e=this._combinePreFiltersToGroup(e),e=this._sortByNameInGroup(e),e=this._reduceGroupsToArray(e),n=this._flattenGroup(e)),n},_combinePreFiltersToGroup:function(e){return t.reduce(e,function(e,n,r){var u=r===o.FILTER_EXPRESSION,t=r===o.COMPLEX_FILTER;return e[i.PRE_FILTER]||(e[i.PRE_FILTER]=[]),u||t?e[i.PRE_FILTER]=e[i.PRE_FILTER].concat(n):e[r]=n,e},{})},_sortByNameInGroup:function(e){return t.reduce(e,function(e,n,r){return e[r]=n.sort(function(e,n){if(e.name&&n.name)return e.name.localeCompare(n.name)}),e},{})},_reduceGroupsToArray:function(e){var n=t.reduce(e,function(e,n,r){var u=Boolean(n.length),o=s[r];if(!u)return e;var i={name:r,entities:n};return t.isUndefined(o)?e.unsortedGroups.push(i):e.sortedGroups[o]=i,e},{sortedGroups:[],unsortedGroups:[]},this);return t.compact(n.sortedGroups).concat(n.unsortedGroups)},_flattenGroup:function(e){return t.reduce(e,function(e,n){if(n.entities){var r=n.entities;n.entities=[],e.push(n),e=e.concat(r)}else e.push(n);return e},[])}}),r.exports=u});