/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./enum/validationStateNameEnum","../../../../model/util/profileAttributeUtil","../../../model/util/resourceNameSpecialCharactersUtil"],function(e,a,t){var i=e("underscore"),r=e("./enum/validationStateNameEnum"),n=e("../../../../model/util/profileAttributeUtil"),o=e("../../../model/util/resourceNameSpecialCharactersUtil"),c=function(e){this.initialize(e)};i.extend(c.prototype,{initialize:function(e){this.clientDomainValidationService=e.clientDomainValidationService,this.domainValidationMutations=e.domainValidationMutations,this.dataSourceFreshInfoService=e.dataSourceFreshInfoService},enter:function(e,a){var t=this;this.dataSourceFreshInfoService.fetchFreshDataSourceInfoWithAvailableSchemas(e.dataSourceUri).then(function(o){var c;o=t._replaceSpecialCharactersInDataSourceName(o),t.domainValidationMutations.replaceDataSourceMetadata(o),e.availableSchemasToMap=o.availableSchemas;var l=t.clientDomainValidationService.getAllSchemasSourceNamesOrNames();c=i.some(l,function(e){return n.containsProfileAttributeWithPlaceholders(e)})?r.DOMAIN_VALIDATION_STATE:r.MAP_SCHEMAS_STATE,a.enter(c,e)},function(t){e.xhr=t,a.enter(r.VALIDATION_ERROR_STATE,e)})},_replaceSpecialCharactersInDataSourceName:function(e){var a=o.replaceResourceNameSpecialCharacters(e.name);return i.extend({},e,{name:a})}}),t.exports=c});