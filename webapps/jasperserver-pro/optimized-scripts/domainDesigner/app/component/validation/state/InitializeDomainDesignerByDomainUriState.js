/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./enum/expandedDomainSchemaUrlParamsEnum","./util/replaceExpandedDataSourceWithDataSourceReferenceUtil","./enum/validationStateNameEnum","./util/validationStateContextUtil"],function(e,i,t){var n=e("underscore"),a=e("./enum/expandedDomainSchemaUrlParamsEnum"),r=e("./util/replaceExpandedDataSourceWithDataSourceReferenceUtil"),o=e("./enum/validationStateNameEnum"),u=e("./util/validationStateContextUtil"),c=function(e){this.initialize(e)};n.extend(c.prototype,{initialize:function(e){this.resourcesService=e.resourcesService,this.validationService=e.validationService,this.domainValidationMutations=e.domainValidationMutations,this.clientDomainInitialDesignerStateService=e.clientDomainInitialDesignerStateService},enter:function(e,i){var t=this,n=e.domainUri;this.resourcesService.getDomain(n,{urlParams:a}).then(function(i){return i=r.replace(i),u.setDomainResource(e,i),t.validationService.validateDomain(i,{}).then(function(){return i})}).then(function(e){return t.clientDomainInitialDesignerStateService.getInitialDesignerStateByDomainResource(e)}).then(function(n){e.domainDesignerState=n,t.domainValidationMutations.setDesignerState(e.domainDesignerState),i.enter(o.LOAD_NEW_FIELDS_FOR_ALL_TABLES_STATE,e)},function(t){e.xhr=t,i.enter(o.DOMAIN_DESIGNER_INITIAL_STATE_FAIL_STATE,e)})}}),t.exports=c});