/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","./enum/validationStateNameEnum"],function(t,r,i){var o=t("underscore"),e=t("backbone"),a=t("./enum/validationStateNameEnum"),n=function(t){this.initialize(t)};o.extend(n.prototype,e.Events,{initialize:function(t){this.dataSourceErrorsConverterFactory=t.dataSourceErrorsConverterFactory,this.dataSourceInvalidErrorsSorter=t.dataSourceInvalidErrorsSorter,this.validationErrorDialogStore=t.validationErrorDialogStore,this.validationEventBus=t.validationEventBus,this.dataSourceErrorValidationDialogStateFactory=t.dataSourceErrorValidationDialogStateFactory},enter:function(t,r){var i=this.dataSourceInvalidErrorsSorter.sort(t.errors),e=this.dataSourceErrorsConverterFactory.create(t.initialState),a=e.convert(i),n=this.dataSourceErrorValidationDialogStateFactory.create(a),n=o.extend({},this.dataSourceErrorValidationDialogStateFactory.create(a),{show:!0});this._subscribeToDialogEvents(t,r,n),this.validationErrorDialogStore.setState(n)},_subscribeToDialogEvents:function(t,r,i){this.listenTo(this.validationEventBus,i.confirmEvent,o.bind(this._selectDifferentDataSource,this,t,r)),this.listenTo(this.validationEventBus,i.rejectEvent,o.bind(this._goToPreviousLocationOrStayInDesigner,this,t,r))},_selectDifferentDataSource:function(t,r){this._closeDialogAndUnsubscribe(),r.enter(a.SELECT_DATA_SOURCE_STATE,t)},_closeDialogAndUnsubscribe:function(){this.stopListening(this.validationEventBus),this.validationErrorDialogStore.set("show",!1)},_goToPreviousLocationOrStayInDesigner:function(t,r){this._closeDialogAndUnsubscribe(),r.enter(a.GOTO_PREVIOUS_LOCATION_OR_STAY_IN_DESIGNER_STATE,t)}}),i.exports=n});