/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../rest/enum/mimeTypesEnum","../../../../util/uuidGenerator","../../../../rest/enum/requestParamsEnum","../../designer/optionsDesigner/enum/tempSchemaResourceFileInfoEnum","./enum/validationStateNameEnum"],function(e,n,r){var t=e("underscore"),i=e("../../../../rest/enum/mimeTypesEnum"),u=e("../../../../util/uuidGenerator"),m=e("../../../../rest/enum/requestParamsEnum"),a=e("../../designer/optionsDesigner/enum/tempSchemaResourceFileInfoEnum"),o=e("./enum/validationStateNameEnum"),s=t.template(a.TEMP_SCHEMA_RESOURCE_NAME_TEMPLATE),c=function(e){this.initialize(e)};t.extend(c.prototype,{initialize:function(e){this.resourcesService=e.resourcesService},enter:function(e,n){this._convertXmlSchemaToJson(e.domainSchemaString).then(function(r){e.domainSchemaAsJSONString=r,n.enter(o.UPLOAD_SCHEMA_PARSE_SCHEMA_AND_CREATE_DOMAIN_STATE,e)},function(r){e.error=r,n.enter(o.UPLOAD_SCHEMA_XML_CONVERSION_ERROR_STATE,e)})},_convertXmlSchemaToJson:function(e){var n=this._generateTemporarySchemaResourceName();return this.resourcesService.saveFileResourceViaDirectStreaming(e,{urlParams:[{name:m.DRY_RUN.NAME,value:m.DRY_RUN.VALUES.TRUE}],uri:a.TEMP_FOLDER,fileType:i.GENERIC_XML,name:n,description:"",accept:i.DOMAIN_SCHEMA_RESOURCE_JSON,dataType:"text"})},_generateTemporarySchemaResourceName:function(){return s({suffix:u.generate()})}}),r.exports=c});