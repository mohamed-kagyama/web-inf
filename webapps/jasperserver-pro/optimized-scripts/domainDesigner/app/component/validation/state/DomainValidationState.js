/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./enum/expandedDomainSchemaUrlParamsEnum","./enum/validationStateNameEnum"],function(i,e,a){var n=i("underscore"),t=i("./enum/expandedDomainSchemaUrlParamsEnum"),r=i("./enum/validationStateNameEnum"),o=function(i){this.initialize(i)};n.extend(o.prototype,{initialize:function(i){this.validationService=i.validationService,this.domainValidationMutations=i.domainValidationMutations,this.domainSchemaMappingService=i.domainSchemaMappingService,this.clientDomainValidationService=i.clientDomainValidationService},enter:function(i,e){var a,n=this;a=this._getDomainSchemaInServerFormat(i),this.validationService.validateDomain(a,{uriParams:t}).then(function(){i.schemaPairs&&n.domainValidationMutations.mapSchemas(i.schemaPairs),i.initialState===r.SAVE_DOMAIN_INITIAL_VALIDATION_STATE?e.enter(r.SET_DOMAIN_DESIGNER_STATE_WITH_CURRENT_DESIGNER_STATE,i):e.enter(r.LOAD_NEW_FIELDS_FOR_ALL_TABLES_STATE,i)},function(a){i.xhr=a,e.enter(r.VALIDATION_ERROR_STATE,i)})},_getDomainSchemaInServerFormat:function(i){var e=i.schemaPairs;return e?this.domainSchemaMappingService.replaceSchemas(this.clientDomainValidationService.serialize(),e):this.clientDomainValidationService.serializeToServerSchema()}}),a.exports=o});