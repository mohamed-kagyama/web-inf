/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/util/SimpleModel","../enum/schemaMappingType","../../../../../model/schema/enum/specialSchemaNamesEnum"],function(e,i,t){var a=e("underscore"),n=e("../../../../../model/util/SimpleModel"),s=e("../enum/schemaMappingType"),l=e("../../../../../model/schema/enum/specialSchemaNamesEnum"),c=l.SCHEMALESS_NAME_SUBSTITUTION;t.exports=n.extend({defaults:function(){return{existingSchemas:[],availableSchemas:[],isSelectingExistingSchema:!1,isSelectingAvailableSchema:!1,allowLink:!1,allowUnlink:!1,isVisible:!1}},getMappedResult:function(){var e=this._getSelectedSchemas();return this.get("isSelectingExistingSchema")&&e.existing?[[e.existing.name,c]]:this.get("isSelectingAvailableSchema")&&e.available?[[c,e.available.name]]:this.get("existingSchemas").reduce(function(e,i){return i.mappedWith&&e.push([i.name,i.mappedWith]),e},[])},updateSelection:function(e){var i=this._getSchemasListByType(e.type),t=this._getOppositeSchemasListByType(e.type);a.each(i,function(i){i.isSelected=i.name===e.name}),a.each(t,function(i){e.mappedWith?i.isSelected=i.name===e.mappedWith:i.mappedWith&&(i.isSelected=!1)});var n=this._getSelectedSchemas();this.set("allowLink",Boolean(n.existing&&n.available&&n.existing.mappedWith!==n.available.name)),this.set("allowUnlink",Boolean(n.existing&&n.available&&n.existing.mappedWith===n.available.name))},disableButtons:function(){this.set("allowLink",!1),this.set("allowUnlink",!1)},unlinkSelectedSchemas:function(){var e=this._getSelectedSchemas();e.existing.mappedWith=!1,e.available.mappedWith=!1,this._updateIndexes(),this.set("allowLink",!0),this.set("allowUnlink",!1)},linkSelectedSchemas:function(){var e=this._getSelectedSchemas();e.existing&&e.available&&(e.existing.mappedWith=e.available.name,e.available.mappedWith=e.existing.name),this._updateIndexes(),this.set("allowLink",!1),this.set("allowUnlink",!0)},_getSchemasListByType:function(e){return this.get(e+"Schemas")},_getOppositeSchemasListByType:function(e){return e=e===s.EXISTING?s.AVAILABLE:s.EXISTING,this._getSchemasListByType(e)},_getSelectedSchemas:function(){var e={};return a.each([s.EXISTING,s.AVAILABLE],function(i){a.some(this._getSchemasListByType(i),function(t){if(t.isSelected)return e[i]=t,!0})},this),e},_updateIndexes:function(){var e=1,i=this.get("existingSchemas").concat().sort(function(e,i){return 0===e.index?1:0===i.index?-1:e.index-i.index});i=i.map(function(i){return i.index=i.mappedWith?i.index=e++:0,i}),this.get("availableSchemas").forEach(function(e){var t=e.mappedWith&&a.findWhere(i,{name:e.mappedWith}).index;e.index=e.mappedWith?t:0})}})});