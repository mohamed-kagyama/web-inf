/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","bundle!DomainDesignerBundle","../model/DomainRepositoryResourceModel","runtime_dependencies/js-sdk/src/jrs.configs","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","../../../../rest/errorHandling/errorMessageUtil","runtime_dependencies/bi-repository/src/bi/repository/dialog/SaveDialogView","text!../template/saveDialogTemplate.htm","text!../template/saveDialogContentTemplate.htm","text!../template/saveDialogButtonTemplate.htm"],function(e,t,a){var i=e("underscore"),r=e("bundle!DomainDesignerBundle"),n=e("../model/DomainRepositoryResourceModel"),o=e("runtime_dependencies/js-sdk/src/jrs.configs"),s=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),l=e("../../../../rest/errorHandling/errorMessageUtil"),d=e("runtime_dependencies/bi-repository/src/bi/repository/dialog/SaveDialogView"),c=e("text!../template/saveDialogTemplate.htm"),p=e("text!../template/saveDialogContentTemplate.htm"),u=e("text!../template/saveDialogButtonTemplate.htm"),m={label:{validationContainer:".jr-jLabelValidation",validationText:".jr-jLabelValidationText"},description:{validationContainer:".jr-jDescriptionValidation",validationText:".jr-jDescriptionValidationText"}};a.exports=d.extend({constructor:function(e){this.request=e.request,this.dataNameAttrs=e.dataNameAttrs,this.skipDataBaseMetadataCheck=e.skipDataBaseMetadataCheck;var t={unknown:l.getFirstErrorMessage},a=r["domain.designer.saveDialog.title"],i=r["domain.designer.saveAsDialog.title"],n="";e.currentDomainUri?n=e.currentDomainUri.substr(0,e.currentDomainUri.lastIndexOf("/")):e.parentFolderUri&&(n=e.parentFolderUri),d.prototype.constructor.call(this,{handles:function(e){return{e:e.find(".jr-jDraggable")}},minWidth:425,minHeight:550,template:c,dialogContentTemplate:p,dialogButtonTemplate:u,folderTreeOptions:{treeBufferSize:e.treeBufferSize,treeContainerClass:".jr-jTree"},errorMessages:t,additionalCssClasses:"domainDesigner",title:a,titleSaveAs:i,model:e.model,defaultSelectedFolder:n,notificationSuccessMessage:r["domain.designer.saved"]})},render:function(){return d.prototype.render.apply(this,arguments),this.$el.attr("data-name",this.dataNameAttrs.dialogTitle),this.$el.find("input").attr("data-name",this.dataNameAttrs.input),this.$el.find("textarea").attr("data-name",this.dataNameAttrs.textarea),this},getResourceOnSave:function(e){return this._getResourceModel(e)},getResourceOnSaveAs:function(e){return this._getResourceModel(e,!0)},fieldIsValid:function(e,t){e._clearValidationMessage(t)},fieldIsInvalid:function(e,t,a){var i=m[t];if(i){var r=e.$(i.validationContainer),n=e.$(i.validationText);r.removeClass("jr-isInvisible"),n.text(a.toString())}},clearValidationErrors:function(){this._clearValidationMessage("name"),this._clearValidationMessage("description")},saveModelOnServer:function(){this.model=this._getResourceModel(this.originalModel),this._saveModelOnServer()},_openDialog:function(){this.enableButton("cancel"),d.prototype._openDialog.apply(this,arguments)},_clearValidationMessage:function(e){var t=m[e];if(t){var a=this.$(t.validationContainer),i=this.$(t.validationText);a.addClass("jr-isInvisible"),i.text("")}},_getResourceModel:function(e,t){var a=e.toJSON(t);return new n(a,{contextPath:o.contextPath,type:s.DOMAIN,request:this.request})},_saveModelOnServer:function(e){e=i.extend({},e,{skipDataBaseMetadataCheck:this.skipDataBaseMetadataCheck}),d.prototype._saveModelOnServer.call(this,e)},_getSaveOptions:function(e){var t=d.prototype._getSaveOptions.call(this,e);return i.extend({},t,{skipDataBaseMetadataCheck:e.skipDataBaseMetadataCheck})},_saveModelOnServerFail:function(e,t,a){var i={label:e.get("label"),uri:e.get("uri"),parentFolderUri:e.get("parentFolderUri"),description:e.get("description")};this.trigger("save:validation:error",t,i)}})});