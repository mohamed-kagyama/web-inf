/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../../util/uriUtil","../../../../../../../model/schema/enum/schemaEntitiesEnum","../../../draggable/enum/draggableOriginEnum","../../../enum/dropZonePositionEnum","../../../../../../../model/schema/util/entityUtil"],function(e,n,t){var r=e("underscore"),i=e("../../../../../../util/uriUtil"),a=e("../../../../../../../model/schema/enum/schemaEntitiesEnum"),s=e("../../../draggable/enum/draggableOriginEnum"),u=e("../../../enum/dropZonePositionEnum"),o=e("../../../../../../../model/schema/util/entityUtil"),c=function(e){this.initialize(e)};r.extend(c.prototype,{initialize:function(e){this.presentationDesignerViewStateModelService=e.presentationDesignerViewStateModelService,this.clientDomainSchemaService=e.clientDomainSchemaService},isParentBeingDroppedIntoChild:function(e,n){var t=this;return r.some(e,function(e){var r=e.id,i=n===r;if(o.isPresentationSet(e.type))return i||t.clientDomainSchemaService.isPresentationItemHasTransitiveParent(n,r)},this)},isConstantGroupCalcFieldsAreDropped:function(e){return r.every(e,function(e){return o.isCalcField(e.type)&&o.isConstantGroup(e.sourceType)})},areResourcesReferencedByDataIsland:function(e){var n=this.clientDomainSchemaService.getDataIslands().reduce(function(e,n){return e[n.sourceId]=!0,e},{});return r.every(e,function(e){var t=e.dataIslandSourceId;if(t)return n[t]},this)},areResourcesLocatedUnderAJoinTree:function(e){return r.every(e,function(e){return e.isJoinTreeItem},this)},isDataIslandsBeingDropped:function(e){return r.every(e,function(e){return o.isDataIsland(e.type)})},isJoinTreesBeingDropped:function(e){return r.every(e,function(e){return o.isJoinTree(e.type)})},isTableReferencesBeingDropped:function(e){return r.every(e,function(e){return o.isTableReference(e.type)})},isItemsBeingDroppedFromCanvas:function(e){return this._getDraggableOrigin(e)===s.CANVAS},isItemsBeingDroppedFromSidebar:function(e){return this._getDraggableOrigin(e)===s.SIDEBAR},isResourcesAreAcceptedByDropZone:function(e,n){return n=r.reduce(n,function(e,n){return e[n]=!0,e},{}),r.every(e,function(e){return n[e.type]})},isDropZoneAcceptsDataIslands:function(e){return e.indexOf(a.DATA_ISLAND)>-1},isDropZoneAcceptsSetsAndFields:function(e){return e.indexOf(a.PRESENTATION_SET)>-1&&e.indexOf(a.PRESENTATION_FIELD)>-1},isMiddleDropZone:function(e){return e.which===u.MIDDLE},isItemsAreFromSameDataIslandAsDropZone:function(e,n){var t=this._getItemsDataIslandId(e);return n.dataIslandId===t},isItemsFromTheSameSourceAsDropZoneDataIsland:function(e,n){var t=this._getItemsDataIslandIdByItemsSource(e);return n.dataIslandId===t},isItemsHaveTheSameSourceAsDataIsland:function(e,n){var t=this.clientDomainSchemaService.getDataIslandById(n);return r.every(e,function(e){return e.sourceId===t.sourceId&&e.sourceType===t.sourceType})},isItemsHaveTheSameSource:function(e){var n=r.map(e,function(e){return e.sourceId});return 1===r.uniq(n).length},getItemsDataIslandIds:function(e){return r.uniq(r.map(e,function(e){return e.dataIslandId}))},getItemsDataIslandSourceId:function(e){return r.uniq(r.map(e,function(e){return e.dataIslandSourceId}))},getResourceIdsInItemsPaths:function(e){return r.reduce(e,function(e,n){var t=n.path,a=i.splitUri(t);return r.each(a,function(n){e[n]=!0}),e},{})},getItemsNestingLevel:function(e){var n=r.first(e);return i.splitUri(n.path).length},getItemsConstantGroupId:function(e){return r.first(e).calcFieldSourceId},_getDraggableOrigin:function(e){return e=r.isArray(e)?e:[e],r.first(e).origin},_getItemsDataIslandId:function(e){return(r.first(e)||{}).dataIslandId},_getItemsDataIslandIdByItemsSource:function(e){var n=r.first(e)||{},t=r.find(this.clientDomainSchemaService.getDataIslands(),function(e){return e.sourceId===n.dataIslandSourceId});return t&&t.id}}),t.exports=c});