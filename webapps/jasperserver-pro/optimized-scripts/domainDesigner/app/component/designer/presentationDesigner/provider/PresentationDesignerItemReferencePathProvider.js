/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage","../../../../util/pathUtil","../../../../../model/schema/util/schemaModelUtil","../../../../../model/schema/util/entityUtil"],function(e,t,i){var a=e("underscore"),r=e("bundle!DomainDesignerBundle"),s=e("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),d=e("../../../../util/pathUtil"),l=e("../../../../../model/schema/util/schemaModelUtil"),n=e("../../../../../model/schema/util/entityUtil"),o=s.create(r),c=function(e){this.initialize(e)};a.extend(c.prototype,{initialize:function(e){this.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec=e.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec,this.dataSourceGroupNameIsEmptySpecification=e.dataSourceGroupNameIsEmptySpecification,this.clientDataSourceGroupService=e.clientDataSourceGroupService},getPresentationFieldReferencePath:function(e,t){var i=e.sourceType;return n.isConstantGroup(i)?this._getConstantGroupFieldSourcePath(e,t):n.isTableReference(i)?this._getTableReferenceFieldSourcePath({fieldId:e.fieldId,fieldType:e.fieldType,sourceId:e.sourceId},t):n.isJoinTree(i)?this._getCrossTableCalcFieldSourcePath(e,t):n.isJoinAlias(i)?this._getJoinAliasFieldSourcePath(e,t):void 0},_getTableReferenceFieldSourcePath:function(e,t){var i,r=this,s=t.tableReferences.byId(e.sourceId),d=l.getTableByTableReference(s,t),c=this.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec.isSatisfied();i=n.isCalcField(e.fieldType)?s.getCalcFields().byId(e.fieldId):a.findWhere(l.getAllTableFields(d),{id:e.fieldId});var u=l.getResourceParents(d,t).reduce(function(e,t){var i=t.toJSON(),a=i.name,s=n.isDataSourceGroup(t),d=r.dataSourceGroupNameIsEmptySpecification.isSatisfied(i);if(s){if(c)return e;a=d?o("domain.designer.sidebar.empty.profile.attribute.value.placeholder"):r.clientDataSourceGroupService.getName(i)}return e.unshift(a),e},[]),h=u.concat([s.getName(),i.getName()]);return this._buildPath(h)},_getConstantGroupFieldSourcePath:function(e,t){var i=t.constantGroups.byId(e.sourceId),a=i.getCalcFields().byId(e.fieldId);return this._buildPath([i.getName(),a.getName()])},_getCrossTableCalcFieldSourcePath:function(e,t){var i=t.dataIslands.byId(e.dataIslandId),a=l.getDataIslandSource(i,t),r=a.getCalcFields().byId(e.fieldId);return this._buildPath([i.getName(),r.getName()])},_getJoinAliasFieldSourcePath:function(e,t){var i=t.joinAliases.byId(e.sourceId),a=l.getTableReferenceByJoinAlias(i,t).getId();return this._getTableReferenceFieldSourcePath({fieldId:e.fieldId,fieldType:e.fieldType,sourceId:a},t)},_buildPath:function(e){return d.join(e,"\\",".")}}),i.exports=c});