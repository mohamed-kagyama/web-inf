/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/schema/enum/schemaEntitiesEnum","backbone","../../../../dispatcher/enum/applicationStateEventsEnum"],function(e,n,a){var i=e("underscore"),r=e("../../../../../model/schema/enum/schemaEntitiesEnum"),t=e("backbone"),l=e("../../../../dispatcher/enum/applicationStateEventsEnum"),o=function(e){this.initialize(e)};i.extend(o.prototype,{initialize:function(e){i.bindAll(this,"_onRenameTableReferenceDialogClickOk","_onRenameTableReferenceDialogClickCancel","_onRenameTableReferenceDialogInput"),this.joinsDesignerEventBus=e.joinsDesignerEventBus,this.renameTableReferenceDialog=e.renameTableReferenceDialog,this.renameTableReferenceDialogStore=e.renameTableReferenceDialogStore,this.renameTableReferenceValidator=e.renameTableReferenceValidator,this.applicationDispatcherEventBus=e.applicationDispatcherEventBus,this.expressionBulkUpdateService=e.expressionBulkUpdateService,this._initEvents()},_initEvents:function(){this.listenTo(this.joinsDesignerEventBus,"rename:tableReference",this._onTableReferenceRename),this.renameTableReferenceDialog.$on("ok",this._onRenameTableReferenceDialogClickOk),this.renameTableReferenceDialog.$on("cancel",this._onRenameTableReferenceDialogClickCancel),this.renameTableReferenceDialog.$on("input",this._onRenameTableReferenceDialogInput)},_onTableReferenceRename:function(e){this.renameTableReferenceDialogStore.show=!0,this.renameTableReferenceDialogStore.value=e.name,this.renameTableReferenceDialogStore.originalValue=e.name,this.renameTableReferenceDialogStore.tableReferenceId=e.id,this.renameTableReferenceDialogStore.validationMessage=""},_onRenameTableReferenceDialogInput:function(e){this.renameTableReferenceDialogStore.value=e,this.renameTableReferenceDialogStore.validationMessage=""},_onRenameTableReferenceDialogClickOk:function(e){var n=this.renameTableReferenceValidator.validate(this.renameTableReferenceDialogStore),a=this.renameTableReferenceDialogStore.tableReferenceId,i=this.renameTableReferenceDialogStore.originalValue,t=this;n?this.renameTableReferenceDialogStore.validationMessage=n:this.expressionBulkUpdateService.getUpdatedExpressions({resourceId:a,resourceType:r.TABLE_REFERENCE,originalName:i,newName:e}).then(function(n){t._renameTableReference(a,e,n),t.renameTableReferenceDialogStore.show=!1})},_onRenameTableReferenceDialogClickCancel:function(){this.renameTableReferenceDialogStore.show=!1},_renameTableReference:function(e,n,a){this.applicationDispatcherEventBus.trigger(l.JOINS_DESIGNER_RENAME_TABLE_REFERENCE,{id:e,name:n,resources:a})}},t.Events),a.exports=o});