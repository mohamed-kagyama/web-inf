/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/schema/util/entityUtil","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage"],function(e,i,n){var t=e("underscore"),s=e("../../../../../model/schema/util/entityUtil"),o=e("bundle!DomainDesignerBundle"),l=e("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),r=l.create(o),d=t.template("{{-joinAliasId}}:{{-fieldId}}"),a=function(e){this.selectOptionClassName=e.selectOptionClassName};t.extend(a.prototype,{getConstantJoinExpressionOptions:function(e){var i={joinId:e.joinId,availableOperators:e.availableOperators};return s.isConstantJoinExpression(e.modelType)?t.extend(i,this._getEditConstantJoinExpressionOptions(e)):t.extend(i,this._getCreateConstantJoinExpressionOptions(e)),i},_getCreateConstantJoinExpressionOptions:function(e){var i=this._createFieldOptions(e.fields);return i=t.sortBy(i,this._fieldOptionsSorter),{field:t.first(i).value,fieldOptions:i,value:""}},_getEditConstantJoinExpressionOptions:function(e){var i=e.fieldId,n=e.joinAliasId,s=e.value,o=e.operator,l=e.id,r=this._createFieldOptions(e.fields);return r=t.sortBy(r,this._fieldOptionsSorter),{id:l,field:this._formatField({fieldId:i,joinAliasId:n}),fieldOptions:r,value:s,operator:o}},_createFieldOptions:function(e){return t.map(e,function(e){return this._createFieldOption({field:e.name,fieldId:e.id,fieldType:e.type,joinAlias:e.joinAlias,joinAliasId:e.joinAliasId})},this)},_createFieldOption:function(e){return{label:r("domain.designer.joinsDesigner.constantJoinExpression.field.template",e.joinAlias,e.field),value:this._formatField(e),fieldType:e.fieldType,className:this.selectOptionClassName}},_fieldOptionsSorter:function(e){return e.label},_formatField:function(e){return d({fieldId:e.fieldId,joinAliasId:e.joinAliasId})}}),n.exports=a});