/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage","../../../../../../rest/enum/requestCanceledEnum","../../../util/constantJoinExpressionErrorMessageBuilder"],function(e,n,i){var r=e("underscore"),t=e("jquery"),s=e("bundle!DomainDesignerBundle"),o=e("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),a=e("../../../../../../rest/enum/requestCanceledEnum"),d=e("../../../util/constantJoinExpressionErrorMessageBuilder"),u=o.create(s),l=function(e){this.initialize(e)};r.extend(l.prototype,{initialize:function(e){r.bindAll(this,"_getExpressionValidationError"),this.validationService=e.validationService},validate:function(e){var n=this;return this.validationDfd=new t.Deferred,this._isExpressionEmpty(e).then(function(){return n.validationService.validateDOMEl(e).then(function(e){return e},function(i){return(new t.Deferred).reject(n._getExpressionValidationError(e,i))})}).then(function(e){return n.validationDfd.resolve(e)},function(e){return n.validationDfd.reject(e)}),this.validationDfd},cancelValidation:function(){return this.validationDfd&&this.validationDfd.reject(a.CANCELED)},_isExpressionEmpty:function(e){var n=new t.Deferred,i=e.expression.string;return""===t.trim(i)?n.reject(u("domain.validation.constantJoinExpressionValue.empty")):n.resolve(),n},_isExpressionValidDomEl:function(e){return this.validationService.validateDOMEl(e).then(null,r.bind(this._getExpressionValidationError,this,e))},_getExpressionValidationError:function(e,n){return d.getErrorMessage({responseJSON:n.responseJSON,validationOptions:{value:e.expression.string}})}}),i.exports=l});