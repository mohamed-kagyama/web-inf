/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../../../../dispatcher/enum/applicationStateEventsEnum"],function(e,i,n){var o=e("underscore"),a=e("backbone"),t=e("../../../../dispatcher/enum/applicationStateEventsEnum"),s=function(e){o.bindAll(this,"_onClickOKRenameDialog","_onClickCancelRenameDialog","_onRenameDialogInput"),this.renameJoinTreeDialog=e.renameJoinTreeDialog,this.renameJoinTreeDialogStore=e.renameJoinTreeDialogStore,this.renameJoinTreeValidator=e.renameJoinTreeValidator,this.applicationDispatcherEventBus=e.applicationDispatcherEventBus,this.joinsDesignerEventBus=e.joinsDesignerEventBus,this.advancedJoinsMappingSpecification=e.advancedJoinsMappingSpecification,this._initEvents()};o.extend(s.prototype,a.Events,{_initEvents:function(){this.listenTo(this.joinsDesignerEventBus,"toggle:useMinimumPathJoins",this._onBeforeToggleUseMinimumPathJoins),this.listenTo(this.joinsDesignerEventBus,"toggle:useAllDataIslandJoins",this._onBeforeToggleUseAllDataIslandJoins),this.listenTo(this.joinsDesignerEventBus,"show:renameJoinTreeDialog",this._onShowRenameJoinTreeDialog),this.renameJoinTreeDialog.$on("ok",this._onClickOKRenameDialog),this.renameJoinTreeDialog.$on("cancel",this._onClickCancelRenameDialog),this.renameJoinTreeDialog.$on("input",this._onRenameDialogInput)},_onBeforeToggleUseMinimumPathJoins:function(e){var i=!e.joinTree.useMinimumPathJoins,n={suppressCircularJoins:this.advancedJoinsMappingSpecification.isSuppressCircularJoinOn(i,!1),includeAllDataIslandJoins:this.advancedJoinsMappingSpecification.isIncludeAllDataIslandJoinsOn(i,!1)},o=e.joinTree.id;this._updateJoinTree(n,o)},_onBeforeToggleUseAllDataIslandJoins:function(e){var i=!e.joinTree.useAllDataIslandJoins,n={suppressCircularJoins:this.advancedJoinsMappingSpecification.isSuppressCircularJoinOn(!1,i),includeAllDataIslandJoins:this.advancedJoinsMappingSpecification.isIncludeAllDataIslandJoinsOn(!1,i)},o=e.joinTree.id;this._updateJoinTree(n,o)},_updateJoinTree:function(e,i){this.applicationDispatcherEventBus.trigger(t.JOINS_DESIGNER_UPDATE_JOIN_TREE,{joinTreeId:i,joinTreeJson:e})},_onShowRenameJoinTreeDialog:function(e){this.renameJoinTreeDialogStore.show=!0,this.renameJoinTreeDialogStore.value=e.joinTree.name,this.renameJoinTreeDialogStore.originalValue=e.joinTree.name,this.renameJoinTreeDialogStore.joinTreeId=e.joinTree.id,this.renameJoinTreeDialogStore.validationMessage=""},_onRenameDialogInput:function(e){this.renameJoinTreeDialogStore.value=e,this.renameJoinTreeDialogStore.validationMessage=""},_onClickOKRenameDialog:function(e){var i=this.renameJoinTreeValidator.validate(this.renameJoinTreeDialogStore);i?this.renameJoinTreeDialogStore.validationMessage=i:(this.applicationDispatcherEventBus.trigger(t.JOINS_DESIGNER_UPDATE_JOIN_TREE,{joinTreeId:this.renameJoinTreeDialogStore.joinTreeId,joinTreeJson:{name:e}}),this.renameJoinTreeDialogStore.show=!1)},_onClickCancelRenameDialog:function(){this.renameJoinTreeDialogStore.show=!1}}),n.exports=s});