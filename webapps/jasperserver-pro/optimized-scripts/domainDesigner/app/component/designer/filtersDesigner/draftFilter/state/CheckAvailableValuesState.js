/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage","../../../../../rest/enum/requestCanceledEnum","../enum/draftFilterStateEnum"],function(e,a,i){var t=e("underscore"),l=e("bundle!DomainDesignerBundle"),n=e("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),s=e("../../../../../rest/enum/requestCanceledEnum"),r=e("../enum/draftFilterStateEnum"),u=n.create(l),c=function(e){this.availableValuesDataProvider=e.availableValuesDataProvider,this.shouldSwitchToRawValueEditorAfterAvailableValuesCheckFailSpecification=e.shouldSwitchToRawValueEditorAfterAvailableValuesCheckFailSpecification};t.extend(c.prototype,{enter:function(e,a){var i=e.currentFilter,l=t.bind(this._availableValuesCheckFailed,this,e,a),n=t.bind(this._availableValuesCheckSuccess,this,e,a);this._checkAvailableValues(i).then(n,l)},_availableValuesCheckSuccess:function(e,a,i){e.availableValues=i.data,a.enter(r.GET_RIGHT_OPERAND_DEFAULT_VALUE_STATE,e)},_checkAvailableValues:function(e){return this.availableValuesDataProvider.getData({limit:1,offset:0,draftFilter:e})},_availableValuesCheckFailed:function(e,a,i){this.shouldSwitchToRawValueEditorAfterAvailableValuesCheckFailSpecification.isSatisfiedBy(e.newFilterOptions)&&(e=t.extend({},e,{newFilterOptions:t.extend({},e.newFilterOptions,{isRawValueEditor:!0})})),i!==s.CANCELED&&(e.error=u("domain.designer.filters.validation.rightOperand.cannotRetrieveAvailableValues")),a.enter(r.GET_RIGHT_OPERAND_STATE,e)}}),i.exports=c});