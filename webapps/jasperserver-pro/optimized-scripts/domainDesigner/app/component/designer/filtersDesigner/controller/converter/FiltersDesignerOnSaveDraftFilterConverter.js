/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../enum/operandSideEnum","../../util/filterOperandTypeUtil","../../../../../../model/schema/util/entityUtil"],function(e,r,t){var i=e("underscore"),n=e("../../enum/operandSideEnum"),o=e("../../util/filterOperandTypeUtil"),a=e("../../../../../../model/schema/util/entityUtil"),u=function(e){this.initialize(e)};i.extend(u.prototype,{initialize:function(e){this.onSaveDraftFilterSourceByExpressionProvider=e.onSaveDraftFilterSourceByExpressionProvider,this.filtersDesignerDraftFilterRightOperandConverter=e.filtersDesignerDraftFilterRightOperandConverter},convert:function(e){var r=this.onSaveDraftFilterSourceByExpressionProvider.getSource(e.expression);return e=i.cloneDeep(e),e=this._updateFilterRightOperandValue(e),e=this._updateOperandsSourceByFilterSource(e,r),i.extend({},e,r)},_updateFilterRightOperandValue:function(e){var r=this.filtersDesignerDraftFilterRightOperandConverter.convert(e.expression.right,{dataType:e.dataType});return i.isUndefined(r)||(e.expression.right=r),e},_updateOperandsSourceByFilterSource:function(e,r){return a.isJoinTree(r.sourceType)?e:(e=this._updateOperandSourceByFilterSource({operandSide:n.LEFT,draftFilter:e,filterSource:r}),e=this._updateOperandSourceByFilterSource({operandSide:n.RIGHT,draftFilter:e,filterSource:r}))},_updateOperandSourceByFilterSource:function(e){var r=e.operandSide,t=e.draftFilter,n=t.expression[r],u=e.filterSource;return o.isVariable(n.type)&&!a.isConstantGroup(n.sourceType)&&(t.expression[r]=i.extend({},t.expression[r],u)),t}}),t.exports=u});