/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/schema/enum/genericTypesEnum","../../../../../model/schema/enum/filterOperandTypesEnum","../../../../../model/schema/enum/fieldTypesToGenericTypesEnum","../util/filterOperandTypeUtil"],function(e,i,t){var r=e("underscore"),a=e("../../../../../model/schema/enum/genericTypesEnum"),n=e("../../../../../model/schema/enum/filterOperandTypesEnum"),l=e("../../../../../model/schema/enum/fieldTypesToGenericTypesEnum"),d=e("../util/filterOperandTypeUtil"),p=function(e){this.initialize(e)};r.extend(p.prototype,{initialize:function(e){this.clientDomainSchemaService=e.clientDomainSchemaService,this.validationRulesRunner=e.validationRulesRunner,this.validatorConfig=e.validatorConfig},validate:function(e){var i=e.expression.left.type,t=e.expression.right.type;if(!d.isVariable(i))throw new Error("Expression's left operand should be variable.");if(r.isUndefined(e.expression.left.fieldId))throw new Error("Expression's left operand isn't specified.");return d.isLiteral(t)?this._validateFieldToLiteralFilter(e):!!d.isRange(t)&&this._validateFieldToRangeFilter(e)},_validateFieldToRangeFilter:function(e){var i={},t=e.expression.right,a=e.expression.operator,n=e.expression.left.fieldId,d=this.clientDomainSchemaService.getFieldById(n),p=d.type,s=l[p],o=t.start.value,g=t.end.value,h=this._validateRightOperandValue({rightOperandValue:o,operator:a,leftFieldType:p,genericFieldType:s}),u=this._validateRightOperandValue({rightOperandValue:g,leftFieldType:p,operator:a,genericFieldType:s});(h||u)&&(i={start:h,end:u});var T=this._validateRangeByFilterType({rightOperand:t,leftFieldType:p,genericFieldType:s})||{};if(T=r.extend({},i,T),T.start||T.end)return this._getFilterErrorMessage({startErrorMessage:T.start,endErrorMessage:T.end})},_validateRangeByFilterType:function(e){var i=e.rightOperand,t=e.leftFieldType,r=e.genericFieldType;return r===a.INTEGER?this._isIntegerRangeValid(i,t):r===a.DECIMAL?this._isDecimalRangeValid(i,t):r===a.DATE?this._isDateRangeValid(i,t):r===a.TIME?this._isTimeRangeValid(i,t):r===a.TIMESTAMP&&this._isTimestampRangeValid(i,t)},_isIntegerRangeValid:function(e){return this._validateRangeRightOperandByType(e,a.INTEGER)},_isDecimalRangeValid:function(e){return this._validateRangeRightOperandByType(e,a.DECIMAL)},_isDateRangeValid:function(e){return this._validateRangeRightOperandByType(e,a.DATE)},_isTimeRangeValid:function(e){return this._validateRangeRightOperandByType(e,a.TIME)},_isTimestampRangeValid:function(e){return this._validateRangeRightOperandByType(e,a.TIMESTAMP)},_validateRangeRightOperandByType:function(e,i){return this._getValidatorForRangeByType(i).validate(e)},_validateFieldToLiteralFilter:function(e){var i=e.expression.right,t=e.expression.operator,r=e.expression.left.fieldId,a=this.clientDomainSchemaService.getFieldById(r),n=a.type,d=l[n],p=i.value,s=this._validateRightOperandValue({rightOperandValue:p,leftFieldType:n,operator:t,genericFieldType:d});if(s)return this._getFilterErrorMessage({errorMessage:s})},_validateRightOperandValue:function(e){var i=e.genericFieldType;return i===a.INTEGER?this._isRightOperandInteger(e):i===a.DECIMAL?this._isRightOperandDecimal(e):i===a.DATE?this._isRightOperandDate(e):i===a.TIME?this._isRightOperandTime(e):i===a.TIMESTAMP?this._isRightOperandTimestamp(e):i===a.BOOLEAN&&this._isRightOperandBoolean(e)},_isRightOperandInteger:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.INTEGER,filterType:e.leftFieldType})},_isRightOperandDecimal:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.DECIMAL,filterType:e.leftFieldType})},_isRightOperandDate:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.DATE,filterType:e.leftFieldType})},_isRightOperandTime:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.TIME,filterType:e.leftFieldType})},_isRightOperandTimestamp:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.TIMESTAMP,filterType:e.leftFieldType})},_isRightOperandBoolean:function(e){return this._validateLiteralRightOperandValue({rightOperandValue:e.rightOperandValue,operator:e.operator,type:a.BOOLEAN,filterType:e.leftFieldType})},_validateLiteralRightOperandValue:function(e){return this._getValidatorForLiteralByType(e.type).validate(e.rightOperandValue,{filterType:e.filterType,operator:e.operator})},_getValidatorForLiteralByType:function(e){return this.validatorConfig[n.LITERAL][e]},_getValidatorForRangeByType:function(e){return this.validatorConfig[n.RANGE][e]},_getFilterErrorMessage:function(e){if(e)return{right:e}}}),t.exports=p});