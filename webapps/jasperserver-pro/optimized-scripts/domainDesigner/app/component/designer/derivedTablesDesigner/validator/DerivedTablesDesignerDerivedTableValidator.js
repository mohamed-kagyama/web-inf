/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../../../model/util/profileAttributeUtil","../../../../enum/clientValidationRegExpEnum","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage"],function(e,i,n){var a=e("underscore"),t=e("../../../../../model/util/profileAttributeUtil"),d=e("../../../../enum/clientValidationRegExpEnum"),r=e("bundle!DomainDesignerBundle"),l=e("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),s=l.create(r),o=function(e){e=e||{},this.i18nMessage=e.i18nMessage?e.i18nMessage:s,this.domainSchemaSpecification=e.domainSchemaSpecification,this.domainSchemaGranularSpecs=e.domainSchemaGranularSpecs};a.extend(o.prototype,{validateQuery:function(e){if(!a.isString(e)||""===e)return s("domain.designer.derivedTables.createDerivedTables.dialog.input.query");e=e.replace("\n"," ");var i,n=e.trim().split(/\s+/,4),d=n.length>=4,r="select"===n[0].toLowerCase(),l="select"!==e&&t.getProfileAttributes(e)||[],o=t.getProfileAttributePlaceHolders(e)||[],c=o.length,u=c>0,m=l.length,g=s("domain.designer.derivedTables.createDerivedTables.dialog.queryIsInvalid");return d||r||!u?d&&r||(i=g):m!==c&&(i=g),i},validateName:function(e,i,n){var a;return!e||e&&e.match(d.RESOURCE_ID_BLACKLIST_REGEX_PATTERN)?a=s("domain.designer.derivedTables.createDerivedTables.dialog.nameIsInvalid",d.RESOURCE_ID_BLACKLIST_SYMBOLS):this.domainSchemaSpecification.canRenameDerivedTable(i,e,n)||(a=s("domain.designer.derivedTables.createDerivedTables.dialog.nameIsDuplicated")),a},validateSelectedFields:function(e){var i;return a.keys(e).length<1&&(i=s("domain.validation.selectedFields.not.selected")),i},validateFieldTypes:function(e,i){var n;return this.domainSchemaGranularSpecs.derivedTableFieldDataTypeCanNotBeChangedIfThereAreDependentFilters(e,i)&&(n=s("domain.designer.derivedTables.updateDerivedTables.fieldUsedInFilterExpression")),n}}),n.exports=o});