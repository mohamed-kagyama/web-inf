/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone"],function(e,t,i){var r=e("underscore"),o=e("backbone"),s=function(e){this.initialize(e)};r.extend(s.prototype,o.Events,{initialize:function(e){this.model=e.model,this.treeView=e.treeView,this.treeDataProvider=e.treeDataProvider,this.storeChangeEventBus=e.storeChangeEventBus,this.applicationDispatcherEventBus=e.applicationDispatcherEventBus,this.selectionEvent=e.selectionEvent,this.viewModelOptionsProvider=e.viewModelOptionsProvider,this.treeDataProviderOptionsProvider=e.treeDataProviderOptionsProvider,this.treeSearchKeywordProvider=e.treeSearchKeywordProvider,this.treeSelectionProvider=e.treeSelectionProvider,this._initEvents()},_initEvents:function(){this.listenTo(this.treeView,"selection:change",this._onTreeSelectionChange),this.listenTo(this.storeChangeEventBus,"change",this._renderFromState)},_onTreeSelectionChange:function(e){this.applicationDispatcherEventBus.trigger(this.selectionEvent,{selection:e})},_renderFromState:function(e,t,i){this._setState(e),this._renderTreeIfVisible(i)},_setState:function(e){this._setSelectionToTreeDataProvider(e),this._setStateToViewModel(e),this._setSearchKeywordToDataProvider(e),this._setTreeDataProviderState(e)},_setStateToViewModel:function(e){var t=e.viewState;this.model.setState(r.extend({currentDesigner:t.getCurrentDesigner()},this.viewModelOptionsProvider.get(e)))},_setSearchKeywordToDataProvider:function(e){var t=this.treeSearchKeywordProvider.get(e);this.treeDataProvider.setSearchKeyword(t)},_isResourcePresent:function(){return Boolean(this.model.get("currentMetadataResourceId"))},_isVisible:function(){return this.model.get("isVisible")},_setTreeDataProviderState:function(e){var t;this._isResourcePresent()&&(t=this.treeDataProviderOptionsProvider.get(e),this.treeDataProvider.setState(t))},_renderTreeIfVisible:function(e){this._isVisible()&&this._renderTree(e)},_renderTree:function(e){this._isResourcePresent()&&e!==this.selectionEvent&&this.treeView.fetch({keepPosition:!0})},_setSelectionToTreeDataProvider:function(e){this.treeDataProvider.setSelection(this.treeSelectionProvider.get(e))}}),i.exports=s});