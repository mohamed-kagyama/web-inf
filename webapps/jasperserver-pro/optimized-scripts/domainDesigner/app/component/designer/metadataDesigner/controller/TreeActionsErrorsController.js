/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","backbone","underscore","../../../../rest/enum/requestCanceledEnum","../../../../dispatcher/enum/applicationStateEventsEnum"],function(e,t,i){var o=e("backbone"),s=e("underscore"),r=e("../../../../rest/enum/requestCanceledEnum"),n=e("../../../../dispatcher/enum/applicationStateEventsEnum"),a=function(e){this.initialize(e)};s.extend(a.prototype,{initialize:function(e){this.metadataDesignerEventBus=e.metadataDesignerEventBus,this.addFetchedResourcesToSchemaStrategy=e.addFetchedResourcesToSchemaStrategy,this.confirmationDialog=e.confirmationDialog,this.confirmationDialogStore=e.confirmationDialogStore,this.applicationDispatcherEventBus=e.applicationDispatcherEventBus,this.metadataDesignerErrorByXhrFactory=e.metadataDesignerErrorByXhrFactory,this.treeActionsErrorMessageFactory=e.treeActionsErrorMessageFactory,this._initEvents()},_initEvents:function(){this.listenTo(this.metadataDesignerEventBus,"fetchSubResource:invalidResources",this._onFetchInvalidResources),this.listenTo(this.metadataDesignerEventBus,"fetchSubResource:fail",this._onFetchFail)},_onFetchInvalidResources:function(e){var t=this.treeActionsErrorMessageFactory.create(e);t.confirmationDialogErrors?this._openConfirmationDialog(t,e):this._showAddResourcesError(t.popoverErrors)},_onFetchFail:function(e){var t=e.xhr;t!==r.CANCELED&&this._showAddResourcesError(this.metadataDesignerErrorByXhrFactory.create(t))},_onAddResourcesConfirm:function(e){var t=e.resourcesWithChildren,i=e.selectedResources,o=e.metadataResourcesType;this._onConfirmClose(),this.addFetchedResourcesToSchemaStrategy.execute({selectedResources:i,fetchedResources:t,parentId:e.parentId,dataSourceId:e.dataSourceId,metadataResourcesType:o,popoverMessage:e.popoverMessage,highlightInvalidResources:!0})},_openConfirmationDialog:function(e,t){t=s.extend({popoverMessage:e.popoverErrors},t);var i=this._getConfirmationDialogWarnings(e.confirmationDialogErrors);this.confirmationDialogStore.set("warnings",i),this.listenTo(this.metadataDesignerEventBus,"warningDialog:addResources",s.bind(this._onAddResourcesConfirm,this,t)),this.listenTo(this.metadataDesignerEventBus,"warningDialog:cancelResourcesAdd",this._onConfirmClose),this.confirmationDialog.open()},_getConfirmationDialogWarnings:function(e){return s.isArray(e)?e.map(this._getConfirmationDialogWarning):[this._getConfirmationDialogWarning(e)]},_getConfirmationDialogWarning:function(e){return{category:{label:e,isBold:!1}}},_showAddResourcesError:function(e){this.applicationDispatcherEventBus.trigger(n.METADATA_DESIGNER_SET_ADD_RESOURCES_ERROR,{popoverMessage:e,highlightInvalidResources:!0})},_onConfirmClose:function(){this.confirmationDialog.close(),this.stopListening(this.metadataDesignerEventBus,"warningDialog:addResources"),this.stopListening(this.metadataDesignerEventBus,"warningDialog:cancelResourcesAdd")}},o.Events),i.exports=a});