/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","./util/getResourcesByParentResourceUtil"],function(e,t,r){var s=e("underscore"),o=e("jquery"),i=e("./util/getResourcesByParentResourceUtil"),a=function(e){this.initialize(e)};s.extend(a.prototype,{initialize:function(e){this.convertToTreeItem=e.convertToTreeItem,this.process=e.process||s.identity,this.sort=e.sort||s.identity,this.match=e.match||s.identity,this.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec=e.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec,this.emptyProfileAttributeValuesToPlaceholderLabelConverter=e.emptyProfileAttributeValuesToPlaceholderLabelConverter},getData:function(e){var t=e.metadataResourceId,r=e.metadataResourceType,a=this.schemaLessDataSourceWithEmptyResolvedSchemaAttributeSpec.isSatisfied(),c=new o.Deferred,n=i.getResources({parentId:t,parentType:r,collections:e.dataStore,isSchemaLessDataSourceWithEmptyResolvedSchemaAttribute:a}),u=this._convertResourcesToTreeItems(n,e),h=this.sort(u),l=h.length;return h=s.map(h,this.emptyProfileAttributeValuesToPlaceholderLabelConverter),c.resolve({data:h,total:l})},_convertResourcesToTreeItems:function(e,t){return e.filter(this.match).map(function(e){var r=this.process(e.toJSON(),{entity:e});return this.convertToTreeItem(r,{selection:t.selection})},this).toArray()}}),r.exports=a});