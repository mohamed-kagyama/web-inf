/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","../../../../model/enum/canvasViewDesignersEnum","../../../../util/uriLocation","backbone","bundle!DomainDesignerBundle","runtime_dependencies/js-sdk/src/common/util/i18nMessage"],function(i,e,n){var t=i("jquery"),s=i("underscore"),o=i("../../../../model/enum/canvasViewDesignersEnum"),a=i("../../../../util/uriLocation"),r=i("backbone"),d=i("bundle!DomainDesignerBundle"),h=i("runtime_dependencies/js-sdk/src/common/util/i18nMessage"),l=h.create(d),u=function(i){this.initialize(i)};s.extend(u.prototype,{initialize:function(i){s.bindAll(this,"_onPageLeave","_onSessionExpired"),this.$=i.$||t,this.window=i.window,this.applicationCrossComponentEventBus=i.applicationCrossComponentEventBus,this.loginPageUrl=i.loginPageUrl,this.storeChangeEventBus=i.storeChangeEventBus,this.clientResourcePropertiesService=i.clientResourcePropertiesService,this.model=i.model,this.expirationManager=i.expirationManager,this.historyModel=i.historyModel,this._initEvents(),this._initSessionExpirationManager(i),this._setSidebarWidth(i.initialSidebarWidth)},_initEvents:function(){this.listenTo(this.storeChangeEventBus,"change",this._onChangeState),this.listenTo(this.applicationCrossComponentEventBus,"sidebar:resize",this._onResize),this.$(this.window).on("beforeunload",this._onPageLeave),this.$(this.window).on("sessionExpired",this._onSessionExpired)},_initSessionExpirationManager:function(i){this.expirationManager({timeoutWarningDelay:i.timeoutWarningDelay})},_setSidebarWidth:function(i){this.model.set("sidebarWidth",i)},_setSidebarWidthInPx:function(i){this._setSidebarWidth(String(i)+"px")},_onResize:function(i){this._setSidebarWidthInPx(i)},_onPageLeave:function(){if(!this.model.get("isSessionExpired"))return!(!this.historyModel.isUndoAvailable()&&!this.historyModel.isRedoAvailable())||void 0},_onSessionExpired:function(){this.model.set("isSessionExpired",!0),a.changeLocation(this.loginPageUrl)},_onChangeState:function(i){this._updateSidebarWidth(i),this._updateDomainLabel()},_updateSidebarWidth:function(i){var e,n=i.viewState,t=n.getCurrentDesigner(),s=this.model.get("isSidebarVisible");t===o.OPTIONS_DESIGNER||t===o.SECURITY_DESIGNER?s&&(e=this.model.get("sidebarWidth"),this.model.set({isSidebarVisible:!1,sidebarWidth:"0",originalSidebarWidth:e})):s||(e=this.model.get("originalSidebarWidth"),this.model.set({isSidebarVisible:!0,sidebarWidth:e}))},_updateDomainLabel:function(){var i=this.clientResourcePropertiesService.getDomainLabel()||l("domain.designer.new_domain");this.model.set("domainLabel",i)},remove:function(){this.window.off("beforeunload",this._onPageLeave),this.window.off("sessionExpired",this._onSessionExpired)}},r.Events),n.exports=u});