/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../../../../../model/schema/enum/schemaEntitiesEnum","../../../../common/util/storeChangeEventCallbackExecutorUtil","../../../../dispatcher/enum/applicationStateEventsEnum","../../../validation/state/enum/validationStateNameEnum"],function(e,t,i){var a=e("underscore"),n=e("backbone"),o=e("../../../../../model/schema/enum/schemaEntitiesEnum"),r=e("../../../../common/util/storeChangeEventCallbackExecutorUtil"),s=e("../../../../dispatcher/enum/applicationStateEventsEnum"),c=e("../../../validation/state/enum/validationStateNameEnum"),l=function(e){this.initialize(e)};a.extend(l.prototype,n.Events,{initialize:function(e){this.storeChangeEventBus=e.storeChangeEventBus,this.applicationCrossComponentEventBus=e.applicationCrossComponentEventBus,this.applicationDispatcherEventBus=e.applicationDispatcherEventBus,this.resourcePropertiesService=e.resourcePropertiesService,this.clientDomainSchemaService=e.clientDomainSchemaService,this.clientDomainSchemaCalcFieldsService=e.clientDomainSchemaCalcFieldsService,this.clearAllDataConfirmationDialog=e.clearAllDataConfirmationDialog,this.sidebarEventBus=e.sidebarEventBus,this.validationStateFactory=e.validationStateFactory,this._initEvents()},_initEvents:function(){var e=r.getExecutor(this);this.listenTo(this.storeChangeEventBus,"change",e),this.listenTo(this.sidebarEventBus,"replaceDataSource",this._onReplaceData),this.listenTo(this.sidebarEventBus,"clearAllData",this._onClearAllData),this.listenTo(this.sidebarEventBus,"createCalcField",this._onCreateCalcField),this.listenTo(this.sidebarEventBus,"createDerivedTable",this._onCreateDerivedTable),this.listenTo(this.clearAllDataConfirmationDialog,"button:yes",this._onClearAllDataConfirm)},_onReplaceData:function(){this.validationStateFactory.enter(c.REPLACE_DATA_SOURCE_INITIAL_STATE,{})},_onClearAllData:function(){this._getDataSourceUri()&&this.applicationDispatcherEventBus.trigger(s.SHOW_CLEAR_ALL_DATA_DIALOG)},_onCreateCalcField:function(){var e={sourceType:o.CONSTANT_GROUP,sourceName:this.clientDomainSchemaCalcFieldsService.getDefaultConstantGroupName()};this.applicationDispatcherEventBus.trigger(s.CALCULATED_FIELDS_DESIGNER_SHOW,e)},_onCreateDerivedTable:function(){var e=this.clientDomainSchemaService.getFirstDataSource();this.applicationCrossComponentEventBus.trigger("sidebar:createDerivedTable",e.id)},_onClearAllDataConfirm:function(){var e=this._getDataSourceUri();this.validationStateFactory.enter(c.INITIALIZE_DOMAIN_DESIGNER_STATE,{dataSourceUri:e})},_getDataSourceUri:function(){var e=this.resourcePropertiesService.getDataSourceName();return this.resourcePropertiesService.getDataSourceUri(e)},"clearAllData:showDialog":function(){this.clearAllDataConfirmationDialog.open()}}),i.exports=l});