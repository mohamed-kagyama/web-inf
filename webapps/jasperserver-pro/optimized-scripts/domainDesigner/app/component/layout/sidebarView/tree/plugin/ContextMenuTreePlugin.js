/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","runtime_dependencies/js-sdk/src/common/component/menu/ContextMenu"],function(t,n,e){function o(t){this.initialize(t)}var i=t("underscore"),s=t("backbone"),u=t("runtime_dependencies/js-sdk/src/common/component/menu/ContextMenu");i.extend(o.prototype,s.Events,{initialize:function(t){if(this.tree=t.tree,this.actionsMap={},!t)throw new Error("Initialization error. Options required.");this.onTreeContextMenuEvent=t.onTreeContextMenuEvent||function(){},this.getOptionsToSelect=t.getOptionsToSelect||function(){return[]},this.contextMenuEvents=t.contextMenuEvents||function(){return{}},this.getContextMenuOptions=t.getContextMenuOptions||function(){return[]},this.showContextMenuCondition=t.showContextMenuCondition||function(){return!0},this._initEvents()},_initEvents:function(){this.listenTo(this.tree,"list:item:contextmenu",this._onContextMenuEvent)},_onContextMenuEvent:function(t,n){this.onTreeContextMenuEvent(t),this._removeLastContextMenu(),this.showContextMenuCondition(t)&&(this.contextMenu=this._getContextMenu(t),this._initContextMenuEvents(t,n),this._preselectOptions(t),this.contextMenu.show({left:n.pageX,top:n.pageY}),this.lastContextMenu=this.contextMenu)},_getContextMenu:function(t){var n=this.getContextMenuOptions(t);return n.contextMenu||new u(n.options,n.additionalSettings)},_initContextMenuEvents:function(t,n){var e=i.isFunction(this.contextMenuEvents)?this.contextMenuEvents(t):this.contextMenuEvents;e&&i.each(e,function(e,o){this.listenTo(this.contextMenu,o,i.partial(e,t,n))},this)},_preselectOptions:function(t){var n=this.getOptionsToSelect(t)||[];n.length&&i.each(n,function(t){this.contextMenu.select(t)},this)},_removeLastContextMenu:function(){this.lastContextMenu&&(this.stopListening(this.lastContextMenu),this.lastContextMenu.remove())},remove:function(){this.stopListening(),this.contextMenu&&this.contextMenu.remove()}}),e.exports=o});