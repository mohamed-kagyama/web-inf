/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../../component/dependenciesInspector/convertor/util/dispatcherActionUtil","../enum/applicationStateEventsEnum"],function(e,t,n){var i=e("underscore"),c=e("backbone"),s=e("../../component/dependenciesInspector/convertor/util/dispatcherActionUtil"),o=e("../enum/applicationStateEventsEnum"),p=function(e){this.initialize(e)};i.extend(p.prototype,c.Events,{initialize:function(e){e=e||{},i.bindAll(this,"interceptDispatcherAction"),this.entityCollector=e.entityCollector,this.dependenciesConverter=e.dependenciesConverter,this.dependenciesInspectorApplication=e.dependenciesInspectorApplication,this.applicationStateActionsEnum=e.applicationStateActionsEnum},interceptDispatcherAction:function(e,t){var n=Array.prototype.slice.call(arguments,2),c=i.extend({},this.applicationStateActionsEnum[e],{args:n,name:e,func:t}),s=this.entityCollector.collectAffectedEntities(e,n);s?this._openDependenciesInspector({entities:s,dispatcherAction:c}):this._executeAction(c)},_executeAction:function(e){e.func.apply(null,e.args)},_openDependenciesInspector:function(e){var t=e.dispatcherAction,n=this.dependenciesConverter.convert(e.entities,{targetEntityType:this._getTargetEntityType(t),targetEntitiesIds:this._getTargetEntitiesIds(t),isReplaceDataSource:o.REPLACE_DATA_SOURCE===t.event})||{};i.isEmpty(n.leftGroup)&&i.isEmpty(n.rightGroup)?this._executeAction(t):(this.listenTo(this.dependenciesInspectorApplication,"confirm",i.bind(this._onChangeConfirmed,this,t)),this.listenTo(this.dependenciesInspectorApplication,"reject",this._closeDependenciesInspector),this.dependenciesInspectorApplication.open(n))},_onChangeConfirmed:function(e){this._closeDependenciesInspector(),this._executeAction(e)},_closeDependenciesInspector:function(){this.dependenciesInspectorApplication.close(),this.stopListening(this.dependenciesInspectorApplication)},_getTargetEntityType:function(e){return s.getTargetEntityType(e)},_getTargetEntitiesIds:function(e){var t=s.getTargetEntitiesIds(e);return i.reduce(t,function(e,t){return e[t]=!0,e},{})}}),n.exports=p});