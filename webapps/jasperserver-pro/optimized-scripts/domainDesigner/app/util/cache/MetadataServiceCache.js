/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../../model/util/profileAttributeUtil"],function(e,t,r){var i=e("underscore"),o=e("../../../model/util/profileAttributeUtil"),n=function(e){this.initialize(e)};i.extend(n.prototype,{initialize:function(e){e=e||{},this.cache=e.cache,this.profileAttributeResolver=e.profileAttributeResolver},get:function(e){var t=e.dataSourceUri,r=e.path,i=this._getDataSourceCache(t);if(this._isRootLevel(r))return i.root;var o=this._getCacheKey(r);return i.subResources[o]},add:function(e){var t=e.dataSourceUri,r=e.data,i=e.resources,o=this._getDataSourceCache(t);return r=r||[],this._isRootLevel(i)?o.root=r.elements:this._putSubResourcesIntoCache(o,r,i),o},reset:function(e){this.cache.reset(e)},_resolvePathFragments:function(e){return i.map(e,function(e){return o.containsProfileAttributeWithPlaceholdersOnly(e)?this.profileAttributeResolver.resolve(e):e},this)},_getCacheKey:function(e){return this._resolvePathFragments(e).join(".")},_getDataSourceCache:function(e){var t=this.cache.get(e);return t||(t={root:[],subResources:{}},this.cache.add(e,t)),t},_isRootLevel:function(e){return i.isEmpty(e)},_putSubResourcesIntoCache:function(e,t,r){i.each(t.elements,function(t){var o=null;i.find(r,function(e){return o=this._getCacheKey(e),i.last(e)===t.group.name},this)&&(e.subResources[o]=t)},this)}}),r.exports=n});