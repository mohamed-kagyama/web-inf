/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","./DevToolsDialog","./devGlobalErrorHandler","./devToolsEnum"],function(t,o,e){var i=t("underscore"),n=t("backbone"),r=t("./DevToolsDialog"),s=t("./devGlobalErrorHandler"),a=t("./devToolsEnum"),l=function(t,o){i.bindAll(this,"open","setError","setState","getState","copyState","getContext","getLog","copyLog","remove","_setStateFromDialog"),this.context=t,this.options=o,this.lastError=null};i.extend(l.prototype,n.Events,{start:function(){var t=this._getDevToolsAPI();this._initGlobals(t),this._initDialog(),this._initGlobalErrorHandling(t)},remove:function(){this._removeGlobals(),this._removeDialog(),this._removeGlobalErrorHandling()},setError:function(t){this.lastError=t},setState:function(t){this._getHistoryModel().setState(t.list,t.position)},getState:function(){var t=this._getHistoryModel();return i.extend(t.getState(),{error:this.lastError})},copyState:function(){var t=this.getState();window.copy(t)},getContext:function(){return i.reduce(this.context.getNames(),function(t,o){return t[o]=this.context.get(o),t},{},this)},getLog:function(){return this.options.devApplicationLogger.getLogEntries()},copyLog:function(){window.copy(this.getLog())},open:function(){this.dialog.open(this.getState())},_initDialog:function(){this.dialog=new r,this.listenTo(this.dialog,"button:update",this._setStateFromDialog)},_removeDialog:function(){this.stopListening(this.dialog),this.dialog.remove()},_setStateFromDialog:function(){var t=this.dialog.getState();t&&this.setState(t),this.dialog.close()},_getHistoryModel:function(){return this.context.get("historyModel")},_getDevToolsAPI:function(){return{open:this.open,setError:this.setError,remove:this.remove,setState:this.setState,getState:this.getState,copyState:this.copyState,getContext:this.getContext,getLog:this.getLog,copyLog:this.copyLog}},_initGlobals:function(t){window[a.GLOBAL_DEV_TOOLS_VAR]=t},_removeGlobals:function(){delete window[a.GLOBAL_DEV_TOOLS_VAR]},_initGlobalErrorHandling:function(t){s.init(t)},_removeGlobalErrorHandling:function(){s.remove()}}),e.exports=l});