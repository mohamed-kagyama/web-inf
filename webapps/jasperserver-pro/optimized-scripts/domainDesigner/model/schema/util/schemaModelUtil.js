/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./entityUtil","../enum/schemaEntitiesEnum","./getCollectionByEntityType"],function(e,n,t){function r(e,n,t){if(!e)throw new Error("Id is not defined");if(!n)throw new Error("Type is not defined");var r=K(t,n);if(W.isUndefined(r))throw new Error("Resource type not supported: "+n);return r.byId(e)}function i(e,n){var t,r=n.dataSources;return W.isUndefined(e)||(k.isDataSource(e)?t=e:(k.isDataSourceGroup(e)||k.isTable(e)||k.isTableGroup(e)||k.isField(e))&&(t=r.byId(e.dataSourceId))),t}function a(e,n){var t,r=e.parentId;return k.isField(e)||k.isTableGroup(e)?t=n.tables.byId(r)||n.tableGroups.byId(r):(k.isTable(e)||k.isDataSourceGroup(e))&&(t=n.dataSourceGroups.byId(r)||n.dataSources.byId(r)),t}function u(e,n){for(var t=[],r=e.parentId;r;)e=a(e,n),t.push(e),r=e.parentId;return t}function o(e,n){for(var t=[],r=e,i=e.parentId,a=e.dataIslandId;i;)r=i===a?n.dataIslands.byId(a):n.presentationSets.byId(i),t.push(r),i=r.parentId,a=e.dataIslandId;return t}function s(e,n,t){return u(r(e,n,t),t)}function d(e,n){var t=n.dataSources.byId(e),r=t;return r||(r=n.dataSourceGroups.byId(e)),r}function c(e,n){var t=n.tables.byId(e),r=t;return r||(r=n.tableGroups.byId(e)),r}function l(e,n){var t,r=e.sourceId,i=e.sourceType;return r&&(i===H.TABLE_REFERENCE?t=n.tableReferences.byId(r):i===H.JOIN_TREE?t=n.joinTrees.byId(r):i===H.CONSTANT_GROUP&&(t=n.constantGroups.byId(r))),t}function f(e,n){var t=l(e,n);return t?k.getEntityName(t):null}function I(e,n){return n.dataIslands.filter(function(n){return n.sourceId===e.id})}function y(e,n){return n.dataIslands.filter(function(n){return n.sourceId===e})}function b(e,n){return n.tableReferences.filter(function(n){return n.tableId===e})}function p(e,n){return b(e.id,n)}function g(e,n){var t=e.tableId;return n.tables.byId(t)}function T(e,n){var t=e.tableReferenceId;return n.tableReferences.byId(t)}function R(e,n){return g(T(e,n),n)}function B(e){return S(e)}function S(e){return e.children.reduce(function(e,n){return k.isField(n)?e.push(n):k.isTableGroup(n)&&(e=e.concat(S(n))),e},[])}function E(e,n){return B(R(e,n),n)}function v(e,n){return B(g(e,n),n)}function A(e,n){return T(e,n).calcFields.toArray()}function F(e,n){return n.joinAliases.findWhere({tableReferenceId:e})}function D(e,n){return n.joinAliases.filter(function(n){return n.tableReferenceId===e})}function h(e,n){return n.tableReferences.filter(function(n){return n.tableId===e})}function G(e,n){return n.joinExpressions.filter(function(n){if(k.isConstantJoinExpression(n)&&n.joinId===e)return!0})}function C(e,n){return O(e,n)||J(e,n)}function P(e,n){return J(e,n)||m(e,n)}function J(e,n){return n.presentationSets.byId(e)}function m(e,n){return n.presentationFields.byId(e)}function O(e,n){return n.dataIslands.byId(e)}function w(e){return e.dataIslands.filter(function(e){return W.isUndefined(e.sourceId)||W.isNull(e.sourceId)})}function x(e){return e.dataIslands.filter(function(e){return 0===e.children.size()})}function N(e,n){return k.isDataIsland(e)?e:k.isPresentationSet(e)||k.isPresentationField(e)?O(e.dataIslandId,n):void 0}function U(e,n){var t;return n.find(function(n,r){if(n.id===e)return t=r,n}),t}function j(e,n){var t=e.fieldId;return n.fields.byId(t)}function L(e,n){var t=e.sourceType;return r(e.sourceId,t,n)}function _(e,n){return e.calcFields.chain().filter(function(e){return e.fieldReferences.find(function(e){return e.sourceId===n})})}function q(e,n,t){return n[t[e]]=t,n}function z(e){var n=e.reducer,t=e.property,r=e.collection;return n=n||W.partial(q,t),r.reduce(n,{})}var W=e("underscore"),k=e("./entityUtil"),H=e("../enum/schemaEntitiesEnum"),K=e("./getCollectionByEntityType");t.exports={reduceCollectionByProperty:z,getResourceByIdAndType:r,getDataSourceByChildResource:i,getResourceParentsByIdAndType:s,getResourceParent:a,getResourceParents:u,getPresentationParents:o,getDataSourceGroupOrDataSource:d,getTableGroupOrTable:c,getDataIslandSource:l,getDataIslandSourceType:f,getDataIslandsBySource:I,getDataIslandsBySourceId:y,getAllTableReferencesByTable:p,getAllTableReferencesByTableId:b,getTableByTableReference:g,getTableReferenceByJoinAlias:T,getTableByJoinAlias:R,getTableFieldsByJoinAlias:E,getTableFieldsByTableReference:v,getAllTableFields:B,getCalcFieldsByJoinAlias:A,getJoinAliasByTableReferenceId:F,getAllJoinAliasesByTableReferenceId:D,getTableReferencesByTableId:h,getConstantJoinExpressionsByJoinId:G,getDataIslandById:O,getSourceLessDataIslands:w,getChildrenLessDataIslands:x,getDataIslandOrPresentationSetById:C,getPresentationSetOrFieldById:P,getDataIslandByPresentationItem:N,getResourceIndexInCollectionById:U,getFieldByFieldReference:j,getSourceByFieldReference:L,getJoinTreeCalcFieldsByTableReferenceId:_}});