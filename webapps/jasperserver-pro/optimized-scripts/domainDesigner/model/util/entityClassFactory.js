/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore"],function(t,e,n){function i(t,e){return I.isNumber(t)?(e.get()<=t&&e.reset(t+1),t):e.next()}function o(t){return t.substr(0,1).toUpperCase()+t.substr(1)}function r(t,e,n,i){var o={};i&&(o.indexConfig=i),this[t]=new e(n,o)}function a(t,e){return this[t].byId(e)}function u(t,e,n){this[t].add(e,n)}function c(t,e,n){var i=this[t].indexOf({id:n}),o="remove"+e+"At";i>=0&&this[o](i)}function s(t,e,n){this[t].remove(e,n)}function d(t){return this[t]}function p(t,e){this[t]=e}function l(t){var e=A(this).idGenerator;this.id=i(t,e)}function f(t,e){var n=o(t),i=o(e);return{getCollectionMethod:"get"+i,setCollectionMethod:"set"+i,getEntityMethod:"get"+n,addEntityMethod:"add"+n,addEntitiesMethod:"add"+i,removeEntityMethod:"remove"+n,removeEntitiesAtMethod:"remove"+i+"At"}}function h(t,e,n){n.prototype[t.getCollectionMethod]=I.partial(d,t.name),n.prototype[t.setCollectionMethod]=I.partial(r,t.name,e),n.prototype[t.getEntityMethod]=I.partial(a,t.name),n.prototype[t.addEntityMethod]=I.partial(u,t.name),n.prototype[t.addEntitiesMethod]=I.partial(u,t.name),n.prototype[t.removeEntityMethod]=I.partial(c,t.name,t.nameCapitalized),n.prototype[t.removeEntitiesAtMethod]=I.partial(s,t.name)}function m(t){var e=t.name,n=o(e);return{getEntityMethod:"get"+n,setEntityMethod:"set"+n}}function y(t,e){e.prototype[t.getEntityMethod]=I.partial(d,t.name),e.prototype[t.setEntityMethod]=I.partial(p,t.name)}function g(t,e,n){t.prototype.initialize=function(t){t=t||{};var i,o,a,u=I.isNumber(this.id)?this.id:t.id,c=this,s=e.entities,d=e.collections;for(l.call(this,u),a=0;a<d.length;a++){i=d[a];var f=i.name,h=i.indexConfig;r.call(c,f,n,t[f],h)}for(a=0;a<s.length;a++)o=s[a].name,p.call(c,o,t[o]);this.update(t)}}function v(t,e){e=e||[],t.prototype.toJSON=function(){for(var t,n,i={id:d.call(this,"id")},o=0;o<e.length;o++)t=e[o],t.toJSON&&(n=d.call(this,t.name),I.isUndefined(n)||(i[t.name]=I.cloneDeep(n))),"id"===t.name&&!1===t.toJSON&&delete i[t.name];return i}}function M(t){t.prototype.setId=l,t.prototype.getId=I.partial(d,"id")}function E(t,e){e=e||[],t.prototype.update=function(t){for(var n,i=0;i<e.length;i++)n=e[i],I.has(t,n.name)&&p.call(this,n.name,t[n.name])}}function C(t){return I.map(t||[],function(t){var e=t.name,n=t.entityName||e.substring(0,e.length-1),i=I.extend({entityName:n,nameCapitalized:o(e)},t,f(n,e));return I.defaults({},t,i)},this)}function x(t){return I.map(t||[],function(t){return I.defaults({},t,m(t))})}function b(t){return I.map(t||[],function(t){return I.defaults({},t,m(t))})}function N(t,e){return t=t||{},I.extend(t,{collections:C(t.collections),entities:x(t.entities),properties:b(t.properties),idGenerator:e.idGenerator})}function z(t,e){t.prototype._entityConfig=e}function A(t){return t._entityConfig}function O(t,e){return new Function("return function (call) { return function "+e+" () { return call(this, arguments) }; };")()(I.bind(t.apply,t))}function G(t,e){t=I.cloneDeep(t);var n=e.Collection,i=O(function(t){this.initialize(t)},t.name);return t=N(t,e),z(i,t),I.each(t.collections,function(t){h(t,n,i)},this),I.each(t.entities,function(t){y(t,i)}),I.each(t.properties,function(t){y(t,i)}),g(i,t,n),v(i,t.properties),E(i,t.properties),M(i),i}var I=t("underscore");n.exports={createClass:G}});