/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","runtime_dependencies/bi-report/src/bi/report/Report","runtime_dependencies/js-sdk/src/jrs.configs","runtime_dependencies/bi-adhoc/src/adhoc/api/chart/adhocToHighchartsAdapter/palette/defaultPalette","bundle!CommonBundle"],function(e,t,i){var r=e("jquery"),s=e("runtime_dependencies/bi-report/src/bi/report/Report"),n=e("runtime_dependencies/js-sdk/src/jrs.configs"),o=e("runtime_dependencies/bi-adhoc/src/adhoc/api/chart/adhocToHighchartsAdapter/palette/defaultPalette"),c=e("bundle!CommonBundle"),d=function(e){this.hyperlinks=e,this.reportInstance=null,this.reportContainer=null,this.selectedLinkIds=[],this.selectedLinks={}};d.prototype={register:function(){var e=this;r(e.hyperlinks[0].selector).on("click",function(t){var i=e._getHyperlinkData(r(this).attr("data-id"));i&&e._handleHyperlinkClick(i)}).css("cursor","pointer")},handleInteraction:function(e){if("hyperlinkClicked"==e.type){var t=this._getHyperlinkData(e.data.hyperlink.id);t&&this._handleHyperlinkClick(t)}},_getHyperlinkData:function(e){var t=null;return r.each(this.hyperlinks,function(i,r){if(e===r.id)return t=r,!1}),t},_handleHyperlinkClick:function(e){var t=r("span[data-id='"+e.id+"'] span"),i=this.selectedLinkIds.indexOf(e.id);if(i>=0){var d=this.selectedLinks[e.id];t.css("color",d.origColor),t.css("background-color",d.origBackcolor),this.selectedLinkIds.splice(i,1),delete this.selectedLinks[e.id]}else{var a=0===this.selectedLinkIds.length?0:(this.selectedLinks[this.selectedLinkIds[this.selectedLinkIds.length-1]].paletteIdx+1)%o.colors.length,d={hyperlink:e,origColor:t.css("color"),origBackcolor:t.css("background-color"),paletteIdx:a};t.css("color","#ffffff"),t.css("background-color",o.colors[a]),this.selectedLinkIds.push(e.id),this.selectedLinks[e.id]=d}var l=this,h=[];if(r.each(this.selectedLinkIds,function(e,t){var i=l.selectedLinks[t],s={};r.each(i.hyperlink.params,function(e,t){0===e.indexOf("param_")&&(s[e.substring(6)]=t)});var n={params:s,color:o.colors[i.paletteIdx]};h.push(n)}),0===r("#seriesReport").length){var p=r('<div id="seriesReport"><div id="seriesReportContainer" style="width:100%;height:100%;"></div></div>');p.insertAfter("#reportContainer");var u=e.params._width||500,k=e.params._height;r("#seriesReport").css("width",u),k&&r("#seriesReport").css("height",k),p.dialog({autoOpen:!1,width:u,height:k||"auto",closeText:c["button.close"]})}0===h.length?r("#seriesReport").dialog("close"):(r("#seriesReport").dialog("open"),this.report||(this.report=new s({resource:e.params._report,container:"#seriesReportContainer",server:n.contextPath})),this.report.params({selectedEntries:[JSON.stringify(h)]}),this.report.refresh())}},i.exports=d});