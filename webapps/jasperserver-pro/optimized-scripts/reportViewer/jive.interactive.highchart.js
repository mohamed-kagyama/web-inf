/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","runtime_dependencies/bi-adhoc/src/adhoc/api/visualChooser/VisualChooserDialog","text!runtime_dependencies/bi-chart/src/jr/jive/highcharts/template/chartMenuTemplate.htm","bundle!adhoc_messages","runtime_dependencies/js-sdk/src/common/util/browserDetection","csslink!runtime_dependencies/bi-chart/src/jr/jive/highcharts/theme/highcharts.csslink.css"],function(e,i,t){var n=e("underscore"),r=e("jquery"),a=e("runtime_dependencies/bi-adhoc/src/adhoc/api/visualChooser/VisualChooserDialog"),s=e("text!runtime_dependencies/bi-chart/src/jr/jive/highcharts/template/chartMenuTemplate.htm"),c=e("bundle!adhoc_messages"),o=e("runtime_dependencies/js-sdk/src/common/util/browserDetection");e("csslink!runtime_dependencies/bi-chart/src/jr/jive/highcharts/theme/highcharts.csslink.css");var h={"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=30)",filter:"alpha(opacity=30)",opacity:"0.3"},u={"-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)",filter:"alpha(opacity=100)",opacity:"1"},d={init:function(e){var i=this;this._reportInstance=e,this._dialog||(this._dialog=new a({typesToExclude:["Crosstab","Table"]}),this._dialog.on("visualizationTypeChange",this._onVisualizationTypeChange,this)),r.each(e.components.chart,function(){var e=this;e.config.interactive&&i._insertMenu(e.config.hcinstancedata.renderto,e.config.chartUuid)})},_onVisualizationTypeChange:function(e){this._currentChart.changeType({type:e.type}),this._dialog.setSelectedType(e.type)},_insertMenu:function(e,i){var t=r(n.template(s,{i18n:c})),a=this;t.insertBefore("#"+e),t.css({top:"0"}),o.isIE8()||t.css(h);var d=t.find(".jive_chartSettingsIcon");d.data("chartuuid",i),d.on("mouseenter",function(){o.isIE8()||r(this).parent().css(u),a._currentChartUuid=r(this).data("chartuuid")}),t.find(".jive_chartMenu").on("mouseleave touchend",function(){o.isIE8()||r(this).parent().css(h)}),d.on("mouseenter",function(){var e=r(this);e.addClass("over"),e.next(".jive_chartMenu").show().position({top:e.height(),left:0})}),t.find(".jive_chartMenu").on("mouseleave touchend",function(){var e=r(this);e.prev(".jive_chartSettingsIcon").removeClass("over"),e.hide()}),t.find(".jive_chartMenu").on("mouseenter touchstart","p.wrap",function(){r(this).addClass("over")}),t.find(".jive_chartMenu").on("mouseleave touchend","p.wrap",function(){r(this).removeClass("over")}),t.find(".jive_chartMenu").on("click touchend","li.jive_chartTypeMenuEntry",function(){var e=a._currentChart=n.find(a._reportInstance.components.chart,function(e){return e.config.chartUuid===a._currentChartUuid}),i=[];e.config.datetimeSupported||(i=i.concat(["TimeSeriesLine","TimeSeriesSpline","TimeSeriesArea","TimeSeriesAreaSpline","TimeSeriesHeatMap"])),e.config.treemapSupported||(i=i.concat(["DualMeasureTreeMap","TreeMap","OneParentTreeMap"])),e.config.gaugesSupported||(i=i.concat(["Gauge","MultiLevelGauge","ArcGauge"])),i=n.uniq(i),a._dialog.setDisabledTypes(i),a._dialog.setSelectedType(e.config.charttype),a._dialog.open()})}};t.exports=d});