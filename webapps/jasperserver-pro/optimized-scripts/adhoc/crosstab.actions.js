/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","jquery","./TopBottomFilterDialog","backbone","./crosstab","../base/designer.base","runtime_dependencies/jrs-ui/src/util/utils.common"],function(e,n,o){var r=e("prototype"),i=r.$,t=e("jquery"),d=e("./TopBottomFilterDialog"),a=e("backbone"),l=e("./crosstab"),u=e("../base/designer.base"),s=e("runtime_dependencies/jrs-ui/src/util/utils.common"),g=s.matchMeOrUp;l.showCrosstabMenu=function(e,n){window.adhocDesigner.showDynamicMenu(e,n,null,function(e,n){return e=l.updateContextMenuWithSiblingLevels(e,n),l.generateAvailableSummaryCalculationsMenu(e,n)})},l.addFieldToXtab=function(e,n,o){var r=o.element();if(r){var t=g(r,window.localContext.DM_AXIS_LIST_PATTERN);if(t){var d=i(t).identify();d.startsWith(window.localContext.OLAP_COLUMNS_ID)?l.appendDimensionToColumnAxisWithLevel():d.startsWith(window.localContext.OLAP_ROWS_ID)&&l.appendDimensionToRowAxisWithLevel()}}},l.processFieldAsColumnGroup=function(e,n,o){var r=o,i=null,t=e.identify();if(t.startsWith("colGroupHeaderRow_")||t.startsWith("colGroupHeader_"))try{i=n.exec(t)[0],r=parseInt(i)+1}catch(e){}l.addFieldAsColumnGroup(r)},l.processFieldAsMeasure=function(e,n,o){var r=o,t=null,d=e.identify();if(d.startsWith("measureHeader_"))try{t=n.exec(d)[0],r=parseInt(t)+1}catch(e){}else"A"!=e.nodeName&&"LI"!=e.nodeName||("A"==e.nodeName&&(e=e.up("li.leaf")),e&&(r=i(e).previousSiblings().length));window.addFieldAsMeasure(r,!0)},l.processFieldAsRowGroup=function(e,n,o){var r=o,i=null,t=e.identify();if(t.startsWith("rowGroup_")||t.startsWith("rowGroupHeader_"))try{i=n.exec(t)[0],r=parseInt(i)+1}catch(e){}l.addFieldAsRowGroup(r)},l.moveRowGroupLeft=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o-1;l.moveRowGroup(o,r,e)},l.moveRowGroupRight=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o+1;l.moveRowGroup(o,r,e)},l.moveColumnGroupLeft=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o-1;l.moveColumnGroup(o,r,e)},l.moveColumnGroupRight=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o+1;l.moveColumnGroup(o,r,e)},l.moveMeasureLeft=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();l.moveMeasure(e.level,e.index-1)},l.moveMeasureRight=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();l.moveMeasure(e.level,e.index+1)},l.moveRowGroupOnDrag=function(){window.draggingMoveOverIndex=parseInt(window.draggingMoveOverIndex),window.currentlyDraggingIndex=parseInt(window.currentlyDraggingIndex),window.currentlyDraggingIndex!=window.draggingMoveOverIndex&&(window.currentlyDraggingIndex>=0&&window.draggingMoveOverIndex>=0?l.moveRowGroup(window.currentlyDraggingIndex,window.draggingMoveOverIndex):-1==window.draggingMoveOverIndex&&l.removeRowGroup(window.currentlyDraggingIndex))},l.hideLevel=function(e){var n=window.getDimensionWithLevelFromSelection();window.selectionCategory.area===u.COLUMN_GROUP_MENU_LEVEL?l.hideColumnLevel(n.dimensionId,n.level):window.selectionCategory.area===u.ROW_GROUP_MENU_LEVEL&&l.hideRowLevel(n.dimensionId,n.level)},l.showLevel=function(e){var n=l.getDimensionWithLevelFromSelection();window.selectionCategory.area===u.COLUMN_GROUP_MENU_LEVEL?l.showColumnLevel(n.dimensionId,n.level):window.selectionCategory.area===u.ROW_GROUP_MENU_LEVEL&&l.showRowLevel(n.dimensionId,n.level)},l.moveColumnGroupDown=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o+1;l.moveColumnGroup(o,r,e)},l.moveColumnGroupUp=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup(),o=l.getSelectedDimensionIndex(n),r=o-1;l.moveColumnGroup(o,r,e)},l.moveColumnGroupOnDrag=function(){window.draggingMoveOverIndex=parseInt(window.draggingMoveOverIndex),window.currentlyDraggingIndex=parseInt(window.currentlyDraggingIndex),window.currentlyDraggingIndex!=window.draggingMoveOverIndex&&(window.currentlyDraggingIndex>=0&&window.draggingMoveOverIndex>=0?l.moveColumnGroup(window.currentlyDraggingIndex,window.draggingMoveOverIndex):-1==window.draggingMoveOverIndex&&l.removeColumnGroup(window.currentlyDraggingIndex))},l.moveMeasureOnDrag=function(){window.draggingMoveOverIndex=parseInt(window.draggingMoveOverIndex),window.currentlyDraggingIndex=parseInt(window.currentlyDraggingIndex),window.currentlyDraggingIndex!=window.draggingMoveOverIndex&&(window.currentlyDraggingIndex>=0&&window.draggingMoveOverIndex>=0?l.moveMeasure(window.currentlyDraggingIndex,window.draggingMoveOverIndex):-1==window.draggingMoveOverIndex&&l.removeMeasure(window.currentlyDraggingIndex))},l.retrieveOverflowRowGroups=function(){confirm(window.adhocDesigner.getMessage("overflowConfirmMessage"))&&l.getOverflowRowGroups()},l.retrieveOverflowColumnGroups=function(){confirm(window.adhocDesigner.getMessage("overflowConfirmMessage"))&&l.getOverflowColumnGroups()},l.selectMeasureMask=function(e){if(l.getSelectedMeasure()){var n=window.selObjects.first().index;l.setMask(e,n)}},l.selectFunction=function(e){var n=l.getSelectedMeasure(),o=window.selObjects.first();if(n){var r=window.adhocDesigner.getSuperType(n.type),i=l.getMeasureTypeByFunction(e);r!==i?l.setSummaryFunctionAndMask(e,window.defaultMasks[i],o.index):l.setSummaryFunction(e,o.index)}},l.selectTimeFunction=function(e){var n=l.getSelectedMeasure(),o=window.selObjects.first();if(n){window.adhocDesigner.getSuperType(n.type),l.getMeasureTypeByFunction(e);l.setSummaryTimeFunction(e,o.index)}},l.selectedMeasureShowsSummaryOptions=function(){return!!l.getSelectedMeasure()},l.selectedMeasureShowsNumericSummaryOptions=function(){return window.localContext.selectedMeasureShowsSummaryOptions()&&window.localContext.isSelectedMeasureNumeric()},l.setCatForColumnGroup=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup();n&&l.isColumnGroupSelected(n)&&l.setCategoryForColumnGroup(e,n.groupIndex)},l.setCatForRowGroup=function(e){var n=window.adhocDesigner.getSelectedColumnOrGroup();n&&l.isRowGroupSelected(n)&&l.setCategoryForRowGroup(e,n.groupIndex)},l.appendDimensionWithLevel=function(e,n,o){var r=e||window.localContext.getAvailableFieldsNodeBySelection();r.axis=o,l.showAddHierarchyConfirm(r.hierarchyName,r.dimensionId,function(){t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItem",r)})||(e?window.localContext.lmHandlersMap.addItems(r,n,o):t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItem",r))},l.appendDimensionToRowAxisWithLevel=function(e,n,o){l.appendDimensionWithLevel(n,o,"row")},l.appendDimensionToColumnAxisWithLevel=function(e,n,o){l.appendDimensionWithLevel(n,o,"column")},l.appendMeasureToRow=function(e){var n=e?window.localContext.getAvailableFieldsNodesBySelection(e):window.localContext.getAvailableFieldsNodesBySelection();t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItems",{axis:"row",levels:n,index:n[0].index})},l.appendMeasureToColumn=function(e){var n=e?window.localContext.getAvailableFieldsNodesBySelection(e):window.localContext.getAvailableFieldsNodesBySelection();t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:addItems",{axis:"column",levels:n,index:n[0].index})},l.removeLevelFromRow=function(){var e=window.localContext.getSelectedObject();t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:removeItem",{axis:"row",index:e.index,item:{level:e.level,dimensionId:e.dimensionId,isMeasure:e.isMeasure}})},l.removeLevelFromColumn=function(){var e=window.localContext.getSelectedObject();t("#"+window.adhocDesigner.DISPLAY_MANAGER_ID).trigger("lm:removeItem",{axis:"column",index:e.index,item:{level:e.level,dimensionId:e.dimensionId,isMeasure:e.isMeasure}})},l.selectedGroupCanShowSummary=function(){var e=l.getSelectedGroup(window.adhocDesigner.getSelectedColumnOrGroup()),n=l.getGroupParent(e);return n?!0===n.expanded&&!l.selectedGroupHasSummary():!l.selectedGroupHasSummary()},l.selectedColumnGroupCanHideSummary=function(){var e=l.canHideSummariesForColumnGroup(),n=l.getSelectedGroup(window.adhocDesigner.getSelectedColumnOrGroup()),o=l.getGroupParent(n);return!!e&&(o?!0===o.expanded&&l.selectedGroupHasSummary():l.selectedGroupHasSummary())},l.selectedRowGroupCanHideSummary=function(){return!!l.canHideSummariesForRowGroup()&&l.selectedGroupHasSummary()},l.getGroupParent=function(e){var n,o=-1;return window.localContext.state.columnGroups.detect(function(n,r){if(n.name===e.name)return o=r-1}),o>=0&&(n=window.localContext.state.columnGroups[o]),n},l.selectedGroupHasSummary=function(){var e=l.getSelectedGroup(window.adhocDesigner.getSelectedColumnOrGroup());return!!e&&!0===e.isShowingSummary},l.selectedRowGroupIsCollapsible=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e&&e.expandable},l.selectedColumnGroupIsCollapsible=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e&&e.expandable},l.topBottomNFilteringClicked=function(e){var n=window.selObjects[0],o=l.getTopBottomFilter(),r=o&&n.path===o.path,i={type:e,limit:r?o.limit:5,aggregateUnranked:!r||o.aggregateUnranked,applyAcrossGroups:!!r&&o.applyAcrossGroups};"none"!==e?new d({model:new a.Model(i),ok:function(n){l.applyTopBottomNFiltering({type:"top"===e?"desc":"asc",limit:n.limit,aggregateUnranked:n.aggregateUnranked,applyAcrossGroups:n.applyAcrossGroups})}}).open():r&&e!==o.type&&l.applyTopBottomNFiltering({type:e,limit:0,aggregateUnranked:!1,applyAcrossGroups:!1})},o.exports=l});