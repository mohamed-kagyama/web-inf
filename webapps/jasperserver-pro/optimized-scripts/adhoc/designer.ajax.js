/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","./designer","../base/designer.base","../controls/controls.adhoc","runtime_dependencies/jrs-ui/src/util/utils.common","jquery"],function(e,t,o){var n=e("./designer"),a=e("../base/designer.base"),i=e("../controls/controls.adhoc"),l=e("runtime_dependencies/jrs-ui/src/util/utils.common"),d=l.encodeText,s=e("jquery");n.ajaxActionPrefix={table:"co",crosstab:"cr",olap_crosstab:"cr",chart:"ch",ichart:"ich",olap_ichart:"ich"},n.getControllerPrefix=function(){return n.ajaxActionPrefix[window.localContext.getMode()]},n.loadState=function(e){a.sendRequest(n.getControllerPrefix()+"_loadState",[],function(e){window.localContext.setMode(e.viewType),i.initialize(e),n.updateStateAndRender(e),n.initFieldsPanel(!0),window.isDesignView&&(n.dimensionsTree.showTree(n._AVAILABLE_TREE_DEPTH),n.measuresTree.showTree(n._AVAILABLE_TREE_DEPTH)),n.filtersController.setFilters(e,{reset:!0})})},n.updateTrees=function(){window.isDesignView&&a.sendRequest(n.getControllerPrefix()+"_updateAvailableTree",[],function(){n.dimensionsTree.showTree(n._AVAILABLE_TREE_DEPTH),n.measuresTree.showTree(n._AVAILABLE_TREE_DEPTH)})},n.undo=function(){window.localContext.state.modeOnUndo&&!window.localContext.state.modeOnUndo.blank()&&window.localContext.state.modeOnUndo!=window.localContext.getMode()?(window.localContext.hide&&window.localContext.hide(),n.switchMode(window.localContext.state.modeOnUndo,"undo")):a.sendRequest("co_undo",[],n.undoAndRedoCallback)},n.undoAll=function(){window.localContext.state.undoModeNames.length>0&&window.localContext.state.undoModeNames[0]!==window.localContext.getMode()?(window.localContext.hide&&window.localContext.hide(),n.switchMode(window.localContext.state.undoModeNames[0],"undoAll")):a.sendRequest("co_undoAll",[],n.undoAndRedoCallback)},n.redo=function(){window.localContext.state.modeOnRedo&&!window.localContext.state.modeOnRedo.blank()&&window.localContext.state.modeOnRedo!=window.localContext.getMode()?(window.localContext.hide&&window.localContext.hide(),n.switchMode(window.localContext.state.modeOnRedo,"redo")):a.sendRequest("co_redo",[],n.undoAndRedoCallback)},n.switchMode=function(e,t,o){var i=["_mode="+e];t&&i.push("undoOrRedo="+t),o&&i.push("chartType="+o);var l=function(e){var o=e.viewType;t&&n.selectDisplayModeTab(o),n.initComponents(o),n.undoAndRedoCallback(e)};window.localContext.cleanupOnSwitch&&window.localContext.cleanupOnSwitch(),a.sendRequest(n.getControllerPrefix()+"_switchMode",i,l)},n.selectDisplayModeTab=function(e){s("#displayMode > li").each(function(){s(this).attr("id").startsWith(e)?s(this).addClass("selected"):s(this).removeClass("selected")})},n.updateReportTitle=function(e){var t=n.getControllerPrefix();e.blank()?a.sendRequest(t+"_setTitle",["l=_null"]):a.sendRequest(t+"_setTitle",["l="+d(e)])},n.toggleTitleBar=function(){a.sendRequest(n.getControllerPrefix()+"_toggleTitleBar",[])},n.setShowDisplayManager=function(e){var t=function(e){};a.sendRequest("co_toggleDisplayManager",new Array("name=showDisplayManager","value="+e),t,null)},n.mergeCrosstabCells=function(e){var t=function(e){window.localContext.standardOpCallback(e)};a.sendRequest("cr_mergeCrosstabCells",["merge="+e],t,null)},n.toggleAdhocDataSetSize=function(e){var t=!1,o="datasize="+e;if(e.startsWith("full")&&!0!==window.localContext.state.isShowingFullData?t=!0:e.startsWith("sample")&&!0!==window.localContext.state.isShowingSampleData?t=!0:e.startsWith("nodata")&&!0!==window.localContext.state.isShowingNoData&&(t=!0),t){var i=function(e){n.updateStateAndRender(e),this.checkMaxRowsLimit()}.bind(n);a.sendRequest("co_toggleAdhocDataSetSize",[o],i)}},n.tryToKeepServerAlive=function(){var e=function(e){window.localContext.standardOpCallback(e)};a.sendRequest("co_tryToKeepServerAlive",[],e,null)},n.setProperty=function(e,t,o){a.sendRequest("co_setProperty",["name="+e,"value="+t],o)},n.changeFieldAttributeOrMeasure=function(e,t){a.sendRequest("co_changeFieldAttributeOrMeasure",["name="+d(e),"type="+t])},n.setFilter=function(e){a.sendRequest("co_setFilter",["testFilter="+e])},n.setSorting=function(e,t){window.localContext.state.sortFields=e;var o=Object.toJSON(e),i=encodeURIComponent(o),l=function(e){n.updateStateAndRender(e),t()};a.sendRequest("ta_resort",["so="+i],l)},n.pivot=function(){window.localContext.pivot?window.localContext.pivot():a.sendRequest(n.getControllerPrefix()+"_pivot",[])},n.undoAndRedoCallback=function(e){n.updateTrees(),n.updateStateAndRender(e),n.filtersController.setFilters(e,{reset:!0})},n.updateStateAndRender=function(e){n.updateState(e),n.render()},o.exports=n});