/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","runtime_dependencies/js-sdk/src/common/util/classUtil","underscore","jquery","runtime_dependencies/jrs-ui/src/components/components.dialogs","runtime_dependencies/js-sdk/src/jrs.configs","../loading/loadingDialog"],function(e,t,i){var r=e("runtime_dependencies/js-sdk/src/common/util/classUtil"),n=e("underscore"),l=e("jquery"),s=e("runtime_dependencies/jrs-ui/src/components/components.dialogs"),a=e("runtime_dependencies/js-sdk/src/jrs.configs"),c=e("../loading/loadingDialog"),o={table:"adhoc/table.html",crosstab:"adhoc/crosstab.html",olap_crosstab:"adhoc/crosstab.html",ichart:"adhoc/intelligentChart.html",olap_ichart:"adhoc/intelligentChart.html"},d=r.extend({constructor:function(e){this.clientKey=e.clientKey,this.mode=e.mode},createUrl:function(e,t){return(t||o[this.mode()])+"?action="+e},_request:function(e,t,i){t=void 0===t||t,i=i||d.defaultCallbacks;var r=l.ajax(e).done(i.done||d.defaultCallbacks.done).fail(i.fail||d.defaultCallbacks.fail).always(i.always||d.defaultCallbacks.always);return t&&c(r,{el:l("#loading"),showDimmer:!1,focus:!1,delay:d.SLOW_REQUEST_TIMEOUT}),r},get:function(){return this._request({url:this.createUrl("generateFilterPanel"),data:{clientKey:this.clientKey}})},add:function(e){return this._request({url:this.createUrl("addAdhocFilter"),type:"POST",data:{addAdhocFilterFields:n.map(e,encodeURIComponent),clientKey:this.clientKey}})},addOlapFilter:function(e,t){return this._request({url:this.createUrl("addOLAPFilter",o.olap_crosstab),type:"POST",data:{dim:e,child:t,clientKey:this.clientKey}})},addSlice:function(e,t,i){return this._request({url:this.createUrl("addQuickSliceFilter",o.crosstab),type:"POST",data:{axis:e,includeOrExclude:t,pathList:JSON.stringify(n.map(i,function(e){return encodeURIComponent(e)})),clientKey:this.clientKey}})},update:function(e,t){return this._request({url:this.createUrl("editAdhocFilter"),type:"POST",data:{filterId:e,editAdhocFilter:JSON.stringify(t),clientKey:this.clientKey}})},remove:function(e){return this._request({url:this.createUrl("deleteAdhocFilter"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},removeAll:function(){return this._request({url:this.createUrl("deleteAllAdhocFilters"),type:"POST",data:{clientKey:this.clientKey}})},reorder:function(e,t){return this._request({url:this.createUrl("reorderFilters"),type:"POST",data:{oldIndex:e,newIndex:t,clientKey:this.clientKey}})},toggleVisibility:function(e){return this._request({url:this.createUrl("toggleFilterPodState"),type:"POST",data:{filterId:e,clientKey:this.clientKey}})},minimizeAll:function(){return this._request({url:this.createUrl("minimizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},maximizeAll:function(){return this._request({url:this.createUrl("maximizeAllAdhocFilterPods"),type:"POST",data:{clientKey:this.clientKey}})},fetchValues:function(e,t,i){return t=t||{},t.criteria&&(t.criteria=encodeURIComponent(t.criteria)),this._request({url:this.createUrl("getFieldValues"),data:n.extend({fieldName:encodeURIComponent(e),clientKey:this.clientKey},t)},i)},applyFiltersAndExpression:function(e,t){return this._request({url:this.createUrl("applyAdhocFiltersAndExpression"),type:"POST",data:{complexFilterExpression:t,adhocFilters:JSON.stringify(e),clientKey:this.clientKey}})},getMaxMinValues:function(e){return this._request({url:this.createUrl("getMaxMinValues"),data:{fieldName:encodeURIComponent(e),clientKey:this.clientKey}})}});d.defaultCallbacks={fail:function(e,t,i){if(e.getResponseHeader("LoginRequested"))document.location=a.urlContext;else if(e.getResponseHeader("adhocException")){var r=e.getResponseHeader("adhocException");r=decodeURIComponent(r),r=r.replace(/@@/g," "),s.errorPopup.show(r)}else(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError"))&&s.errorPopup.show(e.responseText)},always:function(){s.popup.hide(l("#loading")[0])}},d.SLOW_REQUEST_TIMEOUT=2e3,window.FilterService=d,i.exports=d});