/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","runtime_dependencies/jrs-ui/src/util/utils.common","../base/designer.base","runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator","./crosstab"],function(e,t,a){var l=e("prototype"),i=l.$,r=e("runtime_dependencies/jrs-ui/src/util/utils.common"),d=r.isShiftHeld,s=r.isMetaHeld,n=r.isRightClick,o=e("../base/designer.base"),c=e("runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator"),u=e("./crosstab"),b={};b.ROW_GROUP="rowGroup",b.COL_GROUP="colGroupHeaderRow",b.ROW_GROUP_LEVEL="rowGroupLevel_",b.COl_GROUP_LEVEL="colGroupLevel_",b.selectedCells=[],b.selectXtabGroupMember=function(e,t){e=i(e);var a=null,l=null,r=null,m=null,w=new RegExp("\\d+"),O="SPAN"==e.tagName&&e.parentNode||e;O||(a=null);var p=i(O).identify(),v=w.exec(p)[0];if(p.startsWith(b.ROW_GROUP)?(a=b.ROW_GROUP_LEVEL+v,m=b.ROW_GROUP,l="row"):p.startsWith(b.COL_GROUP)&&(a=b.COl_GROUP_LEVEL+v,m=b.COL_GROUP,l="column"),a){var S=null,f=null,A=e.readAttribute("data-path"),C=u.getTopBottomFilter(),h=C&&C.path===A?C.type:"none";if(r={id:e.identify(),path:A,value:e.readAttribute("data-fieldValue"),isSummary:e.readAttribute("data-isSummaryHeader"),isSliceable:"true"===e.readAttribute("data-sliceable"),axis:l,isInner:e.hasClassName("inner"),sorting:e.readAttribute("data-sorting"),level:e.readAttribute("data-levelname"),name:e.readAttribute("data-levelname"),topBottomFilter:h},f=d(t),window.selectionCategory.area==a&&f){w=new RegExp(/\d+$/);var _=window.selObjects[window.selObjects.length-1];if(_){var G=parseInt(w.exec(_.id)),R=parseInt(w.exec(e.id)),j=Math.abs(R-G),y=G<R;if(b.isObjectAlreadySelected(r))window.adhocDesigner.removeSelectedObject(r);else for(var g=0;g<=j;g++){var L=y?G+g:G-g,E=i(m+"_"+v+"_"+L);if(E){var U={id:E.identify(),path:E.readAttribute("data-path"),value:E.readAttribute("data-fieldValue"),isSummary:E.readAttribute("data-isSummaryHeader"),isSliceable:"true"===E.readAttribute("data-sliceable"),axis:l,isInner:E.hasClassName("inner"),sorting:E.readAttribute("data-sorting"),level:E.readAttribute("data-levelname"),name:E.readAttribute("data-levelname"),topBottomFilter:h};o.addToSelected(U),b.activateSelectedXtabCells()}}window.selectionCategory.area=a}}else"false"===i(e).getAttribute("data-isSummaryHeader")?(S=s(t),r={id:e.identify(),path:e.readAttribute("data-path"),value:e.readAttribute("data-fieldValue"),isSummary:e.readAttribute("data-isSummaryHeader"),isSliceable:"true"===e.readAttribute("data-sliceable"),axis:l,isInner:e.hasClassName("inner"),sorting:e.readAttribute("data-sorting"),level:e.readAttribute("data-levelname"),name:e.readAttribute("data-levelname"),topBottomFilter:h},b.isObjectAlreadySelected(r)&&S?b.removeSelectedObject(r):(S&&!o.shouldClearSelections(t,a)||(b.deselectAllGroupMembers(t),o.unSelectAll()),o.addToSelected(r),b.activateSelectedXtabCells(),window.selectionCategory.area=a)):n(t)&&(b.isObjectAlreadySelected(r)||(b.deselectAllGroupMembers(),o.unSelectAll(),o.addToSelected(r)));c.setSelected(window.selObjects)}},b.selectXtabGroupLabel=function(e){o.unSelectAll(),window.selectionCategory.area="column"===e.axis?o.COLUMN_GROUP_MENU_LEVEL:o.ROW_GROUP_MENU_LEVEL,c.setSelected([e]),o.addToSelected(e)},b.isObjectAlreadySelected=function(e){return o.isObjectInSelection(e,"id")},b.removeSelectedObject=function(e){b.deactivateXtabCell(e);for(var t=null,a=0;a<window.selObjects.length;a++)if(window.selObjects[a].id==e.id){t=a;break}window.selObjects=window.selObjects.without(window.selObjects[t])},b.activateSelectedXtabCells=function(){window.selObjects.each(function(e){b.activateXtabCell(e)})},b.activateXtabCell=function(e){if(e&&e.id){var t=e.id;(t.startsWith("colGroupHeaderRow")||t.startsWith("rowGroup"))&&i(t)&&(i(t).addClassName("selected"),b.selectedCells.push(e))}},b.deactivateXtabCell=function(e){if(e&&e.id){var t=e.id;(t.startsWith("colGroupHeaderRow")||t.startsWith("rowGroup"))&&i(t)&&(i(t).removeClassName("selected"),b.selectedCells.without(e))}},b.deactivateSelectedXtabCells=function(){window.selObjects.each(function(e){b.deactivateXtabCell(e)})},b.deselectAllGroupMembers=function(){b.selectedCells.each(function(e){b.deactivateXtabCell(e)}),b.selectedCells.clear()},a.exports=b});