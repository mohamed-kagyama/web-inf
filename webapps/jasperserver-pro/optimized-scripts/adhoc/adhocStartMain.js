/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define("runtime_dependencies/js-sdk/src/common/component/panel/trait/collapsiblePanelTrait",["require","exports","module","underscore","jquery","./abstractPanelTrait"],function(e,t,i){function s(e,t){!t&&e.stopPropagation(),this.onCollapseControlPressed?this.onCollapseControlPressed(e):this.toggleCollapsedState()}function n(){this.$collapser&&this.$collapser.off("mousedown"),this.$el&&this.$el.find(this.expandOnDblClickSelector).off("dblclick")}var o=e("underscore"),r=e("jquery"),a=e("./abstractPanelTrait");i.exports=o.extend({},a,{onConstructor:function(e){this.collapserClass=e.collapserClass||"buttonIconToggle",this.collapserSelector=e.collapserSelector||".buttonIconToggle",this.collapsiblePanelClass=e.collapsiblePanelClass||"collapsiblePanel",this.expandOnDblClickSelector=e.expandOnDblClickSelector||"> p:first",this.allowEventPropagation=!!e.allowMouseDownEventPropagation,this.onCollapseControlPressed=e.onCollapseControlPressed},beforeSetElement:function(){n.call(this)},afterSetElement:function(){this.$el.addClass(this.collapsiblePanelClass),this.$collapser=this.$(this.collapserSelector),this.$collapser.length||(this.$collapser=r("<button></button>").addClass(this.collapserClass),this.$("> .header").prepend(this.$collapser)),this.$collapser.on("mousedown",o.bind(s,this,this.allowEventPropagation)),this.$el.find(this.expandOnDblClickSelector).on("dblclick",o.bind(s,this))},onRemove:function(){n.call(this)}})}),define("runtime_dependencies/js-sdk/src/common/component/tree/trait/addToSelectionModelTrait",["require","exports","module","underscore","../../list/model/ScalableListModel"],function(e,t,i){var s=e("underscore"),n=e("../../list/model/ScalableListModel");i.exports={afterFetchComplete:function(e,t){n.prototype.afterFetchComplete.apply(this,arguments);var i,o;s.each(e,function(e,t){e.addToSelection&&(e.selected=!0,i=e.value,o=this.get("bufferStartIndex")+t,this.selectionContains&&!this.selectionContains(i,o)&&this.addValueToSelection(i,o),delete e.addToSelection)},this)}}}),define("runtime_dependencies/js-sdk/src/common/component/tree/dataprovider/DataProviderWithSearchCache",["require","exports","module","underscore","jquery"],function(e,t,i){var s=e("underscore"),n=e("jquery"),o=function(e){s.bindAll(this,"getData"),e=e||{},this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.pageSize=e.pageSize||999,this.criteriaKey=e.searchKey||"criteria",this.maxSearchCacheSize=e.maxSearchCacheSize||50,this.getDataByCriteriaHolder={},this.criteriaValuesCache=[],this.controlGetTotal=void 0!==e.controlGetTotal&&e.controlGetTotal,this.dataConverter=e.dataConverter,this.saveLastCriteria=void 0!==e.saveLastCriteria&&e.saveLastCriteria,this.lastCriteria=null,this.serialRequestsDelay=void 0!==e.serialRequestsDelay?e.serialRequestsDelay:50,this.serialRequestsDelayedPromise=null,this.request=e.request};s.extend(o.prototype,{getData:function(e){if(e=e||{},s.isEmpty(this.criteriaValuesCache)||void 0===e[this.criteriaKey]&&(e[this.criteriaKey]=s.first(this.criteriaValuesCache)),e[this.criteriaKey])return this._getDataByCriteria(e[this.criteriaKey])(e);if(void 0===e[this.criteriaKey]&&this.saveLastCriteria&&this.lastCriteria)return this._getDataByCriteria(this.lastCriteria)(e);this.lastCriteria=null,this.criteriaValuesCache=[];var t=n.Deferred(),i=this._getPagesToLoad(e);return i?this._requestData(e,i,t):this._resolveDeferredUsingDataFromCache(t,e),t.promise()},clear:function(){this.dataCache=[],this.dataCacheTotal=null,this.dataCachePages=[],this.getDataByCriteriaHolder={},this.criteriaValuesCache=[],this.lastCriteria=null},_requestData:function(e,t,i){var n=(t[t.length-1]-t[0]+1)*this.pageSize,o=s.extend({},e,{offset:t[0]*this.pageSize,limit:n});this.controlGetTotal&&(o.skipGetTotal=!0),n>=2147483647/this.pageSize*this.pageSize&&delete o.limit,this.controlGetTotal&&"number"!=typeof this.dataCacheTotal&&delete o.skipGetTotal,this.serialRequestsDelay>0?(clearTimeout(this.deferredTimeout),this.deferredTimeout=setTimeout(s.bind(this._requestDataDeferred,this,e,o,i),this.serialRequestsDelay)):this._requestDataDeferred(e,o,i)},_requestDataDeferred:function(e,t,i){this._getPagesToLoad(e)?this.serialRequestsDelayedPromise&&s.isEqual(t,this.serialRequestsDelayedPromise.query)?this.serialRequestsDelayedPromise.promise.done(i.resolve).fail(i.reject):(this.serialRequestsDelayedPromise={promise:i.promise(),query:t},this.request(t).done(s.bind(this._requestDone,this,e,t,i)).fail(i.reject)):this._resolveDeferredUsingDataFromCache(i,e)},_requestDone:function(e,t,i,s){this._putDataToCache(t,s),this.serialRequestsDelayedPromise=null,this._resolveDeferredUsingDataFromCache(i,e)},_resolveDeferredUsingDataFromCache:function(e,t){var i=this._getDataFromCache(t);e.resolve({total:this.dataCacheTotal,data:i})},_getPagesToLoad:function(e){var t,i=this._convertLimitOffsetToFirstLast(e),s=this._findPageIndex(i.first),n=this._findPageIndex(i.last),o=[];for(t=s;t<=n;t++)if(!this.dataCachePages[t]){o.push(t);break}for(t=n;t>=s;t--)if(!this.dataCachePages[t]){o.push(t);break}return o.length>0?o:null},_findPageIndex:function(e){return Math.floor(e/this.pageSize)},_convertLimitOffsetToFirstLast:function(e){var t=e&&e.offset?e.offset:0,i=e&&e.limit?t+e.limit-1:this.dataCacheTotal?this.dataCacheTotal-1:2147483647;return this.dataCacheTotal&&i>this.dataCacheTotal-1&&(i=this.dataCacheTotal-1),{first:t,last:i}},_getDataFromCache:function(e){e=s.defaults(e,{offset:0,limit:2147483647});var t=Math.max(0,e.offset),i=Math.min(t+e.limit,this.dataCacheTotal);return this.dataCache.slice(t,i)},_putDataToCache:function(e,t){var i;for(void 0!==t.total&&(this.dataCacheTotal=t.total),e.limit=e.limit||2147483647,i=0;i<t.data.length;i++)this.dataCache[i+e.offset]=this.dataConverter?this.dataConverter(t.data[i]):t.data[i];var s=e.offset/this.pageSize,n=Math.floor((Math.min(e.limit,t.data.length)+e.offset-1)/this.pageSize);for(i=s;i<=n;i++)this.dataCachePages[i]=!0},_getDataByCriteria:function(e){if(!this.getDataByCriteriaHolder[e]){var t,i=Number.MAX_VALUE,s=0,n=0;for(var o in this.getDataByCriteriaHolder)if(this.getDataByCriteriaHolder.hasOwnProperty(o)){n+=1;var r=this.getDataByCriteriaHolder[o];r.index<i&&(i=r.index,t=o),r.index>s&&(s=r.index)}n>=this.maxSearchCacheSize&&(delete this.getDataByCriteriaHolder[t],this.criteriaValuesCache=[]),this.getDataByCriteriaHolder[e]={getData:this._createDataProviderForCriteria(e),index:s+1},this.criteriaValuesCache.push(e)}return this.lastCriteria=e,this.getDataByCriteriaHolder[e].getData},_createDataProviderForCriteria:function(e){var t=this.request,i=this,n=new o({pageSize:this.pageSize,dataConverter:this.dataConverter,serialRequestsDelay:this.serialRequestsDelay,searchKey:this.criteriaKey,controlGetTotal:this.controlGetTotal,request:function(n){var o=s.extend({},n);return o[i.criteriaKey]=e,t(o)}}),r=n.getData;return n.getData=function(e){var t=s.extend({},e);return delete t[i.criteriaKey],r.call(n,t)},n.getData}}),i.exports=o}),define("runtime_dependencies/js-sdk/src/common/component/tree/TreeLevel",["require","exports","module","underscore","../panel/Panel","../panel/trait/collapsiblePanelTrait","../list/view/ListWithSelection","./trait/addToSelectionModelTrait","../list/model/ListWithSelectionModel","./dataprovider/DataProviderWithSearchCache"],function(e,t,i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(){this.$el.removeClass(this.loadingClass).addClass(this.openClass),d.invoke(this.plugins,"itemsRendered",this.list.model,this.list);var e=this.list.$("> .j-view-port-chunk > ul > li").addClass(this.cid).length,t=d.isFunction(this.levelHeight)?this.levelHeight():this.levelHeight;t&&e*this.listItemHeight>t?this.list.$el.css({height:t+"px","overflow-y":"auto"}):this.list.$el.css({height:"auto",overflow:"auto"}),this.list._calcViewPortHeight(),this._isReady=!0,this.trigger("ready",this)}function o(e,t){this.listRenderError=!0,this.trigger("listRenderError",e,t,this)}function r(e){var t=[];d.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||h(this),this.trigger("selection:change",t,this,[])}function a(e){var t=[];d.chain(e).keys(e).each(function(i){t.push(e[i])}),this.selection.multiple||h(this),this.trigger("item:dblclick",t)}function l(e,t){for(var i=0;i<t.length;i++)if(t[i]===e)return!0}function c(e,t,i,s){i&&i.exclude&&d.isArray(i.exclude)&&l(e,i.exclude)||(void 0===s||s>0)&&d.chain(e.items).keys().each(function(n){i&&i.exclude&&d.isArray(i.exclude)&&l(e.items[n],i.exclude)||t.call(e.items[n],i),c(e.items[n],t,i,void 0===s?s:--s)})}function h(e,t){t=t&&{exclude:t.exclude},c(e,function(e){this.list.clearSelection(),this.list.model.selection=[]},t)}var d=e("underscore"),u=e("../panel/Panel"),p=e("../panel/trait/collapsiblePanelTrait"),m=e("../list/view/ListWithSelection"),f=e("./trait/addToSelectionModelTrait"),g=e("../list/model/ListWithSelectionModel"),v=e("./dataprovider/DataProviderWithSearchCache"),T=g.extend(f);i.exports=u.extend({constructor:function(e){e||(e={}),d.extend(e,{traits:[p]}),u.prototype.constructor.call(this,e)},initialize:function(e){e||(e={}),this._isReady=!1,this.item=e.item||{},this.id=this.item.id,this.owner=e.owner,this.parent=e.parent,this.itemsTemplate=e.itemsTemplate,this.listItemHeight=e.listItemHeight,this.levelHeight=e.levelHeight,this.lazyLoad=!!e.lazyLoad,this.selection=e.selection||{allowed:!1,multiple:!1},this.resource=this.item.value,this.bufferSize=e.bufferSize,this.cache=void 0!==e.cache&&e.cache,this.allowMouseDownEventPropagation=e.allowMouseDownEventPropagation,this.items={},this.plugins=[];for(var t={el:this.el,model:this.model},i=0,s=e.plugins.length;i<s;i++){var n=e.plugins[i].constr;this.plugins.push(new n(d.extend({},t,e.plugins[i].options)))}this.dataLayer=this.owner.getDataLayer(this),d.invoke(this.plugins,"dataLayerObtained",this.dataLayer),u.prototype.initialize.apply(this,arguments)},render:function(){var e=new T({bufferSize:this.bufferSize,getData:this._getDataProvider(this.cache)});return this.list=new m({markerClass:"."+this.cid,eventListenerPattern:"."+this.cid+":not(.readonly) > p",el:this.$contentContainer,itemsTemplate:this.itemsTemplate,listItemHeight:this.listItemHeight,lazy:!0,selection:this.selection,allowMouseDownEventPropagation:this.allowMouseDownEventPropagation,model:e}),this.list.on("render:data",d.bind(n,this)),this.list.on("listRenderError",d.bind(o,this)),this.list.on("selection:change",d.bind(r,this)),this.list.on("item:dblclick",d.bind(a,this)),this.lazyLoad?this.on("open",this._onOpen,this):this.list.renderData(),this},_getDataProvider:function(e){var t=this,i=d.bind(function(e){return this.obtainData(e,t)},this.dataLayer),n={};return e&&("object"===s(e)&&(n=d.extend(n,e)),n.request=n.request||i,this.dataProvider=new v(n),i=this.dataProvider.getData),function(e){return e||(e={offset:0,limit:100}),e.id=t.id,i(d.extend({},t.owner.context,e),t)}},_onOpen:function(){this.$el.removeClass(this.openClass).addClass(this.loadingClass),this.list.renderData()},setElement:function(e){var t=u.prototype.setElement.apply(this,arguments);return this.list&&(this.list.setElement(this.$contentContainer),this.list.totalItems=-1),d.each(this.plugins,function(t){t.setElement(e)}),this.lazyLoad||this.list&&this.list.renderData(),this.collapsed||(this.open({silent:!0,depth:0}),this.lazyLoad&&this.list.renderData()),t},open:function(e){c(this,u.prototype.open,e,e?e.depth:0),u.prototype.open.call(this,e)},close:function(e){u.prototype.close.call(this,e),c(this,u.prototype.close,e,e?e.depth:void 0),h(this)},getLevel:function(e){return d(this.items).reduce(function(t,i){return t||(i.id===e?i:i.getLevel(e))},!1)},refresh:function(e){this.listRenderError||(this.lazyLoad&&!this.collapsed||!this.lazyLoad?(this.once("ready",d.bind(c,this,this,this.refresh,e,1)),this.list.model.fetch({top:0,bottom:this.list.model.bufferSize,force:!0}),this.list.scrollTo(0)):(this.list.model.set("bufferStartIndex",void 0,{silent:!0}),this.list.model.set("bufferEndIndex",void 0,{silent:!0}),this.list.model.set("total",void 0,{silent:!0}),c(this,this.refresh,e)))},fetch:function(e,t){this.list.fetch(t,e)},recalcConstraints:function(){this.list.resize()},fetchVisibleData:function(){this.list._fetchVisibleData()},resetSelection:function(e){h(this,e),e&&e.silent||this.trigger("selection:change",[])},hasItems:function(){return!!this.$("> .subcontainer > .j-view-port-chunk > ul > li").length},clearCache:function(){d.each(this.items,function(e){e.clearCache()}),this.dataProvider&&this.dataProvider.clear()},remove:function(){var e=this,t=-1;if(d.forEach(d.keys(this.items),function(t){e.items[t].remove()}),this.dataProvider&&this.dataProvider.clear(),this.list.remove(),this.parent){var i=this.parent.id,s=this.owner.getDataLayer(i);if(s&&s.predefinedData&&s.predefinedData[i]&&d.isArray(s.predefinedData[i])){for(var n=0;n<s.predefinedData[i].length;n++)if(s.predefinedData[i][n].id===this.id){t=n;break}t>-1&&(s.predefinedData[i].splice(t,1),delete s.predefinedData[this.id])}delete this.parent.items[this.id]}u.prototype.remove.apply(this,arguments)},isReady:function(){return this._isReady}})}),define("runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer",["require","exports","module","underscore","jquery","../../util/classUtil","../../util/xssUtil","request"],function(e,t,i){function s(e,t){return o.call(this,n.call(this,e),t)}function n(e){for(var t=0,i=e.length;t<i;t++)e[t]={id:this.extractId(e[t]),value:e[t]};return e}function o(e,t){var i,s;if(this.processors&&this.processors.length)for(var n=0,o=this.processors.length;n<o;n++){i=[];for(var r=0,a=e.length;r<a;r++)(s=this.processors[n].processItem(e[r],t,this))&&i.push(s);e=i}return e}var r=e("underscore"),a=e("jquery"),l=e("../../util/classUtil"),c=(e("../../util/xssUtil"),e("request"));i.exports=l.extend({constructor:function(e){this.requestType=e.requestType?e.requestType:"GET",e.getDataUri&&(this.getDataUri=e.getDataUri),this.getDataUri||(this.getDataUri=r.template(e.dataUriTemplate)),e.getDataArray&&(this.getDataArray=e.getDataArray),e.getDataSize&&(this.getDataSize=e.getDataSize),e.extractId&&(this.extractId=e.extractId),this.levelDataId=e.levelDataId?e.levelDataId:"id",this.processors=e.processors||[],this.initialize(e)},initialize:function(e){},extractId:function(e){return e[this.levelDataId]},getDataSize:function(e,t,i){return this.getDataArray(e,t,i).length},getDataArray:function(e,t,i){return e},obtainData:function(e,t){var i=new a.Deferred,n=this;return this.predefinedData&&this.predefinedData[e.id]?i.resolve({total:this.predefinedData[e.id].length,data:this.predefinedData[e.id]}):c({type:this.requestType,dataType:this.dataType||"json",headers:{Accept:this.accept||"application/json","Content-Type":this.contentType||void 0},cache:!1,data:this.data||void 0,url:this.getDataUri(e)}).done(function(){var t=arguments[0];n.dataSize=n.getDataSize.call(n,t,e,arguments[2]),i.resolve({total:n.dataSize,data:s.call(n,n.getDataArray.call(n,t,e,arguments[2]),e)})}).fail(function(e){i.reject(e.status,e.responseText)}),i},_process:s})}),define("text!runtime_dependencies/js-sdk/src/common/component/tree/template/treeLevelListTemplate.htm",[],function(){return'<ul class="list collapsible folders" style="top: {{- top}}px; position: relative;">\n\n    <js-templateNonce></js-templateNonce>\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button draggable" data-tooltip="{{- item.value.label }}"><b class="icon"></b> {{- item.value.label }} </p>\n        <div class="subcontainer" ></div>\n    </li>\n    {{ }) }}\n</ul>\n'}),define("text!runtime_dependencies/js-sdk/src/common/component/tree/template/treeLevelTemplate.htm",[],function(){return'<div>\n\n    <js-templateNonce></js-templateNonce>\n    <ul class="list collapsible folders">\n        <li class="node">\n            <p class="wrap button">\n                <b class="icon" id="handler2" title=""></b>root\n            </p>\n            <div class="subcontainer"></div>\n        </li>\n    </ul>\n</div>'}),define("runtime_dependencies/js-sdk/src/common/component/tree/Tree",["require","exports","module","jquery","underscore","backbone","./TreeLevel","./TreeDataLayer","text!./template/treeLevelListTemplate.htm","text!./template/treeLevelTemplate.htm"],function(e,t,i){function s(e){var t=e.list.model.get("items"),i=this;t=o.where(t,{_node:!0}),e.$(".node").each(function(n,r){var l=t[n].id;e.items[l]?e.items[l].setElement(r):(e.items[l]=new a(o.extend({},i._options,{el:r,item:t[n],parent:e})),i.listenTo(e.items[l],"listRenderError",o.bind(function(e,t,i){this.trigger("levelRenderError",e,t,i)},i)),e.listenTo(e.items[l],"ready",o.bind(s,i)),e.listenTo(e.items[l],"selection:change",function(t,i,s){i&&s.push(i),e.list.model.clearSelection(),e.trigger("selection:change",t,e,s)}),e.listenTo(e.items[l],"item:dblclick",function(t){e.list.model.clearSelection(),e.trigger("item:dblclick",t)}),e.items[l].render())}).length&&e.$(".j-view-port-chunk").css({height:"auto"})}var n=e("jquery"),o=e("underscore"),r=e("backbone"),a=e("./TreeLevel"),l=e("./TreeDataLayer"),c=e("text!./template/treeLevelListTemplate.htm"),h=e("text!./template/treeLevelTemplate.htm"),d={ADD:"add",UPDATE:"update"},u=r.View.extend({template:o.template(h),_plugins:[],el:function(){return this.template()},constructor:function(e){e||(e={}),this.defaultDataLayer=new l(e),this.customDataLayers=e.customDataLayers,e.type?(this._type=e.type,e.type=void 0):this._type="tree",e.collapserSelector||(e.collapserSelector="b.icon:eq(0)"),e.predefinedData?(this.defaultDataLayer.predefinedData=e.predefinedData,e.predefinedData=void 0):this.defaultDataLayer.predefinedData={},e.rootless&&(this.rootless=e.rootless,e.rootless=void 0),e.additionalCssClasses&&(this.additionalCssClasses=e.additionalCssClasses,e.additionalCssClasses=void 0),e.getDataLayer&&(this.getDataLayer=e.getDataLayer,e.getDataLayer=void 0),this._options=o.extend({itemsTemplate:c,plugins:this._plugins,owner:this},e),this.context=e.context||{};for(var t=0,i=this._plugins.length;t<i;t++)this._plugins[t].processors&&(this.processors=this.processors.concat(this._plugins[t].processors));r.View.apply(this,arguments)},initialize:function(e){this.rootLevel=new a(o.extend({},this._options,{levelHeight:e.rootLevelHeight},{el:this.$("li")[0]},{item:{id:"/",value:{id:"/",resourceType:"folder"}}})),this.rootless&&this.$el.find("ul:first").addClass("hideRoot"),this.additionalCssClasses&&this.$el.find("ul:first").addClass(this.additionalCssClasses),this.listenTo(this.rootLevel,"ready",o.bind(s,this)),this.listenTo(this.rootLevel,"selection:change",o.bind(function(e,t,i){t&&i&&o.isArray(i)&&(this.rootLevel.selection.multiple||this.rootLevel.resetSelection({silent:!0,exclude:[i[0]]})),this.trigger("selection:change",e)},this)),this.listenTo(this.rootLevel,"item:dblclick",o.bind(function(e){this.trigger("item:dblclick",e)},this));for(var t=0,i=this._plugins.length;t<i;t++)this._plugins[t].constr.treeInitialized.call(this,this._plugins[t].options);this.rootLevel.render(),e.collapsed&&e.lazyLoad&&this.rootless&&this.expand("/")},remove:function(){for(var e=0,t=this._plugins.length;e<t;e++)this._plugins[e].constr.treeRemoved.call(this);this.rootLevel.remove(),r.View.prototype.remove.apply(this,arguments)},expand:function(e,t){var i=this.getLevel(e);return i&&i.open(t),this},collapse:function(e,t){var i=this.getLevel(e);return i&&i.close(t),this},_getNodeByLevelId:function(e){var t,i,s=this.getLevel(e);if(s)return s.parent?(t=s.parent.list,{node:s.item,nodeElement:s.$el,itsList:t}):null;var n=!1;if("list"===this._type)n=this.rootLevel;else if("tree"===this._type){var r=e.split("/");if(r=r.slice(0,r.length-1).join("/"),""===r&&(r="/"),!(n=this.getLevel(r)))return null}return n?(t=n.list,i=o.find(t.model.get("items"),function(t){return t.id===e}),i?{node:i,nodeElement:t.$el.find("li.leaf.selected"),itsList:t}:null):null},select:function(e){var t=this._getNodeByLevelId(e);t&&(t.itsList.model.clearSelection().addValueToSelection(t.node.value,t.node.index),this.trigger("selection:change",t.itsList.getValue()))},deselect:function(e){},addItem:function(e,t){var i=this.getLevel(e),s=d.ADD;return i&&this._getNodeItems(e,i,t,s),this},updateItem:function(e,t){var i=t?this.getLevel(t):this.rootLevel;return i&&this._getNodeItems(i.id,i,e),this},resetSelection:function(e){return this.rootLevel.list.clearSelection(),this.rootLevel.list.model.selection=[],this.rootLevel.resetSelection(e),this},refresh:function(e){e&&(this.context=e),this.rootLevel.refresh()},recalcConstraints:function(){this.rootLevel.recalcConstraints()},fetchVisibleData:function(){this.rootLevel.fetchVisibleData()},clearCache:function(){this.rootLevel.clearCache()},getLevel:function(e){return this.rootLevel.id===e?this.rootLevel:this.rootLevel.getLevel(e)},getDataLayer:function(e){return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer},_addItem:function(e,t,i){return!o.findWhere(e,{id:i.id})&&e.push(i),e},_updateItem:function(e,t){return o.each(e,function(e){e.id===t.id&&o.extend(e,t)},this),e},_getNodeItems:function(e,t,i,s){var n,r=this.getDataLayer(t),a=t.list.model.get("items")?t.list.model.get("items"):[];r.predefinedData=r.predefinedData||{},n=s===d.ADD?this._addItem(a,e,i):this._updateItem(a,i),r.predefinedData[e]=o.sortBy(n,"label"),t.fetch({force:!0,keepPosition:!0})},_selectTreeNode:function(e,t){if(o.isString(e)&&""!==e){var i=o.bind(function(){var s=o.bind(function(){var s=e,n=this.getLevelId(s);if(this.expand(n),this.select(n),"list"===this._type)this.rootLevel.on("ready",i);else if("tree"===this._type&&t&&t.length){var o=this.$el,r=this._getNodeByLevelId(n);if(!r)return;var a=r.nodeElement;if(!a)return;var l=a.offset().top-o.offset().top-t.height()/2+a.height()/2;t.scrollTop(l)}},this);if("/"===e||"/public"===e||"list"===this._type)s();else{var r=e.replace(/\/$/,""),a=r.substr(0,r.lastIndexOf("/"));a=a||"/";var l=new n.Deferred;this._openPath(a,l,0),l.done(s)}},this);this.rootLevel.isReady()?i():this.rootLevel.on("ready",i)}},_openPath:function(e,t,i){if(!e)return t.resolve();var s,n,r,a,l=this;if("/"===e?n=["/"]:(n=e.split("/"),n[0]="/"),"/"===n[0]&&"public"===n[1]&&(n=o.union(["/public"],o.rest(n,2))),(i=i||0)===n.length)return t.resolve();s=o.first(n,i+1).join("/"),s=s.replace(/\/\//g,"/"),a=this.getLevelId(s),(r=this.getLevel(a))&&(r.collapsed?(r.once("ready",function(){l._openPath(e,t,i+1)}),r.open()):this._openPath(e,t,i+1))},getLevelId:function(e){var t="",i=["/public"];if("/"===e||"/root"===e)t="/root";else{for(var s=!1,n=0;n<i.length;n++)if(0===e.indexOf(i[n])){s=!0;break}t=s?e:"/root/"+e.substr(1)}return t}},{instance:function(e){return new this(e)}});i.exports={use:function(e,t){return function(e){return{use:function(t,i){return e.prototype._plugins.push({constr:t,options:i}),this},create:function(){return e}}}(u.extend({_plugins:[{constr:e,options:t}]}))},create:function(){return u}}}),define("text!runtime_dependencies/js-sdk/src/common/component/panel/template/tabbedPanelButtonTemplate.htm",[],function(){return'<button class="button up">\n\n    <js-templateNonce></js-templateNonce>\n    <span class="wrap">{{- label }}<span class="icon"></span></span>\n</button>\n'}),define("runtime_dependencies/js-sdk/src/common/component/panel/trait/tabbedPanelTrait",["require","exports","module","underscore","jquery","backbone","./abstractPanelTrait","../../base/OptionContainer","text!../template/tabbedPanelButtonTemplate.htm"],function(e,t,i){function s(e,t){var i=t.get("action");this._contentRendered[i]||(this._contentRendered[i]=!0,this.tabs[i].render&&this.tabs[i].render()),this.$tabs.hide(),this.$tabs.filter(function(){return o(this).data("tab")===i}).css("display","block"),this.selectedTab=i,this.trigger("tab:"+i,e,t)}var n=e("underscore"),o=e("jquery"),r=e("backbone"),a=e("./abstractPanelTrait"),l=e("../../base/OptionContainer"),c=e("text!../template/tabbedPanelButtonTemplate.htm");i.exports=n.extend({},a,{onConstructor:function(e){if(e||(e={}),!e.tabs||!n.isArray(e.tabs)||0===e.tabs.length)throw new Error("Tabbed panel should have at least one tab");this.tabContainerClass=e.tabContainerClass||"tabContainer",this.tabHeaderContainerSelector=e.tabHeaderContainerSelector||"> .header > .tabHeaderContainer",this.tabHeaderContainerClass=e.tabHeaderContainerClass||"tabHeaderContainer",this.tabbedPanelClass=e.tabbedPanelClass||"tabbedPanel",this.tabs={},n.each(e.tabs,n.bind(function(e){this.tabs[e.action]=e.content,delete e.content},this))},afterSetElement:function(){this.$el.addClass(this.tabbedPanelClass),this.$tabHeaderContainer=this.$(this.tabHeaderContainerSelector),this.$tabHeaderContainer.length||(this.$tabHeaderContainer=o("<div></div>").addClass(this.tabHeaderContainerClass),this.$("> .header").append(this.$tabHeaderContainer)),this.$contentContainer.empty(),n.each(this.tabs,n.bind(function(e,t){var i=o("<div></div>").addClass(this.tabContainerClass);i.data("tab",t),i.html(e instanceof r.View?e.$el:e),this.$contentContainer.append(i)},this));var e=this.tabContainerClass.split(" ");this.$tabs=this.$("."+e[0])},afterInitialize:function(e){this.tabHeaderContainer=new l({options:e.tabs,el:this.$tabHeaderContainer,contextName:"tab",toggleClass:e.toggleClass||"active",toggle:!0,optionTemplate:e.optionTemplate||c}),this._contentRendered={},this.listenTo(this.tabHeaderContainer,n.map(e.tabs,function(e){return"tab:"+e.action}).join(" "),n.bind(s,this));for(var t=0;t<e.tabs.length;t++)if(e.tabs[t].primary){this.openTab(e.tabs[t].action);break}},onRemove:function(){n.each(this.tabs,function(e){e.remove&&e.remove()}),this.tabHeaderContainer.remove()},extension:{openTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.select()},showTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.show()},hideTab:function(e){var t=this.tabHeaderContainer.getOptionView(e);t&&t.hide()}}})}),define("runtime_dependencies/js-sdk/src/common/component/tree/plugin/TreePlugin",["require","exports","module","backbone"],function(e,t,i){var s=e("backbone");i.exports=s.View.extend({dataLayerObtained:function(){},itemsRendered:function(){}},{processors:null,treeInitialized:function(){},treeRemoved:function(){}})}),define("text!runtime_dependencies/js-sdk/src/common/component/tooltip/template/tooltipTemplate.htm",[],function(){return'<div class="{{- cssClasses }}" style="position: absolute; z-index: 100000;">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="content">\n        <div class="body"></div>\n    </div>\n</div>\n'}),define("runtime_dependencies/js-sdk/src/common/component/tooltip/Tooltip",["require","exports","module","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(e,t,i){var s=e("jquery"),n=e("underscore"),o=e("backbone"),r=e("text!./template/tooltipTemplate.htm");i.exports=o.View.extend({template:n.template(r),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(e){if(e||(e={}),!e.attachTo||0===s(e.attachTo).length)throw new Error("Tooltip should be attached to an element");if(!e.contentTemplate)throw new Error("Tooltip should have contentTemplate");this._shown=!1,this.$attachTo=s(e.attachTo),this.$attachTo[0].tooltip=this,e.delay&&(this.delay=e.delay),e.offset&&(this.offset=e.offset),e.attribute&&(this.attribute=e.attribute),e.cssClasses&&(this.cssClasses=e.cssClasses),this.contentTemplate=e.contentTemplate,this.i18n=e.i18n||{},!n.isUndefined(e.triggerEvents)&&(this.triggerEvents=e.triggerEvents),this.selector="["+this.attribute+"]",n.bindAll(this,"show","_onMouseMove","_onMouseLeave"),this.$attachTo.on("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.on("mouseleave touchend",this.selector,this._onMouseLeave),o.View.prototype.constructor.apply(this,arguments)},_render:function(e,t,i){if(this._event){e=e instanceof o.Model?e.toJSON():e;var s=n.template(this.contentTemplate)({model:e,i18n:this.i18n,options:t||{}});this.$el.find(".body").empty().append(s),this._showTooltip()}i.resolve()},show:function(e,t){var i=new s.Deferred;return this._timer=setTimeout(n.bind(this._render,this,e,t,i),this.delay),i},_showTooltip:function(){s("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.contentTemplate&&this._timer&&clearTimeout(this._timer),this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var e=this.$el.innerHeight(),t=this.$el.innerWidth(),i=s(window).height(),n=s(window).width(),o=this.offset.y,r=this.offset.x;e+this._event.pageY+this.offset.y+3>=i&&(o=-this.offset.y-e),t+this._event.pageX+this.offset.x+3>=n&&(r=-this.offset.x-t),this.$el.css({top:this._event.pageY+o,left:this._event.pageX+r})},_onMouseMove:function(e){this._event=e},_onMouseLeave:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this._event=null},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.off("mousemove touchmove",this.selector,this._onMouseMove),this.$attachTo.off("mouseleave touchend",this.selector,this._onMouseLeave),o.View.prototype.remove.apply(this,arguments)}},{attachTo:function(e,t){var i=this;return t||(t={}),t.attachTo=e||"body",new i(t)},detachFrom:function(e){e=s(e)[0],e.tooltip&&e.tooltip.remove()}})}),define("runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin",["require","exports","module","./TreePlugin","underscore","../../tooltip/Tooltip"],function(e,t,i){var s=e("./TreePlugin"),n=e("underscore"),o=e("../../tooltip/Tooltip");i.exports=s.extend({initialize:function(e){this.tooltip=o.attachTo(e.attachTo,n.omit(e,"el")),this.listensToList=!1,s.prototype.initialize.apply(this,arguments)},itemsRendered:function(e,t){var i=this;this.listensToList||(this.listensToList=!0,this.listenTo(t,"list:item:mouseover",function(e,t){i.tooltip.show(e)}),this.listenTo(t,"list:item:mouseout",function(){i.tooltip.hide()}))},remove:function(){o.detachFrom(this.$el),this.tooltip.remove(),s.prototype.remove.apply(this,arguments)}})}),define("text!runtime_dependencies/js-sdk/src/common/component/tree/template/searchPluginTemplate.htm",[],function(){return'<span class="control searchLockup ">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="wrap">\n        <input type="text" tabindex="">\n    </div>\n    <b class="right">\n        <a class="button searchClear"></a>\n    </b>\n    <a class="button search up"></a>\n</span>\n'}),define("runtime_dependencies/js-sdk/src/common/component/tree/plugin/SearchPlugin",["require","exports","module","underscore","jquery","backbone","./TreePlugin","text!../template/searchPluginTemplate.htm"],function(e,t,i){var s=e("underscore"),n=e("jquery"),o=e("backbone"),r=e("./TreePlugin"),a=e("text!../template/searchPluginTemplate.htm"),l=o.View.extend({template:s.template(a),el:function(){return this.template()},events:{"click .button.search":"clickHandler","click .button.searchClear":"clear","keydown input[type=text]":"keyHandler"},initialize:function(e){this.owner=e.owner,this.$searchInput=this.$el.find("input[type=text]")},search:function(e){var t=this.$searchInput.val();this.owner.refresh(s.extend({searchString:t},e)),t?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},clearInput:function(){this.$searchInput.val("")},clear:function(){this.clearInput(),this.clickHandler(),this.trigger("clear",this)},clearSilently:function(){this.clearInput(),delete this.owner.context.searchString,
this.owner.refresh(s.extend({searchString:""},this.owner.context)),this.$el.find(".button.searchClear").removeClass("up")},clickHandler:function(){delete this.owner.context.searchString,this.search(this.owner.context),this.trigger("search",this.owner.context)},keyHandler:function(e){13===e.which&&this.clickHandler()},setSearchString:function(e){this.$searchInput.val(e)}});i.exports=r.extend({initialize:function(e){this.searchParameter=e&&e.searchParameter||"q",this.additionalParams=e&&e.additionalParams},dataLayerObtained:function(e){var t=this;if(!e.__searchPluginExtended){var i=e.getDataUri,o=this.searchParameter;e.getDataUri=function(e){var r=i.apply(this,arguments),a={};return e.searchString&&(a[o]=e.searchString),t.additionalParams&&s.extend(a,t.additionalParams,s.pick(e,s.keys(t.additionalParams))),r+=(-1===r.indexOf("?")?"?":"&")+n.param(a,!0)},e.__searchPluginExtended=!0}}},{treeInitialized:function(e){e=e||{};var t=this;this.searchForm=new l({owner:this}),e.dfdRenderTo?e.dfdRenderTo.done(function(e){e.prepend(t.searchForm.render().el)}):this.$el.prepend(this.searchForm.render().el)},treeRemoved:function(){this.searchForm.remove()}})}),define("runtime_dependencies/js-sdk/src/common/component/tree/plugin/InfiniteScrollPlugin",["require","exports","module","./TreePlugin"],function(e,t,i){var s=e("./TreePlugin");i.exports=s.extend({itemsRendered:function(){this.$("> .subcontainer > .j-view-port-chunk").css({height:"auto"})}})}),define("text!runtime_dependencies/js-sdk/src/common/component/tree/template/noResourcesFoundMessageTemplate.htm",[],function(){return'<div class="noSearchResults">\n\n    <js-templateNonce></js-templateNonce>\n    {{- msg}}</div>'}),define("runtime_dependencies/js-sdk/src/common/component/tree/plugin/NoSearchResultsMessagePlugin",["require","exports","module","underscore","bundle!CommonBundle","./TreePlugin","text!../template/noResourcesFoundMessageTemplate.htm"],function(e,t,i){var s=e("underscore"),n=e("bundle!CommonBundle"),o=e("./TreePlugin"),r=e("text!../template/noResourcesFoundMessageTemplate.htm"),a=function(e){!e.list.totalItems&&e.list.$el.html(this.noResourcesFoundMessage)};i.exports=o.extend({},{treeInitialized:function(e){this.noResourcesFoundMessage=s.template(r,{msg:n["no.resources.found"]}),this.listenTo(this.rootLevel,"ready",a)},treeRemoved:function(){this.stopListening(this.rootLevel,"ready",a)}})}),define("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes",["require","exports","module"],function(e,t,i){i.exports={RESOURCE_LOOKUP:"resourceLookup",DASHBOARD:"dashboard",LEGACY_DASHBOARD:"legacyDashboard",REPORT_UNIT:"reportUnit",TOPIC:"topic",ADHOC_DATA_VIEW:"adhocDataView",FILE:"file",BUNDLE_FILE:"bundleFile",SECURITY_FILE:"securityFile",FOLDER:"folder",SECURE_FILE:"secureFile",PROP:"prop",ACCESS_GRANT_SCHEMA:"accessGrantSchema",DATA_TYPE:"dataType",JDBC_DATA_SOURCE:"jdbcDataSource",AWS_DATA_SOURCE:"awsDataSource",AZURE_SQL_DATA_SOURCE:"azureSqlDataSource",JNDI_DATA_SOURCE:"jndiJdbcDataSource",VIRTUAL_DATA_SOURCE:"virtualDataSource",CUSTOM_DATA_SOURCE:"customDataSource",BEAN_DATA_SOURCE:"beanDataSource",XMLA_CONNECTION:"xmlaConnection",LIST_OF_VALUES:"listOfValues",REPORT_OPTIONS:"reportOptions",QUERY:"query",OLAP_UNIT:"olapUnit",DOMAIN_TOPIC:"domainTopic",DOMAIN:"domain",SEMANTIC_LAYER_DATA_SOURCE:"semanticLayerDataSource",SECURE_MONDRIAN_CONNECTION:"secureMondrianConnection",MONDRIAN_XMLA_DEFINITION:"mondrianXmlaDefinition",MONDRIAN_CONNECTION:"mondrianConnection",INPUT_CONTROL:"inputControl",ORGANIZATION:"organization",OLAP_CUBE:"olapCube"}}),define("text!adhoc/datachooser/template/datachooserDialogTemplate.htm",[],function(){return'<div class="jr-mDialog jr-uWidth-400px jr {{- additionalCssClasses }}" tabindex="-1">\n\n    <js-templateNonce></js-templateNonce>\n    <div class="jr-mDialog-header mover jr">\n        <h1 class="jr-mDialog-header-title jr">{{- title }}</h1>\n    </div>\n    <div class="sub header tabHeaderContainer"></div>\n    <div class="jr-mDialog-body subcontainer jr"></div>\n    <p class="itemDescription"></p>\n    <div class="jr-mDialog-footer jr"></div>\n</div>\n'}),define("text!adhoc/datachooser/template/dataChooserTreeLeafTemplate.htm",[],function(){return'<ul class="list collapsible" style="top: {{- top}}px; position: relative;">\n\n    <js-templateNonce></js-templateNonce>\n    {{ _.each(items, function(item){ }}\n    <li class="{{- item._node ? \'node folders closed\' : \'leaf\'}} {{- item.selected ? \'selected\' : \'\'}} {{- item.cssClass }}" data-index="{{- item.index }}" tabindex="-1">\n        <p class="wrap button {{- item._node ? \'\' : \'draggable\'}} " {{ if (item.value.description || item.value.uri) { }}data-tooltip=\'{{ if (item.value.description) { }}<p class="message label">{{- item.i18n ? item.i18n["tooltip.description"] : "Description:" }} </p><p class="message">{{- item.value.description }}</p>{{ } }} {{ if (item.value.uri) { }} <p class="message label">{{- item.i18n ? item.i18n["tooltip.path"] : "Path:" }} </p><p class="message">{{- item.value.uri }}</p> {{ } }}\' {{ } }}><b class="icon"></b> {{- item.value.label }} </p>\n        <div class="subcontainer" ></div>\n    </li>\n    {{ }) }}\n</ul>'}),define("text!adhoc/datachooser/template/tooltip/sidebarTreeLeafTooltipTemplate.htm",[],function(){return'{{ if (model.value.description) { }}\n    <p class="message label">{{- model.i18n[\'tooltip.description\'] }}</p><p class="message">{{- model.value.description }}</p>\n{{ } }}\n{{ if (model.value.uri) { }}\n    <p class="message label">{{- model.i18n[\'tooltip.path\'] }}</p><p class="message">{{- model.value.uri }}</p>\n{{ } }}\n\n    <js-templateNonce></js-templateNonce>'}),define("text!adhoc/datachooser/template/datachooserTabTemplate.htm",[],function(){return'<button class="button {{- additionalCssClasses }}{{ if (exposeAction) { }} {{- action}} {{ } }} up" title="{{ if(action === \'list\') { }} {{- i18n.ADH_108_DATA_CHOOSER_LIST_TAB_TOOLTIP }} {{ } else { }} {{- i18n.ADH_108_DATA_CHOOSER_FOLDERS_TAB_TOOLTIP }} {{ } }}">\n\n    <js-templateNonce></js-templateNonce>\n    <span class="wrap">{{- label }}<span class="icon"></span></span>\n</button>'}),define("runtime_dependencies/bi-repository/src/bi/repository/util/resourcesTreeGetDataUriFnUtil",["require","exports","module","underscore"],function(e,t,i){var s=e("underscore");i.exports=function(e){return function(t){var i="";if(i+=e.contextPath+"/rest_v2/api/resources?",e.getFolderUri){var n=e.getFolderUri(t.id);n&&(i+="folderUri="+encodeURIComponent(n))}else i+="folderUri="+encodeURIComponent(t.id);return e.recursive?i+="&recursive=true":i+="&recursive=false",e.type&&(i+=e.type.reduce(function(e,t){return e+="&type="+t},"")),e.containerType&&(i+="&containerType="+e.containerType),e.exclude&&(i+="&excludeFolder="+e.exclude),i+="&offset={{= offset }}&limit={{= limit }}",e.forceTotalCount&&(i+="&forceTotalCount=true"),e.forceFullPage&&(i+="&forceFullPage=true"),s.template(i,t)}}}),define("runtime_dependencies/bi-repository/src/bi/repository/util/extractRootLevelDataFromHtmlResponse",["require","exports","module"],function(e,t,i){i.exports=function(e){var t=e.trim().match(/^<div\s?(?:(?:.*)=(?:['"]).*(?:['"]))*>(.*)<\/div>/);return JSON.parse(t?t[1]:"{}")}}),define("adhoc/datachooser/view/DatachooserDialogView",["require","exports","module","underscore","jquery","runtime_dependencies/js-sdk/src/common/component/dialog/Dialog","runtime_dependencies/js-sdk/src/common/component/dialog/AlertDialog","runtime_dependencies/js-sdk/src/common/component/tree/Tree","runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer","runtime_dependencies/js-sdk/src/common/component/panel/trait/tabbedPanelTrait","runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin","runtime_dependencies/js-sdk/src/common/component/tree/plugin/SearchPlugin","runtime_dependencies/js-sdk/src/common/component/tree/plugin/InfiniteScrollPlugin","runtime_dependencies/js-sdk/src/common/component/tree/plugin/NoSearchResultsMessagePlugin","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","bundle!adhoc_messages","bundle!CommonBundle","runtime_dependencies/js-sdk/src/common/util/browserDetection","text!../template/datachooserDialogTemplate.htm","text!../template/dataChooserTreeLeafTemplate.htm","text!../template/tooltip/sidebarTreeLeafTooltipTemplate.htm","text!../template/datachooserTabTemplate.htm","settings!treeComponent","runtime_dependencies/bi-repository/src/bi/repository/util/resourcesTreeGetDataUriFnUtil","runtime_dependencies/bi-repository/src/bi/repository/util/extractRootLevelDataFromHtmlResponse","runtime_dependencies/js-sdk/src/jrs.configs"],function(e,t,i){function s(e){switch(e.value.resourceType){case f.REPORT_UNIT:e.cssClass="topic";break;case f.DOMAIN_TOPIC:e.cssClass="domain topic";break;case f.SEMANTIC_LAYER_DATA_SOURCE:e.cssClass="domain";break;case f.OLAP_CUBE:e.cssClass="olap"}return e}var n=e("underscore"),o=e("jquery"),r=e("runtime_dependencies/js-sdk/src/common/component/dialog/Dialog"),a=e("runtime_dependencies/js-sdk/src/common/component/dialog/AlertDialog"),l=e("runtime_dependencies/js-sdk/src/common/component/tree/Tree"),c=e("runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer"),h=e("runtime_dependencies/js-sdk/src/common/component/panel/trait/tabbedPanelTrait"),d=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin"),u=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/SearchPlugin"),p=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/InfiniteScrollPlugin"),m=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/NoSearchResultsMessagePlugin"),f=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),g=e("bundle!adhoc_messages"),v=e("bundle!CommonBundle"),T=e("runtime_dependencies/js-sdk/src/common/util/browserDetection"),b=e("text!../template/datachooserDialogTemplate.htm"),y=e("text!../template/dataChooserTreeLeafTemplate.htm"),C=e("text!../template/tooltip/sidebarTreeLeafTooltipTemplate.htm"),_=e("text!../template/datachooserTabTemplate.htm"),D=e("settings!treeComponent"),L=e("runtime_dependencies/bi-repository/src/bi/repository/util/resourcesTreeGetDataUriFnUtil"),x=e("runtime_dependencies/bi-repository/src/bi/repository/util/extractRootLevelDataFromHtmlResponse"),S=e("runtime_dependencies/js-sdk/src/jrs.configs"),P=S.contextPath,w=parseInt(D.treeLevelLimit,10),O=[f.DOMAIN_TOPIC,f.TOPIC,f.SEMANTIC_LAYER_DATA_SOURCE],E=[f.SECURE_MONDRIAN_CONNECTION,f.MONDRIAN_CONNECTION,f.XMLA_CONNECTION],R=L({getFolderUri:function(e){return"@fakeRoot"===e?"":e},contextPath:P,recursive:!0,forceTotalCount:!0,forceFullPage:!0}),I=[f.MONDRIAN_CONNECTION,f.SECURE_MONDRIAN_CONNECTION,f.XMLA_CONNECTION];i.exports=r.extend({events:{resize:"onResizeHeight"},onResizeHeight:function(){this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight),this.listTreeView.rootLevel.list.$el.height(this.$el.height()-this._resizableContainerShiftHeight-6),this.hierarhicalTreeView.rootLevel.list.$el.css("height","100%")},constructor:function(e){e||(e={}),this._dfdRenderSerachFormTo=o.Deferred();var t=this._getParameterByName("reportType");t=t||"crosstab",this.reportType="chart"===t?"ichart":t,this.decorate=this._getParameterByName("decorate")||"yes",this.isEmbeddedDesigner=this._getParameterByName("embeddedDesigner");var i,a=e.resourcesTypes;a||(a="table"===this.reportType?O:O.concat(E)),i=L({getFolderUri:function(e){return"@fakeRoot"===e?"":e},contextPath:P,recursive:!1,type:a,containerType:f.FOLDER,forceTotalCount:!0,forceFullPage:!0});var T={attachTo:this.$el,i18n:g,contentTemplate:C},D=l.use(d,T).use(p).create(),S=e.resourcesTypes;S||(S=n.union([f.TOPIC,f.DOMAIN_TOPIC,f.SEMANTIC_LAYER_DATA_SOURCE],I));var A=l.use(d,T).use(m).use(u,{additionalParams:{type:"table"===this.reportType?n.first(S,3):S},dfdRenderTo:this._dfdRenderSerachFormTo}).create(),k={treeNodeProcessor:{processItem:function(e){return e._node=n.contains(n.union([f.FOLDER],I),e.value.resourceType),e}},i18nItemProcessor:{processItem:function(e){return e.i18n=v,e}},filterPublicFolderProcessor:{processItem:function(e){if("/public"!==e.value.uri)return e}},filterTempFolderProcessor:{processItem:function(e){if(!e.value.uri.match(/\/temp\//)&&!e.value.uri.match(/\/temp$/))return e}},filterEmptyFoldersProcessor:{processItem:function(e){if("folder"!==e.value.resourceType||""!==e.value._links.content)return e}},cssClassItemProcessor:{processItem:s}},N=new c({requestType:"POST",dataUriTemplate:P+"/rest_v2/connections",processors:[k.i18nItemProcessor,k.cssClassItemProcessor],levelDataId:"uri",getDataArray:function(e,t,i){return e&&e[f.RESOURCE_LOOKUP]?e[f.RESOURCE_LOOKUP]:[]}}),j=function(e){if(n.contains(I,e.resource.resourceType)){var t=n.clone(this.customDataLayers.olapDataLayer);return n.extend(t,{accept:"application/repository."+e.resource.resourceType+".metadata+json",contentType:"application/repository."+e.resource.resourceType+"+json",data:JSON.stringify(e.resource)}),t}return this.customDataLayers&&this.customDataLayers[e.id]?this.customDataLayers[e.id]:this.defaultDataLayer};this.hierarhicalTreeView=D.instance({itemsTemplate:y,listItemHeight:26,selection:{allowed:!0,multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,bufferSize:w,additionalCssClasses:"folders",getDataUri:i,levelDataId:"uri",customDataLayers:{"/":n.extend(new c({dataUriTemplate:P+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:n.chain(k).omit("filterPublicFolderProcessor").values().value(),getDataArray:function(e){e=x(e);var t=n.find(e.children,function(e){return"/public"===e.uri}),i=[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",_links:{content:"@fakeContentLink"}}];return t&&i.push({id:"/public",label:t.label,uri:"/public",resourceType:"folder",_links:{content:"@fakeContentLink"}}),i}}),{accept:"text/html",dataType:"text"}),olapDataLayer:N},processors:n.values(k),getDataArray:function(e,t,i){return e&&e[f.RESOURCE_LOOKUP]?e[f.RESOURCE_LOOKUP]:[]},getDataSize:function(e,t,i){return+i.getResponseHeader("Total-Count")},getDataLayer:j}),this.listTreeView=A.instance({rootLevelHeight:n.bind(this.getContentHeight,this),itemsTemplate:y,listItemHeight:26,selection:{allowed:!0,multiple:!1},rootless:!0,collapsed:!0,lazyLoad:!0,getDataUri:R,levelDataId:"uri",cache:{searchKey:"searchString",pageSize:100},processors:[{processItem:function(e){return e._node=n.contains(I,e.value.resourceType),e}},k.i18nItemProcessor,k.cssClassItemProcessor,k.filterTempFolderProcessor],customDataLayers:{olapDataLayer:N},getDataLayer:j,getDataArray:function(e,t,i){return e&&e[f.RESOURCE_LOOKUP]?e[f.RESOURCE_LOOKUP]:[]},getDataSize:function(e,t,i){return+i.getResponseHeader("Total-Count")}}),r.prototype.constructor.call(this,{template:b,modal:!0,resizable:!0,additionalCssClasses:"sourceDialogNew",title:g.ADH_108_DATA_CHOOSER_DIALOG_TITLE,traits:[h],tabHeaderContainerSelector:".tabHeaderContainer",tabContainerClass:"tabContainer control groupBox treeBox",optionTemplate:_,toggleClass:"down",tabs:[{label:g.ADH_108_DATA_CHOOSER_FOLDERS_TAB,action:"tree",content:this.hierarhicalTreeView,exposeAction:!0,additionalCssClasses:"action square small",i18n:g},{label:g.ADH_108_DATA_CHOOSER_LIST_TAB,action:"list",content:this.listTreeView,exposeAction:!0,additionalCssClasses:"action square small",i18n:g}],buttons:[{label:g.ADH_016_BUTTON_OK,action:"apply",primary:!0},{label:g.ADH_010_BUTTON_CANCEL,action:"cancel",primary:!1}]}),this.disableButton("apply"),this.on("button:apply",n.bind(this._onSelectDataDialogOkButtonClick,this)),this.on("button:cancel",n.bind(this._onSelectDataDialogCancelButtonClick,this))},initialize:function(e){var t=function(e){var t=n.find(this.buttons.options,function(e){return"apply"===e.model.attributes.action}).$el,i=e&&n.isArray(e)&&e[0],s=i?e[0].uri:void 0,o=i?e[0].resourceType:void 0;return i||s||o?(o!==f.FOLDER?this.$(".itemDescription").text(i.description||""):this.$(".itemDescription").empty(),o===f.SEMANTIC_LAYER_DATA_SOURCE?t.find(".wrap").text(g.ADH_108_DATA_CHOOSER_DOMAIN_LABEL):t.find(".wrap").text(g.ADH_016_BUTTON_OK),n.contains(n.union([f.FOLDER],I),o)?(delete this.resourceData,void this.disableButton("apply")):(this.resourceData={},o===f.OLAP_CUBE?(this.resourceData.resourceUri=s.substring(0,s.lastIndexOf("/")),this.resourceData.cube=s.substring(s.lastIndexOf("/")+1),this.resourceData.reportType="olap_"+this.reportType):(this.resourceData.resourceUri=s,this.resourceData.reportType=this.reportType),this.resourceData.event=this._getAdHocFlowEvent(o),this.resourceData.flowExecutionKey=window.flowExecutionKey,void this.enableButton("apply"))):(this.disableButton("apply"),void this.$(".itemDescription").empty())};this.errorDialog=new a,this.listenTo(this.hierarhicalTreeView,"selection:change",t),this.listenTo(this.listTreeView,"selection:change",t),this.listenTo(this.hierarhicalTreeView,"levelRenderError",n.bind(this._onLevelRenderError,this.errorDialog)),this.listenTo(this.listTreeView,"levelRenderError",n.bind(this._onLevelRenderError,this.errorDialog)),this.listenTo(this.hierarhicalTreeView,"item:dblclick",this._onSelectDataDialogOkButtonClick),this.listenTo(this.listTreeView,"item:dblclick",this._onSelectDataDialogOkButtonClick),this.listenTo(this.listTreeView.rootLevel,"ready",this.onResizeHeight,this),this.listenTo(this.hierarhicalTreeView.rootLevel,"ready",this.onResizeHeight,this),this.listenTo(this.listTreeView.searchForm,"search",this._onSearch),this.listenTo(this.listTreeView.searchForm,"clear",this._resetItemSelection),this.on("tab:tree tab:list",this._resetItemSelection,this),r.prototype.initialize.apply(this,arguments)},getContentHeight:function(){return this.$el.height()-this._resizableContainerShiftHeight},render:function(){return r.prototype.render.apply(this,arguments),this._dfdRenderSerachFormTo.resolve(this.$tabHeaderContainer),this.openTab("list"),this},open:function(){var e=this;e._resizableContainerShiftHeight=6,r.prototype.open.apply(this,arguments);var t=n.bind(function(){this.$contentContainer.find(".tabContainer").css({height:"inherit","overflow-y":"auto"})},this);T.isIE8()||T.isIE9()?setTimeout(t,1):t(),this.$el.children().not(".subcontainer").not(".ui-resizable-e").not(".ui-resizable-se").each(function(){e._resizableContainerShiftHeight+=e.$(this).outerHeight(!0)}),this.$contentContainer.height(this.$el.height()-this._resizableContainerShiftHeight)},close:function(){this.hierarhicalTreeView&&(this.hierarhicalTreeView.collapse("@fakeRoot",{silent:!0}),this.hierarhicalTreeView.collapse("/public",{silent:!0}),this.hierarhicalTreeView.resetSelection()),r.prototype.close.apply(this,arguments)},_onSearch:function(){this.openTab("list"),this.disableButton("apply")},_resetItemSelection:function(){this.hierarhicalTreeView.resetSelection(),this.listTreeView.resetSelection(),this.$(".itemDescription").empty()},_getAdHocFlowEvent:function(e){var t="";return e==f.REPORT_UNIT||e==f.DOMAIN_TOPIC?t="startAdHocWithTopic":e==f.SEMANTIC_LAYER_DATA_SOURCE?t="startQueryBuilder":e===f.OLAP_CUBE&&(t="startAdhocForOlap"),t},_onSelectDataDialogOkButtonClick:function(){this.resourceData&&(document.location="flow.html?_flowId=adhocFlow&realm="+encodeURIComponent(encodeURIComponent(this.resourceData.resourceUri))+"&_flowExecutionKey="+this.resourceData.flowExecutionKey+"&reportType="+this.resourceData.reportType+"&embeddedDesigner="+this.isEmbeddedDesigner+"&decorate="+this.decorate+"&_eventId="+this.resourceData.event+(this.resourceData.cube?"&cube="+this.resourceData.cube:""))},_onLevelRenderError:function(e,t,i){t=JSON.parse(t);var s=t.message;t.parameters&&(s=t.parameters[0].substring(t.parameters[0].indexOf(": ")+2,t.parameters[0].indexOf("\n"))),this.setMessage(s),this.open(),i.$el.removeClass(i.loadingClass).addClass(i.openClass)},_onSelectDataDialogCancelButtonClick:function(){this.close(),this.isEmbeddedDesigner&&-1===document.referrer.indexOf("login.html")&&o(document).trigger("adhocDesigner:cancel")},_getParameterByName:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}})}),define("adhoc/adhocStartMain",["require","exports","module","requirejs-domready","settings!adhocSettings","./datachooser/view/DatachooserDialogView"],function(e,t,i){function s(e){var t=new r({resourcesTypes:e});window.location.href.indexOf("embeddedDesigner=true")<0&&t.listenTo(t,"close",function(){"undefined"!=typeof alreadyEditing&&-1===document.referrer.indexOf("login.html")?window.history.back():document.location="flow.html?_flowId=homeFlow"}),t.open()}var n=e("requirejs-domready"),o=e("settings!adhocSettings"),r=e("./datachooser/view/DatachooserDialogView");n(function(){s([].concat(o.commonTypes).concat(o.olapTypes))})});