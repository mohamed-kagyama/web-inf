/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","./crosstab","underscore","runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator"],function(e,t,n){var o=e("./crosstab"),i=e("underscore"),r=e("runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator");o.deselectAllSelectedOverlays=function(){},o.deselectAllColumnGroupOverlays=function(){},o.deselectAllRowGroupOverlays=function(){},o.deselectAllMeasureOverlays=function(){},o.removeFromSelectObjects=function(e){var t=null;window.selObjects.each(function(n){n.id==e&&(t=n)}),window.selObjects=window.selObjects.without(t)},o.getSelectedDimensionIndex=function(e){var t,n=-1;return e?i.isNumber(e.groupIndex)?e.groupIndex:(t=e.isMeasure?window.adhocDesigner.MEASURES:e.dimensionId,i.find(window.localContext.state.getDimensions(e.axis),function(e,o){if(e.name===t)return n=o,!0}),n):n},o.getSelectedMeasure=function(){if(window.selObjects&&window.selObjects.length>0){var e=window.selObjects[0];if(e.isMeasure){return o.getRefinedMeasuresFromState()[e.index]}}return null},o.getRefinedMeasuresFromState=function(){return i.filter(window.localContext.state.measures,function(e){return!e.isSpacer})},o.getSelectedGroup=function(e){return e?"row"===e.axis?window.localContext.state.rowGroups[e.groupIndex]:window.localContext.state.columnGroups[e.groupIndex]:null},o.getMeasureTypeByFunction=function(e){var t=o.getSelectedMeasure();if(t){var n=window.adhocDesigner.getSuperType(t.type);return"Average"===e?"dec":"Count"===e||"DistinctCount"===e?"int":n}return null},o.updateContextMenuWithSiblingLevels=function(e,t){if(!window.adhocDesigner.ui.display_manager)return t;var n=t.find(function(e){return"AdHocCrosstab.canAddSiblingLevels"===e.clientTest});if(!n)return t;var s=null,a=null,l=null,d=window.selObjects[0],c=/.*\[(.*)\]/.exec(d.level),u=c&&c[1];if(d.isMeasure)a=window.adhocDesigner.measuresTree.getRootNode(),l="row"===d.axis?"AdHocCrosstab.appendMeasureToRow":"AdHocCrosstab.appendMeasureToColumn";else{if(!window.localContext.isOlapMode())return d.index=0,t;a=window.adhocDesigner.dimensionsTree.getRootNode().childs.find(function(e){return e.param.extra.id===d.dimensionId}),a.childs[0].param.extra.isHierarchy&&(a=i.find(a.childs,function(e){return e.param.extra.id===u})),l="row"===d.axis?"AdHocCrosstab.appendDimensionToRowAxisWithLevel":"AdHocCrosstab.appendDimensionToColumnAxisWithLevel"}if(void 0===d.allLevels){var m=d;m.allLevels=o.state.getLevelsFromDimension(d.dimensionId,m.axis),m.index=m.allLevels.indexOf(m.level)}return d.allLevels&&(s=window.localContext.isOlapMode()?a.childs.findAll(function(e){return!d.allLevels.include(e.param.extra.id)}):window.adhocDesigner.getAllLeaves(a,window.adhocDesigner.measuresTree).findAll(function(e){return!d.allLevels.include(e.param.extra.id)})),s&&0!==s.length?(n.text=window.adhocDesigner.getMessage(d.isMeasure?"addMeasures":"addLevels"),n.children=s.collect(function(e){return r.createMenuElement("optionAction",{text:e.name,action:l,actionArgs:d.isMeasure?[e.param.extra.id]:[{id:e.param.extra.id,groupId:e.param.extra.dimensionId,isMeasure:!1}]})}),t):t},o.generateAvailableSummaryCalculationsMenu=function(e,t){var n=i.find(t,function(e){return"AdHocCrosstab.selectedMeasureShowsSummaryOptions"===e.clientTest});if(n){var s=r.selObjects[0],a=i.findWhere(window.localContext.state.measures,{name:s.name});a&&window.adhocDesigner.generateAvailableSummaryCalculationsMenu(a.fieldName,n,{action:o.selectFunction,isSelectedTest:o.isSelectedSummaryFunction})}return t},o.getTopBottomFilter=function(){if(void 0===window.localContext.state.crosstab.topBottomFilter){window.localContext.state.crosstab.topBottomFilter=null;var e=window.localContext.state.crosstab.axisTransforms,t=e&&e.ROWS;if(t&&t.length>0)for(var n=0;n<t.length;n++){var o=t[n];if(o&&"com.jaspersoft.commons.dimengine.axistransform.TopOrBottomN"===o.type){window.localContext.state.crosstab.topBottomFilter={path:"/"+o.path.join("/"),type:o.asc?"bottom":"top",aggregateUnranked:o.createOtherBucket,applyAcrossGroups:o.limitAllLevels,limit:o.limit};break}}}return window.localContext.state.crosstab.topBottomFilter},n.exports=o});