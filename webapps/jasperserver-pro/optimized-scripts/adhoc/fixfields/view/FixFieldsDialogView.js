/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","runtime_dependencies/js-sdk/src/common/component/dialog/Dialog","runtime_dependencies/js-sdk/src/components/scalableList/view/ScalableList","bundle!adhoc_messages","text!../template/fixFieldsDialogTemplate.htm","text!../template/missingFieldItemsTemplate.htm"],function(e,t,i){var n=e("underscore"),s=e("jquery"),l=e("runtime_dependencies/js-sdk/src/common/component/dialog/Dialog"),o=e("runtime_dependencies/js-sdk/src/components/scalableList/view/ScalableList"),a=e("bundle!adhoc_messages"),d=e("text!../template/fixFieldsDialogTemplate.htm"),r=e("text!../template/missingFieldItemsTemplate.htm");i.exports=l.extend({defaultTemplate:d,constructor:function(e){e||(e={}),n.defaults(e,{title:a["adhoc.inuse.dialog.title"],modal:!0,resizable:!0,dataNameAttribute:"fixFieldsDialog",buttons:[{label:a["adhoc.inuse.remove.items.button.label"],action:"apply",primary:!0},{label:a.ADH_010_BUTTON_CANCEL,action:"cancel",primary:!1}]}),this.isEmbeddedDesigner=this._getParameterByName("embeddedDesigner"),l.call(this,e);var t=this;this.on("button:apply",n.bind(this._onOKClick,t)),this.on("button:cancel",n.bind(this._onCancelClick,t)),this.fieldList=new o({getData:this._missingFieldDataProvider,itemsTemplate:r,el:this.$el.find(".jr-mListbox-list")})},el:function(){return this.template({title:this.title,additionalCssClasses:this.additionalCssClasses,fields:this.missingFields,bodyInstructions:a["adhoc.inuse.body.instructions"]})},_missingFieldDataProvider:function(e){var t=document.getElementById("missingFieldBuffer"),i=n.filter(n.map(s(t).html().split("<br>"),function(e){return{fieldName:n.trim(e)}}),function(e){return""!==e.fieldName});n.defaults(e,{limit:t.length,offset:0});var l=new s.Deferred,o=Math.min(i.length,e.limit),a=[];return e.offset<i.length&&(a=i.slice(e.offset,e.offset+o)),l.resolve({data:a,total:i.length}),l.promise()},_getParameterByName:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))},_onOKClick:function(){var e=this._getParameterByName("decorate");document.location="flow.html?_flowId=adhocFlow&_flowExecutionKey="+window.flowExecutionKey+"&embeddedDesigner="+window.isEmbeddedDesigner+"&decorate="+e+"&_eventId=fixAndInit"},_onCancelClick:function(){this.close(),window.isEmbeddedDesigner&&-1===document.referrer.indexOf("login.html")?s(document).trigger("adhocDesigner:cancel"):(this.close(),window.history.back())}})});