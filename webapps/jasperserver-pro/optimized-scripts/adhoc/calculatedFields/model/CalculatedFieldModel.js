/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone"],function(e,r,t){var i=e("underscore"),a=e("backbone");t.exports=a.Model.extend({defaults:{fieldName:"",fieldLabel:"",kind:"",type:"",expression:"",summaryFunction:"",summaryExpression:"",summaryParameter:null,availableSummaryFunctions:[],availableFields:[],availableFunctions:[],operators:[]},populateFromField:function(e){this.set({fieldName:e.id,fieldLabel:e.label,expression:e.expression,kind:e.kind,type:e.type,summaryFunction:e.summaryFunction,summaryExpression:e.summaryExpression,summaryParameter:e.summaryParameter,availableSummaryFunctions:e.availableSummaries})},_checkForEmpty:function(e,r){return!(!this.attributes[e]||""===this.attributes[e])||(this.trigger("invalid:"+e,r),!1)},_checkForRestrictedChars:function(e,r){return!/[<>"]/g.test(this.attributes[e])||(this.trigger("invalid:"+e,r),!1)},_checkForReservedWords:function(e,r){return!i.contains(["NOT","AND","IN","OR"],this.attributes[e].trim().toUpperCase())||(this.trigger("invalid:"+e,r),!1)},isLabelValid:function(){var e=!0;return e=this._checkForEmpty("fieldLabel",{errorCode:"adh.calculated.fields.name.empty"})&&e,e=this._checkForRestrictedChars("fieldLabel",{errorCode:"adh.calculated.fields.name.restrictedChars"})&&e,e=this._checkForReservedWords("fieldLabel",{errorCode:"adh.calculated.fields.name.reservedWords"})&&e},isExpressionValid:function(e){if(!e)throw"model.isExpressionValid(attr) requires an attribute!";var r=!0;return r=this._checkForEmpty(e,{errorCode:"adh.calculated.fields.formula.empty"})&&r},isSummaryFunctionValid:function(){var e=!0;return i.contains(this.attributes.availableSummaryFunctions,this.attributes.summaryFunction)||(e=!1),e},isSummaryParameterValid:function(){var e=!0;return e=this._checkForEmpty("summaryParameter",{errorCode:"adh.calculated.fields.summaryParameter.empty"})&&e},isValidField:function(){var e=!0;return e=this.isLabelValid()&&e,e=this.isExpressionValid("expression")&&e,"WeightedAverage"===this.attributes.summaryFunction&&(e=this.isSummaryParameterValid()&&e),"Custom"===this.attributes.summaryFunction&&(e=this.isExpressionValid("summaryExpression")&&e),e},toRequest:function(){var e={label:this.attributes.fieldLabel,display:this.attributes.fieldLabel,expression:this.attributes.expression,kind:this.attributes.kind},r=this.attributes.summaryFunction;return r&&""!==r&&(e.summaryFunction=r),"WeightedAverage"===r?e.summaryParameter=this.attributes.summaryParameter:"Custom"===r&&(e.summaryExpression=this.attributes.summaryExpression),e}})});