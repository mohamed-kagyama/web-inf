/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","./table","../base/designer.base","jquery","./table.ajax","./table.actions","./table.helpers","./table.observers","./table.dnd"],function(e,t,a){var n=e("prototype"),i=n.$,o=e("./table"),l=e("../base/designer.base"),r=e("jquery");e("./table.ajax"),e("./table.actions"),e("./table.helpers"),e("./table.observers"),e("./table.dnd"),o.initOverlays=function(){o.columnLazyInitState={},l.clearOverlaySet(o.columnResizers),l.clearOverlaySet(o.columnOverlays),l.clearOverlaySet(o.summaryOverlays);var e=function(e){var t=r(this).index();!0!==o.columnLazyInitState[t]&&(o.columnLazyInitState[t]=!0,o.initOverlayById(t))};r(window.adhocDesigner.overlayParent).on("mouseover","td",e),r(window.adhocDesigner.overlayParent).on("mouseover","th",e)},o.initOverlayById=function(e){o.initColumnOverlay(e),o.initColumnResizer(e),o.initSummaryOverlay(e)},o.initRowDependentDimensions=function(){o.lastRow=o.theRows.length-1,"NoDataRow"==o.theRows[o.lastRow].id&&(o.lastRow=o.lastRow-1),o.columnHeaderRow=i("columnHeaderRow")},o.initNewRows=function(){if(o.state.endOfFile=i("endOfFileRow")||o.existingRowCount==o.theRows.length,o.theRows=i("canvasTable").rows,window.status="total rows = "+o.theRows.length,this.shouldFetchMoreRows())return void setTimeout(function(){window.localContext.fetchMoreRows()},100);o.initRowDependentDimensions(),o.initOverlays(),o.existingRowCount=o.theRows.length,o.fetchingRows=!1},o.initColumnResizer=function(e){var t=o.columnHeaderRow.cells;if(!(t.length<=e||r("#columnSizer_"+e).length>0)){var a=this.getTableTop(),n=this.getTableHeight(),s=t[e],u=i(s).cumulativeOffset()[0]-i("mainTableContainer").cumulativeOffset()[0]-1,c=u+s.offsetWidth+"px",m=l.createDomObject("DIV","columnSizer");m.writeAttribute("id","columnSizer_"+e),m.setStyle({left:c,top:a,height:n}),o.columnResizers[e]=m,window.adhocDesigner.overlayParent.appendChild(m)}},o.initColumnOverlay=function(e){var t=o.columnHeaderRow.cells;if(!(t.length<=e||r("#columnOverlay_"+e).length>0)){var a=this.getTableTop(),n=this.getTableHeight(),s=t[e];if(i(s).hasClassName("label")){var u=i(s).cumulativeOffset()[0]-i("mainTableContainer").cumulativeOffset()[0]+"px",c=s.offsetWidth+2+"px",m=l.createDomObject("DIV","overlay col");m.writeAttribute("id","columnOverlay_"+e),m.setStyle({left:u,width:c,top:a,height:n}),o.columnOverlays[e]=m,window.adhocDesigner.overlayParent.appendChild(m)}}},o.initSummaryOverlay=function(e){if(i("grandSummaryRow")){var t=i("grandSummaryRow").cells;if(t.length<=e)return;var a=i(t[e]),n=a.cellIndex;if(r("#grandSummaryOverlay_"+n).length>0)return;var s=a.offsetTop+i("canvasTable").offsetTop,u=a.cumulativeOffset()[0]-i("mainTableContainer").cumulativeOffset()[0],c=a.offsetWidth-2,m=a.offsetHeight,d=l.createDomObject("DIV","overlay summary button");d.writeAttribute("id","grandSummaryOverlay_"+n),d.writeAttribute("data-summaryIndex",n),d.setStyle({left:u+"px",width:c+"px",top:s+"px",height:m+"px"}),o.summaryOverlays[e]=d,window.adhocDesigner.overlayParent.appendChild(d)}},a.exports=o});