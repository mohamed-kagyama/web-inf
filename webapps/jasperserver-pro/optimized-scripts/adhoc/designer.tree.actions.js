/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","./designer","runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils"],function(e,r,t){var d=e("underscore"),i=e("./designer"),n=e("runtime_dependencies/jrs-ui/src/dynamicTree/dynamicTree.utils");i.moveToMeasuresOrAttributes=function(e){if(e){var r=Object.isArray(e)?e:[e];e=r.first();var t=e.getTreeId(),n=i[t].getRootNode(),a=0===t.indexOf("dimension")?i.measuresTree:i.dimensionsTree;d.each(r,function(e){i.mergeToDestTree(i.copyParentStructure(e,a),a.getRootNode());for(var r=e;r!=n&&0===r.childs.length;){var t=r.parent;t.removeChild(r),r=t}}),a.resortTree(),a.renderTree(),a.openAndSelectNode(e.param.uri)}},i.addNodeToTree=function(e,r){var t=r.processNode(e);t.isloaded=!0,t.editable=!1,r.rootNode.addChild(t),t.refreshStyle()},i.removeNodeFromTree=function(e){if(!e.parent)throw"The parent node is undefined";var r=e.parent,t=e.param.extra.isMeasure;r.removeChild(e),0===r.childs.length&&!t&&r.parent&&r.parent.removeChild(r)},i.copyParentStructure=function(e,r){if(e&&r){for(var t=n.trees[e.getTreeId()],d=r===i.measuresTree,a=window.localContext.metaNodeBuilder?window.localContext.metaNodeBuilder:i.metaNodeBuilder,o=r.processNode(a(e,d)),s=e.parent,u=null;s&&s!=t.getRootNode();)u=r.processNode(a(s,d)),u.addChild(o),o=u,s=s.parent;return o}},i.mergeToDestTree=function(e,r){if(r){var t=n.trees[r.getTreeId()],d=t.findNodeChildByMetaName(r,e.param.id);null!=d?e.hasChilds()&&e.childs.each(function(e){i.mergeToDestTree(e,d)}):(i.markNodeAsLoaded(e),r.addChild(e))}},i.metaNodeBuilder=function(e,r){var t={id:e.param.id,label:e.name,type:e.param.type,uri:e.param.uri,order:e.orderNumber};if(e.param.extra){var d=Object.extend({},e.param.extra);t.extra=Object.extend(d,{id:e.param.id,isMeasure:r,dimensionId:r?i.MEASURES:e.param.id})}return t},i.markNodeAsLoaded=function(e){e.isloaded=!0,e.isParent()&&e.childs.each(function(e){i.markNodeAsLoaded(e)})},i.getAllLeaves=function(e,r){var t=arguments[2]||[];if(!e){if(!r)return t;if(!(e=r.getRootNode()))return t}if(!e.hasChilds())return t.push(e),t;for(var d=0;d<e.childs.length;d++)this.getAllLeaves(e.childs[d],null,t);return t},i.getFirstLeaf=function(e){if(!e)return null;var r=e;if(!e.childs||0===e.childs.length)return r;for(var t=0;t<e.childs.length;t++)if(r=this.getFirstLeaf(e.childs[t]))return r},i.getNodeByEvent=function(e){return this.measuresTree.getTreeNodeByEvent(e)||this.dimensionsTree.getTreeNodeByEvent(e)},t.exports=i});