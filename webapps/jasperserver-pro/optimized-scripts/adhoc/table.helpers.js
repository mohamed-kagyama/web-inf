/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","jquery","../base/designer.base","./table","underscore","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator"],function(e,n,t){var o=e("prototype"),r=o.$,i=e("jquery"),s=e("../base/designer.base"),l=e("./table"),d=e("underscore"),a=e("runtime_dependencies/jrs-ui/src/util/utils.common"),c=a.isIPad,u=a.isAlmostInView,w=e("runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator");l.canAddFieldAsColumn=function(e){return!0},l.isSpacer=function(e){return e==s.SPACER_NAME},l.canAddAsColumn=function(){return d.all(window.selObjects,function(e){return!!e.param&&l.canAddFieldAsColumn(e.param.id)})},l.canMoveColumnsLeft=function(){return l.getLeftMostPositionFromSelectedColumns()>0},l.canMoveColumnsRight=function(){return l.getRightMostPositionFromSelectedColumns()<l._getTableHeaders().length-1},l.canAddFilter=function(e,n){return window.adhocDesigner.isSpacerSelected(e)?(n&&n.push(window.addFilterErrorMessageSpacerAdd),!1):window.adhocDesigner.isPercentOfParentCalcSelected(e)?(n&&n.push(window.addFilterErrorMessagePercentOfParentCalcFieldAdd),!1):window.adhocDesigner.isConstantSelected(e)?(n&&n.push(window.addFilterErrorMessageConstantAdd),!1):!window.adhocDesigner.isMeasureSelected(e)||(n&&n.push(window.addFilterErrorMessageMeasureAdd),!1)},l.getLeftMostPositionFromSelectedColumns=function(){var e=window.selObjects.length;if(e>0){for(var n=window.adhocDesigner.getSelectedColumnOrGroup(),t=n.index,o=1;o<e;o++){var r=window.selObjects[o].index;r<t&&(t=r)}return parseInt(t)}return-1},l.getRightMostPositionFromSelectedColumns=function(){var e=window.selObjects.length;if(e>0){for(var n=window.adhocDesigner.getSelectedColumnOrGroup(),t=n.index,o=1;o<e;o++){var r=window.selObjects[o].index;r>t&&(t=r)}return parseInt(t)}return-1},l.getNewColumnWidth=function(e,n){var t=i(e),o=i(window.localContext._getTableHeaders()[n]),r=t.offset().left,s=o.offset().left;return Math.max(r-s,l.MINIMUM_COL_WIDTH)},l.setColumnWidth=function(e,n){i("#canvasTableCols col").eq(e).width(n);var t=i(window.localContext._getTableHeaders()[e]);return t.css({minWidth:Number(n)}),t[0]},l.isSelectedColumnType=function(e){return window.localContext.getSelectedColumnType()==e},l.getSelectedColumnType=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e?e.model.numericType:window.adhocDesigner.NaN},l.hasColumns=function(){var e=!1;return l.theCols=r("canvasTableCols").getElementsByTagName("col"),l.theCols&&(e=l.theCols.length>0),e},l.hasGroups=function(){return window.localContext.state.groups.length>0},l.isFetchingRows=function(){return l.fetchingRows},l.shouldFetchMoreRows=function(){return(l.hasColumns()||l.hasGroups())&&window.localContext.state.isShowingFullData&&!window.localContext.state.endOfFile&&l.theRows.length<window.adhocDesigner.ROW_SIZE_TO_TRIGGER_SCROLLBAR},l.tableScrolled=function(){if(window.localContext.getMode()===s.TABLE&&window.localContext.state.isShowingFullData&&!window.localContext.state.endOfFile&&!l.isFetchingRows()){(c()?window.adhocDesigner._touchController.isBottom():u(l.theRows[l.lastRow],l.ALMOST_IN_VIEW_OFFSET))&&window.localContext.fetchMoreRows()}},l.isTotalsOnly=function(){var e=window.localContext.state.table;return e.showTableTotals&&!e.showTableDetails},l.selectedColumnCanAddSummary=function(){return!l.isTotalsOnly()&&!window.adhocDesigner.hasSpacerInSelection()&&!l.selectedColumnHasSummary()},l.selectedColumnCanRemoveSummary=function(){return!l.isTotalsOnly()&&l.selectedColumnHasSummary()},l.selectedColumnHasSummary=function(){return 1===window.selObjects.length&&window.localContext.state.columns[s.getSelectedObject().index].showSummary},l.selectedColumnShowsSummaryOptions=function(){return l.selectedColumnHasSummary()&&l.selectedMeasureShowsSummaryOptions()},l.selectedMeasureShowsSummaryOptions=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return!!e&&!!window.localContext.state.columns[e.index]},l.isSelectedMeasureNumeric=function(){return l.isSelectedColumnType("int")||l.isSelectedColumnType("dec")},l.isSelectedSummaryFunction=function(e){var n=w.selObjects[0];return n&&n.summaryFunction===e},l.isSelectedTimeSummaryFunction=function(e){var n=w.selObjects[0];return n&&n.summaryTimeFunction===e},l.functionSelected=function(e){if(window.selObjects.length>0){var n=s.getSelectedObject().index;window.localContext.setSummaryFunction(e,n)}},l.timeFunctionSelected=function(e){if(window.selObjects.length>0){var n=s.getSelectedObject().index;window.localContext.setTimeSummaryFunction(e,n)}},l.selectedFieldUsedForSorting=function(){var e=s.getSelectedObject(),n=window.adhocDesigner.getNameForSelected(e);return l.usedInSorting(n)},l.selectedFieldCouldBeUsedForSorting=function(){return!(window.adhocDesigner.hasSpacerInSelection()||window.adhocDesigner.hasGroupInSelection()||l.selectedFieldUsedForSorting()||s.isSelectedNodeAFolder()||window.adhocDesigner.isAggregateSelected())},l.selectedColumnUsedForSorting=function(){return!!window.localContext.state.inDesignView&&window.selObjects.any(function(e){return l.usedInSorting(e.model.name)})},l.selectedColumnCouldBeUsedForSorting=function(){return!!window.localContext.state.inDesignView&&(!l.selectedColumnUsedForSorting()&&!window.adhocDesigner.hasSpacerInSelection()&&!window.adhocDesigner.isAggregateSelected())},l.usedInSorting=function(e){if(null!=window.localContext.state.sortFields)for(var n=window.localContext.state.sortFields,t=0;t<n.length;t++)if(n[t].name==e)return!0;return!1},l.canAddAsGroup=function(){return(!window.selObjects[0]||!window.selObjects[0].parent||"measuresTree"!=window.selObjects[0].parent.treeId)&&!(window.adhocDesigner.hasSpacerInSelection()||window.adhocDesigner.multiSelect||window.adhocDesigner.isSelectedTreeNodeAFolder()||window.adhocDesigner.isPercentOfParentCalcSelected())},l.canSwitchToGroup=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e&&"dimension"===e.ftype},l.canMoveGroupUp=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e&&e.index>0},l.canMoveGroupDown=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup(),n=window.localContext.state.groups.length;return e&&e.index<n-1},l.isSelectedGroupType=function(e){return l.getSelectedGroupType()===e},l.getSelectedGroupType=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e?e.dataType:window.adhocDesigner.NaN},l.canAddGroupLabelToSelected=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();if(e){return e.label.blank()}return!1},l.canGroupSetMask=function(){return l.getSelectedGroupType()!=window.adhocDesigner.NaN},l.isGroupMaskSelected=function(e){return l.getMaskForSelectedGroup()==e.unescapeHTML()},l.isSelectedGridMode=function(e){var n=window.localContext.state.table;switch(e){case"d":return n.showTableDetails&&!n.showTableTotals;case"t":return!n.showTableDetails&&n.showTableTotals;case"dt":return n.showTableDetails&&n.showTableTotals;default:throw"Unknown Grid Selector Mode: "+e}},l.isShowDistinctRowValues=function(){return window.localContext.state.table.showDistinctRowValues},l.isHideDistinctRowValues=function(){return!window.localContext.state.table.showDistinctRowValues},l.getMaskForSelectedGroup=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();return e&&e.mask},l.canColumnSetMask=function(){return window.localContext.getSelectedColumnType()!=window.adhocDesigner.NaN},l.isColumnMaskSelected=function(e){return l.getMaskForSelectedColumn()===e.unescapeHTML()},l.getMaskForSelectedColumn=function(){return window.adhocDesigner.getSelectedColumnOrGroup().header.getAttribute("data-mask")},l.canEditColumnHeaderForSelected=function(){return!l.selectedHasNoColumnHeader()&&!window.adhocDesigner.hasSpacerInSelection()},l.canAddColumnHeaderToSelected=function(){return l.selectedHasNoColumnHeader()&&!window.adhocDesigner.hasSpacerInSelection()},l.selectedHasNoColumnHeader=function(){return window.adhocDesigner.getSelectedColumnOrGroup().header.hasClassName("deletedHeader")},l.getTableTop=function(){var e=i("#canvasTable"),n=e.find(".caption").height();return e.position().top+n+"px"},l.getTableHeight=function(){var e=i("#canvasTable"),n=e.find("tbody");return n.first().height()+n.last().height()+2+"px"},window.AdHocTable=l,t.exports=l});