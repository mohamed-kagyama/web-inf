/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","dragdropextra","prototype","./table","../base/designer.base","runtime_dependencies/jrs-ui/src/util/utils.common","underscore","jquery","./designer.sort"],function(e,o,l){var n=e("dragdropextra"),t=n.Draggable,d=e("prototype"),a=d.$,r=e("./table"),i=e("../base/designer.base"),s=e("runtime_dependencies/jrs-ui/src/util/utils.common"),c=s.isIPad,u=e("underscore"),m=e("jquery"),w=e("./designer.sort"),g=document.body;r.addFieldAsColumn=function(e){var o=window.adhocDesigner.getSelectedTreeNodes(),l=window.adhocDesigner.collectFields(o,e,r.canAddFieldAsColumn),n=r.hoverColumn>-1?r.hoverColumn:-1;r.addFieldAsColumnAtPosition(l,n)},r.addThisFieldAsColumn=function(e){var o=r._getTableHeaders().length;r.addFieldAsColumnAtPosition(e,o)},r.moveColumnLeft=function(e){var o=window.localContext.getLeftMostPositionFromSelectedColumns(),l=o-1;window.localContext.moveColumn(o,l,e)},r.moveColumnRight=function(e){var o=window.localContext.getLeftMostPositionFromSelectedColumns(),l=o+1;window.localContext.moveColumn(o,l,e)},r.updateSelectedIndexes=function(e){for(var o=0;o<window.selObjects.length;o++)window.selObjects[o].index=(+window.selObjects[o].index+e).toString()},r.resizeColumnWhenSizerDrag=function(e){if(e.match("#designer .columnSizer")){var o=e.readAttribute("id");g.style.cursor="col-resize";i.TABLE_SELECT_AREA;window.adhocDesigner.overlayDraggedColumn=new t(o,{constraint:"horizontal",onStart:function(){r.draggingColumnSizer=!0,r.activateColumnSizer(o)},onEnd:function(e,l){var n=e.element,t=a(n).readAttribute("id"),d=r.digitRegex.exec(t)[0],i=r.getNewColumnWidth(n,d),s=r.setColumnWidth(d,i);r.deactivateColumnSizer(o),window.localContext.tableColumnResize(parseInt(m(s).outerWidth(),10),d),r.draggingColumnSizer=!1}})}},r.selectTableColumn=function(e,o){r.deselectAllSummaryCells(),r.deselectAllColumnGroupRows();var l=window.adhocDesigner.isMultiSelect(e,i.COLUMN_LEVEL),n=window.adhocDesigner.isAlreadySelected(o),t=o.index,d="columnOverlay_"+t;a(d)||r.initOverlayById(t),n?l?a(d)&&(a(d).removeClassName("selected").removeClassName("over"),r.removeFromSelectObjects(t)):(!c()&&r.deselectAllTableColumns(),a(d).addClassName("selected"),window.adhocDesigner.addSelectedObject(e,o,l,n),window.selectionCategory.area=i.COLUMN_LEVEL,!c()&&r.createDraggableColumn(a(d).identify())):(l||u.each(r.columnOverlays,function(e){a(e).removeClassName("selected").removeClassName("over")}),a(d)&&a(d).addClassName("selected"),window.adhocDesigner.addSelectedObject(e,o,l,n),window.selectionCategory.area=i.COLUMN_LEVEL,!c()&&window.isDesignView&&r.createDraggableColumn(a(d).identify()))},r.deselectTableColumn=function(e,o){var l={},n="columnOverlay_"+o;a(n)&&(a(n).removeClassName("selected"),a(n).removeClassName("over"),l.header=window.localContext._getTableHeaders()[o],l.index=o)},r.deselectAllTableColumns=function(){for(var e=window.localContext._getTableHeaders(),o=e.length,l=0;l<o;l++)r.deselectTableColumn(null,l),r.removeFromSelectObjects(l)},r.columnMaskSelected=function(e){var o=window.adhocDesigner.getSelectedColumnOrGroup();o&&window.localContext.setMask(e,o.index)},r.removeColumnHeaderRequest=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();e&&window.localContext.setColumnHeaderToNull(e.index)},r.launchSortingDialogForColumn=function(e){var o=window.selObjects;if(!o&&window.adhocDesigner.getSelectedTreeNodes().length&&(o=window.adhocDesigner.getSelectedTreeNodes()),o){var l=[];m(o).each(function(){l.push(window.adhocDesigner.getNameForSelected(this))}),w.launchDialog(l)}},r.cleanupOnSwitch=function(){w.hideDialog()},r.moveGroupUp=function(e){function o(){r.updateSelectedIndexes(-1),e&&e()}var l=window.adhocDesigner.getSelectedColumnOrGroup();if(l){var n=parseInt(l.index),t=n-1;window.localContext.moveGroup(n,t,o)}},r.moveGroupDown=function(e){function o(){r.updateSelectedIndexes(1),e&&e()}var l=window.adhocDesigner.getSelectedColumnOrGroup();if(l){var n=parseInt(l.index),t=n+1;window.localContext.moveGroup(n,t,o)}},r.selectGroup=function(e,o){var l=o.id,n=(o.index,window.adhocDesigner.isMultiSelect(e,i.GROUP_LEVEL));window.selectionCategory.area=i.GROUP_LEVEL;var t=window.adhocDesigner.isAlreadySelected(o);t?(r.deselectAllColumnGroupRows(),a(l)&&a(l).addClassName("selected"),window.adhocDesigner.addSelectedObject(e,o,n,t)):(r.deselectAllColumnGroupRows(),r.deselectAllTableColumns(),r.deselectAllSummaryCells(),a(l)&&(a(l).addClassName("selected"),!c()&&r.createDraggableGroup(l)),window.adhocDesigner.addSelectedObject(e,o,n,t))},r.deselectAllColumnGroupRows=function(){i.deselectOverlaySet(r.groupOverlays,"selected"),i.deselectOverlaySet(r.groupOverlays,"pressed")},r.editGroupLabel=function(){window.adhocDesigner.getSelectedColumnOrGroup()&&window.adhocDesigner.editDataHeader(null,"tableGroup")},r.removeGroupLabel=function(){var e=window.adhocDesigner.getSelectedColumnOrGroup();if(e){var o=e.index;window.localContext.setGroupLabelToNull(o)}},r.groupMaskSelected=function(e){var o=window.adhocDesigner.getSelectedColumnOrGroup(),l=o.index;o&&window.localContext.setGroupMask(e,l)},r.selectGrandRowCell=function(e,o){r.deselectAllTableColumns(),r.deselectAllColumnGroupRows(),window.selectionCategory.area=i.SUMMARY_LEVEL;var l=a("grandSummaryRow").cells,n={element:l[o],index:o,model:window.localContext.state.table.columns[o]},t="grandSummaryOverlay_"+o,d=window.adhocDesigner.isAlreadySelected(n);d||(r.deselectAllSummaryCells(),a(t)&&a(t).addClassName("selected"),window.adhocDesigner.addSelectedObject(e,n,!1,d))},r.deselectAllSummaryCells=function(){i.deselectOverlaySet(r.summaryOverlays,"selected")}});