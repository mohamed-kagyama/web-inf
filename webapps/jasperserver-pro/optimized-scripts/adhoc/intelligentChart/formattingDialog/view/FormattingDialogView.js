/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","backbone","bundle!adhoc_messages","../view/AdvancedSectionView","./appearanceTab/AppearanceTabWrapper","text!../template/FormattingDialogTemplate.htm","text!../template/AxisSectionTemplate.htm","text!../template/LabelsSectionTemplate.htm","runtime_dependencies/jrs-ui/src/components/components.dialogs"],function(e,t,a){var o=e("underscore"),i=e("jquery"),s=e("backbone"),l=e("bundle!adhoc_messages"),r=e("../view/AdvancedSectionView"),n=e("./appearanceTab/AppearanceTabWrapper"),d=e("text!../template/FormattingDialogTemplate.htm"),c=e("text!../template/AxisSectionTemplate.htm"),p=e("text!../template/LabelsSectionTemplate.htm"),h=e("runtime_dependencies/jrs-ui/src/components/components.dialogs"),u=["seriesColors","showDataPoints","showScatterLine","advancedProperties","chartBackgroundColor","plotBackgroundColor"],g=function(e){return o.omit(e.toJSON(),u)};a.exports=s.View.extend({template:o.template(d),el:"#chartFormatDialog",events:{"click .applyButton":"_apply","click .okButton":"_ok","click .cancelButton":"_cancel","click ul.tabSet .tab":"_switchTab","change select#legend":"_disableLegendBorderControl","change input#showSingleMeasuresLabels":"_disableMeasureNamesControl"},open:function(){this.render(),h.popup.show(this.el,!1,{useJQueryForDraggable:!0})},setState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.model.set(e)},render:function(){var e=this.model.toJSON();this.previousModelState=e,this.advancedSectionView&&this.advancedSectionView.remove(),this.appearanceTab&&this.appearanceTab.remove(),this.$el.empty(),this.$el.html(this.template({i18n:l})),this.$el.find("#axisSection").html(o.template(c)({i18n:l})),this.$el.find("#labelsSection").html(o.template(p)({i18n:l}));var t={showDataPoints:e.showDataPoints,showScatterLine:e.showScatterLine,seriesColors:e.seriesColors,chartBackgroundColor:e.chartBackgroundColor,plotBackgroundColor:e.plotBackgroundColor,gaugesLayout:this.model.get("gaugesLayout"),gaugesLayoutOptions:[{value:"bestFit",label:l.ADH_1214_ICHARTS_CHART_FORMAT_DIALOG_GAUGES_LAYOUT_BEST_FIT},{value:"horizontal",label:l.ADH_1214_ICHARTS_CHART_FORMAT_DIALOG_GAUGES_LAYOUT_HORIZONTAL},{value:"vertical",label:l.ADH_1214_ICHARTS_CHART_FORMAT_DIALOG_GAUGES_LAYOUT_VERTICAL}],gaugesMinValue:this.model.get("gaugesMinValue"),gaugesMaxValue:this.model.get("gaugesMaxValue"),gaugesDecimalPlaces:this.model.get("gaugesDecimalPlaces"),gaugesSuffixLabel:this.model.get("gaugesSuffixLabel"),gaugeStopColor1Value:this.model.get("gaugeStopColor1Value"),gaugeStopColor2Value:this.model.get("gaugeStopColor2Value"),gaugeStopColor3Value:this.model.get("gaugeStopColor3Value"),gaugeStopColor4Value:this.model.get("gaugeStopColor4Value"),gaugeStopColor1Color:this.model.get("gaugeStopColor1Color"),gaugeStopColor2Color:this.model.get("gaugeStopColor2Color"),gaugeStopColor3Color:this.model.get("gaugeStopColor3Color"),gaugeStopColor4Color:this.model.get("gaugeStopColor4Color")};return this.appearanceTab=new n(this.$el.find("#appearanceSection")[0],t),this.advancedSectionView=new r,this.advancedSectionView.reset(this.model.get("advancedProperties")),this.$el.find("#advancedSection").html(this.advancedSectionView.$el),this._renderFields(),this},_renderFields:function(){var e=g(this.model);this.inputFields={},o.each(e,function(e,t){var a=this.$el.find("#"+t);"checkbox"===a.attr("type")?(this.inputFields[t]=a.prop("checked",e),"showMeasureOnValueAxis"===t&&(this.model.get("showSingleMeasuresLabels")?this.inputFields[t].prop("disabled",!1).parent().removeClass("disabled"):this.inputFields[t].prop("disabled",!0).parent().addClass("disabled"))):this.inputFields[t]=a.val(e)},this)},_updateModel:function(){var e=this._extractData();this.model.set(e,{validate:!0})},_isFormValid:function(){return this.$el.find("#axisSection .error").removeClass("error"),this.$el.find("#labelsSection .error").removeClass("error"),this.$el.find("#advancedSection .error").removeClass("error"),this.model.isValid()},_revertInputs:function(){o.each(this.model.validationError,function(e,t){this.$el.find("#"+t).val(this.model.get(t))},this)},_apply:function(){this._updateModel(),this._isFormValid()&&this.model.applyModel()},_ok:function(){this._updateModel(),this._isFormValid()&&(this.model.applyModel(),h.popup.hide(this.el))},_cancel:function(){this.model.rollbackChangesAfterApply(this.previousModelState),h.popup.hide(this.el)},_switchTab:function(e){if(this._updateModel(),this._isFormValid(),0)this._revertInputs();else{this.$el.find("ul.tabSet li.tab").removeClass("selected");var t=this.$el.find(e.currentTarget);t.addClass("selected"),t.children("a").removeClass("over");var a=t.attr("id"),o=a.substring(0,a.indexOf("Tab"));this.$el.find("div.body.section.noTitle").addClass("hidden"),this.$el.find("#"+o+"Section").removeClass("hidden")}this._resetAdvancedTab()},_resetAdvancedTab:function(){this.advancedSectionView.resetState()},_extractData:function(){var e=g(this.model),t={};return o.each(e,function(e,a){var o=this.inputFields[a];o.length&&("checkbox"===o.attr("type")?t[a]=o.prop("checked"):t[a]=o.val())},this),o.extend({},t,this.appearanceTab.getState(),{advancedProperties:this.advancedSectionView.toJSON()})},_disableMeasureNamesControl:function(e){var t=this.$el.find("input#showMeasureOnValueAxis");i(e.currentTarget).is(":checked")?t.prop("checked",this._tmpPreviousStateShowMeasureOnValueAxis).prop("disabled",!1).parent().removeClass("disabled"):(this._tmpPreviousStateShowMeasureOnValueAxis=t.prop("checked"),t.prop("checked",!1).prop("disabled",!0).parent().addClass("disabled"))},_disableLegendBorderControl:function(e){var t=this.$el.find("input#legendBorder");"none"===i(e.currentTarget).val()?t.prop("disabled",!0).parent().addClass("disabled"):t.prop("disabled",!1).parent().removeClass("disabled")},remove:function(){this.advancedSectionView.remove(),this.appearanceTab.remove(),s.View.prototype.remove.call(this)}})});