/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","underscore","./chart.helpers","runtime_dependencies/jrs-ui/src/util/utils.common","../base/designer.base","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/jrs-ui/src/core/core.layout"],function(e,t,a){var n=e("prototype"),r=n.$,i=n.$$,s=e("underscore"),o=e("./chart.helpers"),l=e("runtime_dependencies/jrs-ui/src/util/utils.common"),u=l.isIPad,c=e("../base/designer.base"),d=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),h=e("runtime_dependencies/jrs-ui/src/core/core.layout");o.showChartMenu=function(e,t){u()?window.adhocDesigner.showDynamicMenu(e,t,{menuLeft:e.changedTouches[0].clientX,menuTop:e.changedTouches[0].clientY-100}):window.adhocDesigner.showDynamicMenu(e,t,{menuLeft:e.clientX,menuTop:e.clientY-100})},o.getCurrentMeasure=function(){if(1==window.localContext.state.numberOfMeasures||o.isPie())return 0;var e=c.getSelectedObject(),t=e.index;return isNaN(t)?-1:parseInt(t)},o.addFieldAsMeasure=function(e,t){var a="";if(s.isNumber(t)||(t=o.hoverLegendIndex),window.selObjects.length>0){var n=window.adhocDesigner.getSelectedTreeNodes();a=window.adhocDesigner.collectFields(n,e),o.supportsSeries()?s.isNumber(t)&&t>-1?o.addAsMeasure(a,t):o.addAsLastMeasure(a):o.replaceMeasure(a)}},o.addFieldAsGroup=function(){var e=c.getSelectedObject();if(e){var t=window.adhocDesigner.getNameForSelected(e);o.setGroup(t)}},o.functionSelected=function(e,t){t||(t=o.getCurrentMeasure());var a=o.getUpdatedMeasureType(e);a?o.setSummaryFunctionAndMask(e,defaultMasks[a],t):o.setSummaryFunction(e,t)},o.getUpdatedMeasureType=function(e){var t=window.localContext.getMeasureType(e);return t!=window.localContext.state.dataTypes[o.getCurrentMeasure()]?t:null},o.getMeasureType=function(e){return"Count"==e||"DistinctCount"==e?"int":window.localContext.state.dataTypes[o.getCurrentMeasure()]},o.maskSelected=function(e,t){t||(t=o.getCurrentMeasure()),o.setMask(e,t)},o.deselectAllSelectedOverlays=function(){i(window.adhocDesigner.LEGEND_OVERLAY_PATTERN).each(function(e){r(e)&&(d.unSelect(r(e)),u()&&(r(e).removeClassName(h.HOVERED_CLASS),r(e).removeClassName(h.PRESSED_CLASS)))})},o.getNewChartPositionAndMove=function(){var e=r("chartBorder"),t=null,a=null,n=null,i=null,s=!1;if(e){if(n=e.positionedOffset(),i=e.cumulativeScrollOffset(),o.isContentPageSize())t=n[0]+i[0],a=n[1]+i[1],t<0&&(t=0),a<o.getTitleBottom()&&(a=o.getTitleBottom());else{var l=n[0]+o.getChartWidth(),u=n[1]+o.getChartHeight();l>window.localContext.state.availableChartWidth?(t=window.localContext.state.availableChartWidth-o.getChartWidth(),t+=i[0],s=!0):t=n[0]+i[0],u>window.localContext.state.availableChartHeight?(a=window.localContext.state.availableChartHeight-o.getChartHeight(),a+=i[1],s=!0):a=n[1]<0?o.getTitleBottom():n[1]+i[1],t<0&&(t=0),a<o.getTitleBottom()&&(a=o.getTitleBottom()),s&&moveTo(window.chartContainer,t,a,null)}o.moveChart(t,a)}},o.computeDimensions=function(e,t){var a=null,n=null,i=r("chartBorder"),s=null;return i&&(a=isNaN(e)?parseInt(i.getStyle("width")):e,n=isNaN(t)?parseInt(i.getStyle("height")):t,o.isContentPageSize()||(a>o.state.availableChartWidth-o.state.chartX&&(a=o.state.availableChartWidth-o.state.chartX),n>o.state.availableChartHeight-o.state.chartY&&(n=o.state.availableChartHeight-o.state.chartY)),a=a<o.MIN_CHART_WIDTH?o.MIN_CHART_WIDTH:a,n=n<o.MIN_CHART_HEIGHT?o.MIN_CHART_HEIGHT:n,s=[a,n]),s},a.exports=o});