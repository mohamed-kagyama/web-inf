/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","runtime_dependencies/js-sdk/src/common/component/tree/Tree","jquery","underscore","runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer","runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","runtime_dependencies/bi-repository/src/bi/repository/util/resourcesTreeGetDataUriFnUtil","runtime_dependencies/bi-repository/src/bi/repository/util/extractRootLevelDataFromHtmlResponse","text!../template/repositoryFoldersTreeLevelTemplate.htm","bundle!CommonBundle","runtime_dependencies/js-sdk/src/jrs.configs"],function(e,r,t){function o(e){var r=2;return e.isWritable&&(r|=4),e.isRemovable&&(r|=16),e.isAdministrable&&(r=1),r}var n=e("runtime_dependencies/js-sdk/src/common/component/tree/Tree"),s=(e("jquery"),e("underscore")),i=e("runtime_dependencies/js-sdk/src/common/component/tree/TreeDataLayer"),l=e("runtime_dependencies/js-sdk/src/common/component/tree/plugin/TooltipPlugin"),c=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),a=e("runtime_dependencies/bi-repository/src/bi/repository/util/resourcesTreeGetDataUriFnUtil"),u=e("runtime_dependencies/bi-repository/src/bi/repository/util/extractRootLevelDataFromHtmlResponse"),p=e("text!../template/repositoryFoldersTreeLevelTemplate.htm"),d=e("bundle!CommonBundle"),m=e("runtime_dependencies/js-sdk/src/jrs.configs"),f={folderTreeProcessor:{processItem:function(e){return e._node=!0,e._readonly=!(1==e.value.permissionMask||4&e.value.permissionMask),e}},filterPublicFolderProcessor:{processItem:function(e){if(e.value.uri!==y.settings.publicFolderUri&&e.value.uri!==y.settings.tempFolderUri)return e}},i18n:{processItem:function(e){return e.i18n=d,e}},tenantProcessor:{processItem:function(e){return e._node=!0,e.value.label=e.value.tenantName,e.value.uri=e.value.tenantUri,e}}},y=function(e){return e=e||{},n.use(l,{i18n:d,contentTemplate:e.tooltipContentTemplate}).create().instance({additionalCssClasses:"folders",getDataUri:a({getFolderUri:function(e){return"@fakeRoot"===e?"":e},contextPath:e.contextPath,type:[c.FOLDER]}),levelDataId:"uri",bufferSize:e.treeBufferSize||5e3,itemsTemplate:p,collapsed:!0,lazyLoad:!0,rootless:!0,selection:{allowed:!0,multiple:!1},customDataLayers:{"/":s.extend(new i({dataUriTemplate:e.contextPath+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:s.chain(f).omit("filterPublicFolderProcessor","tenantProcessor").values().value(),getDataArray:function(e){e=u(e);var r=s.find(e.children,function(e){return"/public"===e.uri}),t=[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",permissionMask:o(e.extra),_links:{content:"@fakeContentLink"}}];return r&&t.push({id:"/public",label:r.label,uri:"/public",resourceType:"folder",permissionMask:o(r.extra),_links:{content:"@fakeContentLink"}}),t}}),{accept:"text/html",dataType:"text"})},processors:[f.i18n,f.folderTreeProcessor,f.filterPublicFolderProcessor],getDataArray:function(e,r,t){return e?e[c.RESOURCE_LOOKUP]:[]}})};y.settings=m,t.exports=y});