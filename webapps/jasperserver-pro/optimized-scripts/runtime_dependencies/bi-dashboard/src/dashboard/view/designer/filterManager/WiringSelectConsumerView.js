/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy","bundle!DashboardBundle","bundle!CommonBundle","text!../../../template/filterManager/wiringSelectConsumerTemplate.htm","text!../../../template/filterManager/wiringConsumerOptionTemplate.htm"],function(e,t,i){function a(){var e=n.template(h),t="";return n.isUndefined(this.model.get("id"))&&(t+=e({label:d["dashboard.filter.manager.select.dashlet"],value:void 0,title:void 0})),n.each(this.consumers,function(i){t+=e({label:i.name,value:i.id,title:void 0})}),t}function r(){var e=n.findWhere(this.consumers,{id:this.model.get("id")}),t=n.template(h),i="",a=this,r=[];return this.model.collection.each(function(e){e===a.model||n.isUndefined(e.get("id"))||n.isUndefined(e.get("parameter"))||r.push(e.get("id")+":"+e.get("parameter"))}),(n.isUndefined(this.model.get("parameter"))||e&&!n.contains(n.pluck(e.parameters,"id"),this.model.get("parameter")))&&(i+=t({label:d["dashboard.filter.manager.select.parameter"],value:void 0,title:d["dashboard.filter.manager.select.parameter"]})),e&&n.each(e.parameters,function(e){-1===n.indexOf(r,a.model.get("id")+":"+e.id)&&(i+=t({label:e.label,value:e.id,title:m["tooltip.parameter"]+" "+e.id}))}),i}var n=e("underscore"),l=e("backbone"),s=e("runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy"),d=e("bundle!DashboardBundle"),m=e("bundle!CommonBundle"),o=e("text!../../../template/filterManager/wiringSelectConsumerTemplate.htm"),h=e("text!../../../template/filterManager/wiringConsumerOptionTemplate.htm");i.exports=s.extend({el:n.template(o,{i18n:n.extend(m,d)}),constructor:function(e){e||(e={}),this.consumers=e.consumers,l.View.apply(this,arguments)},initialize:function(){this.listenTo(this.model,"change:parameter",this.setParameterLabel),this.setParameterLabel(),s.prototype.initialize.apply(this,arguments)},render:function(){return this.$("select[name='id']").html(a.call(this)),this.$("select[name='parameter']").html(r.call(this)),s.prototype.render.apply(this,arguments)},setParameterLabel:function(){var e,t=n.findWhere(this.consumers,{id:this.model.get("id")});t&&(e=n.findWhere(t.parameters,{id:this.model.get("parameter")}))&&this.model.set("parameterLabel",e.label)}})});