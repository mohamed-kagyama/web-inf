/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy","./WiringConsumerCollectionView","underscore","bundle!DashboardBundle","bundle!CommonBundle","../../../enum/dashboardComponentTypes","./WiringSelectConsumerView","../../../model/filterManager/WiringConsumerViewModel","./WiringRemoveConsumerView","text!../../../template/filterManager/wiringProducerTemplate.htm"],function(e,o,n){var t=e("runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy"),i=e("./WiringConsumerCollectionView"),r=e("underscore"),s=e("bundle!DashboardBundle"),m=e("bundle!CommonBundle"),l=e("../../../enum/dashboardComponentTypes"),d=e("./WiringSelectConsumerView"),u=e("../../../model/filterManager/WiringConsumerViewModel"),c=e("./WiringRemoveConsumerView"),a=e("text!../../../template/filterManager/wiringProducerTemplate.htm");n.exports=t.extend({events:{"blur > .filterColumn > input":"checkNewProducerName","click > .addConsumerColumn > button.add":"addConsumer","click > .removeConsumerColumn > button.delete":"removeProducer"},computeds:{isHidden:function(){return!this.model.component.isVisible()}},constructor:function(e){e.template=a,e.i18n=r.extend(m,s),t.prototype.constructor.call(this,e)},initialize:function(e){var o=this;t.prototype.initialize.call(this,e),this.selectConsumersCollectionView=new i({collection:this.model.consumers,el:this.$(".selectConsumerColumn > .consumerTable > tbody"),modelView:d,modelViewOptions:{consumers:e.consumers}}),this.removeConsumersCollectionView=new i({collection:this.model.consumers,el:this.$(".removeConsumerColumn > .consumerTable > tbody"),modelView:c}),this.listenTo(this.model.consumers,"add remove",this.toggleRemoveProducerButton),this.listenTo(this.model,"change",function(){o.model.isValid(!0)})},render:function(){return t.prototype.render.apply(this,arguments),this.selectConsumersCollectionView.render(),this.removeConsumersCollectionView.render(),this.toggleRemoveProducerButton(),this},checkNewProducerName:function(){if(this.model.isValid(!0)){this.model.component.set("name",this.model.component.generateName(this.model.get("name")));var e=this.model.component.generateId();this.model.component.set("id",e),this.model.set({parameter:e,id:e+":"+e,label:this.model.component.get("name"),parameterPublicName:e})}},removeProducer:function(){this.model.trigger("destroy",this.model,this.model.collection)},addConsumer:function(){this.model.consumers.add(new u({},{collection:this.model.consumers}))},toggleRemoveProducerButton:function(){this.$("> .removeConsumerColumn > button.delete")[this.model.component.get("type")!==l.VALUE||this.model.consumers.length?"hide":"show"]()},remove:function(){this.selectConsumersCollectionView.remove(),this.removeConsumersCollectionView.remove(),t.prototype.remove.apply(this,arguments)}})});