/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","runtime_dependencies/bi-report/src/bi/report/enum/scaleStrategies","backbone"],function(e,t,n){function i(e){return{display:"table-cell","font-weight":e.get("bold")?"bold":"normal","font-style":e.get("italic")?"italic":"normal","text-decoration":e.get("underline")?"underline":"normal","font-family":e.get("font")||"inherit",color:e.get("color"),"text-overflow":1==e.get("scaleToFit")?"ellipsis":"","background-color":e.get("backgroundColor")}}var o=e("underscore"),s=e("jquery"),l=e("runtime_dependencies/bi-report/src/bi/report/enum/scaleStrategies"),r=e("backbone");n.exports=r.View.extend({initialize:function(){o.bindAll(this,"applyFontSize"),this.$el.css({"white-space":"nowrap",overflow:"hidden","line-height":1}),this.$content=s("<span></span>"),this.$el.append(this.$content),s(window).on("resize",this.applyFontSize)},remove:function(){s(window).off("resize",this.applyFontSize)},applyFontSize:function(e){function t(){u["text-align"]="center",u.fontSize=s()+"px",p.$content.css("padding",m*x+"px")}function n(){u["vertical-align"]="middle",u.fontSize=i()+"px",p.$content.css("padding",z*x+"px")}function i(){return h=Math.floor(r()/p.$content.height()*f)}function s(){for(h=Math.floor(c()/p.$content.width()*f),p.$el.css("fontSize",h+"px");c()<p.$content.width();)p.$el.css("fontSize",--h+"px");return p.$el.css("fontSize",Math.floor(f)+"px"),h}function r(){return(z-2*d)*(1-2*x)}function c(){return(m-2*d)*(1-2*x)}var a,d,h,p=this,g=this.model.get("scaleToFit"),f=this.model.get("size"),u={"text-align":this.model.get("alignment"),"vertical-align":this.model.get("verticalAlignment")},$={padding:0},x=function(){var e=(p.model.get("text")||"").length;return 1===e?.1/e:e<3?.2/e:.3/e}(),m=this.$el.parent().width(),z=this.$el.parent().height();!e||o.isUndefined(e.padding)?(a=this.$el.css("padding"),d=a&&a.indexOf("px")>0?+a.replace("px",""):0):d=+e.padding,this.$el.css("fontSize",Math.floor(f)+"px"),this.$content.css($),this.$el.width(m),this.$el.height(z-2*d),g==l.WIDTH?t():g==l.HEIGHT?n():g==l.CONTAINER&&(s()>i()?n():t()),this.$el.css(u)},toggleHyperlinkCssClass:function(){this.$el.toggleClass("hyperlink",this.model.get("exposeOutputsToFilterManager"))},render:function(e){return this.$el.css(i(this.model)),this.$content.text(o.isUndefined(e)?this.model.get("text")||"":e),o.defer(this.applyFontSize),this.toggleHyperlinkCssClass(),this}})});