/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../../factory/addDashboardComponentDialogTitleFactory","../../factory/addDashboardComponentDialogTemplateFactory","../../view/mixin/parameterExpressionAutocompletionMixin","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","runtime_dependencies/js-sdk/src/common/component/dialog/Dialog","runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy","runtime_dependencies/bi-repository/src/bi/repository/dialog/resourceChooser/RepositoryChooserDialogFactory","text!../../template/tooltip/sideBarTreeLeafTooltipTemplate.htm","bundle!DashboardBundle","bundle!CommonBundle","settings!treeComponent"],function(e,o,t){function i(e,o){var t=this;this.model=e,o&&o.overElement&&(this.lastHighestIndex=d.highestIndex,d.highestIndex=parseInt(o.overElement.css("zIndex"))+1),this.dialog=new d({modal:!0,model:e,additionalCssClasses:"addDashboardComponentDialog",title:r(e),content:new y({template:n(e),model:e,i18n:m}),buttons:[{label:u[o&&o.okButtonLabel?o.okButtonLabel:"button.ok"],action:"ok",primary:!0,triggerOnKeyCode:13},{label:u["button.cancel"],action:"cancel",primary:!1,triggerOnKeyCode:27}]}),this.dialog.listenTo(e,"validated:valid",function(){this.enableButton("ok")}),this.dialog.listenTo(e,"validated:invalid",function(){this.disableButton("ok")}),this.dialog.listenTo(e,"change",function(){e.isValid(!0)}),this.dialog.on("close",function(){t.dialog.content.trigger("close")}),this.dialog.on("dialog:visible",function(){var e=this.$el.find("input"),o=e.val();e.focus().val("").val(o)}),o&&o.okButtonDisabled&&this.dialog.disableButton("ok")}var s=e("underscore"),r=e("../../factory/addDashboardComponentDialogTitleFactory"),n=e("../../factory/addDashboardComponentDialogTemplateFactory"),a=e("../../view/mixin/parameterExpressionAutocompletionMixin"),l=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),d=e("runtime_dependencies/js-sdk/src/common/component/dialog/Dialog"),p=e("runtime_dependencies/js-sdk/src/common/view/ViewWithEpoxy"),c=e("runtime_dependencies/bi-repository/src/bi/repository/dialog/resourceChooser/RepositoryChooserDialogFactory"),h=e("text!../../template/tooltip/sideBarTreeLeafTooltipTemplate.htm"),m=e("bundle!DashboardBundle"),u=e("bundle!CommonBundle"),g=e("settings!treeComponent"),y=p.extend({events:s.extend({},p.prototype.events,{"click .showRepositoryChooserDialog":"showDialog"}),render:function(){var e=p.prototype.render.apply(this,arguments);return this.applyParameterExpressionAutocompletionMixin(),e},showDialog:function(){if(!this.repositoryChooserDialog){var e=c.getDialog("item"),o=[".pdf",".docx",".html",".ods",".odt",".csv",".pptx",".rtf",".xls",".xlsx",".svg",".xml",".jar",".jrxml",".cur",".jrtx",".properties",".css",".eot",".ttf",".woff"];this.repositoryChooserDialog=new e({treeBufferSize:parseInt(g.treeLevelLimit,10),resourcesTypeToSelect:["img"],resourcesTypeToSelectTree:["file"],title:m["dashboard.dialog.properties.repository.chooser.title"],tooltipTemplate:h,tooltipi18n:u,cssClassItemProcessor:function(e){return e.value.resourceType!==l.FILE||s.find(o,function(o){return e.value.label.toLowerCase().endsWith(o)})||(e.cssClass="dashboard-newContent-image"),e}}),this.listenTo(this.repositoryChooserDialog,"close",function(){if(this.repositoryChooserDialog.selectedResource&&this.repositoryChooserDialog.selectedResource.resourceUri){var e={url:"repo:"+this.repositoryChooserDialog.selectedResource.resourceUri};this.model.set(e),this.model.validate(e)}},this)}this.repositoryChooserDialog.open()},remove:function(){return this.repositoryChooserDialog&&this.repositoryChooserDialog.remove(),p.prototype.remove.apply(this,arguments)}});s.extend(y.prototype,a),i.prototype.remove=function(){this.dialog.off("dialog:visible"),this.dialog.remove()},i.prototype.closeAndRemove=function(){d.resetHighestIndex(this.lastHighestIndex),this.dialog.close(),this.remove()},t.exports=i});