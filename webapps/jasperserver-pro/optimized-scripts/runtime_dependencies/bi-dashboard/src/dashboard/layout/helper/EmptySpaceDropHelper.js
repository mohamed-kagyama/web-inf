/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","../../dashboardSettings","../../enum/dashboardComponentTypes","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","./BasicHelper"],function(e,t,i){var o=e("jquery"),r=e("underscore"),s=e("../../dashboardSettings"),n=e("../../enum/dashboardComponentTypes"),p=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),a=e("./BasicHelper");i.exports=a.extend({init:function(e){this.container=e,this.helper=o("<div>").addClass("helper empty-space-drop").appendTo(e).hide(),this.helper.position={}},drag:function(e,t){var i,a=t?t.componentId:void 0,d=o(e.toElement||e.originalEvent.target);if(!d.is(".content > .body")){if(d.attr(s.COMPONENT_ID_ATTRIBUTE)||d.parents("["+s.COMPONENT_ID_ATTRIBUTE+"]").length)return void this.stop();if(d.hasClass("dashboardLevelPropertiesDialog")||d.parents(".dashboardLevelPropertiesDialog").length||d.hasClass("inputControlWrapper"))return void this.stop();if(d[0]!==this.helper[0])return d.parents(".dashboardCanvas").length||d.is(".dragHelper")||d.is(".overlay")?void 0:void this.stop();d=d.siblings(".content").find("> .body")}if(t.resourceType===p.INPUT_CONTROL&&this.strategy.model.currentFoundation.components.findWhere({type:n.FILTER_GROUP})){if(this.strategy.model.currentFoundation.components.getDashboardPropertiesComponent().get("dashletFilterShowPopup"))return void this.stop();if(!d.parents(".dashboardCanvas").length)return void this.stop();i=this.strategy.model.currentFoundation.components.findWhere({type:n.FILTER_GROUP}).getPositionObject()}else{if(i=d[0].getBoundingClientRect(),i=this.strategy.preciseCoordsToCell(d,e.clientX-i.left,e.clientY-i.top),r.isUndefined(i.x)||r.isUndefined(i.y)||this.helper.position.x===i.x&&this.helper.position.y===i.y)return;if(this.helper.position.x=i.x,this.helper.position.y=i.y,i.width=i.height=1,!(i=this.strategy.calculateEmptyArea(i,a)))return void this.stop()}this.helper.css(this.strategy.cellCSS(i)).show()},stop:function(e){this.helper.hide(),this.helper.position.x=void 0,this.helper.position.y=void 0},drop:function(e,t,i){var o=t.helper.data("data")?t.helper.data("data").componentId:void 0,r=this.strategy.calculateEmptyArea(i,o);for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},deinit:function(){this.helper.remove()}})});