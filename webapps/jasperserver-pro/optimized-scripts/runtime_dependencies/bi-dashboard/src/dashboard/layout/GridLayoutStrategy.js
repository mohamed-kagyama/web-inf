/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","../dashboardSettings","./helper/MoveHelper","./helper/ResizeHelper","./helper/EmptySpaceDropHelper","./helper/SplitDropHelper","./helper/FilterDialogHelper"],function(e,t,r){var o=e("underscore"),n=e("jquery"),i=e("../dashboardSettings"),h=e("./helper/MoveHelper"),s=e("./helper/ResizeHelper"),l=e("./helper/EmptySpaceDropHelper"),a=e("./helper/SplitDropHelper"),p=e("./helper/FilterDialogHelper"),u=function(e){this.model=e,this.helpers=o.map([h,s,l,p,a],function(e){return new e(this)},this)};u.prototype={coordsToCell:function(e,t,r){return{x:t!==e.width()?Math.floor(t/(e.width()/i.GRID_WIDTH)):i.GRID_WIDTH,y:r!==e.height()?Math.floor(r/(e.height()/i.GRID_HEIGHT)):i.GRID_HEIGHT}},preciseCoordsToCell:function(e,t,r){return{x:parseInt(t*i.GRID_WIDTH/e.width()),y:parseInt(r*i.GRID_HEIGHT/e.height())}},cellToCoord:function(e,t){return{x:100*e/i.GRID_WIDTH,y:100*t/i.GRID_HEIGHT}},gridSize:function(e){return{x:e.width()/i.GRID_WIDTH,y:e.height()/i.GRID_HEIGHT}},cellCSS:function(e){var t=this.cellToCoord(e.x,e.y),r=this.cellToCoord(e.width,e.height);return{left:t.x+"%",top:t.y+"%",width:r.x+"%",height:r.y+"%"}},onDashletDragStart:function(e,t){o.each(this.helpers,function(r){r.start&&r.start(t,e)},this)},onDashletDrag:function(e,t){o.each(this.helpers,function(r){r.drag&&r.drag(t,e)},this)},onDashletDragStop:function(e,t){o.each(this.helpers,function(r){r.stop&&r.stop(t,e)},this)},onDashletDrop:function(e,t,r,n){var i;i=n[0].getBoundingClientRect(),i=this.coordsToCell(n,t.clientX-i.left,t.clientY-i.top),i.width=i.height=1,o.each(this.helpers,function(o){o.drop&&o.drop(t,r,i,e.id)},this),i&&this.updateLayout(e.id,i)},initVisualHelpers:function(e){o.each(this.helpers,function(t){t.init&&t.init(e)},this)},updateLayout:function(e,t){var r=this.model.currentFoundation.components.get(e);r&&r.set(t)},getDashletDropTarget:function(e){var t=n(e.toElement||e.originalEvent.target);if(t.hasClass("dragHelper")?t=this.lastTarget:this.lastTarget=t,(t=t.parents("["+i.COMPONENT_ID_ATTRIBUTE+"]"))&&t.length)return t},calculateEmptyArea:function(e,t){var r,n;if(e=o.clone(e),r=function(e,t){var r=o.clone(t);return 1&e&&r.x--,2&e&&r.y--,4&e&&r.width++,8&e&&r.height++,r},this.overlapsOrIsOutOfBounds(e,t))return!1;for(var i=15;i;i--)for(;!this.overlapsOrIsOutOfBounds(n=r(i,e),t);)e=n;return e},overlapsOrIsOutOfBounds:function(e,t){return!!this.model.currentFoundation.components.isOutOfCanvasBounds(e)||this.model.currentFoundation.components.overlaps(e,t)},remove:function(){o.each(this.helpers,function(e){e.deinit&&e.deinit()},this)}},r.exports=u});