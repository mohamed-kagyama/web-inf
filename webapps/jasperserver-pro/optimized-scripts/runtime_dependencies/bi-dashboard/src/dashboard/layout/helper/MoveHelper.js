/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","../../dashboardSettings","./BasicHelper"],function(t,e,a){var s=t("jquery"),r=t("underscore"),n=t("../../dashboardSettings"),o=t("./BasicHelper");a.exports=o.extend({elements:"> .content > .body > ["+n.COMPONENT_ID_ATTRIBUTE+"]:not(.inputControlWrapper)",init:function(t){this.container=t,this.mouseEnter=r.bind(this.mouseEnter,this),this.mouseLeave=r.bind(this.mouseLeave,this),this.container.on("mouseenter",this.elements,this.mouseEnter),this.container.on("mouseleave",this.elements,this.mouseLeave)},mouseEnter:function(t){var e=s(t.target).parents("["+n.COMPONENT_ID_ATTRIBUTE+"]");e.parents(".ui-dropping").length||e.hasClass("inputControlWrapper")||e.draggable({cursor:"move",appendTo:this.container.parent(),cursorAt:{top:0,left:0},zIndex:100,distance:10,start:r.bind(this.dashletDragStart,this),stop:r.bind(this.dashletDragStop,this),drag:r.bind(this.dashletDrag,this)})},mouseLeave:function(t){var e=s(t.target);if(e.hasClass("ui-draggable")||(e=e.parents("["+n.COMPONENT_ID_ATTRIBUTE+"]")),!e.hasClass("ui-draggable-dragging"))try{e.draggable("destroy")}catch(t){}},dashletDragStart:function(t,e){var a=s(t.target),r=a.attr(n.COMPONENT_ID_ATTRIBUTE),o={componentId:r};this.strategy.model.currentFoundation.components.selectComponent(r);try{e.helper.resizable("destroy")}catch(t){}e.helper.attr("class","wrap button draggable dragging dragHelper").attr("style",""),o.dashletEl=e.helper.find("> .dashlet").detach();var i=this.strategy.model.currentFoundation.components.get(r);e.helper.text(i.get("name")).data("data",o),this.strategy.onDashletDragStart.call(this.strategy,o,t)},dashletDrag:function(t,e){var a=s(t.target),r=a.attr(n.COMPONENT_ID_ATTRIBUTE);this.strategy.onDashletDrag.call(this.strategy,{componentId:r},t)},dashletDragStop:function(t,e){var a=s(t.target),r=a.attr(n.COMPONENT_ID_ATTRIBUTE);if(!e.helper.find("> .dashlet").length){var o=this.strategy.model.currentFoundation.components.get(e.helper.data("data").componentId);e.helper.attr("class","").attr("style","").html(e.helper.data("data").dashletEl).css(o.getCssPosition())}this.strategy.onDashletDragStop.call(this.strategy,{componentId:r},t)},drop:function(t,e,a){if(e.helper.data("data")&&e.helper.data("data").componentId&&e.helper.data("data").dashletEl){var s=this.strategy.model.currentFoundation.components.get(e.helper.data("data").componentId);s.unset("x",{silent:!0}),s.unset("y",{silent:!0}),s.unset("width",{silent:!0}),s.unset("height",{silent:!0}),e.helper.attr("class","").attr("style","").html(e.helper.data("data").dashletEl)}},deinit:function(){this.container.off("mouseenter",this.elements,this.mouseEnter),this.container.off("mouseleave",this.elements,this.mouseLeave)}})});