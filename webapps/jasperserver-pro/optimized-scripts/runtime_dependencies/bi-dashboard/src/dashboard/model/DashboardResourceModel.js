/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","backbone","underscore","runtime_dependencies/bi-repository/src/bi/repository/model/RepositoryResourceModel","./RepositoryJsonFileModel","./RepositoryComponentsFileModel","./RepositoryHtmlFileModel","../enum/dashboardResourceReferenceTypes","../enum/dashboardResourceTypes","runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes","../dashboardSettings"],function(e,r,s){function t(e){T.FILE in e?(this.resourceReferenceType=T.FILE,this.get("type")===p.COMPONENTS?this.resource=new u(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH}):this.get("type")===p.LAYOUT?this.resource=new R(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH}):this.resource=new n(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH})):T.ADHOC_VIEW in e?(this.resourceReferenceType=T.ADHOC_VIEW,this.resource=new c(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH,type:E.ADHOC_DATA_VIEW})):T.REPORT in e?(this.resourceReferenceType=T.REPORT,this.resource=new c(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH,type:E.REPORT_UNIT})):T.INPUT_CONTROL in e?(this.resourceReferenceType=T.INPUT_CONTROL,this.resource=new c(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH,type:E.INPUT_CONTROL})):T.RESOURCE_REFERENCE in e&&(this.get("type")===p.COMPONENTS?(this.resourceReferenceType=T.FILE,this.resource=new u(e[T.RESOURCE_REFERENCE],{contextPath:h.CONTEXT_PATH})):this.get("type")===p.LAYOUT?(this.resourceReferenceType=T.FILE,this.resource=new R(e[T.RESOURCE_REFERENCE],{contextPath:h.CONTEXT_PATH})):this.get("type")===p.WIRING?(this.resourceReferenceType=T.FILE,this.resource=new n(e[T.RESOURCE_REFERENCE],{contextPath:h.CONTEXT_PATH})):(this.resourceReferenceType=T.RESOURCE_REFERENCE,this.resource=new c(e[this.resourceReferenceType],{contextPath:h.CONTEXT_PATH,type:E.RESOURCE_LOOKUP})))}var o=e("backbone"),i=e("underscore"),c=e("runtime_dependencies/bi-repository/src/bi/repository/model/RepositoryResourceModel"),n=e("./RepositoryJsonFileModel"),u=e("./RepositoryComponentsFileModel"),R=e("./RepositoryHtmlFileModel"),T=e("../enum/dashboardResourceReferenceTypes"),p=e("../enum/dashboardResourceTypes"),E=e("runtime_dependencies/bi-repository/src/bi/repository/enum/repositoryResourceTypes"),h=e("../dashboardSettings"),y=o.Model.extend({idAttribute:"name",defaults:{name:void 0,type:void 0,resource:void 0},initialize:function(){this.updateResource(),this.on("change:resource",this.updateResource)},updateResource:function(){var e=this.get("resource");e&&i.isObject(e)&&(this.resource&&this.resourceReferenceType in e?this.resource.set(e[this.resourceReferenceType]):t.call(this,e))},toJSON:function(e){var r=o.Model.prototype.toJSON.apply(this,arguments);return r.resource={},this.resourceReferenceType!==T.FILE?this.resource.isNew()||!0===e?r.resource[this.resourceReferenceType]=this.resource.toJSON():r.resource[T.RESOURCE_REFERENCE]={uri:this.resource.get("uri")}:(r.resource[T.FILE]=this.resource.toJSON(),delete r.resource[T.FILE].version,delete r.resource[T.FILE].uri,delete r.resource[T.FILE].permissionMask,delete r.resource[T.FILE].creationDate,delete r.resource[T.FILE].updateDate),r}});y.createDashboardResource=function(e,r){var s={};return e.resourceType===E.ADHOC_DATA_VIEW?s[T.ADHOC_VIEW]=e:e.resourceType===E.REPORT_UNIT?s[T.REPORT]=e:e.resourceType===E.INPUT_CONTROL&&(s[T.INPUT_CONTROL]=e),new this({resource:s,type:e.resourceType,name:e.uri},{contextPath:r})},s.exports=y});