/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","./DashboardComponentModel","../../enum/dashboardComponentTypes","bundle!DashboardBundle","underscore"],function(e,t,i){function s(e){this._ignoreValueChange=!0,this._deferValue()?this._deferredValue={value:this._default,index:-1}:(this._current=-1,this.set("value",this._default,e),this._ignoreValueChange=!1)}var a=e("jquery"),n=e("./DashboardComponentModel"),r=e("../../enum/dashboardComponentTypes"),u=e("bundle!DashboardBundle"),h=e("underscore");i.exports=n.extend({componentName:u["dashboard.component.value.component.name"],defaults:h.extend({},n.prototype.defaults,{type:r.VALUE,value:void 0}),initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this._values=[],this._current=-1,this.on("change:value",function(){this._ignoreValueChange||(this._changed=!0,this.notify())},this),this.initializeSpecific(e,t)},initializeSpecific:function(e,t){this.on("change:name",function(){this.set("label",this.get("name"),{silent:!0})},this),this.set("label",this.get("name"),{silent:!0})},isVisible:function(){return!1},isValueProducer:function(){return!0},notify:function(){this.trigger(this.get("id"),this.get("value"))},acceptWiringVisitor:function(e){e.register(this,{signals:[this.get("id")],slots:{}}),this.notify()},applyDeferredValue:function(){if(this.isValueDeferred()&&(this._current=this._deferredValue.index,this.set("value",this._deferredValue.value),this._deferredValue=void 0,this._ignoreValueChange=!1,this.trigger("parametersState:deferredValueApplied",this)),this._isValueApplying){var e={};e[this.id]=this._deferredExternalValue,this.acquireValue(e)}},prepareForAcquire:function(){},acquireValue:function(e,t){return h.isUndefined(e[this.id])?this.unset("value",t):(this.unset("value",{silent:!0}),this.set("value",e[this.id],t)),(new a.Deferred).resolve()},canPopValue:function(e){return this._current+e>=-1&&this._current+e<this._values.length},isValueDeferred:function(){return!h.isUndefined(this._deferredValue)},pushParametersState:function(){n.prototype.pushParametersState.call(this),this._current<this._values.length-1&&(this._values=this._values.slice(0,this._current+1)),this._values.push(this._changed?h.cloneDeep(this.get("value")):this._values[this._values.length-1]||this._default),this._current=this._values.length-1,this._changed=!1},popParametersState:function(e){n.prototype.popParametersState.call(this,e),this.canPopValue(e)&&(this._current+e===-1?s.call(this):(this._ignoreValueChange=!0,this._deferValue()?this._deferredValue={value:this._values[this._current+e],index:this._current+e}:(this._current+=e,this.set("value",this._values[this._current]),this._ignoreValueChange=!1)))},resetParametersState:function(e){n.prototype.resetParametersState.call(this),s.call(this,e)},setCurrentParametersStateAsDefault:function(e){n.prototype.setCurrentParametersStateAsDefault.call(this,e),this._default=h.cloneDeep(e||this.get("value"))},_deferValue:function(){return!1}})});