/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","backbone","underscore","jquery","../enum/dashboardComponentTypes","../enum/dashboardWiringStandardIds","../collection/DashboardWiringCollection","../collection/DashboardComponentCollection"],function(t,n,i){var e=t("backbone"),o=t("underscore"),s=t("jquery"),r=t("../enum/dashboardComponentTypes"),h=t("../enum/dashboardWiringStandardIds"),a=t("../collection/DashboardWiringCollection"),c=t("../collection/DashboardComponentCollection");i.exports=e.Model.extend({defaults:{id:void 0,description:void 0,wiring:void 0,layout:void 0,components:void 0},initialize:function(t,n){this.components=new c,this.wiring=new a,this.listenTo(this.components,"add",o.bind(function(t,n,i){this.trigger("addComponent",t,this),t.acceptWiringVisitor(this.wiring)},this)),this.listenTo(this.components,"remove",o.bind(function(t,n,i){this.trigger("removeComponent",t,this),t.get("type")===r.INPUT_CONTROL?(this.wiring.unregister(t),t.getParent()&&(t.getParent().getChildren().length?t.getParent().notify(!0):this.components.remove(t.getParent()))):t.get("type")===r.FILTER_GROUP?(this.components.remove(t.getChildren()),t.notify(!0),this.wiring.unregister(t)):this.wiring.unregister(t)},this)),this.listenTo(this.components,"change",o.bind(function(t,n,i){var e=t.changedAttributes();e&&(("width"in e||"height"in e)&&this.trigger("resizeComponent",t,this),("x"in e||"y"in e)&&this.trigger("moveComponent",t,this),"selected"in e&&this.trigger("selectComponent",t,this)),o.contains(o.values(r),t.get("type"))&&this.trigger("changeProperties",t,this)},this)),this.listenTo(this.components,"edit",o.bind(function(t){this.trigger("editComponent",t,this)},this)),this.listenTo(this.components,"changedControlProperties",o.bind(function(t){this.trigger("changedControlProperties",t,this)},this)),this.listenTo(this.wiring,"add change remove",o.bind(function(t,n,i){this.trigger("changeWiring",t,this)},this))},startLoadingSequence:function(){var t=this.wiring,n=this,i=this.components.getDashboardPropertiesComponent();s.when.apply(null,this.components.reduce(function(t,n){return n.componentInitializedDfd&&t.push(n.componentInitializedDfd),t},[])).then(function(){s.when.apply(null,n.components.reduce(function(t,n){return n.paramsDfd&&t.push(n.paramsDfd),t},[])).then(function(){t.initialized=!0,t.trigger("init")}),n.components.setEnabledCascading(!0),n.components.setMuteFilterPanels(!1),n.components.setCurrentParametersStateAsDefault(),i.trigger(h.INIT_SIGNAL,{}),t.enableAutowiring()})},hasVisualComponents:function(){return this.components.any(function(t){return t.isVisible()})}})});