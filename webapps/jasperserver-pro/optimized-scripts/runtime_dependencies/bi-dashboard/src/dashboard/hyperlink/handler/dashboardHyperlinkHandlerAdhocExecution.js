/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","runtime_dependencies/bi-report/src/bi/report/jive/enum/hyperlinkTargets"],function(e,n,r){function t(e,n){return u.find(o(i(e)),function(e){return e.name===n})}function a(e,n,r){var t=e.indexOf("?"),a=e.indexOf("#"),u=l(c(o(i(e)),n,r));return-1===t?-1===a?e.concat("?",u):e.slice(0,a).concat("?",u,e.slice(a)):-1===a?e.slice(0,t+1).concat(u):e.slice(0,t+1).concat(u,e.slice(a))}function i(e){var n,r,t="";return(n=e.indexOf("?"))>=0&&(t=(r=e.indexOf("#"))>=n?e.substring(n+1,r):e.substring(n+1)),t}function o(e){return e?u.compact(u.map(e.split("&"),function(e){if(e){var n=e.split("=");return{name:n[0],value:n[1]}}})):[]}function l(e){return u.map(e,function(e){return u.isUndefined(e.value)?e.name:e.name.concat("=",e.value)}).join("&")}function c(e,n,r){for(var t=0;t<e.length;t++)if(e[t].name===n)return e[t].value=r,e;return e.push({name:n,value:r}),e}var u=e("underscore"),s=e("runtime_dependencies/bi-report/src/bi/report/jive/enum/hyperlinkTargets");r.exports={events:{click:function(e,n,r){if(r.model.get("exposeOutputsToFilterManager")&&n.parameters)if(r.model.get("dashletHyperlinkUrl"))try{r.model.collection.disableParametersStateStack(),r.notify(n.parameters),r.model.collection.enableParametersStateStack()}catch(e){throw r.model.collection.enableParametersStateStack(),e}else r.notify(n.parameters);r.model.get("dashletHyperlinkUrl")&&r.model.get("dashletHyperlinkTarget")&&r.model.getLinkUrl(r.model.paramsModel.attributes).done(function(e){var n=t(window.location.href,"_ddHyperlink");if(n=n&&+n.value?+n.value:0,e=a(e,"_ddHyperlink",n+1),r.model.get("dashletHyperlinkTarget")===s.BLANK&&(e=a(e,"noReturn",!0)),r.model.get("dashletHyperlinkTarget")===s.SELF){var i=t(window.location.href,"viewAsDashboardFrame");i&&"true"===i.value&&(e=a(e,i.name,i.value)),window.location.href=e}else window.open(e)}).fail(function(e){r.showErrorDialog(e)})}}}});