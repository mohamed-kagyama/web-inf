/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","runtime_dependencies/js-sdk/src/common/component/dialog/Dialog","bundle!CommonBundle","runtime_dependencies/js-sdk/src/common/component/panel/trait/tabbedPanelTrait","runtime_dependencies/bi-chart/src/jr/jive/highcharts/dialogs/trait/adjustDialogPositionWithinViewportTrait","text!./template/tableFormatDialogTemplate.htm","text!./template/tabOptionTemplate.htm","./view/TableBasicFormatView","./view/TableConditionCollectionView"],function(t,o,e){function i(t){if(this.conditionFormatView.validate()){var o=[];o.push.apply(o,this.basicFormatView.getActions()),o.push.apply(o,this.conditionFormatView.getActions()),o.length&&this.columnComponentModel.format(o),this.close()}}function n(){this.basicFormatView.clear(),this.conditionFormatView.clear(),this.close()}function a(){var t=this.columnComponentModel.parent.columns.indexOf(this.columnComponentModel),o=this.columnComponentModel.parent.columns.length;t>0?this.$el.find("button.colprev").prop("disabled",!1):this.$el.find("button.colprev").prop("disabled",!0),t<o-1?this.$el.find("button.colnext").prop("disabled",!1):this.$el.find("button.colnext").prop("disabled",!0)}var l=t("underscore"),s=t("runtime_dependencies/js-sdk/src/common/component/dialog/Dialog"),c=t("bundle!CommonBundle"),m=t("runtime_dependencies/js-sdk/src/common/component/panel/trait/tabbedPanelTrait"),r=t("runtime_dependencies/bi-chart/src/jr/jive/highcharts/dialogs/trait/adjustDialogPositionWithinViewportTrait"),d=t("text!./template/tableFormatDialogTemplate.htm"),h=t("text!./template/tabOptionTemplate.htm"),p=t("./view/TableBasicFormatView"),u=t("./view/TableConditionCollectionView");e.exports=s.extend({defaultTemplate:d,events:l.extend({"click button.colprev":"_goToPreviousColumn","click button.colnext":"_goToNextColumn"},s.prototype.events),el:function(){return this.template({title:this.title,additionalCssClasses:this.additionalCssClasses,i18n:this.i18n})},constructor:function(t){this.i18n=t.i18n,this.basicFormatView=new p({i18n:this.i18n}),this.conditionFormatView=new u({i18n:this.i18n}),s.prototype.constructor.call(this,{buttons:[{label:c["button.cancel"],action:"cancel",primary:!1,float:"right"},{label:c["button.ok"],action:"ok",primary:!0,float:"right"}],additionalCssClasses:"tableFormatDialog",modal:!0,resizable:!1,traits:[m,r],tabHeaderContainerSelector:".dialogHeader > .tabContainer",tabContainerClass:"jive_form_container",optionTemplate:h,tabs:[{label:this.i18n["net.sf.jasperreports.components.headertoolbar.title.basicformat"],action:"basicFormatTab",content:this.basicFormatView},{label:this.i18n["net.sf.jasperreports.components.headertoolbar.title.conditions"],action:"conditionalFormatTab",content:this.conditionFormatView}]}),this.on("button:ok",l.bind(i,this)),this.on("button:cancel",l.bind(n,this)),this.on("tab:basicFormatTab",function(){if(!this.conditionFormatView.validate())return this.tabHeaderContainer.options[0].removeSelection(),this.$(this.$tabs.get(0)).hide(),this.tabHeaderContainer.options[1].addSelection(),void this.$(this.$tabs.get(1)).show();this.conditionFormatView.trigger("tabSwitched")}),this.on("tab:conditionalFormatTab",function(){this.basicFormatView.trigger("tabSwitched")})},open:function(t){var o=t.get("columnLabel")?t.get("columnLabel"):"#"+(t.get("columnIndex")+1);this.columnComponentModel=t,this.$el.find(".dialogTitle.columnLabel").text(o),this.basicFormatView.setColumnComponentModel(this.columnComponentModel),this.conditionFormatView.setColumnComponentModel(this.columnComponentModel),this.openTab("basicFormatTab"),s.prototype.open.apply(this,arguments),a.call(this)},_goToPreviousColumn:function(t){if(this.conditionFormatView.validate()){var o=this.columnComponentModel.collection.indexOf(this.columnComponentModel),e=this.columnComponentModel.collection.at(o-1),i=e.get("columnLabel")?e.get("columnLabel"):"#"+(e.get("columnIndex")+1);this.basicFormatView.setColumnComponentModel(e,!0),this.conditionFormatView.setColumnComponentModel(e,!0),this.$el.find(".dialogTitle.columnLabel").text(i),this.columnComponentModel=e,a.call(this)}},_goToNextColumn:function(t){if(this.conditionFormatView.validate()){var o=this.columnComponentModel.parent.columns.indexOf(this.columnComponentModel),e=this.columnComponentModel.parent.columns[o+1],i=e.get("columnLabel")?e.get("columnLabel"):"#"+(e.get("columnIndex")+1);this.basicFormatView.setColumnComponentModel(e,!0),this.conditionFormatView.setColumnComponentModel(e,!0),this.$el.find(".dialogTitle.columnLabel").text(i),this.columnComponentModel=e,a.call(this)}},remove:function(){s.prototype.remove.call(this),this.basicFormatView&&this.basicFormatView.remove(),this.conditionFormatView&&this.conditionFormatView.remove()}})});