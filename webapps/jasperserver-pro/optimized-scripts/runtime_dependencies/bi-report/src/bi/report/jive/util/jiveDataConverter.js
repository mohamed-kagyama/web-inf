/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","runtime_dependencies/js-sdk/src/common/util/parse/date","runtime_dependencies/js-sdk/src/common/util/parse/time","runtime_dependencies/js-sdk/src/common/extension/jQueryTimepickerExtension"],function(e,t,i){var r=e("jquery"),n=e("underscore"),_=e("runtime_dependencies/js-sdk/src/common/util/parse/date"),a=e("runtime_dependencies/js-sdk/src/common/util/parse/time");e("runtime_dependencies/js-sdk/src/common/extension/jQueryTimepickerExtension");var o={DURATION_PATTERN:"[h]:mm:ss",jQueryUiTimestampToIsoTimestamp:function(e,t){if(e&&t&&t.calendarPatterns){var i=t.calendarPatterns.date,n=t.calendarPatterns.time;return _.dateObjectToIso8601Timestamp(r.datepicker.parseDateTime(i,n,e))}},jQueryUiTimeToIsoTime:function(e,t){if(e&&t&&t.calendarPatterns){var i=t.calendarPatterns.time,n=r.datepicker.parseTime(i,e);if(n)return a.timeToIso8061Time(n.hour,n.minute,n.second)}},isoTimestampTojQueryUiTimestamp:function(e,t){if(e&&t&&t.calendarPatterns){var i=_.iso8601TimestampToDateObject(e),n=t.calendarPatterns.date,a=t.calendarPatterns.time,o=r.timepicker&&r.timepicker._defaults&&r.timepicker._defaults.separator?r.timepicker._defaults.separator:" ";return r.datepicker.formatDate(n,i)+o+r.datepicker.formatTime(a,{hour:i.getHours(),minute:i.getMinutes(),second:i.getSeconds()})}},isoTimeTojQueryUiTime:function(e,t){if(e&&t&&t.calendarPatterns){var i=a.iso8601TimeToTimeObject(e),n=t.calendarPatterns.time;if(i)return r.datepicker.formatTime(n,{hour:i.hours,minute:i.minutes,second:i.seconds})}},filterStartValue:function(e,t,i,r){var _=null==t&&null==e,a=null!=e&&-1!==e.indexOf("null"),m="boolean"===i,T="datetime"===i,s="time"===i;return _||a?"":n.isArray(t)?T?o.isoTimestampTojQueryUiTimestamp(t[0],r):s?o.isoTimeTojQueryUiTime(t[0],r):t[0]:m?"":T?o.isoTimestampTojQueryUiTimestamp(t,r):s?o.isoTimeTojQueryUiTime(t,r):t},filterEndValue:function(e,t,i,r){var _=null==t&&null==e,a="datetime"===i,m="time"===i;return _?"":n.isArray(t)?a?o.isoTimestampTojQueryUiTimestamp(t[1],r):m?o.isoTimeTojQueryUiTime(t[1],r):t[1]:""},dataTypeToSchemaFormat:{Text:"string",Numeric:"numeric",Date:"datetime",Boolean:"boolean",Time:"time"},schemaFormatOperatorToFilterOperatorMap:function(){var e={};return e.string={},e.string.equal="EQUALS",e.string.not_equal="IS_NOT_EQUAL_TO",e.string.contain="CONTAINS",e.string.not_contain="DOES_NOT_CONTAIN",e.string.start_with="STARTS_WITH",e.string.not_start_with="DOES_NOT_START_WITH",e.string.end_with="ENDS_WITH",e.string.not_end_with="DOES_NOT_END_WITH",e.string.is_null="IS_NULL",e.string.is_not_null="IS_NOT_NULL",e.datetime={},e.datetime.equal="EQUALS",e.datetime.not_equal="IS_NOT_EQUAL_TO",e.datetime.between="IS_BETWEEN",e.datetime.not_between="IS_NOT_BETWEEN",e.datetime.on_or_before="IS_ON_OR_BEFORE",e.datetime.before="IS_BEFORE",e.datetime.on_or_after="IS_ON_OR_AFTER",e.datetime.after="IS_AFTER",e.datetime.is_null="IS_NULL",e.datetime.is_not_null="IS_NOT_NULL",e.time={},e.time.equal="EQUALS",e.time.not_equal="IS_NOT_EQUAL_TO",e.time.between="IS_BETWEEN",e.time.not_between="IS_NOT_BETWEEN",e.time.on_or_before="IS_ON_OR_BEFORE",e.time.before="IS_BEFORE",e.time.on_or_after="IS_ON_OR_AFTER",e.time.after="IS_AFTER",e.time.is_null="IS_NULL",e.time.is_not_null="IS_NOT_NULL",e.numeric={},e.numeric.equal="EQUALS",e.numeric.not_equal="DOES_NOT_EQUAL",e.numeric.greater="GREATER_THAN",e.numeric.greater_or_equal="GREATER_THAN_EQUAL_TO",e.numeric.less="LESS_THAN",e.numeric.less_or_equal="LESS_THAN_EQUAL_TO",e.numeric.between="IS_BETWEEN",e.numeric.not_between="IS_NOT_BETWEEN",e.numeric.is_null="IS_NULL",e.numeric.is_not_null="IS_NOT_NULL",e}(),filterOperatorToSchemaFormatMap:function(){var e={};return e.string={},e.string.EQUALS="equal",e.string.IS_NOT_EQUAL_TO="not_equal",e.string.CONTAINS="contain",e.string.DOES_NOT_CONTAIN="not_contain",e.string.STARTS_WITH="start_with",e.string.DOES_NOT_START_WITH="not_start_with",e.string.ENDS_WITH="end_with",e.string.DOES_NOT_END_WITH="not_end_with",e.string.IS_NULL="is_null",e.string.IS_NOT_NULL="is_not_null",e.datetime={},e.datetime.EQUALS="equal",e.datetime.IS_NOT_EQUAL_TO="not_equal",e.datetime.IS_BETWEEN="between",e.datetime.IS_NOT_BETWEEN="not_between",e.datetime.IS_ON_OR_BEFORE="on_or_before",e.datetime.IS_BEFORE="before",e.datetime.IS_ON_OR_AFTER="on_or_after",e.datetime.IS_AFTER="after",e.datetime.IS_NULL="is_null",e.datetime.IS_NOT_NULL="is_not_null",e.numeric={},e.numeric.EQUALS="equal",e.numeric.DOES_NOT_EQUAL="not_equal",e.numeric.GREATER_THAN="greater",e.numeric.GREATER_THAN_EQUAL_TO="greater_or_equal",e.numeric.LESS_THAN="less",e.numeric.LESS_THAN_EQUAL_TO="less_or_equal",e.numeric.IS_BETWEEN="between",e.numeric.IS_NOT_BETWEEN="not_between",e.numeric.IS_NULL="is_null",e.numeric.IS_NOT_NULL="is_not_null",e.time={},e.time.EQUALS="equal",e.time.IS_NOT_EQUAL_TO="not_equal",e.time.IS_BETWEEN="between",e.time.IS_NOT_BETWEEN="not_between",e.time.IS_ON_OR_BEFORE="on_or_before",e.time.IS_BEFORE="before",e.time.IS_ON_OR_AFTER="on_or_after",e.time.IS_AFTER="after",e.time.IS_NULL="is_null",e.time.IS_NOT_NULL="is_not_null",e}(),schemaFormatOperatorToFilterOperator:function(e,t,i){return"boolean"!==i?o.schemaFormatOperatorToFilterOperatorMap[i][e]:"equal"===e&&!0===t?"IS_TRUE":"equal"===e&&!1===t?"IS_FALSE":"not_equal"===e&&!0===t?"IS_NOT_TRUE":"not_equal"===e&&!1===t?"IS_NOT_FALSE":"is_null"===e?"IS_NULL":"is_not_null"===e?"IS_NOT_NULL":void 0},operatorAndValueToSchemaFormat:function(e,t,i,r,n){var _={};if("boolean"===t)"IS_TRUE"===e?(_.operator="equal",_.value=!0):"IS_FALSE"===e?(_.operator="equal",_.value=!1):"IS_NOT_TRUE"===e?(_.operator="not_equal",_.value=!0):"IS_NOT_FALSE"===e?(_.operator="not_equal",_.value=!1):"IS_NULL"===e?(_.operator="is_null",_.value=""):"IS_NOT_NULL"===e&&(_.operator="is_not_null",_.value="");else{_.operator=o.filterOperatorToSchemaFormatMap[t][e];var a="between"===_.operator||"not_between"===_.operator,m="is_null"===_.operator||"is_not_null"===_.operator;if("string"===t)_.value=null==i?"":i;else if("numeric"===t)try{_.value=a?[i,r]:i}catch(e){throw new Error("Cannot convert filter value to number",e)}else{var T=this.parent&&this.parent.config?this.parent.config.genericProperties:void 0;"datetime"===t?_.value=a?[o.jQueryUiTimestampToIsoTimestamp(i,T),o.jQueryUiTimestampToIsoTimestamp(r,T)]:m?i:o.jQueryUiTimestampToIsoTimestamp(i,T):"time"===t&&(_.value=a?[o.jQueryUiTimeToIsoTime(i,T),o.jQueryUiTimeToIsoTime(r,T)]:m?i:o.jQueryUiTimeToIsoTime(i,T))}}return _}};i.exports=o});