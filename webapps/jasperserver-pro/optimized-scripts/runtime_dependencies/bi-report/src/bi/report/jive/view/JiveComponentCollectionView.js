/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","backbone","underscore","jquery","runtime_dependencies/js-sdk/src/common/logging/logger","jquery-ui-touch-punch","csslink!../jr/theme/jive.csslink.css"],function(e,t,i){function s(e){e||(e={}),this.stateModel=e.stateModel,this.collection=e.collection,this.dialogStates=e.dialogStates,this.listenTo(this.collection,"reset",this.initSubviews,this)}var n=e("backbone"),o=e("underscore"),r=e("jquery"),u=e("runtime_dependencies/js-sdk/src/common/logging/logger");e("jquery-ui-touch-punch"),e("csslink!../jr/theme/jive.csslink.css");var c=u.register("JiveComponentCollectionView");s.prototype={initSubviews:function(){var t=this,i=[],s=[];if(o.invoke(this.subviews||[],"remove"),this.subviews=[],this.subviewsReadyDfd){var n=this.subviewsReadyDfd;this.subviewsReadyDfd=(new r.Deferred).done(function(){n.resolve()}).fail(function(){n.reject()})}else this.subviewsReadyDfd=new r.Deferred;this.collection.forEach(function(e){"chart"===e.get("type")&&i.push("runtime_dependencies/bi-chart/src/jr/jive/highcharts/view/ChartJiveComponentView")&&s.push(e.get("id")),"fusionMap"===e.get("type")&&i.push("./FusionComponentView")&&s.push(e.get("id")),"fusionChart"===e.get("type")&&i.push("./FusionComponentView")&&s.push(e.get("id")),"fusionWidget"===e.get("type")&&i.push("./FusionComponentView")&&s.push(e.get("id")),"googlemap"===e.get("type")&&i.push("./GooglemapComponentView")&&s.push(e.get("id")),"tibco-maps"===e.get("type")&&i.push("./TibcomapComponentView")&&s.push(e.get("id")),"CVComponent"===e.get("type")&&i.push("./CustomJiveComponentView")&&s.push(e.get("id")),"table"===e.get("type")&&i.push("./TableJiveComponentView")&&s.push(e.get("id")),"crosstab"===e.get("type")&&i.push("./CrosstabJiveComponentView")&&s.push(e.get("id"))}),e(i,function(){var e=o.toArray(arguments);o.each(e,function(e,i){t.subviews.push(new e({model:t.collection.get(s[i]),report:t.collection.report,dialogStates:t.dialogStates,stateModel:t.stateModel}))}),c.debug("Create JIVE views ",t.subviews),t.subviewsReadyDfd.resolve()},this.subviewsReadyDfd.reject)},render:function(e,t){var i=this,s=new r.Deferred;return i.subviewsReadyDfd.then(function(){var n=o.invoke(i.subviews,"render",e,t);r.when.apply(r,n).then(s.resolve,s.reject)},s.reject),s},sizableSubviews:function(){return o.filter(this.subviews,function(e){return e.setSize})},scalableSubviews:function(){return o.filter(this.subviews,function(e){return e.scale})},getSizableSubviews:function(){var e=this,t=new r.Deferred;return this.subviewsReadyDfd.then(function(){t.resolve(o.filter(e.subviews,function(e){return e.setSize}))}),t},getScalableSubviews:function(){var e=this,t=new r.Deferred;return this.subviewsReadyDfd.then(function(){t.resolve(o.filter(e.subviews,function(e){return e.scale}))}),t},remove:function(){o.invoke(this.subviews||[],"remove"),this.stopListening(this.collection,"reset",this.initSubviews,this)}},o.extend(s.prototype,n.Events),i.exports=s});