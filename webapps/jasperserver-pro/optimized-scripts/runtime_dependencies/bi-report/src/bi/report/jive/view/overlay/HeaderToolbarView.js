/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","backbone","jquery","underscore","runtime_dependencies/js-sdk/src/common/component/base/OptionContainer","runtime_dependencies/js-sdk/src/common/component/menu/HoverMenu","runtime_dependencies/js-sdk/src/common/component/menu/cascadingMenuTrait","text!./template/headerToolbarTemplate.htm","text!./template/headerToolbarButtonTemplate.htm","text!./template/dropdownMenuTemplate.htm","text!./template/dropdownOptionTemplate.htm"],function(e,t,n){var o=e("backbone"),s=e("jquery"),i=e("underscore"),u=e("runtime_dependencies/js-sdk/src/common/component/base/OptionContainer"),r=e("runtime_dependencies/js-sdk/src/common/component/menu/HoverMenu"),a=e("runtime_dependencies/js-sdk/src/common/component/menu/cascadingMenuTrait"),c=e("text!./template/headerToolbarTemplate.htm"),h=e("text!./template/headerToolbarButtonTemplate.htm"),l=e("text!./template/dropdownMenuTemplate.htm"),m=e("text!./template/dropdownOptionTemplate.htm"),d=r.extend(a),p=o.View.extend({events:{"mousedown button":"_onMouseTouchDown","touchstart button":"_onMouseTouchDown","mouseup button":"_onMouseTouchUp","touchend button":"_onMouseTouchUp"},initialize:function(e){e=e||{},this.parentElement=s(e.parentElement?e.parentElement:"body");var t=e.buttons||[];this.buttons=new u({contextName:"button",mainTemplate:c,contentContainer:".jive_button_bar_options",optionTemplate:h,options:t}),this.resetCurrentButton(),this.initEvents(),this.initHoverMenus(),this.setElement(this.buttons.$el),this.rendered=!1,o.View.prototype.initialize.apply(this,arguments)},initEvents:function(){this.listenTo(this.buttons,"mouseover",this._onMouseOver),this.listenTo(this.buttons,"mouseout",this._onMouseOut),this.listenTo(this.buttons,"button:select button:sortAsc button:sortDesc button:filter",this._onSelect)},initHoverMenus:function(){this.cascadingMenus=[],i.each(this.buttons.options,function(e){var t=e.model.get("hoverMenuOptions");if(t){var n=new d(t,e.$el,null,{menuContainerTemplate:l,menuOptionTemplate:m});this.listenTo(n,"option:select",this._onSelect),this.cascadingMenus.push(n)}},this)},_onSelect:function(e,t,n){this.trigger("select",e,t,n)},_onMouseTouchDown:function(e){if(this.currentButton){var t=this.currentButton;!t.$el.hasClass("disabled")&&t.$el.addClass("pressed")}return!1},_onMouseTouchUp:function(e){return this.currentButton&&this.currentButton.$el.removeClass("pressed"),!1},_onMouseOver:function(e,t,n){this.resetCurrentButton(e),!e.$el.hasClass("disabled")&&e.$el.addClass("over")},_onMouseOut:function(e,t,n){this.resetCurrentButton(),e.$el.removeClass("over pressed")},resetCurrentButton:function(e){this.currentButton=e||null},resetButtonsClasses:function(){this.$el.find("button").removeClass("over pressed disabled")},disableButtons:function(){this.$el.find("button").addClass("disabled")},setPosition:function(e){return this.$el.position(e),this},show:function(e){return this.resetButtonsClasses(),!e&&this.disableButtons(),this.$el.show(),this},hide:function(){return this.$el.hide(),this},render:function(){return this.parentElement.append(this.$el),this.rendered=!0,this},remove:function(){o.View.prototype.remove.apply(this,arguments),this.rendered=!1,this.buttons&&this.buttons.remove(),i.invoke(this.cascadingMenus,"remove")}});n.exports=p});