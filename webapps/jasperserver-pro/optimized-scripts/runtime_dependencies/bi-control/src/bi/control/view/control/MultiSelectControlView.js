/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../BaseInputControlView","jquery","runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/selectedItemsDataProviderSorterFactory","../../enum/substitutionConstants","runtime_dependencies/js-sdk/src/components/multiSelect/view/MultiSelect","runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/DataProviderWithLabelHash","../../util/inputControlHelpers","text!../../template/multiSelectTemplate.htm"],function(e,t,i){var s=e("underscore"),n=e("../BaseInputControlView"),l=e("jquery"),o=e("runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/selectedItemsDataProviderSorterFactory"),r=e("../../enum/substitutionConstants"),a=e("runtime_dependencies/js-sdk/src/components/multiSelect/view/MultiSelect"),c=e("runtime_dependencies/js-sdk/src/components/multiSelect/dataprovider/DataProviderWithLabelHash"),d=e("../../util/inputControlHelpers"),u=e("text!../../template/multiSelectTemplate.htm");i.exports=n.extend({template:u,renderStructure:function(){var e=this;this.multiSelect||(this.dataProvider=new c,this.multiSelect=new a({getData:this.dataProvider.getData,selectedListOptions:{formatLabel:function(t){return e.dataProvider.getDataLabelHash()[t]},sortFunc:o.create(r.NULL_SUBSTITUTION_LABEL)},resizable:!0}),this.multiSelect.setDisabled(this.model.get("readOnly"))),this.template&&(this.multiSelect.undelegateEvents(),this.setElement(l(s.template(this.template||"")(this._renderData()))),this.multiSelect.render().renderData(),this.$el.find(".jr-mInput-label").after(this.multiSelect.el),this.multiSelect.$el.find(".jr-mSizer").detach().insertAfter(this.$el.find(".jr-mInput-alert")),this.multiSelect.delegateEvents(),this.updateOptionsSelection())},updateOptionsSelection:function(){var e=this.model.state.options.toJSON();this.dataProvider.setData(e);var t=this;this.multiSelect.fetch(function(){var i=d.extractSelection(e);t.multiSelect.setValue(i,{silent:!0}),t.multiSelect.resize()},{keepPosition:!0})},bindCustomEventListeners:function(){this.multiSelect.off("selection:change").on("selection:change",function(e){this.model.changeState(e)},this),this.model.state.options.on("reset",this.updateOptionsSelection,this),this.model.state.options.on("change:selected",this.updateOptionsSelection,this)},remove:function(){this.multiSelect.remove(),this.model.state.options.off("reset",this.updateOptionsSelection,this),this.model.state.options.off("change:selected",this.updateOptionsSelection,this),n.prototype.remove.call(this)}})});