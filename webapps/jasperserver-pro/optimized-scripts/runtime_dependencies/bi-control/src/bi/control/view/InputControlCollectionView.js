/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","backbone","requirejs-domready","../enum/uiTypes"],function(e,t,i){var n=e("jquery"),o=e("underscore"),r=e("backbone"),s=e("requirejs-domready"),c=e("../enum/uiTypes");i.exports=r.View.extend({className:"jr-mForm jr",$icContainer:!1,$icList:!1,initialize:function(e){this.stateModel=e.stateModel,this.uiTypes=c,this.controlViews={},this.containerAttachedToDOM=new n.Deferred,this.$el.css("position","relative"),this.collection.on("reset",this._createControlViews,this),this.collection.on("disableICs",this._disableICs,this),this.collection.on("enableICs",this._enableICs,this)},_createControlViews:function(){var e=this;this.controlViews={},e.collection.each(o.bind(e._createControlView,e)),e.render()},_createControlView:function(e){var t=e.get("type"),i=e.get("id");if(!o.has(this.uiTypes,t))throw new Error("Can not find implementation of the control type: "+t);return e.get("visible")&&(this.controlViews[i]=new this.uiTypes[t]({model:e})),this.controlViews[i]},setContainer:function(e){var t=n(e),i=this;t.length&&(t.empty(),this.$icContainer=t,this.containerAttachedToDOM=new n.Deferred,s(function(){i.$icContainer.html(i.$el),i.containerAttachedToDOM.resolve()}))},render:function(){var e=this,t=new n.Deferred;return this.containerAttachedToDOM.done(function(){e.$el.empty(),e._renderControls(),t.resolve()}),t},_renderControls:function(){var e=this;this.collection.each(function(t){var t=e.controlViews[t.get("id")];t&&(e.$el.append(t.$el),t.trigger("attached"))}),this.trigger("controls:rendered")},disable:function(){o.pluck(this.controlViews,"disable")},enable:function(){o.pluck(this.controlViews,"enable")},_disableICs:function(e){var t=this;o.each(e,function(e){t.controlViews[e]&&t.controlViews[e].disable()})},_enableICs:function(e){var t=this;o.each(e,function(e){t.controlViews[e]&&!t.controlViews[e].model.get("readOnly")&&t.controlViews[e].enable()})},remove:function(){o.pluck(this.controlViews,"remove"),this.collection.off("reset",this._createControlViews,this),r.View.prototype.remove.call(this)}})});