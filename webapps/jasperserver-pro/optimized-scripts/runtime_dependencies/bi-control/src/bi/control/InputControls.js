/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","backbone","runtime_dependencies/js-sdk/src/common/bi/component/util/biComponentUtil","runtime_dependencies/js-sdk/src/common/bi/component/BiComponent","./model/InputControlPropertiesModel","./collection/InputControlCollection","./view/InputControlCollectionView","./error/biComponentErrorFactoryInputControlsProxy","json!./schema/InputControls.json"],function(e,t,r){function o(e,t,r,o){var n=this.validate(),c=this,p={};if(n)return void e.reject(C.validationError(n));var d=r.validate();if(d)return void e.reject(C.inputControlsValidationError(d));s(t,r),p.params=i.cloneDeep(t.properties.params)||{},i.defaults(p.params,r.getState());var l=i.isEmpty(p.params)?"fetch":"update";if(t.properties.container){var u=a(t.properties.container);u.length&&"1"==u[0].nodeType||e.reject(C.containerNotFoundError(t.properties.container)),o.setContainer(u)}r[l](p).done(function(o){t.data=r.toJSON(),t.data.parameters=r.getState(),e.resolve(c.data())}).fail(function(t){"generic.error.message"===t.responseJSON.errorCode&&-1!=t.responseJSON.message.search(/Parameter [\S]+ does not exist/)?e.reject(C.inputControlParameterNotFound(t.responseJSON.message)):e.reject(C.requestError(t))})}function n(e,t,r){var o=this;t.properties.params={},r.fetch().done(function(n){t.data=r.toJSON(),t.data.parameters=r.getState(),e.resolve(o.data())}).fail(function(t){"generic.error.message"===t.responseJSON.errorCode&&-1!=t.responseJSON.message.search(/Parameter [\S]+ does not exist/)?e.reject(C.inputControlParameterNotFound(t.responseJSON.message)):e.reject(C.requestError(t))})}function s(e,t){i.extend(t,{resourceUri:e.properties.resource,contextPath:e.properties.server})}var a=e("jquery"),i=e("underscore"),c=e("backbone"),p=e("runtime_dependencies/js-sdk/src/common/bi/component/util/biComponentUtil"),d=e("runtime_dependencies/js-sdk/src/common/bi/component/BiComponent"),l=e("./model/InputControlPropertiesModel"),u=e("./collection/InputControlCollection"),m=e("./view/InputControlCollectionView"),C=e("./error/biComponentErrorFactoryInputControlsProxy"),f=e("json!./schema/InputControls.json"),v=i.keys(f.properties),j=["properties"],S=["data"],g=function(e){var t={properties:i.extend({},e),data:[]},r=new l(e||{});p.createInstancePropertiesAndFields(this,t,v,j,S,r);var s=new u([],{stateModel:r}),a=new m({collection:s,stateModel:r});i.extend({},c.Events).listenTo(s,"changeState",function(){t.data=s.toJSON(),t.data.parameters=s.getState()}),i.extend(this,{validate:p.createValidateAction(t,f,r),run:p.createDeferredAction(o,r,t,s,a),reset:p.createDeferredAction(n,r,t,s)})};g.prototype=new d,r.exports=g});