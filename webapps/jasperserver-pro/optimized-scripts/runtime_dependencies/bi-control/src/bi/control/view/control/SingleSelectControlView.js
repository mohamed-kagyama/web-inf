/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","../BaseInputControlView","jquery","runtime_dependencies/js-sdk/src/components/singleSelect/view/SingleSelect","runtime_dependencies/js-sdk/src/components/singleSelect/dataprovider/CacheableDataProvider","../../util/inputControlHelpers","text!../../template/singleSelectTemplate.htm"],function(e,t,i){var s=e("underscore"),n=e("../BaseInputControlView"),l=e("jquery"),o=e("runtime_dependencies/js-sdk/src/components/singleSelect/view/SingleSelect"),a=e("runtime_dependencies/js-sdk/src/components/singleSelect/dataprovider/CacheableDataProvider"),c=e("../../util/inputControlHelpers"),r=e("text!../../template/singleSelectTemplate.htm");i.exports=n.extend({template:r,renderStructure:function(){this.singleSelect||(this.dataProvider=new a,this.singleSelect=new o({getData:this.dataProvider.getData}).setDisabled(this.model.get("readOnly"))),this.template&&(this.singleSelect.undelegateEvents(),this.setElement(l(s.template(this.template||"")(this._renderData()))),this.singleSelect.renderData(),this.singleSelect.$el.insertBefore(this.$el.find(".jr-mInput-alert")),this.singleSelect.delegateEvents(),this.updateOptionsSelection())},updateOptionsSelection:function(){var e=this.model.state.options.toJSON();this.dataProvider.setData(e);var t=this;this.singleSelect.fetch(function(){t.singleSelect.setValue(c.extractSelection(e,!0),{silent:!0})})},bindCustomEventListeners:function(){var e=this;this.singleSelect.off("selection:change").on("selection:change",function(e){this.model.changeState(e)},this),this.model.state.options.on("reset",this.updateOptionsSelection,this),this.model.state.options.on("change:selected",this.updateOptionsSelection,this),this.$el.on("click",".jr-mInput-label",function(){e.singleSelect.$input.focus()})},remove:function(){this.$el.off("change","input"),this.$el.off("click","a"),this.$el.off("click",".jr-mInput-label"),this.singleSelect.remove(),this.model.state.options.off("reset",this.updateOptionsSelection,this),this.model.state.options.off("change:selected",this.updateOptionsSelection,this),n.prototype.remove.call(this)}})});