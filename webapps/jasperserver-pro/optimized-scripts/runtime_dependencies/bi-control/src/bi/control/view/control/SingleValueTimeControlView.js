/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","../BaseInputControlView","jquery","underscore","runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker","text!../../template/singleValueTimeTemplate.htm","settings!dateTimeSettings","runtime_dependencies/js-sdk/src/common/util/parse/date","runtime_dependencies/js-sdk/src/common/util/parse/time"],function(e,t,i){function s(e){return e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"").replace(/[\s]*(\+|\-)[\s]*/g,"$1")}var n=e("../BaseInputControlView"),a=e("jquery"),r=e("underscore"),o=e("runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker"),d=e("text!../../template/singleValueTimeTemplate.htm"),m=e("settings!dateTimeSettings"),u=e("runtime_dependencies/js-sdk/src/common/util/parse/date"),c=e("runtime_dependencies/js-sdk/src/common/util/parse/time");i.exports=n.extend({template:d,initialize:function(e){this.renderStructure(e),this.renderState(),this.model.get("visible")&&(this.setupCalendar(),this.bindCustomEventListeners()),this.model.get("readOnly")&&this.disable(),this.updateWarningMessage()},setupCalendar:function(){var e,t,i=this,n=this.$el.find("input"),d=this.model.get("dataType"),u=null,l=null;d&&d.minValue&&(u=new Date,e=c.iso8601TimeToTimeObject(d.minValue),u.setHours(e.hours),u.setMinutes(e.minutes),u.setSeconds(e.seconds+(d.strictMin?1:0))),d&&d.maxValue&&(l=new Date,t=c.iso8601TimeToTimeObject(d.maxValue),l.setHours(t.hours),l.setMinutes(t.minutes),l.setSeconds(t.seconds-(d.strictMax?1:0))),this.picker=new o({el:n,currentText:m.timepicker.currentText,timeFormat:m.timepicker.timeFormat,disabled:n[0].disabled,onClose:r.bind(this.updateState,this),minDateTime:u,maxDateTime:l}),n.change(r.bind(function(e){e.stopPropagation();var t=a(e.target),i=s(t.val());t.val(i),this.updateState(i)},this)),this.$el.find(".jr-mInput-datetrigger").on("click",function(){i.picker.show()})},updateValue:function(e){var t=u.isoTimeToLocalizedTime(e);this.$el.find("input").val(t)},updateState:function(e){this.model.changeState(u.localizedTimeToIsoTime(e))},bindCustomEventListeners:function(){this.listenTo(this.model.state,"change:value",function(e,t){this.updateValue(t)},this),this.listenTo(this.model.state,"reset change",this.updateWarningMessage,this)},remove:function(){this.picker.remove(),n.prototype.remove.call(this)}})});