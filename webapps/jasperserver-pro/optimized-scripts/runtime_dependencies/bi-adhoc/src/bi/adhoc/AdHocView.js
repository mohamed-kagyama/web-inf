/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","runtime_dependencies/js-sdk/src/common/bi/component/BiComponent","runtime_dependencies/js-sdk/src/common/bi/component/util/biComponentUtil","./error/biComponentErrorFactoryAdHocViewProxy","../../adhoc/api/AdHocViewFacade","../../adhoc/api/model/AdHocPropertiesModel","json!./schema/AdHocView.json","runtime_dependencies/js-sdk/src/common/logging/logger","json!./schema/AdHocViewDatasetComponent.json"],function(e,r,t){function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function n(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(t,!0).forEach(function(r){i(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e){var r=l.omit(e,"container");return n({},l.cloneDeep(r),{container:e?e.container:""})}function c(e,r,t){var o=this.validate();if(o)e.reject(j.validationError(o));else{if(r.properties.container&&0===m(r.properties.container).length){var n=j.containerNotFoundError(r.properties.container);return A.error(n.toString()),void e.reject(n)}t.adv||(t.adv=new y(r,{stateModel:t.stateModel})),t.adv.run(e,r)}}function d(e,r,t){var o=this.validate();if(o)e.reject(j.validationError(o));else{if(0===m(r.properties.container).length){var n=j.containerNotFoundError(r.properties.container);return A.error(n.toString()),void e.reject(n)}t.adv||(t.adv=new y(r.properties,{stateModel:t.stateModel})),t.adv.refresh(e)}}function s(e,r){r.stateModel.set("_destroyed",!0),r.adv?r.adv.destroy(e):e.resolve()}function p(e,r){if(r.adv)r.adv.resize(),e.resolve();else{var t=j.notYetRenderedError();A.error(t.toString()),e.reject(t)}}function u(e,r,t){return function(){var o,n,i,a,c,d=new m.Deferred;if(r.get("_destroyed"))o=j.alreadyDestroyedError(),A.error(o.toString()),d.reject(o);else try{if(l.isArray(arguments[0]))n=arguments[0],i=arguments[1],a=arguments[2],c=arguments[3];else if(l.isString(arguments[0]))n=[l.extend({},arguments[1],{id:arguments[0]})],i=arguments[2],a=arguments[3],c=arguments[4];else{if(l.isFunction(arguments[0])||l.isUndefined(arguments[0]))throw new Error("Invalid arguments supplied. No component to update");n=[arguments[0]],i=arguments[1],a=arguments[2],c=arguments[3]}i&&l.isFunction(i)&&d.done(i),a&&l.isFunction(a)&&d.fail(a),c&&l.isFunction(c)&&d.always(c);var s=l.reduce(n,function(e,r){if(!e){var t=v.validateObject(O[r.id],l.omit(r,"id"));t&&(e=j.validationError(t))}return e},!1);if(s)d.reject(s);else{var p=l.compact(l.map(n,function(r){var t=e.adv.dataComponents[r.id];if(t&&t.updateFromDataComponent)return t.updateFromDataComponent(r)}));m.when.apply(m,p).then(function(){d.resolve(t.data)}).fail(function(e){d.reject(e)})}}catch(e){o=j.javaScriptException(e),A.error(o.toString()),d.reject(o)}return d}}var l=e("underscore"),m=e("jquery"),f=e("runtime_dependencies/js-sdk/src/common/bi/component/BiComponent"),v=e("runtime_dependencies/js-sdk/src/common/bi/component/util/biComponentUtil"),j=e("./error/biComponentErrorFactoryAdHocViewProxy"),y=e("../../adhoc/api/AdHocViewFacade"),g=e("../../adhoc/api/model/AdHocPropertiesModel"),b=e("json!./schema/AdHocView.json"),h=e("runtime_dependencies/js-sdk/src/common/logging/logger"),w=e("json!./schema/AdHocViewDatasetComponent.json"),A=h.register("AdhocView"),O={_dataset_internal_:w},D=l.keys(b.properties),P=["properties"],_=["data"],E=function(e){var r={properties:l.extend({},e),data:{}},t=new g(a(e)),o={stateModel:t};v.createInstancePropertiesAndFields(this,r,D,P,_,t),l.extend(this,{validate:v.createValidateAction(r,b,t),run:v.createDeferredAction(c,t,r,o),refresh:v.createDeferredAction(d,t,r,o),destroy:v.createDeferredAction(s,t,o),resize:v.createDeferredAction(p,t,o),_updateComponent_internal_:u(o,t,r)})};E.prototype=new f,t.exports=E});