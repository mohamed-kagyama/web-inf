/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../enum/QueryVariableTypes","../enum/DefaultFormatMap","../enum/DefaultFormatBundle","../enum/TypeKindMap","bundle!AdHocBundle"],function(e,t,i){function a(e){var t=e.get("functionName"),i=e.isDateTime()?e.get("type"):r.DECIMAL;return"Sum"===t?e.isFloat()?r.BIG_DECIMAL:r.LONG:"CountAll"===t||"CountDistinct"===t?r.LONG:"Average"===t?r.DOUBLE:"Max"===t||"Median"===t||"Min"===t||"Mode"===t||"Range"===t||"StdDevP"===t||"StdDevS"===t?i:"RangeDays"===t||"RangeHours"===t||"RangeMinutes"===t||"RangeMonths"===t||"RangeQuarters"===t||"RangeSemis"===t||"RangeWeeks"===t||"RangeYears"===t?r.BIG_DECIMAL:void 0}var n=e("underscore"),s=e("backbone"),r=e("../enum/QueryVariableTypes"),o=e("../enum/DefaultFormatMap"),g=e("../enum/DefaultFormatBundle"),u=e("../enum/TypeKindMap"),l=e("bundle!AdHocBundle"),h=s.Model.extend({defaults:{timeBalanceFunctionName:"TimeBalanceDefault",includeAll:!1},initialize:function(){this.isDateTime()?this.has("categorizer")||this.set({categorizer:this.defaultCategorizer()},{silent:!0}):"all"===this.get("categorizer")&&this.unset("categorizer",{silent:!0}),this.has("aggregationType")||this.set({aggregationType:a(this)},{silent:!0}),this.has("format")||(this.has("aggregationFormat")&&u[this.get("aggregationType")]===u[this.get("type")]?this.set({format:this.get("aggregationFormat"),formatId:this.get("aggregationFormatId")}):this.set({format:g[o[this.get("type")]],formatId:o[this.get("type")]},{silent:!0})),this.has("aggregationFormat")||(u[this.get("aggregationType")]===u[this.get("type")]?this.set({aggregationFormat:this.get("format"),aggregationFormatId:this.get("formatId")},{silent:!0}):this.set({aggregationFormat:g[o[this.get("type")]],aggregationFormatId:o[this.get("type")]},{silent:!0})),this.has("defaultFunctionName")||this.set({defaultFunctionName:this.collection.adHocModel.schema.getByReference(this.get("hierarchicalName")).aggregation},{silent:!0})},label:function(e){var t;return this.has("labelId")&&this.collection.adHocModel.bundles.length&&(t=this.collection.adHocModel.bundles.getCurrent().toLabel(this.get("labelId"))),n.isUndefined(t)&&(t=this.has("label")?this.get("label"):this.get("dimension")),e&&this.has("functionName")&&this.get("functionName")!==this.get("defaultFunctionName")&&(t+=" ("+l["adhoc.function.aggregate.name."+this.get("functionName")]+")"),t},isDateTime:function(){return this.isDate()||this.isTime()},isDate:function(){var e=this.get("type");return e===r.DATE||e===r.TIMESTAMP},isTime:function(){return this.get("type")===r.TIME},isFloat:function(){var e=this.get("type");return e===r.DECIMAL||e===r.BIG_DECIMAL||e===r.DOUBLE||e===r.FLOAT},isString:function(){return this.get("type")===r.STRING},isMeasure:function(){return"measure"===this.get("kind")},isLevel:function(){return"level"===this.get("kind")},isDefaultCategorizer:function(){return this.get("categorizer")===this.defaultCategorizer()},defaultCategorizer:function(){if(this.isDateTime())return this.isTime()?"minute":"day"},toQueryMultiaxisAxisItem:function(){var e;if(this.isMeasure())e={aggregations:{}};else{if(!this.isLevel())throw new Error("Unknown kind: "+this.get("kind"));e={level:n.pick(this.attributes,"id","includeAll","dimension")},e.level.field=this.get("hierarchicalName"),this.isDateTime()&&(e.level.categorizer=this.get("categorizer"))}return e}});i.exports=h});