/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone"],function(e,t,r){function n(e,t,r){var n=i.filter(e,function(e){return e.member});return i.reduce(r.axis.multiAxisMap(function(t){var r="measure"===t.get("kind"),n=i.find(e,function(e){return e.level&&(r&&e.level.aggregation||!r&&t.get("id")===e.level.fieldRef)});return n||(n={level:{expanded:!1,aggregation:r}},r||(n.level.fieldRef=t.has("id")?t.get("id"):t.get("hierarchicalName"))),n}),function(e,t){return t.level.aggregation?(e.hasMeasure||e.res.push(t),e.hasMeasure=!0):e.res.push(t),e},{hasMeasure:!1,res:[]}).res.concat(n)}var i=e("underscore"),u=e("backbone");r.exports=u.Collection.extend({initialize:function(e,t){this.query=t.query,this.axis=t.axis},reset:function(e,t){return u.Collection.prototype.reset.call(this,n(e,this.query,this.axis),t)},getByGroupByItem:function(e){if(e.level){var t=e.level.id||e.level.field;return this.find(function(e){var r=e.get("level");if(r)return r.fieldRef===t})}if(e.aggregations)return this.find(function(e){var t=e.get("level");if(t)return t.aggregation})},getByPath:function(e){return this.find(function(t){var r=t.get("member");if(r&&r.path.length===e.length){for(var n=0;n<e.length;n++)if(r.path[n]!==e[n])return!1;return!0}return!1})},getLevelExpansions:function(){return this.filter(function(e){return!e.has("member")})},getMemberExpansions:function(){return this.filter(function(e){return e.has("member")})},toJSON:function(e){return e&&e.isChartMode?i.compact(this.map(function(t){if(t.get("level"))return t.toJSON(e)})):u.Collection.prototype.toJSON.call(this,e)}})});