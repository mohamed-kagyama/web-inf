/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","jquery","backbone","bundle!AdHocBundle","./model/CrosstabAuxModel","text!./template/crosstabTemplate.htm","text!../template/empty.htm","./view/CrosstabCornerView","./view/CrosstabHeaderView","./view/CrosstabBodyView","perfect-scrollbar"],function(t,e,s){function i(t){if(t.has("member")){var e=t.get("member");if(e.path.length===this.member.path.length){for(var s=0;s<e.path.length;s++)if(e.path[s]!==this.member.path[s])return!1;return!0}}return!1}function o(t){return t.has("level")&&t.get("level").fieldRef===this.level.fieldRef}function a(t,e){var s,i,o,a;for(s=t.length-1;s>-1;s--)if(!t.models[s].hasSummary()&&!t.models[s].isMeasure()){for(i=t.models[s];(i=i.prevLevel())&&(!i.hasSummary()||i.isMeasure()););r(i,e)&&(i=t.models[s].prevLevel())&&(o=e.getByGroupByItem(i.isMeasure()?{aggregations:{}}:i.level().toQueryMultiaxisAxisItem()),a=b.clone(o.get("level")),a.expanded=!0,o.set("level",a))}}function r(t,e){var s,i,o=t;if(o){for(;(o=o.prevLevel())&&!(i=o.level()););s=!o||e.getByGroupByItem(i.toQueryMultiaxisAxisItem()).get("level").expanded}else s=!0;return s}function n(t){this._rendering=!0,t?(this.crosstabColumnsView.scrollTo(0),this.crosstabBodyView.scrollToLeft(0)):(this.crosstabRowsView.scrollTo(0),this.crosstabBodyView.scrollToTop(0)),this.auxModel.set(t?"colsOffset":"rowsOffset",0,{silent:!0})}function l(t){var e,s;if(this._fromScroll?this._fromScroll===x?s=this.crosstabBodyView.validateViewportWidth(t.columns,this.auxModel.get("colsOffset"),this.auxModel.get("colsPageSize")):e=this.crosstabBodyView.validateViewportHeight(t.rows,this.auxModel.get("rowsOffset"),this.auxModel.get("rowsPageSize")):(e=h(t.rows,this.auxModel.get("rowsOffset"),this.auxModel.get("rowsPageSize")),s=h(t.columns,this.auxModel.get("colsOffset"),this.auxModel.get("colsPageSize")),-1==s&&-1==e&&(e=this.crosstabRowsView.validateViewport(t.rows,this.auxModel.get("rowsOffset"),this.auxModel.get("rowsPageSize")),s=this.crosstabColumnsView.validateViewport(t.columns,this.auxModel.get("colsOffset"),this.auxModel.get("colsPageSize")))),s>=0||e>=0){var i={};return s>=0&&(i.colsOffset=s),e>=0&&(i.rowsOffset=e),i}}function h(t,e,s){var i=-1;if(!t.range.length&&t.loaded&&e>=t.loaded){for(i=e;i>t.loaded;)i-=s;i=Math.max(i,0)}return i}function d(t){for(var e=t[0],s=1;s<t.length;s++)e=e>t[s]?t[s]:e;return e}function c(t,e,s,i){if(s.get("orderBy")){b.each(b.compact(b.map(s.get("orderBy"),function(t){return t.topN||t.bottomN||t.member})),function(s){if(e.member){var o=s.path.length-e.member.path.length;if(o<=2&&o>0){for(var a=0;a<e.member.path.length;a++)if(s.path[a]!==e.member.path[a])return;i.keepAxis(t.id)}}if(e.level){var r=t.axis.multiAxisMap(function(t,e){return t}),n=1+b.reduce(r,function(t,s,i){return(e.level.aggregation&&s.isMeasure()||e.level.fieldRef===s.get("id"))&&(t=i),t},-1),o=s.path.length-n;o<=2&&o>0&&i.keepAxis(t.id)}})}}var b=t("underscore"),u=t("jquery"),p=t("backbone"),w=t("bundle!AdHocBundle"),m=t("./model/CrosstabAuxModel"),f=t("text!./template/crosstabTemplate.htm"),g=t("text!../template/empty.htm"),C=t("./view/CrosstabCornerView"),y=t("./view/CrosstabHeaderView"),v=t("./view/CrosstabBodyView");t("perfect-scrollbar");var x="horz";s.exports=p.View.extend({DEFAULT_CROSSTAB_HEIGHT:500,el:function(){return u(b.template(f)({i18n:w}))[0]},initialize:function(t){this.options=t,this.adHocModel=t.dataModel,this.auxModel=new m({},t),this.rowsProperties={},this.columnsProperties={},this._initElements(),this._initExpansions(),this.crosstabCornerView=new C({model:t.dataModel,el:this.$headerRowLabelsContainer}),this.crosstabColumnsView=new y({model:t.dataModel,el:this.$headerColumnLabelsContainer,options:t.options,orientation:y.Orientation.HORIZONTAL}),this.crosstabRowsView=new y({model:t.dataModel,el:this.$bodyRowLabelsContainer,options:t.options,orientation:y.Orientation.VERTICAL}),this.crosstabBodyView=new v({model:t.dataModel,el:this.$bodyDataContainer,options:t.options}),this.listenTo(this.crosstabBodyView,"scroll",this.onScroll,this),this.crosstabRowsView.listenTo(this.crosstabBodyView,"scroll:y",this.crosstabRowsView.scrollTo,this.crosstabRowsView),this.crosstabColumnsView.listenTo(this.crosstabBodyView,"scroll:x",this.crosstabColumnsView.scrollTo,this.crosstabColumnsView),this.listenTo(this.crosstabRowsView,"expansion",this.expandRow,this),this.listenTo(this.crosstabColumnsView,"expansion",this.expandColumn,this),this.listenTo(this.crosstabCornerView,"expansion:column",b.bind(n,this,!0)),this.listenTo(this.crosstabCornerView,"expansion:row",b.bind(n,this,!1)),this.listenTo(this.crosstabCornerView,"expansion:column",this.expandColumn,this),this.listenTo(this.crosstabCornerView,"expansion:row",this.expandRow,this),this.listenTo(this.crosstabBodyView,"hyperlink",this.onHyperlink,this),this.listenTo(this.crosstabRowsView,"hyperlink",this.onHyperlink,this),this.listenTo(this.crosstabColumnsView,"hyperlink",this.onHyperlink,this),this.listenToOnce(this.auxModel,"data:data",function(t){this.adHocModel.bundles.bundle().done(b.bind(function(){this.listenTo(this.auxModel,"data:data",this.onDataSetChange,this),this.onDataSetChange(t)},this))},this),this.listenTo(this.auxModel,"data:error",b.bind(this.adHocModel.trigger,this.adHocModel,"component:error")),this.listenTo(this.auxModel,"data:loading",function(t){t&&this.adHocModel.trigger("component:busy",!0)},this),this.enableHyperlinks()},isAcceptable:function(t){return"Crosstab"===t},render:function(t){return t&&(t.append(this.$el),this.$el.height()||(this.el.style.height="100%")),this._refresh(new u.Deferred).promise()},refresh:function(t){return this._refresh(t,!0)},onDataSetChange:function(t){var e=l.call(this,t);e?this.auxModel.set(e):(this.crosstabBodyView.isEmptyCrosstab()?this.$el.parent().html(b.template(g,{i18n:w})):(this.crosstabRowsView.acquireData(t),this.crosstabBodyView.acquireData(t),this.crosstabColumnsView.acquireData(t),this.crosstabCornerView.render(),this.crosstabBodyView.render(),this.crosstabRowsView.render(),this.crosstabColumnsView.render(),this._resetStyling(),this._synchronizeWidthsCorner(t),this._alignTables(t),this._synchronizeWidthsBody(t),this._updateStretchedState(),this._synchronizeHeights(t),this._updateViewPortSize(t),this._updateScrollState(),this._applyLookAndFeel(),this._updateCalculatedValues(t),this._processLinks()),this._done())},expandRow:function(t){this.crosstabBodyView.hasData()&&this._expand(this.adHocModel.dataSet.query.rows,t)},expandColumn:function(t){this.crosstabBodyView.hasData()&&(c(this.adHocModel.dataSet.query.cols,t,this.adHocModel.dataSet.query,this.auxModel),this._expand(this.adHocModel.dataSet.query.cols,t))},resize:function(){this._alignTables(),this._updateStretchedState(),this._updateCalculatedValues(),this._updateScrollState(),this._checkDataEdge()},remove:function(){return this._hasPs&&this.$bodyDataContainer.perfectScrollbar("destroy"),this.crosstabCornerView.remove(),this.crosstabColumnsView.remove(),this.crosstabRowsView.remove(),this.crosstabBodyView.remove(),this.auxModel.dispose(),p.View.prototype.remove.call(this)},enableHyperlinks:function(t){t||(t=this.options.options.linkOptions),t&&(this.crosstabColumnsView.enableHyperlinks(t),this.crosstabRowsView.enableHyperlinks(t),this.crosstabBodyView.enableHyperlinks(t))},disableHyperlinks:function(){this.crosstabColumnsView.disableHyperlinks(),this.crosstabRowsView.disableHyperlinks(),this.crosstabBodyView.disableHyperlinks()},_done:function(){this._rendering=!1,this._fromScroll=!1,this.rendered||(this.rendered=!0,this._checkDataEdge()),this.crosstabRowsView.onDone(),this.crosstabColumnsView.onDone(),this.adHocModel.trigger("component:busy",!1)},_refresh:function(t,e){return this.rendered=!1,this._rendering=!0,this.auxModel.once("data:data",function(){t.resolve()},this),this.crosstabColumnsView.scrollTo(0),this.crosstabBodyView.scrollToLeft(0),this.crosstabRowsView.scrollTo(0),this.crosstabBodyView.scrollToTop(0),e&&this.adHocModel.dataSet.resetDataset(),this.auxModel.reset(),this.adHocModel.dataSet.data().fail(b.bind(t.reject,t)),t},_expand:function(t,e){var s=t.expansions.find(b.bind(e.level?o:i,e));s?s.has("member")&&s.get("member").expanded&&!e.member.expanded?t.expansions.remove(s):s.set(e):t.expansions.add(e)},_applyLookAndFeel:function(){this.adHocModel.component.getCrosstabComponent().getRowsComponent().components.length&&this.crosstabBodyView.hasData()||this.$bodyContainer.addClass("jr-isEmpty");var t=this.$bodyRowLabelsTable.outerWidth(!0)>this.$headerRowLabelsContainer.outerWidth(!0)?this.$bodyRowLabelsTable.outerWidth(!0):this.$headerRowLabelsContainer.outerWidth(!0),e=parseInt(this.$bodyDataContainer.css("border-right-width"));this.$bodyRowLabelsContainer.width(t),this.$bodyDataContainer.css({left:t}),this.$headerRowLabelsContainer.width(t),this.$headerColumnLabelsContainer.css({left:t}),this.$el.width()<this.$bodyDataContainer.width()+t+e&&(this.$bodyDataContainer.width(this.$el.width()-t-e),this.$headerColumnLabelsContainer.width(this.$el.width()-t-e))},_processLinks:function(){var t,e,s,i,o=this.options.options.linkOptions;if(o&&o.beforeRender){t=[],i=this.crosstabBodyView.$(".jr-jHyperLink"),e=this.crosstabColumnsView.getHyperlinks(),s=this.crosstabRowsView.getHyperlinks();for(var a=0,r=s.bottomDataRow.length;a<r;a++)for(var n=0,l=e.bottomDataRow.length;n<l;n++)t.push({element:i[a*l+n],data:b.extend({},s.bottomDataRow[a],e.bottomDataRow[n])});o.beforeRender(s.all.concat(e.all,t))}},_initExpansions:function(){a(this.adHocModel.component.getCrosstabComponent().getColumnsComponent().components,this.adHocModel.dataSet.query.cols.expansions),a(this.adHocModel.component.getCrosstabComponent().getRowsComponent().components,this.adHocModel.dataSet.query.rows.expansions)},_initElements:function(){this.$headerRowLabelsContainer=this.$(".jr-mDatatableCrosstab-header-rowlabelsContainer"),this.$headerColumnLabelsContainer=this.$(".jr-mDatatableCrosstab-header-columnlabelsContainer"),this.$headerColumnLabelsTable=this.$(".jr-mDatatableCrosstab-header-columnlabelsContainer .jr-mDatatable.jr-mDatatableCrosstab"),this.$headerColumnLabelsBackground=this.$(".jr-mDatatableCrosstab-header-columnlabelsContainer .jr-DatatableCrosstab-background"),this.$bodyRowLabelsContainer=this.$(".jr-mDatatableCrosstab-body-rowlabelsContainer"),this.$bodyRowLabelsTable=this.$(".jr-mDatatableCrosstab-body-rowlabelsContainer .jr-mDatatable.jr-mDatatableCrosstab"),this.adHocModel.component.getCrosstabComponent().get("mergeCrosstabCells")||this.$bodyRowLabelsTable.addClass("jr-isUnmerged"),this.$bodyRowLabelsBackground=this.$(".jr-mDatatableCrosstab-body-rowlabelsContainer .jr-DatatableCrosstab-background"),this.$bodyDataContainer=this.$(".jr-mDatatableCrosstab-body-dataContainer"),this.$bodyContainer=this.$(".jr-mDatatableCrosstab-bodyContainer"),this.$bodyDataTable=this.$(".jr-mDatatableCrosstab-body-dataContainer .jr-mDatatable.jr-mDatatableCrosstab"),this.$bodyDataBackground=this.$(".jr-mDatatableCrosstab-body-dataContainer .jr-mDatatableCrosstab-background")},_updateStretchedState:function(){if(this.columnsProperties.stretched){var t,e,s,i;this.$headerColumnLabelsTable.addClass("jr-uWidth-100pc"),this.$bodyDataTable.addClass("jr-uWidth-100pc"),s=this.$headerColumnLabelsContainer.find(".jr-mDatatable-cellSpacer"),i=this.$bodyDataTable.find(".jr-mDatatable-cell:lt("+s.length+")"),t=b.map(s,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width")))}),e=b.map(i,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width")))});for(var o=0;o<i.length;o++){var a=Math.max(t[o],e[o]);i[o].style.maxWidth=a+"px",s[o].style.maxWidth=a+"px"}}},_synchronizeWidthsBody:function(t){var e,s,i,o,a;o=this.$headerColumnLabelsContainer.find(".jr-mDatatable-cellSpacer"),a=this.$bodyDataTable.find(".jr-mDatatable-cell:lt("+o.length+")"),e=b.map(o,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width"))+1)}),s=b.map(a,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width"))+1)}),i=[];for(var r=0;r<s.length;r++){var n=t.columns.range[r][t.columns.range[r].length-1],l=Math.max(e[r],s[r],n.pixels||0);i.push(l),n.pixels=l}t.columns.resultPixels=i;for(var r=0,h=i.length;r<h;r++){var c=i[r]+"px";a[r].style.minWidth=c,o[r].style.minWidth=c}this.columnsProperties.minCellSize=d(i.length?i:e)},_synchronizeWidthsCorner:function(t){var e,s,i,o=this.$headerRowLabelsContainer.find(".jr-mDatatable-cellColumnlabel"),a=this.$bodyRowLabelsContainer.find(".jr-mDatatable-row:first").find(".jr-mDatatable-cell");if(o.length){e=b.map(o,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width")))}),s=b.map(a,function(t){var e=u(t);return Math.ceil(e.find("div:first-child").width()+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right"))+parseInt(e.css("border-left-width"))+parseInt(e.css("border-right-width")))}),i=Math.min(o.length,a.length);for(var r=0;r<i;r++){var n=Math.max(e[r],s[r])+"px";o[r].style.minWidth=n,a[r].style.minWidth=n}}},_synchronizeHeights:function(t){var e,s,i,o,a;if(Math.abs(this.$bodyDataTable.height()-this.$bodyRowLabelsTable.height())<=1&&"nowrap"===this.$bodyDataTable.find(".jr-mDatatable-cell-wrapper:first").css("whiteSpace")){this.rowsProperties.minCellSize||(this.rowsProperties.minCellSize=this.$(".jr-mDatatable-cell:first")[0].offsetHeight),i=[];for(var r=0;r<t.rows.range.length;r++){var n=t.rows.range[r][t.rows.range[r].length-1];i.push(this.rowsProperties.minCellSize),n.pixels=this.rowsProperties.minCellSize}t.rows.resultPixels=i}else{o=this.$bodyRowLabelsContainer.find(".jr-mDatatable-row").find(".jr-mDatatable-cell:last"),a=this.$bodyDataTable.find(".jr-mDatatable-row").find(".jr-mDatatable-cell:first"),e=b.map(o,function(t){return t.offsetHeight}),s=b.map(a,function(t){return t.offsetHeight}),i=[];for(var r=0;r<s.length;r++){var n=t.rows.range[r][t.rows.range[r].length-1],l=Math.max(e[r],s[r],n.pixels||0);i.push(l),n.pixels=l}t.rows.resultPixels=i;for(var r=0,h=i.length;r<h;r++){var c=i[r]+"px";a[r].style.height=c,o[r].style.height=c}for(var u=this.$headerRowLabelsContainer.find(".jr-mDatatable-row"),p=this.$headerColumnLabelsContainer.find(".jr-mDatatable-row"),w=b.map(u,function(t){return t.offsetHeight}),m=b.map(p,function(t){return t.offsetHeight}),f=Math.min(w.length,m.length),r=0;r<f;r++){var c=Math.max(w[r],m[r])+"px";u[r].style.height=c,p[r].style.height=c}this.rowsProperties.minCellSize=d(i.length?i:e)}},_alignTables:function(){var t,e,s=this.$el.width(),i=this.$el.height(),o=this.$bodyDataTable.height();t=this.$headerRowLabelsContainer.width(),e=this.$headerRowLabelsContainer.height(),s-t<75?(s+=t,this.$el.css({overflowX:"auto"}),this._overflowXEnabled=!0):this._overflowXEnabled&&(this.$el.css({overflowX:"hidden"}),this._overflowXEnabled=!1),i-e<75?(i+=e,this.$el.css({overflowY:"auto"}),this._overflowYEnabled=!0):this._overflowYEnabled&&(this.$el.css({overflowX:"hidden"}),this._overflowYEnabled=!1),this.$headerColumnLabelsContainer.css({left:t,width:s-t}),this.$bodyRowLabelsContainer.css({top:e,height:Math.min(i-e,o),width:t}),this.$bodyDataContainer.css({top:e,left:t,width:s-t,height:Math.min(i-e,o)}),this.columnsProperties.stretched=Math.max(this.$headerColumnLabelsTable.width(),this.$bodyDataTable.width())<=this.$bodyDataContainer.width()},_updateViewPortSize:function(t){var e=t.rows.top<0?0:t.rows.top,s=t.columns.top<0?0:t.columns.top,i=t.columns.bottom+s+b.reduce(t.columns.resultPixels,function(t,e){return t+e}),o=t.rows.bottom+e+b.reduce(t.rows.resultPixels,function(t,e){return t+e}),a=this.crosstabRowsView.getRequiredScrollPosition(),r=this.crosstabColumnsView.getRequiredScrollPosition();this._dataTop(e),this._dataLeft(s),this._backgroundWidth(i),this._backgroundHeight(o),r>=0&&this.crosstabBodyView.scrollToLeft(r),a>=0&&this.crosstabBodyView.scrollToTop(a),this.crosstabBodyView.onScroll()},_updateScrollState:function(){this._hasPs?this.$bodyDataContainer.perfectScrollbar("update"):(this.$bodyDataContainer.perfectScrollbar(),this._hasPs=!0)},_updateCalculatedValues:function(t){t&&(this.rowsProperties.hasFirst=t.rows.hasFirst,this.rowsProperties.hasLast=t.rows.hasLast,this.columnsProperties.hasFirst=t.columns.hasFirst,this.columnsProperties.hasLast=t.columns.hasLast),this.rowsProperties.visible=Math.ceil(this.$bodyDataContainer.height()/this.rowsProperties.minCellSize)||this.rowsProperties.visible,this.columnsProperties.visible=Math.ceil(this.$bodyDataContainer.width()/this.columnsProperties.minCellSize)||this.columnsProperties.visible,this.rowsProperties.additional=Math.min(Math.floor(this.rowsProperties.visible/2),12)||this.rowsProperties.additional,this.columnsProperties.additional=Math.min(Math.floor(this.columnsProperties.visible/2),12)||this.columnsProperties.additional,this.rowsProperties.dataSizeInPixels=Math.ceil(this.$bodyDataTable.height())||this.rowsProperties.dataSizeInPixels,this.columnsProperties.dataSizeInPixels=Math.ceil(this.$bodyDataTable.width())||this.columnsProperties.dataSizeInPixels,this.rowsProperties.viewportSizeInPixels=Math.ceil(this.$bodyDataContainer.height())||this.rowsProperties.viewportSizeInPixels,this.columnsProperties.viewportSizeInPixels=Math.ceil(this.$bodyDataContainer.width())||this.columnsProperties.viewportSizeInPixels,this.rowsProperties.dataOffsetInPixels=this._dataTop(),this.columnsProperties.dataOffsetInPixels=this._dataLeft()},_resetStyling:function(){this.$headerRowLabelsContainer.attr("style",""),this.$headerColumnLabelsContainer.attr("style",""),this.$bodyRowLabelsContainer.attr("style",""),this.$headerColumnLabelsTable.removeClass("jr-uWidth-100pc"),this.$bodyDataTable.removeClass("jr-uWidth-100pc"),this.$bodyContainer.removeClass("jr-isEmpty")},onScroll:function(t){this._checkDataEdge(t)},onHyperlink:function(t){var e=this.options.options.linkOptions,s=e.events[t.event.type],i=t.data;s&&(i||(i=b.extend({},this.crosstabColumnsView.getHyperlinkData(t.column),this.crosstabRowsView.getHyperlinkData(t.row))),s.call(t.context,t.event,i))},_checkDataEdge:function(t){this._rendering||(!this.rowsProperties.hasFirst&&this._isTopEdge(t)?(this._rendering=!0,this._fromScroll="vert",this.auxModel.set({rowsOffset:Math.max(0,this.auxModel.get("rowsOffset")-this.rowsProperties.visible),rowsPageSize:this.rowsProperties.additional+this.rowsProperties.visible+this.rowsProperties.additional})):!this.rowsProperties.hasLast&&this._isBottomEdge(t)?(this._rendering=!0,this._fromScroll="vert",this.auxModel.set({rowsOffset:Math.max(0,this.auxModel.get("rowsOffset")+this.auxModel.get("rowsPageSize")-this.rowsProperties.additional-this.rowsProperties.visible),rowsPageSize:this.rowsProperties.additional+this.rowsProperties.visible+this.rowsProperties.additional})):!this.columnsProperties.hasFirst&&this._isLeftEdge(t)?(this._rendering=!0,this._fromScroll=x,this.auxModel.set({colsOffset:Math.max(0,this.auxModel.get("colsOffset")-this.columnsProperties.additional),colsPageSize:this.columnsProperties.additional+this.columnsProperties.visible+this.columnsProperties.additional})):!this.columnsProperties.hasLast&&this._isRightEdge(t)&&(this._rendering=!0,this._fromScroll=x,this.auxModel.set({colsOffset:Math.max(0,this.auxModel.get("colsOffset")+this.auxModel.get("colsPageSize")-this.columnsProperties.additional-this.columnsProperties.visible),colsPageSize:this.columnsProperties.additional+this.columnsProperties.visible+this.columnsProperties.additional})))},_dataTop:function(t){if(void 0===t)return+this.$bodyDataTable.css("top").replace("px","");this.$bodyDataTable.css({top:t}),this.$bodyRowLabelsTable.css({top:t})},_dataLeft:function(t){if(void 0===t)return+this.$bodyDataTable.css("left").replace("px","");this.$bodyDataTable.css({left:t}),this.$headerColumnLabelsTable.css({left:t})},_backgroundHeight:function(t){if(void 0===t)return this.$bodyDataBackground.height();this.$bodyDataBackground.height(t),this.$bodyRowLabelsBackground.height(t)},_backgroundWidth:function(t){if(void 0===t)return this.$bodyDataBackground.width();this.$bodyDataBackground.width(t),this.$headerColumnLabelsBackground.width(t)},_isBottomEdge:function(t){var e=t?t.top:this.$bodyDataContainer.scrollTop(),s=this.rowsProperties.dataOffsetInPixels+this.rowsProperties.dataSizeInPixels;return e=Math.ceil(e)+this.rowsProperties.viewportSizeInPixels,s-e<5},_isTopEdge:function(t){var e=t?t.top:this.$bodyDataContainer.scrollTop();return(e=Math.ceil(e))<this.rowsProperties.dataOffsetInPixels},_isLeftEdge:function(t){var e=t?t.left:this.$bodyDataContainer.scrollLeft();return(e=Math.ceil(e))<this.columnsProperties.dataOffsetInPixels},_isRightEdge:function(t){var e=t?t.left:this.$bodyDataContainer.scrollLeft(),s=this.columnsProperties.dataOffsetInPixels+this.columnsProperties.dataSizeInPixels;return e=Math.ceil(e)+this.columnsProperties.viewportSizeInPixels,s-e<5}})});