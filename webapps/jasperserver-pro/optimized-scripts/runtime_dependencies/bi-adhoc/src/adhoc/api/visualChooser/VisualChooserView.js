/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","backbone","./VisualizationTypesController","./view/TabView","./view/BodyView","text!./template/visualChooserTemplate.htm","text!./template/adHocVisualizationTemplate.htm"],function(e,i,t){var s=e("jquery"),o=e("underscore"),n=e("backbone"),a=e("./VisualizationTypesController"),r=e("./view/TabView"),l=e("./view/BodyView"),h=e("text!./template/visualChooserTemplate.htm"),d=e("text!./template/adHocVisualizationTemplate.htm");t.exports=n.View.extend({template:o.template(h),adhoctemplate:o.template(d),el:function(){return this.isDesignView?this.adhoctemplate({options:this.options}):this.template({options:this.options})},constructor:function(e){this.options=o.defaults(e||{},this.defaults),this.typesManager=this.options.typesManager,this.isDesignView=window.isDesignView,this.typesManager||(this.typesManager=new a),n.View.apply(this,arguments)},initialize:function(){o.bindAll(this,"_onGroupSelectionChange","_onTypeChange"),this.tabView=new r({minimized:this.options.minimized,typesManager:this.typesManager}),this.bodyView=new l({typesManager:this.typesManager}),this.tabView.setShowDisabledIcons(!0),this.bodyView.setShowDisabledIcons(!0);var e=this,i=["jr-mVisualchooser-menu-item-icon","jr-mVisualchooser-menu-item-label","jr-mVisualchooser-menu-item-wrapper"];this.isDesignView&&s(this.el).on("mouseover",function(t){if(!i.some(function(e){return s(t.target).hasClass(e)})){var o=e.$("li.jr-mVisualchooser-menu-item.jr-isSelected"),n=e.bodyView.getChartType(o);s(".jr-mVisualchooser-rule").addClass("jr-isSelected"),e.isDesignView&&n&&e.bodyView.showMessages(n,!1)}}),this.listenTo(this.tabView,"tabMinimizedEvent",this._onTabMinimizedEvent),this.listenTo(this.tabView,"change:groupSelected",this._onGroupSelectionChange),this.listenTo(this.bodyView,"change:visualizationType",this._onTypeChange)},render:function(){return this.$(".jr-mVisualchooser").html(this.tabView.render().$el).append(this.bodyView.render().$el),this},remove:function(){this.tabView.remove(),this.bodyView.remove(),n.View.prototype.remove.call(this)},setSelectedType:function(e){this.bodyView.setSelectedType(e)},setDisabledTypes:function(e){this.bodyView.setDisabledTypes(e)},getState:function(){return{selectedType:this.bodyView.getSelectedType(),selectedGroupName:this.tabView.getSelectedGroupName(),scrollPosition:this.bodyView.getScrollPosition(),areGroupsMinimized:this.tabView.isMinimized()}},applyState:function(e){o.isUndefined(e.selectedType)||this.setSelectedType(e.selectedType),o.isUndefined(e.selectedGroupName)||this.tabView.changeTabToGroupName(e.selectedGroupName),o.isUndefined(e.scrollPosition)||this.bodyView.setScrollPosition(e.scrollPosition),o.isUndefined(e.areGroupsMinimized)||this.tabView.setMinimized(e.areGroupsMinimized)},_onTabMinimizedEvent:function(e,i){this.trigger("tabMinimizedEvent",e,i)},_onGroupSelectionChange:function(e){this.bodyView.trigger("change:groupSelected",e)},_onTypeChange:function(e){this.trigger("change:visualizationType",e)}})});