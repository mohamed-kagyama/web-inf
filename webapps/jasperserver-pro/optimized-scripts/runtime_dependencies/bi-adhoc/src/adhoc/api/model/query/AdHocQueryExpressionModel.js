/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","backbone","../enum/MetadataToQueryTypeMap"],function(e,n,a){function r(e){var n=o.keys(e)[0],a=o.omit(e[n],"operands","start","end");return a.nodeType=n,"range"==n?a.operands=[r(e[n].start),r(e[n].end)]:"boundary"==n?a=r(e[n]):e[n].operands&&(a.operands=o.map(e[n].operands,r)),e[n].value&&(a.nodeType="literal",a.type=n),a}function t(e,n,a){if(a||(a=[]),e.nodeType===n&&a.push(e),e.operands)for(var r=0;r<e.operands.length;r++)t(e.operands[r],n,a);return a}var o=e("underscore"),i=e("backbone"),u=e("../enum/MetadataToQueryTypeMap"),s=i.Model.extend({initialize:function(e,n){this.schema=n.adHocModel.schema},acquire:function(e){e&&e.object&&this.set(r(e.object))},readFilterInformation:function(){var e=this,n=o.filter(t(this.attributes,"function"),function(e){return"filter"===e.functionName});return o.compact(o.map(n,function(n){if("DYNAMIC"===n.operands[1].value){var a=t(n.operands[2],"variable"),r=o.reduce(a,function(n,a){if(!n){var r=e.schema.getByReference(a.name);r&&(n=u[r.type]||r.type)}return n},null);return{id:n.operands[0].value,isDynamic:"DYNAMIC"===n.operands[1].value,levelName:n.operands[2].operands[0].name,filterExpression:n.operands[2],variables:o.map(a,function(e){return{name:e.name,type:r}})}}}))}});a.exports=s});