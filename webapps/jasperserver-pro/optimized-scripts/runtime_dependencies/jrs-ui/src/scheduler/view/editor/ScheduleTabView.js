/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","bundle!all","runtime_dependencies/js-sdk/src/jrs.configs","backbone","runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker","./HolidayCalView","../../collection/HolidayCalsCollection","momentExtension","text!../../template/editor/scheduleTabTemplate.htm"],function(e,t,n){var a=e("jquery"),r=e("underscore"),i=e("bundle!all"),l=e("runtime_dependencies/js-sdk/src/jrs.configs"),c=e("backbone"),s=e("runtime_dependencies/js-sdk/src/components/dateAndTime/DateAndTimePicker"),d=e("./HolidayCalView"),o=e("../../collection/HolidayCalsCollection"),h=e("momentExtension"),m=e("text!../../template/editor/scheduleTabTemplate.htm"),u=l.calendar.timepicker.dateFormat,g=l.calendar.timepicker.timeFormat.replace(":ss","");n.exports=c.View.extend({events:{"change [name=startType]":"setStartType","change [name=startDate]":"setStartDate","change [name=schedulerTimeZone]":"setTimeZone","change [name=recurrenceType]":"setRecurrenceType","change [name=recurrenceInterval]":"setRecurrenceInterval","change [name=recurrenceIntervalUnit]":"setRecurrenceIntervalUnit","change [name=endat]":"setEnDat","change [name=occurrenceCount]":"setOccurrenceCount","change [name=simpleEndDate]":"setEndDate","change [name=calendarEndDate]":"setEndDate","change [name=whichMonth]":"monthRadioSelector","change [name=monthSelector]":"setMonthSelector","change [name=whichDay]":"dayRadioSelector","change [name=daySelector]":"setDaySelector","change [name=datesInMonth]":"setDatesInMonth","change [name=hours]":"setHours","change [name=minutes]":"setMinutes","change [name=calendarSelect]":"setCalendar"},initialize:function(){this.calCollection=new o,this.calView=new d({collection:this.calCollection}),this.calCollection.fetch({reset:!0,data:{calendarType:"holiday"}}),this.listenTo(this.model,"change:trigger",this.triggerChanged),this.listenTo(this.calCollection,"reset change",this.calendarChanged)},render:function(){this.setElement(a(r.template(m,{_:r,i18n:i,timeZones:l.timeZones}))),this.$el.find("[name=calendarBlockHolder]").append(this.calView.$el),this.setupDatepickersOn()},setupDatepickersOn:function(){var e=this;this.$el.find(".datepicker").each(function(t,n){var r=a(n);new s({el:r[0],constrainInput:!0,dateFormat:u,timeFormat:g,showOn:"button",buttonText:""}),r.next().addClass("button").addClass("picker"),e.listenTo(e.model,"change:trigger",function(){var t=h.tz(e.model.get("trigger").timezone).utcOffset();a.datepicker._getInst(a(n)[0]).settings.timepicker.timezone=t}),a(n)[0].getValue=function(){return a(this).val()}})},triggerChanged:function(){var e=this.model.get("trigger");this.$el.find("[name=startType]").filter("[value="+e.startType+"]").prop("checked",!0),this.$el.find("[name=startDate]").val(e.startDate),this.$el.find("[name=schedulerTimeZone]").val(e.timezone),this.$el.find("[name=recurrenceType]").val(e.type),this.$el.find("fieldset[data-recurrence]").addClass("hidden"),this.$el.find('fieldset[data-recurrence="'+e.type+'"]').removeClass("hidden"),"none"===e.type&&this.$el.find("[name=calendarBlockHolder]").addClass("hidden"),"simple"===e.type&&(this.$el.find("[name=recurrenceInterval]").val(e.recurrenceInterval),this.$el.find("[name=recurrenceIntervalUnit]").val(e.recurrenceIntervalUnit),this.$el.find("[name=endat]").filter("[value="+e.radioEndDate+"]").prop("checked",!0),this.$el.find("[name=occurrenceCount]").val(e.occurrenceCount),this.$el.find("[name=simpleEndDate]").val(e.endDate),this.$el.find("[name=calendarBlockHolder]").removeClass("hidden"),this.$el.find("[name=calendarSelect]").val(e.calendarName)),"calendar"===e.type&&(this.$el.find("[name=whichMonth]").filter("[value="+e.radioWhichMonth+"]").prop("checked",!0),this.$el.find("[name=monthSelector]").val(e.months.month),this.$el.find("[name=whichDay]").filter("[value="+e.radioWhichDay+"]").prop("checked",!0),this.$el.find("[name=daySelector]").val(e.weekDays.day),this.$el.find("[name=datesInMonth]").val(e.monthDays),this.$el.find("[name=hours]").val(e.hours),this.$el.find("[name=minutes]").val(e.minutes),this.$el.find("[name=calendarEndDate]").val(e.endDate),this.$el.find("[name=calendarBlockHolder]").removeClass("hidden"),this.$el.find("[name=calendarSelect]").val(e.calendarName))},calendarChanged:function(){var e=this.model.get("trigger");e&&this.$el.find("[name=calendarSelect]").val(e.calendarName)},setStartType:function(e){this.model.update("trigger",{startType:a(e.target).val()})},setStartDate:function(e){this.model.update("trigger",{startType:"2",startDate:a(e.target).val()})},setTimeZone:function(e){this.model.update("trigger",{timezone:a(e.target).val()})},setRecurrenceType:function(e){this.model.update("trigger",{type:a(e.target).val()})},setRecurrenceInterval:function(e){this.model.update("trigger",{recurrenceInterval:a(e.target).val()})},setRecurrenceIntervalUnit:function(e){this.model.update("trigger",{recurrenceIntervalUnit:a(e.target).val()})},setEnDat:function(e){this.model.update("trigger",{radioEndDate:a(e.target).val()})},setOccurrenceCount:function(e){this.model.update("trigger",{occurrenceCount:a(e.target).val()})},setEndDate:function(e){this.model.update("trigger",{endDate:a(e.target).val()})},monthRadioSelector:function(e){this.model.update("trigger",{radioWhichMonth:a(e.target).val()})},setMonthSelector:function(e){for(var t=a(e.target).val()||[],n=0,r=t.length;n<r;n++)t[n]=parseInt(t[n]);this.model.update("trigger",{months:{month:t}})},dayRadioSelector:function(e){this.model.update("trigger",{radioWhichDay:a(e.target).val()})},setDaySelector:function(e){for(var t=a(e.target).val()||[],n=0,r=t.length;n<r;n++)t[n]=parseInt(t[n]);this.model.update("trigger",{weekDays:{day:t}})},setDatesInMonth:function(e){this.model.update("trigger",{monthDays:a(e.target).val()})},setHours:function(e){this.model.update("trigger",{hours:a(e.target).val()})},setMinutes:function(e){this.model.update("trigger",{minutes:a(e.target).val()})},setCalendar:function(e){this.model.update("trigger",{calendarName:a(e.target).val()})}})});