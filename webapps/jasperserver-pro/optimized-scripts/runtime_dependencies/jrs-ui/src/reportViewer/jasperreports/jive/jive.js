/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","jquery","underscore","bundle!jasperreports_messages","text!./template/jive.htm","jquery-ui/ui/position","jquery-ui/ui/widgets/draggable"],function(e,t,i){var o=e("jquery"),n=e("underscore"),s=e("bundle!jasperreports_messages"),a=e("text!./template/jive.htm");e("jquery-ui/ui/position"),e("jquery-ui/ui/widgets/draggable");var l="click";/Android|iPhone|iPad/i.test(navigator.userAgent)&&(l="touchend");var r={name:"jive",reportInstance:null,active:!1,started:!1,selectors:{},elements:{},interactive:{},clickEventName:l,isIE:/msie/i.test(navigator.userAgent),isIPad:/ipad/i.test(navigator.userAgent),isFloatingHeader:!1,isDashboard:!1,activeContainer:null,getReportContainer:function(){return this.activeContainer},i18n:s,ui:{scaleFactor:1,marker:{jo:null,position:null,setElement:function(e){this.jo=o(e),this.jo.draggable({axis:"x",start:function(e,t){r.ui.overlay.left=r.ui.overlay.jo.position().left,r.resizingColumn=!0},drag:function(e,t){r.ui.overlay.jo.width(t.position.left-r.ui.overlay.left)},stop:function(e,t){r.interactive[r.selected.ie.config.type].resize((t.position.left-r.ui.overlay.left)/(r.reportInstance.zoom?r.reportInstance.zoom.level:1)),r.resizingColumn=!1}})},show:function(e){var t=!1;this.jo||(this.setElement("#jive_marker"),t=!0),this.jo.css({height:e.h}),this.jo.appendTo(r.getReportContainer()).show(),this.jo.position({of:r.ui.overlay.jo,my:"left top",at:"right top",collision:"none"}),t&&this.jo.position({of:r.ui.overlay.jo,my:"left top",at:"right top",collision:"none"});var i=(this.jo.get(0),this.jo.get(0).style.left),o=this.jo.get(0).style.top,n=i.indexOf("px");n>0&&(i=i.substring(0,n)),n=o.indexOf("px"),n>0&&(o=o.substring(0,n)),this.position={left:i,top:o}}},overlay:{jo:null,left:null,setElement:function(e){this.jo=o(e),this.jo.draggable({cursorAt:{top:40,left:-30},containment:"parent",scroll:!1,start:function(e,t){r.hide(["foobar","marker"]),r.interactive[r.selected.ie.config.type].onDragStart(e,t)},drag:function(e,t){r.interactive[r.selected.ie.config.type].debouncedDrag.apply(e,t)},stop:function(e,t){var i=r.interactive[r.selected.ie.config.type],o=i.debouncedDrag;o.isRunning()&&o.cancelAndExecute(e,t),i.onDragStop(e,t),r.hide()}})},show:function(e){var t=!1;this.jo||(this.setElement("#jive_overlay"),t=!0),this.jo.css({width:e.w,height:e.h}).draggable("option","helper",function(e){return o("div.jive_drag_label").clone().appendTo("#jive_components").html(r.i18n["net.sf.jasperreports.components.headertoolbar.label.draghelper"]).show()}),this.jo.appendTo(r.getReportContainer()).show(),this.jo.position({of:r.selected.jo,my:"left top",at:"left top",collision:"none"}),t&&this.jo.position({of:r.selected.jo,my:"left top",at:"left top",collision:"none"})}},foobar:{jo:null,current:null,dropMenu:null,cache:{},menus:{},setElement:function(e){this.jo=o(e),this.jo.on("mousedown touchstart","button",function(e){var t=o(this);return!t.hasClass("disabled")&&t.addClass("pressed"),!1}),this.jo.on("mouseup touchend","button",function(e){var t=o(this);t.removeClass("pressed");var i=r.selected.ie.config.type,n=t.attr("fn");if(!r.resizingColumn)if(n&&!t.hasClass("disabled"))r.interactive[i][n](r.interactive[i].actions[t.attr("actionkey")].arg);else if(t.attr("menu")){var s=r.ui.foobar.menus[i][t.attr("menu")];s.jo.show().position({of:o(this),my:"left top+2",at:"left bottom",collision:"none"}),r.ui.foobar.dropMenu=s}return!1}),this.jo.on("mouseover","button",function(){r.ui.foobar.dropMenu&&r.ui.foobar.dropMenu.jo.hide();var e=o(this);if(!e.hasClass("disabled")&&e.addClass("over"),e.attr("menu")){var t=r.ui.foobar.menus[r.selected.ie.config.type][e.attr("menu")];t.jo.show().position({of:o(this),my:"left top+2",at:"left bottom",collision:"none"}),r.ui.foobar.dropMenu=t}}),this.jo.on("mouseout","button",function(){o(this).removeClass("over pressed")}),this.cache={},this.menus={},this.current=null},show:function(e){!this.jo&&this.setElement("#jive_foobar"),this.render(r.interactive[r.selected.ie.config.type].actions),this.jo.find("button").removeClass("over pressed"),this.jo.appendTo(r.getReportContainer()).show(),this.setToolbarPosition(),this.setToolbarPosition()},setToolbarPosition:function(){var e,t=r.selected.jo.offset().top-this.jo.outerHeight();e=r.isDashboard?o(window).scrollTop():o("div#reportViewFrame .body").length>0?o("div#reportViewFrame .body").offset().top:0,this.jo.css({position:"absolute"}),this.jo.offset({top:t,left:r.selected.jo.offset().left}),r.isFloatingHeader?r.setToolbarPositionWhenFloating(!0):e>=t&&this.jo.offset({top:r.selected.jo.offset().top})},render:function(e){var t=this,i=['<button class="jive_foobar_button" title="',,'" actionkey="',,'" ',,'><span class="wrap"><span class="icon ',,'"></span></span></button>'];if(!t.cache[r.selected.ie.config.type]){t.cache[r.selected.ie.config.type]="";o.each(e,function(e,o){o.actions&&(t.menus[r.selected.ie.config.type]=t.menus[r.selected.ie.config.type]||{},t.createMenu(e,o.label,o.actions)),i[1]=o.title,i[3]=e,i[5]=o.fn?'fn="'+o.fn+'"':o.actions?'menu="'+e+'"':"",i[7]=o.icon,t.cache[r.selected.ie.config.type]+=i.join("")})}t.current!=r.selected.ie.config.type&&(t.jo.empty(),t.jo.html(t.cache[r.selected.ie.config.type]),t.current=r.selected.ie.config.type)},createMenu:function(e,t,i){var n=this,s='<ul class="pmenu" label="'+e+'">';o.each(i,function(e,t){if(!t.disabled){var i=t.fn?'fn="'+t.fn+'"':"",o=t.label||e;i+=t.arg?" data-args='"+t.arg+"'":"",s+='<li class="pmenuitem" key="'+e+'" '+i+">"+r.encodeHTML(o)+"</li>",t.actions&&n.createMenu(e,t.label,t.actions)}}),s+="</ul>",n.menus[r.selected.ie.config.type][e]={jo:o(s).appendTo("#jive_menus")}},reset:function(){this.cache={},this.menus={}}},dialog:{jo:null,body:null,isVisible:!1,setElement:function(e){var t,i,n=this;n.jo=o(e),n.jo.draggable({handle:"div.dialogHeader"}),n.body=o("#jive_dialog div.dialogBody"),n.title=o("#jive_dialog span.dialogTitle"),n.tabs=o("#jive_dialog div.tabContainer"),"function"==typeof isIE&&isIE()&&navigator.appVersion.indexOf("MSIE 10.0;")<0&&n.jo.prepend('<div class="msshadow" ></div>'),n.tabs.on(l,".tab",function(e){var t,i=o(this);i.hasClass("disabled")||(n.tabs.find(".tab").removeClass("active"),i.addClass("active"),r.selected.form.onBlur(),r.selected.form.jo.hide(),t=r.selected.form.actionDataCache,r.selected.form=r.ui.forms[i.data("form")],o.extend(r.selected.form.actionDataCache,t),r.selected.form.onShow(),r.selected.form.jo.show(),o("body")[0].style.zoom=0==o("body")[0].style.zoom?1:0)}),n.body.on(l,"input, select",function(e){var t=o(this);t.focus(),"radio"==t.attr("type")&&t.trigger("change").prop("checked",!0)}),n.body.on("change",".jive_listTextInput, .jive_listTextInputTouch",function(e){var t=o(this);r.selected.form.inputs[t.next("select").attr("name")].value=""!==t.val()?t.val():null}),n.body.on("change","select.wFreeText",function(e){var t=o(this);t.prev().val(t.val()),r.selected.form.inputs[t.attr("name")].set(t.val())}),n.body.on("keypress",".jive_restrictedInput",function(e){return"numeric"!==o(this).data("restriction")||!isNaN(String.fromCharCode(e.which))}),n.body.on(l,".jive_inputbutton",function(){switch(t=o(this),i=r.selected.form.inputs[t.attr("bname")],t.attr("type")){case"radio":i.set(t.attr("value"),t);break;case"checkbox":i.toggle()}i.onClick&&i.onClick(t)}),n.body.on(l,".jive_freeTextButton",function(){t=o(this),t.parent().next().find("input, select").toggle()}),o("#dialogOk, #dialogCancel").on(l,function(e){this.className.indexOf("disabled")<0&&("dialogCancel"==this.id?(r.active=!1,o("body").trigger("jive.inactive")):r.selected.form.submit(),r.ui.dialog.hide(),r.ui.dialog.isVisible=!1)})},show:function(e,t,i){if(!this.jo&&this.setElement("#jive_dialog"),t.length>1){var n,s,a="",l=i||0;o.each(t,function(e,t){n=r.ui.forms[t],s=e==l?"active":"",a+='<div id="'+n.name+'Tab" data-form="'+n.name+'" class="tab dialog '+s+'"><span>'+n.title+"</span></div>",!n.jo&&r.ui.forms.render(n),r.ui.dialog.body.append(n.jo)}),this.tabs.html(a).show(),r.selected.form=r.ui.forms[t[l]]}else this.tabs.hide(),r.selected.form=r.ui.forms[t[0]],!r.selected.form.jo&&r.ui.forms.render(r.selected.form),this.body.append(r.selected.form.jo);r.selected.form.onShow(),this.title.html(e),r.selected.form.jo.show(),this.jo.show().position({of:o(window),at:"center center",my:"center center",collision:"none fit"}),this.isVisible=!0,r.hide(null,!0)},hide:function(){var e=this,t=[];r.ui.dialog.jo.hide(),e.body.children().each(function(){t.push(this.id.substring(10)),o(this).appendTo("#jive_forms").hide()}),o("#jive_dropdown .pmenu").hide(),o.each(t,function(e,t){r.ui.forms[t].onHide&&r.ui.forms[t].onHide()})},toggleButtons:function(){o("#dialogOk, #dialogCancel").toggleClass("disabled")}},forms:{add:function(e){r.ui.forms[e.name]=e},render:function(e){var t=r.ui.forms,i=o('<form id="jive_form_'+e.name+'" action="" method="'+e.method+'" class="jive_form" style="display:none;width:700px;"></form>').appendTo("#jive_forms"),n=[];e.inputs={},o.each(e.elements,function(t,s){n.push('<table width="100%">'),o.each(s,function(t,s){n.push("<tr>"),o.each(s,function(t,o){r.ui.forms.createElement(o,e,i,n)}),n.push("</tr>")}),n.push("</table>")}),i.append(n.join("")),t[e.name].jo=i,t[e.name].onCreate(i)},createElement:function(e,t,i,n){var s,a=e.label||"",l=e.colspan?' colspan="'+e.colspan+'"':"",c=e.rowspan?' rowspan="'+e.rowspan+'"':"",d=e.tdClass?" "+e.tdClass:"",u=e.tdWidth?"width: "+e.tdWidth+";":"",p=e.isHeader?"th":"td",h=e.align?"text-align: "+e.align+";":"",f=e.width?" width: "+e.width+"px;":"",v=e.wrapClass||"";if(n.push("<"+p+" "),"label"==e.type&&(s=e.value||"",n.push('class="jive_textLabel'+d+'" style="'+u+'"'+l+">"),e.nowrap?n.push(s):n.push('<div class="'+v+'" style="'+h+f+'">'+s+"</div>")),"text"==e.type&&(n.push('class="'+d+'" style="'+u+'"'+l+c+">"),e.label&&n.push('<div class="wrapper label">'+e.label+":</div>"),n.push('<div class="wrapper"><input id="'+e.id+'" type="text" name="'+e.id+'" value="'+e.value+'"/></div>'),t.inputs[e.id]={set:function(t){o("#"+e.id).val(t)},get:function(){return o("#"+e.id).val()}}),"radio"==e.type&&(n.push('class="'+d+'" style="'+u+'"'+l+c+'><div class="thick wrapper"><input type="radio" id="'+e.id+e.value+'" name="'+e.id+'" value="'+e.value+'"/><label for="'+e.id+e.value+'" class="jive_inputLabel">'+a+"</label></div>"),t.inputs[e.id]={set:function(t){o('input[name="'+e.id+'"]').val(t)},get:function(){return o('input[name="'+e.id+'"]').val()}}),"list"==e.type){var m=e.size?e.size:1,b="ontouchstart"in document.documentElement?"Touch":"",g="ontouchstart"in document.documentElement||1==m?"":"showList",j=e.freeText?"wFreeText":"",y=null!=e.restriction,w=['<select id="'+e.id+'" name="'+e.id+'" class="'+g+" "+j+'" size="'+m+'">'];o.each(e.values,function(e,t){w.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),e.groups&&o.each(e.groups,function(e,t){w.push('<optgroup label="'+t.name+'">'),o.each(t.values,function(e,t){w.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),w.push("</optgroup>")}),w.push("</select>"),n.push('class="'+d+'" style="'+u+'"'+l+c+">"),e.label&&n.push('<div class="wrapper label">'+e.label+":</div>"),n.push('<div class="wrapper">'),e.freeText&&n.push('<input id="'+e.id+'Text" type="text" class="'+(y?"jive_restrictedInput ":"")+"jive_listTextInput"+b+'" name="'+e.id+'Text" value=""'+(y?' data-restriction="'+e.restriction+'"':"")+"/>"),n.push(w.join("")),n.push("</div>"),t.inputs[e.id]={value:null,set:function(t){this.value=t,o("#"+e.id).val(t),e.freeText&&o("#"+e.id+"Text").val(t)&&o("#"+e.id+"Text").trigger("change")},get:function(){return this.value}}}"button"==e.type&&(n.push('class="'+d+'" style="'+u+'">'),n.push('<div class="jive_inputbutton'+(e.btnClass?"  "+e.btnClass:"")+'" bname="'+e.id+'">'),e.bIcon&&n.push('<span class="jive_bIcon '+e.bIcon+'"></span>'),e.bLabel&&(e.nowrap?n.push(e.bLabel):n.push('<span class="jive_bLabel">'+e.bLabel+"</span>")),n.push("</div>"),t.inputs[e.id]={onClick:function(i){r.ui.forms[t.name][e.fn](i)}}),"buttons"==e.type&&(n.push('class="'+d+'" style="'+u+'"'+l+c+">"),a.length>0&&n.push('<div class="wrapper label">'+a+":</div>"),n.push('<div class="wrapper"><div class="buttonbar">'),o.each(e.items,function(e,s){!t.inputs[s.id]&&i.append('<input type="hidden" name="'+s.id+'" value="" />'),n.push('<div class="jive_inputbutton '+(s.btnClass?" "+s.btnClass:"")+(s.drop?" drop":"")+'" bname="'+s.id+'" value="'+s.value+'" type="'+s.type+'">'),"color"!==s.type&&"backcolor"!==s.type||n.push('<div class="colorpick'+(s.styleClass?" "+s.styleClass:" normal")+'"></div>'),s.bIcon&&n.push('<span class="jive_bIcon '+s.bIcon+'"></span>'),s.bLabel&&n.push('<span class="jive_bLabel">'+s.bLabel+"</span>"),n.push("</div>"),"dropdown"===s.type&&(t.inputs[s.id]={_idd:s.id,_options:s.options,onClick:function(){r.interactive[r.selected.ie.config.type][s.fn]()},showOptions:function(){var e=o("#jive_dropdown");e.empty();var t='<ul class="pmenu">';o.each(this._options,function(e,i){t+="<li class='pmenuitem' data-args='{\"val\":\""+i.value+"\"}' fn='"+i.fn+"'>"+r.encodeHTML(i.label)+"</li>"}),t+="</ul>",e.append(t),e.find(".pmenu").show(),e.css({width:"150px",height:"100px"}),e.position({my:"left top-10",at:"left bottom",of:o('div.jive_inputbutton[bname="'+this._idd+'"]'),collision:"none"})},hideOptions:function(){o("#jive_dropdown .pmenu").hide()}}),"checkbox"==s.type&&(t.inputs[s.id]={value:null,set:function(e){var t=o('div.jive_inputbutton[bname="'+s.id+'"]');this.value=e,!0===e?t.removeClass("unchanged").addClass("selected"):!1===e?t.removeClass("unchanged").removeClass("selected"):null===e&&(s.isTripleState?t.removeClass("selected").addClass("unchanged"):this.set(!1))},toggle:function(){!0===this.value?this.set(!1):!1===this.value?s.isTripleState?this.set(null):this.set(!0):s.isTripleState&&null===this.value&&this.set(!0)},get:function(){return this.value},onClick:function(){s.fn&&r.interactive[r.selected.ie.config.type][s.fn]()}}),"radio"!=s.type||t.inputs[s.id]||(t.inputs[s.id]={value:null,set:function(e,t){if(t&&t.is(".selected")&&s.isTripleState)return void this.set(null);this.value=e,o('div.jive_inputbutton[bname="'+s.id+'"]').removeClass("selected"),o('div.jive_inputbutton[bname="'+s.id+'"][value="'+e+'"]').addClass("selected")},get:function(){return this.value},onClick:function(e){s.fn&&r.interactive[r.selected.ie.config.type][s.fn]()}}),"action"==s.type&&(t.inputs[s.id]={onClick:function(){r.interactive[r.selected.ie.config.type][s.fn]()}}),"color"==s.type&&(t.inputs[s.id]={value:null,set:function(e){var t=o('div.jive_inputbutton[bname="'+s.id+'"]');this.value=e,null===e?t.addClass("unchanged").find("div.colorpick").css("background-color","transparent"):"null"===e?this.set(null):t.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"===e?e:"#"+e)},get:function(){return this.value},onClick:function(e){r.ui.colorpicker.show({title:s.title,inputId:s.id,anchor:e,currentColor:o('input[name="'+s.id+'"]').val(),showTransparent:s.showTransparent,showReset:s.showReset})}}),"backcolor"==s.type&&(t.inputs[s.id]={backColor:null,modeValue:null,set:function(e,t,i){var n=o('div.jive_inputbutton[bname="'+s.id+'"]');i?"keep_existing"!==e&&(this.backColor="null"===e?null:e):this.backColor=e,this.modeValue="null"===t?null:t,this.backColor||this.modeValue?"Transparent"!==this.modeValue&&this.backColor?this.backColor&&n.removeClass("unchanged").find("div.colorpick").css("background-color","#"+this.backColor):n.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"):n.addClass("unchanged").find("div.colorpick").css("background-color","transparent")},getBackColor:function(){return this.backColor},getModeValue:function(){return this.modeValue},onClick:function(e){r.ui.colorpicker.show({title:s.title,inputId:s.id,anchor:e,currentColor:o('input[name="'+s.id+'"]').val(),showTransparent:s.showTransparent,showReset:s.showReset})}})}),n.push("</div></div>")),n.push("</"+p+">")},createTemplateElement:function(e,t,i,n){var s=e.label||"",a=e.colspan?'colspan="'+e.colspan+'"':"",l=e.rowspan?'rowspan="'+e.rowspan+'"':"",c=i.find("*[id^='"+e.id+"']").length,d=e.id+(c>0?"_"+o.now():""),u=e.tdClass?" "+e.tdClass:"",p=e.align?"text-align: "+e.align+";":"",h=e.width?" width: "+e.width+"px;":"",f=e.wrapClass||"";if("label"==e.type&&(n.push('<td class="jive_textLabel'+u+'" '+a+">"),e.nowrap?n.push(e.value):n.push('<div class="'+f+'" style="'+p+h+'">'+e.value+"</div>"),n.push("</td>")),"text"==e.type&&(n.push('<td class="'+u+'" '+a+" "+l+">"),e.label&&n.push('<div class="'+f+'">'+e.label+":</div>"),n.push('<div class="'+f+'"><input id="'+d+'" type="text" name="'+e.id+'" value="'+e.value+'"/></div></td>'),t.inputs[d]={set:function(e){o("#"+d).val(e)},get:function(){return o("#"+d).val()}}),"list"==e.type){var v=e.size?e.size:1,m="ontouchstart"in document.documentElement?"Touch":"",b="ontouchstart"in document.documentElement||1==v?"":"showList",g=e.freeText?"wFreeText":"",j=null!=e.restriction,y=['<select id="'+d+'" name="'+e.id+'" class="'+b+" "+g+'" size="'+v+'">'];o.each(e.values,function(e,t){y.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),e.groups&&o.each(e.groups,function(e,t){y.push('<optgroup label="'+t.name+'">'),o.each(t.values,function(e,t){y.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),y.push("</optgroup>")}),y.push("</select>"),n.push('<td class="'+u+'" '+a+" "+l+">"),e.label&&n.push('<div class="'+f+'">'+e.label+":</div>"),n.push('<div class="'+f+'">'),e.freeText&&n.push('<input id="'+d+'Text" type="text" class="'+(j?"jive_restrictedInput ":"")+"jive_listTextInput"+m+'" name="'+e.id+'Text" value=""'+(j?' data-restriction="'+e.restriction+'"':"")+"/>"),n.push(y.join("")),n.push("</div></td>"),t.inputs[d]={set:function(t){o("#"+d).val(t),e.freeText&&o("#"+d+"Text").val(t)},get:function(){return e.freeText?o("#"+d+"Text").val():o("#"+d).val()}}}"button"==e.type&&(n.push('<td class="'+u+'">'),n.push('<div class="jive_inputbutton'+(e.btnClass?"  "+e.btnClass:"")+'" bname="'+e.id+'">'),e.bIcon&&n.push('<span class="jive_bIcon '+e.bIcon+'"></span>'),e.bLabel&&(e.nowrap?n.push(e.bLabel):n.push('<span class="jive_bLabel">'+e.bLabel+"</span>")),n.push("</div>"),n.push("</td>"),t.inputs[e.id]={onClick:function(i){r.ui.forms[t.name][e.fn](i)}}),"buttons"==e.type&&(n.push('<td class="'+u+'" '+a+" "+l+">"),s.length>0&&n.push('<div class="'+f+'">'+s+":</div>"),n.push('<div class="'+f+'"><div class="buttonbar">'),o.each(e.items,function(e,s){var a=i.find("*[bname^='"+s.id+"']").length,l=s.id+(a>0?"_"+o.now():"");n.push('<div class="jive_inputbutton '+(s.btnClass?" "+s.btnClass:"")+(s.drop?" drop":"")+'" bname="'+l+'" value="'+s.value+'" type="'+s.type+'">'),"color"!==s.type&&"backcolor"!==s.type||n.push('<div class="colorpick'+(s.styleClass?" "+s.styleClass:" normal")+'"></div>'),s.bIcon&&n.push('<span class="jive_bIcon '+s.bIcon+'"></span>'),s.bLabel&&n.push('<span class="jive_bLabel">'+s.bLabel+"</span>"),n.push("</div>"),"checkbox"==s.type&&(t.inputs[l]={value:null,set:function(e){var t=o('div.jive_inputbutton[bname="'+l+'"]');this.value=e,!0===e?t.removeClass("unchanged").addClass("selected"):!1===e?t.removeClass("unchanged").removeClass("selected"):null===e&&(s.isTripleState?t.removeClass("selected").addClass("unchanged"):this.set(!1))},toggle:function(){!0===this.value?this.set(!1):!1===this.value?s.isTripleState?this.set(null):this.set(!0):s.isTripleState&&null===this.value&&this.set(!0)},get:function(){return this.value},onClick:function(){s.fn&&r.interactive[r.selected.ie.config.type][s.fn]()}}),"action"==s.type&&(t.inputs[l]={onClick:function(e){r.ui.forms[t.name][s.fn](e)}}),"color"==s.type&&(t.inputs[l]={value:null,set:function(e){var t=o('div.jive_inputbutton[bname="'+l+'"]');this.value=e,null===e?t.addClass("unchanged").find("div.colorpick").css("background-color","transparent"):"null"===e?this.set(null):t.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"===e?e:"#"+e)},get:function(){return this.value},onClick:function(e){r.ui.colorpicker.show({title:s.title,inputId:l,anchor:e,currentColor:o('input[name="'+l+'"]').val(),showTransparent:s.showTransparent,showReset:s.showReset})}}),"backcolor"==s.type&&(t.inputs[l]={backColor:null,modeValue:null,set:function(e,t,i){var n=o('div.jive_inputbutton[bname="'+l+'"]');i?"keep_existing"!==e&&(this.backColor="null"===e?null:e):this.backColor=e,this.modeValue="null"===t?null:t,this.backColor||this.modeValue?"Transparent"!==this.modeValue&&this.backColor?this.backColor&&n.removeClass("unchanged").find("div.colorpick").css("background-color","#"+this.backColor):n.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"):n.addClass("unchanged").find("div.colorpick").css("background-color","transparent")},getBackColor:function(){return this.backColor},getModeValue:function(){return this.modeValue},onClick:function(e){r.ui.colorpicker.show({title:s.title,inputId:l,anchor:e,currentColor:o('input[name="'+l+'"]').val(),showTransparent:s.showTransparent,showReset:s.showReset})}})}),n.push("</div></div></td>"))}},colorpicker:{jo:null,selected:null,title:"",inputId:null,setElement:function(){var e=this;e.jo=o("#jive_colorpicker"),e.jo.draggable({handle:"div.dialogHeader"}),e.jo.on(l,"div.pick",function(t){e.selected=o(this).parent().addClass("selected"),r.selected.form.inputs[e.inputId].set(e.extractHexColor(e.selected.children().eq(0).attr("hexcolor")),e.selected.closest("tr").data("mode"),!0),r.ui.colorpicker.jo.hide(),r.ui.modal.hide(),t.preventDefault()})},show:function(e){this.title=e.title||"Pick a color",this.inputId=e.inputId,!this.jo&&this.setElement(),this.jo.find("td.selected").removeClass("selected"),e.currentColor&&this.jo.find("div.pick[hexcolor="+e.currentColor+"]").parent().addClass("selected"),e.showTransparent?this.jo.find("tr.transparent_pick").show():this.jo.find("tr.transparent_pick").hide(),e.showReset?this.jo.find("tr.reset_pick").show():this.jo.find("tr.reset_pick").hide(),r.ui.modal.show(this.jo),this.jo.find("h2").html(this.title),this.jo.show().position({of:e.anchor,at:"left bottom",my:"left top",offset:"0 0",collision:"none"})},extractHexColor:function(e){if(e&&-1!==e.toLowerCase().indexOf("rgb")){var t,i,o,n="",s=e.split(",");for(t=0;t<s.length;t++)i=parseInt(/\d+/.exec(s[t])[0],10),o=i.toString(16),n+=1===o.length?"0"+o:o;return n}return e}},modal:{whf:null,visible:!1,show:function(e){this.whf=e,0==o("#jive_modal").length&&(o("table.jrPage").parent().append('<div id="jive_modal" style="display:none;position:absolute;z-index:9999;top:0;bottom:0;left:0;right:0;"></div>'),o("#jive_modal").on(l,function(e){r.ui.modal.hide(),e.preventDefault()})),this.visible||(r.ui.dialog.toggleButtons(),o("#jive_modal").show(),this.visible=!0)},hide:function(){r.ui.modal.whf.hide(),r.ui.dialog.toggleButtons(),o("#jive_modal").hide(),this.visible=!1}}},selected:{ie:null,jo:null,form:null},viewerReady:!1,encodeHTML:function(e){return o("<div></div>").text(e).html()},decodeHTML:function(e){return o("<div></div>").html(e).text()},escapeFontName:function(e){return e?e.replace(/"/g,""):null},hide:function(e,t){var i=this;e?o.each(e,function(e,t){i.ui[t].jo&&i.ui[t].jo.hide()}):(t?i.active=i.ui.dialog.isVisible:(i.active=!1,i.ui.dialog.isVisible&&i.ui.dialog.hide()),i.ui.marker.jo&&i.ui.marker.jo.appendTo("#jive_components").hide(),i.ui.overlay.jo&&i.ui.overlay.jo.appendTo("#jive_components").hide(),i.ui.foobar.jo&&(i.ui.foobar.jo.appendTo("#jive_components").hide(),i.scrollData&&i.scrollHeader(i.isDashboard,!0)),o(".pmenu").hide(),i.ui.colorpicker.jo&&i.ui.colorpicker.jo.hide())},getHeaderTable:function(){var e=o("table.floatableHeader");if(0==e.length){e=o("<table class='floatableHeader' style='display:none'/>").appendTo("div#reportContainer"),e.on(l,".jrcolHeader",function(t){if(!o(t.target).parent().is("a")){var i=o(this),n=i.data("coluuid"),s=e.parent().find("table.jrPage td.jrcolHeader[data-coluuid="+n+"]:first");return s.length&&r.selectInteractiveElement(s),!1}});var t,i,n,s,a,c,d,u,p,h,f,v,m=o("td.jrcolHeader:first"),b=m.closest("table"),g=o("td.jrcolHeader:last",b),j=[],y=[];if(m.length>0){if(m.addClass("first_jrcolHeader"),i=m.closest("tr"),n=g.closest("tr"),f=m.closest("table"),i===n)j.push(i);else for(v=b.find("tr"),d=v.index(i),u=v.index(n),p=d;p<=u;p++)j.push(v.get(p));o.each(j,function(i,n){for(c=o(n).find("td"),t=o("<tr></tr>"),y[i]=0,d=0,h=c.length;d<h;d++)a=o(c.get(d)),s=a.clone(),y[i]=y[i]+a.outerWidth(),s.css("width",a.css("width")),s.css("height",a.css("height")),t.append(s);e.append(t)}),e.css({position:"relative",width:Math.max.apply(Math,y),"empty-cells":f.css("empty-cells"),"border-collapse":f.css("border-collapse"),"background-color":f.css("background-color")}),e.attr("cellpadding",f.attr("cellpadding")),e.attr("cellspacing",f.attr("cellspacing")),e.attr("border",f.attr("border"))}}return e},setToolbarPositionWhenFloating:function(e,t){if(e){var i=t||this.getHeaderTable().offset().top;this.ui.foobar.jo.css({position:"relative"}),this.ui.foobar.jo.offset({top:i,left:this.selected.jo.offset().left-o(window).scrollLeft()})}},applyScaleTransform:function(e,t,i){var o="scale("+t+")",i=i||"50% 0",n={"-webkit-transform":o,"-webkit-transform-origin":i,"-moz-transform":o,"-moz-transform-origin":i,"-ms-transform":o,"-ms-transform-origin":i,"-o-transform":o,"-o-transform-origin":i,transform:o,"transform-origin":i};e.css(n)},zoom:function(e){var t=this;t.isFloatingHeader&&t.scrollHeader(t.isDashboard,!0),t.active&&t.hide()},scrollHeader:function(e,t){var i=this,n=o(window),s=o("div#reportViewFrame .body"),a=!1,l=!1;if(null!=i.scrollData.scrollTop?s.scrollTop()!=i.scrollData.scrollTop&&(i.scrollData.scrollTop=s.scrollTop(),a=!0):0!=s.scrollTop()&&(i.scrollData.scrollTop=s.scrollTop(),a=!0),null!=i.scrollData.scrollLeft?s.scrollLeft()!=i.scrollData.scrollLeft&&(i.scrollData.scrollLeft=s.scrollLeft(),l=!0):0!=s.scrollLeft()&&(i.scrollData.scrollLeft=s.scrollLeft(),l=!0),l||a||t){var c=o("td.jrcolHeader:first");if(!(!c.length>0)){var d,u=i.getHeaderTable(),p=c.closest("table"),h=e?n.scrollTop():o("div#reportViewFrame .body").offset().top,f=c.closest("tr").offset().top,v=o("#reportContainer").offset().top,m=o("td.first_jrcolHeader:first").closest("table").find("td.jrcel:last"),b=m.length?m.offset().top-u.outerHeight()-h:-1,g=i.cachedScroll||0,j=r.reportInstance.zoom;i.isIPad&&!i.cachedHeaderTop&&(i.cachedHeaderTop=f),!e&&i.isIPad&&(g+=i.cachedHeaderTop-f),d=e?i.isIPad?g:0:i.isIPad?g:h,!i.scrollData.bMoved&&f-h<0&&b>0?(u.show(),j&&i.applyScaleTransform(u,j.level,j.overflow?"0 0":"50% 0"),u.offset({top:d,left:p.offset().left}),i.setToolbarPositionWhenFloating(i.active,d),i.scrollData.bMoved=i.isFloatingHeader=!0,e||i.scrollData.reportContainerPositionAtMove||(i.scrollData.reportContainerPositionAtMove=v)):i.scrollData.bMoved&&f-h<0&&b>0?(u.show(),j&&i.applyScaleTransform(u,j.level,j.overflow?"0 0":"50% 0"),u.offset({top:d,left:p.offset().left}),i.setToolbarPositionWhenFloating(i.active,d)):i.scrollData.bMoved&&(i.isFloatingHeader&&(u.hide(),i.isFloatingHeader=!1,i.cachedScroll=0),i.active&&f-h-i.ui.foobar.jo.outerHeight()<0&&b>0?i.setToolbarPositionWhenFloating(!0,h):i.active?(i.setToolbarPositionWhenFloating(!0,i.selected.jo.offset().top-i.ui.foobar.jo.outerHeight()),i.scrollData.bMoved=!1):i.scrollData.bMoved=!1),i.isIPad&&(i.cachedHeaderTop=f),i.isIPad&&(i.cachedScroll=g)}}},setScrollableHeader:function(e){var t=this;t.scrollData={bMoved:!1,reportContainerPositionAtMove:null},e||o("div#reportViewFrame .body").on("scroll",function(){t.scrollHeader(e)}),t.isIE&&o("body").on("scroll",function(){t.scrollHeader(e),t.active&&!t.ui.dialog.isVisible&&t.showVisualElements(r.selected.dim)}),o(window).on("resize scroll",function(){t.scrollHeader(e),t.active&&!t.ui.dialog.isVisible&&t.showVisualElements(r.selected.dim)}),o("body").on("layout_update",function(e,i){null==i||"panel-maximize"!==i.type&&"panel-minimize"!==i.type||r.interactive.column&&r.interactive.column.init(t.reportInstance)})},init:function(e){var t=this;if(r.reportInstance=e,!t.initialized){t.isDashboard=o("body").is(".dashboardViewFrame");var i=!0;o.each(e.components.table,function(e,t){if(!t.config.hasFloatingHeader)return i=!1,!1}),i&&(t.isDashboard||o("div#reportViewFrame").length>0)&&t.setScrollableHeader(t.isDashboard),0==o("#jive_components").length&&o("body").append('<div id="jive_components"></div>'),o("#jive_components").empty(),o("#jive_components").append(n.template(a,{i18n:s})),e.config.container.on(l,function(){t.ui.dialog.isVisible||(t.hide(),o("body").trigger("jive.inactive"))});var c;o("div#jive_menus, div#jive_dropdown").on({"mouseup touchend":function(e){c=o(this);var t=c.data("args");if(c.attr("fn")&&r.interactive[r.selected.ie.config.type][c.attr("fn")](t),"touchend"==e.type){var i=c.attr("key");r.ui.foobar.menus[r.selected.ie.config.type][i]?r.ui.foobar.menus[r.selected.ie.config.type][i].jo.show().position({of:c,my:"left top",at:"right top"}):!r.ui.dialog.isVisible&&r.hide()}e.preventDefault()},mouseover:function(e){c=o(this),c.addClass("hover"),c.width()<c.parent().width()-24&&c.width(c.parent().width()-24),c.parent().prevAll().hide();var t=c.attr("key");r.ui.foobar.menus[r.selected.ie.config.type][t]&&r.ui.foobar.menus[r.selected.ie.config.type][t].jo.show().position({of:c,my:"left top",at:"right top"})},mouseout:function(e){c=o(this),c.removeClass("hover")}},".pmenuitem"),o("div#jive_dropdown").on({"mouseup touchend":function(e){var t=o(this).data("args");o(this).attr("fn")&&r.interactive[r.selected.ie.config.type][o(this).attr("fn")](t),e.preventDefault()}},".pmenuitem"),o("div#jive_dropdown").on("mouseleave",".pmenu",function(e){o(this).hide()}),t.initialized=!0,o("body").trigger("jive.initialized",[t])}},initInteractiveElement:function(e,t){r.elements[e.config.id]&&(o.hasData(t.find("table.jrPage")[0])||(r.selectors={})),r.elements[e.config.id]=e,r.selectors[e.config.parentId+"-"+e.config.selector]||(r.selectors[e.config.parentId+"-"+e.config.selector]=e.config.type,t.find("table.jrPage").on(l,e.config.selector,function(e){if(!o(e.target).parent().is("a")){var t=o(this);return r.selectInteractiveElement(t),!1}})),e.config.proxySelector&&!r.selectors[e.config.parentId+"-"+e.config.proxySelector]&&(r.selectors[e.config.parentId+"-"+e.config.proxySelector]=e.config.type,t.find("table.jrPage").on(l,e.config.proxySelector,function(t){if(!o(t.target).parent().is("a")){var i=r.interactive[e.config.type].getInteractiveElementFromProxy(o(this));return r.selectInteractiveElement(i),!1}}))},selectInteractiveElement:function(e){if(e&&e.is(".interactiveElement")){r.ui.dialog.isVisible&&r.ui.dialog.hide(),r.activeContainer=e.closest("._jr_report_container_");var t=r.interactive.column.columnsData[e.data("tableuuid")][e.data("coluuid")];r.selected={ie:r.elements[e.data("coluuid")],jo:r.interactive.column.getJoForCurrentSelection(e),realWidth:t.width,realHeight:t.height},r.selected.dim=r.interactive[r.selected.ie.config.type].getElementSize(),this.showVisualElements(r.selected.dim),r.active=!0,r.started=!0,r.interactive[r.selected.ie.config.type].onSelect()}},showVisualElements:function(e){r.ui.foobar.dropMenu&&r.ui.foobar.dropMenu.jo.hide(),r.ui.foobar.menus.column&&r.ui.foobar.menus.column.showColumns&&r.ui.foobar.menus.column.showColumns.jo.hide(),r.ui.overlay.show(e),r.ui.marker.show(e),r.ui.foobar.show(e)},withDebounce:function(e,t,i,o){var n=null;return{apply:function(){var s=arguments;o?e.apply(t,s):(clearTimeout(n),n=setTimeout(function(){n=null,e.apply(t,s)},i))},isRunning:function(){return null!=n},cancelAndExecute:function(){null!=n&&(clearTimeout(n),e.apply(t,arguments))}}}};i.exports=r});