/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","jquery","underscore","runtime_dependencies/jrs-ui/src/namespace/namespace","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.ajax","../core/core.ajax.utils","runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator","runtime_dependencies/jrs-ui/src/components/components.dialogs","runtime_dependencies/jrs-ui/src/core/core.layout","scriptaculous/src/builder"],function(require,exports,module){function SelectedFormula(){this.reset()}function SelectionCategory(){this.area="",this.reset=function(){this.area=""}}function getSessionExpireTime(){return function(){var e,r=new Date,t=r.getHours()%12;0===t&&(t=12);var a=r.getMinutes()+(delayBeforeSessionTimeoutWarning<MILL_PER_MIN?1:MIN_WARN_BEFORE_TIMEOUT);return e=a<10||a>59?"0"+a%60:a," "+t+":"+e}()}var __disableStrictMode__="use strict",_prototype=require("prototype"),$=_prototype.$,$A=_prototype.$A,jQuery=require("jquery"),_=require("underscore"),_runtime_dependenciesJrsUiSrcNamespaceNamespace=require("runtime_dependencies/jrs-ui/src/namespace/namespace"),JRS=_runtime_dependenciesJrsUiSrcNamespaceNamespace.JRS,_runtime_dependenciesJrsUiSrcUtilUtilsCommon=require("runtime_dependencies/jrs-ui/src/util/utils.common"),restoreDefaultCursor=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.restoreDefaultCursor,isMetaHeld=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.isMetaHeld,isShiftHeld=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.isShiftHeld,isSupportsTouch=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.isSupportsTouch,getTextBeforeUnderscore=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.getTextBeforeUnderscore,getTextAfterUnderscore=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.getTextAfterUnderscore,isNotNullORUndefined=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.isNotNullORUndefined,encodeText=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.encodeText,isIPad=_runtime_dependenciesJrsUiSrcUtilUtilsCommon.isIPad,_runtime_dependenciesJrsUiSrcCoreCoreAjax=require("runtime_dependencies/jrs-ui/src/core/core.ajax"),ajaxTargettedUpdate=_runtime_dependenciesJrsUiSrcCoreCoreAjax.ajaxTargettedUpdate,AjaxRequester=_runtime_dependenciesJrsUiSrcCoreCoreAjax.AjaxRequester,ajaxClobberredUpdate=_runtime_dependenciesJrsUiSrcCoreCoreAjax.ajaxClobberredUpdate,ajaxNonReturningUpdate=_runtime_dependenciesJrsUiSrcCoreCoreAjax.ajaxNonReturningUpdate,_coreCoreAjaxUtils=require("../core/core.ajax.utils"),errorHandler=_coreCoreAjaxUtils.errorHandler,actionModel=require("runtime_dependencies/jrs-ui/src/actionModel/actionModel.modelGenerator"),dialogs=require("runtime_dependencies/jrs-ui/src/components/components.dialogs"),layoutModule=require("runtime_dependencies/jrs-ui/src/core/core.layout"),Builder=require("scriptaculous/src/builder"),theBody,fieldsTable,savePanel,nullStateValue="_null",multiSelect=!1,saveOldLabel="",saveOldFolder="",flowExecutionKey,notificationButton,notification,saveAsTree,editor,windowPopUp,controllerMap={ta:"/adhoc/table.html",cr:"/adhoc/crosstab.html",ch:"/adhoc/chart.html",ich:"/adhoc/intelligentChart.html",da:"/dashboard/dashboard.html",st:"/adhoc/status.html",co:"/adhoc/table.html","":"/adhoc/table.html?"};SelectedFormula.prototype.reset=function(){this.formulaId=null,this.constant=null,this.isEdited=!1,this.isSwapped=!1,this.isChanged=!1};var selectedFormula=new SelectedFormula,selectionCategory=new SelectionCategory;window.selectionCategory=selectionCategory,window.selObjects=[];var timeoutValue=null,TIMEOUT_INTERVAL=null;window.TIMEOUT_INTERVAL=TIMEOUT_INTERVAL;var delayBeforeSessionTimeoutWarning,MILL_PER_MIN=6e4,MIN_WARN_BEFORE_TIMEOUT=2,ADHOC_SESSION_TIMEOUT_MESSAGE=null;window.ADHOC_EXIT_MESSAGE=null;var DASHBOARD_SESSION_TIMEOUT_MESSAGE=null;window.DASHBOARD_SESSION_TIMEOUT_MESSAGE=DASHBOARD_SESSION_TIMEOUT_MESSAGE;var DASHBOARD_EXIT_MESSAGE=null;window.DASHBOARD_EXIT_MESSAGE=DASHBOARD_EXIT_MESSAGE;var designerBase={AVAILABLE_FIELDS_AREA:"af",DASHBOARD_SPECIAL_CONTENT_TREE_AREA:"dsc",DASHBOARD_REPO_TREE_AREA:"drp",CROSSTAB_SELECT_AREA:"cr",TABLE_SELECT_AREA:"tb",CHART_SELECT_AREA:"ch",TITLE_SELECT_AREA:"co",CHART_LEGEND_AREA:"clg",REPORT_MENU_LEVEL:"reportLevel",FIELD_MENU_LEVEL:"fieldLevel",FIELDSET_MENU_LEVEL:"fieldSetLevel",COLUMN_LEVEL:"columnLevel",GROUP_LEVEL:"groupLevel",CHART_LEVEL:"chartLevel",SUMMARY_LEVEL:"summaryLevel",COLUMN_GROUP_MENU_LEVEL:"columnGroupLevel",ROW_GROUP_MENU_LEVEL:"rowGroupLevel",MEASURE_MENU_LEVEL:"measureLevel",LEGEND_MENU_LEVEL:"legendItemLevel",MEMBER_GROUP_MENU_LEVEL:"memberGroupCell",GRID_SELECTOR_MENU:".selector.mutton",DASHBOARD_SPECIAL_CONTENT_TREE_LEVEL:"dashboardSpecialContentTreeLeafLevel",DASHBOARD_REPO_TREE_LEVEL:"dashboardRepoTreeLeafLevel",DASHBOARD_CONTENT_FRAME_MENU_LEVEL:"dashboardContentFrameLevel",DASHBOARD_TEXT_FRAME_MENU_LEVEL:"dashboardTextFrameLevel",DASHBOARD_CLICKABLE_FRAME_MENU_LEVEL:"dashboardClickableFrameLevel",DASHBOARD_CONTROL_FRAME_MENU_LEVEL:"dashboardControlFrameLevel",SPACER_NAME:"_spacer",ARTIFICIAL_NAME:"_artificial",DEFAULT_THEME_ID:"default",TABLE:"table",CHART:"chart",ICHART:"ichart",OLAP_ICHART:"olap_ichart",CROSSTAB:"crosstab",OLAP_CROSSTAB:"olap_crosstab",DASHBOARD:"dashboard",DASHBOARD_RUNTIME:"dashboardRuntime",SAVE_AS_TREE_DOM_ID:"saveAsFoldersTree",UNDEFINED_STRING:"undefined",CLOBBER:"clobber",LABEL_MAX_LEN:94,DESC_MAX_LEN:249,DRAGGABLE_GHOST_HEIGHT:"20px",DRAGGABLE_GHOST_WIDTH:"150px",superInitAll:function(){theBody=document.body,window.localContext.initAll(),window.localContext.getMode()!==designerBase.DASHBOARD&&window.adhocDesigner&&window.adhocDesigner.initExplorerObjectListeners(),restoreDefaultCursor()},updateFlowKey:function(){var e=$("flowId");e&&(flowExecutionKey=e.getAttribute("value"))},setState:function setState(){var stateSnapshotScript=$("stateSnapshotScript");null!=stateSnapshotScript&&(window.eval(stateSnapshotScript.text),window.state=eval("("+stateSnapshot+")"),stateSnapshotScript.parentNode.removeChild(stateSnapshotScript))},getCanRunAndSave:function(){return window.canRunAndSave},getControllerPrefix:function(){return window.localContext.controller?window.localContext.controller:"co"},handleSave:function(){window.saveLabel?designerBase.save(window.saveFolder,window.saveLabel,window.saveDesc,!0):designerBase.launchSaveDialog()},handleSaveAs:function(){designerBase.launchSaveDialog()},handleSaveAndGenerate:function(){window.saveLabel?designerBase.checkSave(window.saveFolder,window.saveLabel,window.saveDesc,!1,{reportName:window.saveLabel+" "+window.defaultReportSuffix}).then(function(){designerBase.launchSaveDialog({forDataView:!1,forReport:!0,reportGenerators:window.localContext.state.reportGenerators})}):designerBase.launchSaveDialog({forDataView:!0,forReport:!0,reportGenerators:window.localContext.state.reportGenerators})},getSelectedObject:function(e){return e&&!isNaN(e)&&e<window.selObjects.length?window.selObjects[e]:window.selObjects[0]},getSelectedObjects:function(){return window.selObjects},getLastSelectedObject:function(){return window.selObjects[window.selObjects.length-1]},isSelectedNodeAFolder:function(){if(1!=window.selObjects.length)return!0;if(selectionCategory.area===designerBase.AVAILABLE_FIELDS_AREA){var e=this.getSelectedObject();return!!e&&e.isParent()}return!1},unSelectAll:function(){window.selObjects.clear()},addToSelected:function(e){this.isInSelection(e)||window.selObjects.push(e)},shouldClearSelections:function(e,r){var t=isMetaHeld(e),a=isShiftHeld(e);return!((r=selectionCategory.area==r)&&(t||a))},unSelectGiven:function(e){window.selObjects=window.selObjects.without(e)},isInSelection:function(e){for(var r=0;r<window.selObjects.length;r++)if(selectionCategory.area===this.COLUMN_LEVEL){if(e.header&&window.selObjects[r].header&&e.header.getAttribute("data-fieldName")==window.selObjects[r].header.getAttribute("data-fieldName"))return window.selObjects[r].index==e.index}else if(selectionCategory.area===this.GROUP_LEVEL){if(e.fieldName===window.selObjects[r].fieldName)return!0}else if(selectionCategory.area===this.ROW_GROUP_MENU_LEVEL||selectionCategory.area===this.COLUMN_GROUP_MENU_LEVEL||selectionCategory.area===this.LEGEND_MENU_LEVEL||selectionCategory.area===this.MEASURE_MENU_LEVEL){if(e.id===window.selObjects[r].id)return!0}else if(e==window.selObjects[r])return!0;return!1},isObjectInSelection:function(e,r){for(var t=0;t<window.selObjects.length;t++)if(r){if(e[r]==window.selObjects[t][r])return!0}else if(e==window.selObjects[t])return!0;return!1},clearOverlaySet:function(e){e&&(_.each(e,function(e){var r=$(e).identify();$(r)&&$(r).remove()}),e={})},deselectOverlaySet:function(e,r){_.each(e,function(e){$(e).removeClassName(r)})},enableSelection:function(){window.localContext.getMode()!==designerBase.DASHBOARD&&window.adhocDesigner&&window.adhocDesigner.initEnableBrowserSelection($("designer"))},disableSelection:function(){window.localContext.getMode()!==designerBase.DASHBOARD&&window.adhocDesigner&&window.adhocDesigner.initPreventBrowserSelection($("designer"))},getLastSavedReportFolder:function(){var e=null;return window.localStorage&&(e=window.localStorage.getItem("lastSavedReportFolder")),e},setLastSavedReportFolder:function(e){if(window.localStorage)try{window.localStorage.setItem("lastSavedReportFolder",e)}catch(e){window.console&&console.log(e)}},createAdhocSaveDialog:function(){var e=this;savePanel=new JRS.SaveAsDialog({templateMatcher:"#saveDataViewAndReport",inputMatchers:{dataViewName:".dataViewName",dataViewDescription:".dataViewDescription",reportName:".reportName",reportDescription:".reportDescription"},organizationId:window.organizationId,publicFolderUri:window.publicFolderUri,prepareState:function(e){savePanel.generatorSelect&&"TEMPLATE"===savePanel.generatorSelect.state&&(e.params.reportTemplate=savePanel.generatorSelect.val())},validator:function(r){var t=!0;return r.params.forDataView&&(t=t&&e.validateSaveNamePresent(r.dataViewName,"dataView")&&e.validateDescription(r.dataViewDescription,"dataView"),t=t&&e.validateSaveFolder(r,"dataView")),r.params.forReport&&(t=t&&e.validateSaveNamePresent(r.reportName,"report")&&e.validateDescription(r.reportDescription,"report"),r.reportName!=r.dataViewName||!r.params.forDataView&&r.folder!=window.saveFolder||(alert(window.designerMessages.datasourceOverwrite),t=!1),t=t&&e.validateSaveReportFolder(r,"report")),savePanel.generatorSelect&&"TEMPLATE"===savePanel.generatorSelect.state&&(t=t&&e.validateTemplate(r,"templateNotSelected")),t},saveHandler:function(r){var t=!r.params.forDataView||window.saveLabel===r.dataViewName&&window.saveFolder===r.folder,a={dataViewOverwriteOk:t};if(r.params.forReport&&(a.reportName=r.reportName,a.reportDescription=r.reportDescription,a.dataViewFolder=r.folder,a.reportFolder=r.reportFolder,designerBase.setLastSavedReportFolder(r.reportFolder),savePanel.generatorSelect)){var o=savePanel.generatorSelect.val();"TEMPLATE"===savePanel.generatorSelect.state&&(a.reportTemplate=o,e.generatorConfig({template:o})),"GENERATOR"===savePanel.generatorSelect.state&&(a.reportGenerator={id:o},e.generatorConfig({generator:o}))}var n;return n=r.params.forDataView?e.saveAdHoc(r.folder,r.dataViewName,r.dataViewDescription,!1,a):e.saveAdHoc(null,null,null,!1,a),r.params.forDataView?n.then(function(){window.saveLabel=r.dataViewName,window.saveDesc=r.dataViewDescription,window.saveFolder=r.folder}):n}}),savePanel.generatorSelect=new JRS.generatorSelect({id:"adHocGeneratorSelect",parent:savePanel.dialogElement.get(0),reportGenerators:window.localContext.state.reportGenerators})},createDashboardSaveDialog:function(){var e=this;savePanel=new JRS.SaveAsDialog({templateMatcher:"#saveAs",foldersTreeMatcher:"#saveAsFoldersTree",okButtonMatcher:"#saveAsBtnSave",cancelButtonMatcher:"#saveAsBtnCancel",inputMatchers:{resourceName:"#saveAsInputName",resourceDescription:"#saveAsInputDescription"},organizationId:window.organizationId,publicFolderUri:window.publicFolderUri,validator:function(r){return e.validateSaveNamePresent(r.resourceName,"dashboard")&&e.validateDescription(r.resourceDescription,"dashboard")&&e.validateSaveFolder(r,"dashboard")},saveHandler:function(r){var t=window.saveLabel===r.resourceName&&window.saveFolder===r.folder;return e.save(r.folder,r.resourceName,r.resourceDescription,t).then(function(){window.saveLabel=r.resourceName,window.saveDesc=r.resourceDescription,window.saveFolder=r.folder})}})},_showAdhocSavePanel:function(e){var r=this,t=window.saveLabel||window.defaultSaveName,a={dataViewName:t,dataViewDescription:window.saveDesc,reportName:t+" "+window.defaultReportSuffix,reportTemplate:e.reportTemplate,reportGenerators:e.reportGenerators,reportDescription:"",params:e};if(e.forDataView&&(_.isEmpty(window.saveFolder)?a.folder="/":(a.folder=jQuery("<textarea></textarea>").html(window.saveFolder).text(),a.folder=a.folder.replace(/[^\w+\d+\/]/g,"_"))),e.forReport){var o=a.folder||window.saveFolder||"/";a.reportFolder=designerBase.getLastSavedReportFolder()||o}savePanel.open(a).then(function(){void 0!==window.adhocDesigner&&window.adhocDesigner.initPreventBrowserSelection(savePanel.foldersTree[0]);var t=r.generatorConfig();t&&(t.template?savePanel.generatorSelect.val(t.template,"TEMPLATE"):t.generator&&savePanel.generatorSelect.val(t.generator,"GENERATOR")),e.forDataView?savePanel.dialogElement.find(".dataViewName").focus().select():e.forReport&&savePanel.dialogElement.find(".reportName").focus().select()})},launchSaveAdhocDialog:function(e){void 0===e&&(e={forDataView:!0,forReport:!1}),savePanel||this.createAdhocSaveDialog(),function(e,r){r.forDataView?(e.dialogElement.addClass("forDataView"),e.dialogElement.find(".forDataView").removeClass("hidden")):(e.dialogElement.removeClass("forDataView"),e.dialogElement.find(".forDataView").addClass("hidden")),r.forReport?(e.dialogElement.addClass("forReport"),e.dialogElement.find(".forReport").removeClass("hidden")):(e.dialogElement.removeClass("forReport"),e.dialogElement.find(".forReport").addClass("hidden")),r.forDataView&&!r.forReport?(e.dialogElement.find(".forDataViewOnly").removeClass("hidden"),savePanel.generatorSelect.hide()):(e.dialogElement.find(".forDataViewOnly").addClass("hidden"),savePanel.generatorSelect.show()),0===window.localContext.state.reportGenerators.length&&e.dialogElement.addClass(layoutModule.NO_GENERATORS_CLASS)}(savePanel,e),window.adhocDesigner.filtersController.hasNotAppliedFilters()?window.adhocDesigner.showSaveConfirmationDialog(function(){designerBase._showAdhocSavePanel(e)}):designerBase._showAdhocSavePanel(e)},launchSaveDashboardDialog:function(){savePanel||this.createDashboardSaveDialog();var e={resourceName:window.saveLabel||window.defaultSaveName,resourceDescription:window.saveDesc,folder:window.saveFolder&&window.saveFolder.length>0?window.saveFolder:"/"};savePanel.open(e).then(function(){savePanel.dialogElement.find("#saveAsInputName").focus().select()})},launchSaveDialog:function(e){window.localContext.getMode()==designerBase.DASHBOARD?this.launchSaveDashboardDialog():this.launchSaveAdhocDialog(e),designerBase.enableSelection()},launchDependenciesDialog:function(e,r){var t=jQuery.Deferred();return dialogs.dependentResources.show(e.dependentResources,{dependenciesBtnSave:function(){t.resolve()},dependenciesBtnSaveAs:function(){t.reject();var e=null!=r.addOns&&null!=r.addOns.reportName;designerBase.launchSaveDialog({forDataView:!0,forReport:e})},dependenciesBtnCancel:function(){t.reject()}},{canSave:!0,okOnly:"FORBID"==e.result||"WARN"==e.result,topMessage:e.topMessage,bottomMessage:e.bottomMessage}),t},selectSaveDirectory:function(){saveAsTree.openAndSelectNode(window.saveFolder)},okSaveDialog:function(){saveOldLabel="",saveOldFolder="",designerBase.hideSaveDialog(),this._saveConfirmMessage()},validateSaveNamePresent:function(e,r){return!e||e.blank()?(alert(window.designerMessages.emptyName[r]),!1):!(e.length>this.LABEL_MAX_LEN)||(alert(window.designerMessages.saveLabelError[r].replace("{0}",this.LABEL_MAX_LEN)),!1)},validateDescription:function(e,r){return!(e&&!e.blank())||(!(e.length>this.DESC_MAX_LEN)||(alert(window.designerMessages.saveDescriptionError[r].replace("{0}",this.DESC_MAX_LEN)),!1))},validateSaveFolder:function(e,r){if(null==e.folder)return alert(window.designerMessages.nonSelectedFolder[r]),!1;if(!e.isFolderWritable){var t=window.designerMessages.selectedFolderIsNotWritable[r];return alert(t.replace("{0}",e.folder)),!1}return!0},validateSaveReportFolder:function(e,r){if(null==e.reportFolder)return alert(window.designerMessages.nonSelectedFolder[r]),!1;if(!e.isReportFolderWritable){var t=window.designerMessages.selectedFolderIsNotWritable[r];return alert(t.replace("{0}",e.folder)),!1}return!0},validateTemplate:function(e,r){return!_.isEmpty(e.params.reportTemplate)||(alert(window.designerMessages[r]),!1)},launchJSOverwriteConfirm:function(e){confirm(e)?this.overwriteConfirmed():window.saveLabel=null},overwriteConfirmed:function(){this.save(window.saveFolder,window.saveLabel,window.saveDesc,!0)},updateSessionWarning:function(e){if(TIMEOUT_INTERVAL>0&&!delayBeforeSessionTimeoutWarning){var r=TIMEOUT_INTERVAL-MILL_PER_MIN*MIN_WARN_BEFORE_TIMEOUT;delayBeforeSessionTimeoutWarning=r>0?r:MILL_PER_MIN/2}delayBeforeSessionTimeoutWarning&&(window.clearTimeout(timeoutValue),timeoutValue=window.setTimeout(function(){return designerBase.showExpirationDialog()},delayBeforeSessionTimeoutWarning))},showExpirationDialog:function(){var e=!1;(e=window.localContext.getMode()!==this.DASHBOARD?confirm(ADHOC_SESSION_TIMEOUT_MESSAGE+getSessionExpireTime()):confirm(DASHBOARD_SESSION_TIMEOUT_MESSAGE+getSessionExpireTime()))&&(window.localContext.getMode()!==designerBase.DASHBOARD?window.adhocDesigner.tryToKeepServerAlive():window.localContext.tryToKeepServerAlive())},initAdhocSpecificDesignerBaseVar:function(){TIMEOUT_INTERVAL=1e3*window.serverTimeoutInterval,ADHOC_SESSION_TIMEOUT_MESSAGE=window.adHocSessionExpireCode,window.ADHOC_EXIT_MESSAGE=window.adHocExitConfirmation},confirmAndLeave:function(){return window.localContext.getMode()===designerBase.DASHBOARD?confirm(DASHBOARD_EXIT_MESSAGE):!window.localContext.state.canUndo||!window.localContext.state.isWritable||confirm(window.ADHOC_EXIT_MESSAGE)},generatorConfig:function(e){var r=window.localStorage;if(r&&r.getItem("reportGenerator")){var t=JSON.parse(r.reportGenerator);if(!e)return t;var a=t.sourceURI?{sourceURI:t.sourceURI}:{};t=jQuery.extend({},a,e),r.setItem("reportGenerator",JSON.stringify(t))}return null},sendAjaxActionRequest:function(e,r,t){var a=this.getFilterDialogFlowURL(e,t);ajaxTargettedUpdate(a,{fillLocation:"ajaxbuffer",callback:r,errorHandler:errorHandler,postData:t})},sendSelectiveAjaxActionRequest:function(e,r,t){var a=this.getFilterDialogFlowURL(e,t);ajaxTargettedUpdate(a,{fillLocation:"ajaxbuffer",callback:r,errorHandler:errorHandler,postData:t,mode:AjaxRequester.prototype.CUMULATIVE_UPDATE})},getFilterDialogFlowURL:function(e,r){var t=window.urlContext+"/flow.html?_flowId=adhocAjaxFilterDialogFlow";if(null!=e)for(var a=0;a<e.length;a++)t+="&"+e[a];return t=t+"&clientKey="+window.clientKey},sendRequestToAjaxBuffer:function(e,r,t){this.sendRequest(e,r,t,{target:"ajaxbuffer",mode:AjaxRequester.prototype.TARGETTED_REPLACE_UPDATE})},encodeParam:function(e){return _.isArray(e)?_.map(e,encodeURIComponent):encodeURIComponent(null!=e?e:"")},sendRequest:function sendRequest(action,otherParams,postFillAction,options,customErrorHandler){var bPost=options&&options.bPost,target=options&&options.target;target=target||(isSupportsTouch()?$("mainTableContainer").down().identify():"mainTableContainer");var mode=options&&options.mode||AjaxRequester.prototype.EVAL_JSON,container=options&&options.container,hideLoader=options&&options.hideLoader,actionPrefix=getTextBeforeUnderscore(action),javaAction=getTextAfterUnderscore(action),thisURL=window.urlContext+controllerMap[actionPrefix],params="action="+javaAction;if(!_.isEmpty(otherParams))if(_.isArray(otherParams))params+="&"+_.compact(otherParams).join("&");else if(_.isObject(otherParams)){var cleanedParams=_.reduce(otherParams,function(e,r,t){return isNotNullORUndefined(r)&&(e[t]=r),e},{});params+="&"+jQuery.param(cleanedParams)}params+="&clientKey="+window.clientKey,bPost||(thisURL+="?"+params,params=null),window.localContext.getMode()!==this.DASHBOARD&&null==postFillAction&&(postFillAction=window.adhocDesigner.updateStateAndRender);var internalErrorHandler=function(e){var r=errorHandler(e);return r&&customErrorHandler&&customErrorHandler(e),r};isIPad()&&"ta_fetchMoreRows"!=action&&designerBase.updateMainOverlay(""),void 0!==window.adhocDesigner&&(actionModel&&actionModel.hideMenu(),window.adhocDesigner&&window.adhocDesigner.unSelectAvailableTreeNodes());var delayedFn=function(updateURL,ajaxResponseTarget,postResponseCallback,params){return function(){var callbackWrapper=function callbackWrapper(){clearTimeout(window.cancelQueryTimer),window.cancelQueryTimer=null,designerBase.updateMainOverlay("hidden"),postResponseCallback&&("string"==typeof postResponseCallback?eval(postResponseCallback):postResponseCallback.apply(null,arguments))};return target==designerBase.CLOBBER?ajaxClobberredUpdate(updateURL,{callback:callbackWrapper,errorHandler:internalErrorHandler,postData:params}):ajaxTargettedUpdate(updateURL,{fillLocation:ajaxResponseTarget,fromLocation:container,callback:callbackWrapper,errorHandler:internalErrorHandler,postData:params,mode:mode,hideLoader:hideLoader})}}(thisURL,target,postFillAction,params);setTimeout(delayedFn,0)},sendNonReturningRequest:function(e,r,t,a){var o=getTextBeforeUnderscore(e),n=getTextAfterUnderscore(e),i=window.urlContext+controllerMap[o]+"?action="+n;if(r)for(var s=0;s<r.length;s++)i+="&"+r[s];i+="&clientKey="+window.clientKey,ajaxNonReturningUpdate(i,{callback:t,errorHandler:errorHandler})},redirectToHomePage:function(){document.location="flow.html?_flowId=homeFlow"},save:function(e,r,t,a,o){return window.localContext.getMode()===designerBase.DASHBOARD?window.localContext.saveDashboard(e,r,t,a):designerBase.saveAdHocWithNotAppliedFiltersCheck(e,r,t,a,o)},saveAdHocWithNotAppliedFiltersCheck:function(e,r,t,a,o){if(!window.adhocDesigner.filtersController.hasNotAppliedFilters())return this.saveAdHoc(e,r,t,a,o);window.adhocDesigner.showSaveConfirmationDialog(_.bind(function(){return this.saveAdHoc(e,r,t,a,o)},this))},saveAdHoc:function(e,r,t,a,o){return this.checkSave(e,r,t,a,o).then(function(){return designerBase.doSave(e,r,t,a,o)})},createOverwriteHanlder:function(e,r){var t=this;return function(a){var o=a.getResponseHeader("fileExistsException");if(!o)return void e.reject(a);o=decodeURIComponent(o),confirm(o.replace(/@@/g," "))?t.doSave.apply(t,r).then(function(){e.resolve()},function(r){e.reject(r)}):e.reject()}},doSave:function(e,r,t,a,o){var n=jQuery.Deferred();window.adhocDesigner&&jQuery("#designer").trigger("report_name_update",[r]);var i=function(e){window.localContext.standardOpCallback&&window.localContext.standardOpCallback(e),this._saveConfirmMessage(),n.resolve()}.bind(designerBase),s=designerBase.createOverwriteHanlder(n,[e,r,t,!0,o]),l=new Array("allOverwrite="+a);if(null!=r&&(l.push("aruLabel="+encodeText(r)),l.push("aruDesc="+encodeText(t)),l.push("aruFolder="+encodeText(e))),void 0!==o&&(l.push("aruOverwrite="+o.dataViewOverwriteOk),void 0!==o.reportName&&(l.push("reportLabel="+encodeText(o.reportName)),l.push("reportDesc="+encodeText(o.reportDescription)),l.push("reportFolder="+encodeText(o.reportFolder)),o.reportTemplate&&l.push("reportTemplate="+encodeText(o.reportTemplate)),o.reportGenerator))){var d=Object.toJSON(o.reportGenerator);l.push("reportGenerator="+encodeText(d))}return this.sendRequest(designerBase.getControllerPrefix()+"_save",l,i,null,s),n},checkSave:function(e,r,t,a,o){var n=this,i=jQuery.Deferred(),s=function(s){s.topMessage?n.launchDependenciesDialog(s,{folder:e,name:r,desc:t,overwrite:a,addOns:o}).then(function(){i.resolve()},function(){i.reject()}):i.resolve()}.bind(designerBase),l=new Array("aruFolder="+encodeText(e),"aruLabel="+encodeText(r));return o&&o.reportName&&(l.push("reportFolder="+encodeText(o.reportFolder)),l.push("reportLabel="+encodeText(o.reportName))),this.sendRequest("co_checkSave",l,s,null),i},_saveConfirmMessage:function(){dialogs.systemConfirm.show(window.saveConfirmation,5e3)},createDomObject:function(e,r){if(e)return Builder.node(e,{className:r});throw"Please provide a valid tag"},getContentDimensions:function(e){var e=$A(e),r=e.collect(function(e){var r=e.getDimensions(),t=e.positionedOffset();return{width:r.width+t[0],height:r.height+t[1]}});return{width:r.collect(function(e){return e.width}).max(),height:r.collect(function(e){return e.height}).max()}},updateIFrameScrolls:function(){},updateMainOverlay:function(e){var r=document.getElementById("mainTableContainerOverlay");r&&(r.className=e)}};window.designerBase=designerBase,module.exports=designerBase});