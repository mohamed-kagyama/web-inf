/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","underscore","runtime_dependencies/js-sdk/src/jrs.configs","bundle!all","../enum/collectorStatusEnum","runtime_dependencies/js-sdk/src/common/model/BaseModel","runtime_dependencies/js-sdk/src/common/extension/backboneValidationExtension","settings!globalConfiguration"],function(e,t,o){var s=e("underscore"),n=e("runtime_dependencies/js-sdk/src/jrs.configs"),r=e("bundle!all"),i=e("../enum/collectorStatusEnum"),a=e("runtime_dependencies/js-sdk/src/common/model/BaseModel"),u=e("runtime_dependencies/js-sdk/src/common/extension/backboneValidationExtension"),l=e("settings!globalConfiguration"),c=l.resourceIdNotSupportedSymbols.slice(1,l.resourceIdNotSupportedSymbols.length-1),d=a.extend({urlRoot:n.contextPath+"/rest_v2/diagnostic/collectors/",defaults:{id:null,name:"",status:"",verbosity:"LOW",filterBy:{userId:"",resource:{uri:"",includeDataSnapshot:!1}}},validation:{name:[{required:!0,msg:r["logCollectors.form.validation.specifyCollectorName"]},{maxLength:30,msg:r["logCollectors.form.validation.too.long.name"]},{doesNotContainSymbols:c,msg:r["logCollectors.form.validation.invalid.chars.name"]}],resourceUri:function(e,t,o){if(!0===o.includeDataSnapshot&&!e)return r["logCollectors.form.validation.specifyResourceUri"]}},constructor:function(e,t){a.prototype.constructor.apply(this,arguments)},initialize:function(e,t){this.options=t},parse:function(e){return e.userId=e.filterBy.userId||"",e.resourceUri="",e.filterBy.resource&&(e.resourceUri=e.filterBy.resource.uri||""),e.name=e.name||e.id,e.includeDataSnapshot=!1,e.filterBy.resource&&(e.includeDataSnapshot=!0===e.filterBy.resource.includeDataSnapshot||"true"===e.filterBy.resource.includeDataSnapshot),delete e.filterBy,e},toJSON:function(){var e=s.cloneDeep(this.attributes);return e.filterBy={userId:e.userId,resource:{uri:e.resourceUri,includeDataSnapshot:!0===e.includeDataSnapshot?"true":"false"}},this.isNew()&&(delete e.id,delete e.status),delete e.userId,delete e.resourceUri,delete e.includeDataSnapshot,e},sendStopSignal:function(){if(this.isInRunningMode()){var e=this.get("status");this.set({status:i.STOPPED},{silent:!0});var t=this.save();return this.set({status:e},{silent:!0}),t}},isInRunningMode:function(){return this.get("status").toLowerCase()===i.RUNNING.toLowerCase()},isInShuttingDownMode:function(){return this.get("status").toLowerCase()===i.SHUTTING_DOWN.toLowerCase()},isInStoppedMode:function(){return this.get("status").toLowerCase()===i.STOPPED.toLowerCase()}});s.extend(d.prototype,u.mixin),o.exports=d});