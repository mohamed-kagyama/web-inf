/*
 * Copyright (C) 2005 - 2020 TIBCO Software Inc. All rights reserved. Confidentiality & Proprietary.
 * Licensed pursuant to commercial TIBCO End User License Agreement.
 */

define(["require","exports","module","prototype","runtime_dependencies/jrs-ui/src/core/core.layout","runtime_dependencies/jrs-ui/src/components/components.webHelp","runtime_dependencies/jrs-ui/src/util/utils.common","runtime_dependencies/jrs-ui/src/core/core.events.bis","runtime_dependencies/jrs-ui/src/components/components.dialogs","runtime_dependencies/jrs-ui/src/administer/administer.base","jquery"],function(e,t,i){var n=e("prototype"),r=n.$,s=n.$$,o=e("runtime_dependencies/jrs-ui/src/core/core.layout"),a=e("runtime_dependencies/jrs-ui/src/components/components.webHelp"),l=e("runtime_dependencies/jrs-ui/src/util/utils.common"),c=l.centerElement,d=l.matchAny,u=e("runtime_dependencies/jrs-ui/src/core/core.events.bis"),m=e("runtime_dependencies/jrs-ui/src/components/components.dialogs"),_=e("runtime_dependencies/jrs-ui/src/administer/administer.base"),p=e("jquery"),C={DS_CONTAINER:"dsContainer",BUTTON_CLOSE:"#detail #close",BUTTON_CLEAR_ALL_CACHE:"clearAllCache",Q_ITEM_PFX:"qItem_",SORTING_FORM:"changeSortType",SORTING_SELECT_ITEMS:"#sortMode .tab",initialize:function(){if(o.resizeOnClient("serverSettingsMenu","settings"),a.setCurrentContext("admin"),!r(this.DS_CONTAINER)){var e=r("nothingToDisplay");e.removeClassName(o.HIDDEN_CLASS),c(e,{horz:!0,vert:!0}),p(document.body).addClass(o.NOTHING_TO_DISPLAY_CLASS)}r("display").observe("click",function(e){var t=e.element(),i=d(t,[o.BUTTON_PATTERN],!0);if(i){for(var n in _.menuActions)if(i.match(n)&&!i.up("li").hasClassName("selected"))return void(document.location=_.menuActions[n]());if(i.match("button#"+C.BUTTON_CLEAR_ALL_CACHE)&&(e.stop(),C._clearAll()),i.match("div.five > button"))return void C._clearQuery(i)}if(t.match("a")&&d(t,["div.two"],!0))return void C._getDetails(t)}),document.body.appendChild(r("detail")),s(C.BUTTON_CLOSE)[0].observe("click",function(e){e.stop(),m.popup.hide(r("detail"))});var t=r(C.SORTING_FORM),i=t.sort.value;s(C.SORTING_SELECT_ITEMS).each(function(e){i&&r(e)[i===e.id?"addClassName":"removeClassName"]("selected"),r(e).observe("click",function(e){return function(){t.sort.setAttribute("value",e),t.submit()}}(e.id))})},_getDetails:function(e){var t="flow.html?_flowExecutionKey="+_.flowExecutionKey+"&_eventId=isServerAvailable";_._sendRequest(t,null,function(t){if(t.data&&"Yes"==t.data.strip()){var i="id="+e.readAttribute("name"),n="flow.html?_flowExecutionKey="+_.flowExecutionKey+"&_eventId=getDetails";_._sendRequest(n,i,C._getDetailsCallback)}})},_clearQuery:function(e){var t="id="+e.name,i="flow.html?_flowExecutionKey="+_.flowExecutionKey+"&_eventId=clearQuery";_._sendRequest(i,t,C._clearCallback)},_clearAll:function(){var e="flow.html?_flowExecutionKey="+_.flowExecutionKey+"&_eventId=clearAll";_._sendRequest(e,null,C._clearCallback)},_getDetailsCallback:function(e){var t=r("detail");r("detAge").update(e.age),r("detQuery").update(e.query.replace(new RegExp("\n","g"),"<br/>")),r("detDataSourceURI").update(e.datasourceURI),r("detParameters").update(e.params),r("detTime").update(e.idle),r("detRows").update(e.rows),r("detQueryTime").update(e.queryTime),r("detFetchTime").update(e.fetchTime),m.popup.show(t)},_clearCallback:function(e){if(r("detail").hide(),e.empty){var t=r("nothingToDisplay");t.removeClassName(o.HIDDEN_CLASS),c(t,{horz:!0,vert:!0}),p(document.body).addClass(o.NOTHING_TO_DISPLAY_CLASS),C._disableClearAll()}else e.id&&r(C.Q_ITEM_PFX+e.id).remove();m.systemConfirm.show(_.getMessage(e.result))},_disableClearAll:function(e){u.disable(r(C.BUTTON_CLEAR_ALL_CACHE))}};void 0===e&&document.observe("dom:loaded",C.initialize.bind(C)),i.exports=C});